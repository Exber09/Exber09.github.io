{"themeConfig":{"themeName":"gridea-theme-expert-next","postPageSize":10,"archivesPageSize":50,"siteName":"Exber's Blog","siteDescription":"Exber's Blog","footerInfo":"Powered by <a href=\"https://github.com/getgridea/gridea\" target=\"_blank\">Gridea</a>","showFeatureImage":true,"domain":"https://Rebxe.github.io","postUrlFormat":"SLUG","tagUrlFormat":"SHORT_ID","dateFormat":"YYYY-MM-DD","feedFullText":false,"feedCount":10,"archivesPath":"archives","postPath":"post","tagPath":"tag"},"posts":[{"abstract":"<blockquote>\n<p>给定一个长 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的字符串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 和两个权值数组 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a,b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>。</p>\n<p>定义 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>g</mi><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></msubsup><mo>[</mo><msub><mi>s</mi><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>i</mi><mo>−</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo>]</mo></mrow></msub><mo>=</mo><msub><mi>s</mi><mrow><mo>[</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>i</mi><mo>]</mo></mrow></msub><mo>]</mo><mo>×</mo><msub><mi>a</mi><mi>j</mi></msub><mo>×</mo><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">g_i=\\sum\\limits_{j=1}^i [s_{[1,i-j+1]}=s_{[j,i]}]\\times a_j\\times b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.625446em;vertical-align:-1.113777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5116690000000004em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.113777em;\"><span></span></span></span></span></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1052em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8694379999999999em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>定义 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>n</mi><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></msubsup><msub><mi>g</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">ans_i=\\sum\\limits_{j=1}^i g_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">n</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.625446em;vertical-align:-1.113777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5116690000000004em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.113777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>，你需要求出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>n</mi><msub><mi>s</mi><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">ans_{[1,n]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">n</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>强制在线，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mo>(</mo><msubsup><mi>s</mi><mi>i</mi><mo mathvariant=\"normal\">′</mo></msubsup><mo>+</mo><mi>a</mi><mi>n</mi><msub><mi>s</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>⊕</mo><mn>31</mn></mrow><annotation encoding=\"application/x-tex\">s_i=(s&#x27;_i+ans_{i-1})\\oplus 31</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.010556em;vertical-align:-0.258664em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-2.441336em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.258664em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">n</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">1</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le a_i,b_i\\le 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个长 nnn 的字符串 sss 和两个权值数组 a,ba,ba,b。 定义 gi=∑j=1i[s[1,i−j+1]=s[j,i]]×aj×big_i=\\sum\\limits_{j=1}^i [s_{[1,i-j+1]}=s_{[j,i]}]\\times a_j\\times b_igi​=j=1∑i​[s[1,i−j+1]​=s[j,i]​]×aj​×bi​。 定义 ansi=∑j=1igjans_i=\\sum\\limits_{j=1}^i g_jansi​=j=1∑i​gj​，你需要求出 ans[1,n]ans_{[1,n]}ans[1,n]​。 强制在线，si=(si′+ansi−1)⊕31s_i=(s&#x27;_i+ans_{i-1})\\oplus 31si​=(si′​+ansi−1​)⊕31。 1≤n≤1061\\le n\\le 10^61≤n≤106，1≤ai,bi≤1031\\le a_i,b_i\\le 10^31≤ai​,bi​≤103。 讲一下等差数列做法。 只需要每次算出 iii 的所有 border 的左端点的 aaa 的和即可。 找等差数列是简单的，对于一个长度为 nnn 的串 SSS，假设 S[1,n]S_{[1,n]}S[1,n]​ 也是其 border。 设 fif_ifi​ 为 S[1,i]S_{[1,i]}S[1,i]​ 的 border，d=n−fnd=n-f_nd=n−fn​，则 S[1,n],S[1+d,n],S[1+2d,n]…S[1+ld,n]S_{[1,n]},S_{[1+d,n]},S_{[1+2d,n]}\\dots S_{[1+ld,n]}S[1,n]​,S[1+d,n]​,S[1+2d,n]​…S[1+ld,n]​ 都是 SSS 的 border，其中 l=⌊nd⌋−1l=\\lfloor\\frac{n}{d}\\rfloor-1l=⌊dn​⌋−1。这样就能找到 S[1,n]S_{[1,n]}S[1,n]​ 所在的等差数列，递归寻找 S[n−fn−ld+1,n]S_{[n-f_{n-ld}+1,n]}S[n−fn−ld​+1,n]​ 所在的等差数列即可，这样每次长度至少减半。 赛时太困了，并没有想到怎么维护等差数列的和。实际上，对于 l=0l\\not=0l​=0 的情况，有 fn=fn−d+df_{n}=f_{n-d}+dfn​=fn−d​+d，即 border 可以同时往里缩一个周期，那么不妨开一个哈希表 gj,dg_{j,d}gj,d​ 维护 jjj，公差为 ddd 的在 [1,i][1,i][1,i] 中的等差数列的和，即 aj+aj+d+aj+2d+…a_{j}+a_{j+d}+a_{j+2d}+\\dotsaj​+aj+d​+aj+2d​+…。这样每次找到一个等差数列的时候前面 l−1l-1l−1 项一定都算好了，只需要另外开一个长度哈希表判断第 lll 项有没有算即可。 时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)，哈希表用 map 会变成 O(nlog⁡2n)O(n\\log ^2 n)O(nlog2n)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;map&gt; using namespace std; template&lt;typename T&gt; inline void read(T &amp;x) { x=0; T w=1; char c=getchar(); while(c&lt;'0'||c&gt;'9') w=(c=='-'?-w:w),c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); x*=w; } typedef long long ll; const int S=1000005; int n,t,a[S],b[S],s[S]; int f[S]; map&lt;int,int&gt; sm[S],le[S]; int main() { freopen(&quot;str.in&quot;,&quot;r&quot;,stdin); freopen(&quot;str.out&quot;,&quot;w&quot;,stdout); read(n),read(t); for(int i=1;i&lt;=n;i++) read(a[i]); for(int i=1;i&lt;=n;i++) read(b[i]); for(int i=1;i&lt;=n;i++) read(s[i]); f[1]=0; ll ans=b[1]*a[1]; printf(&quot;%lld\\n&quot;,ans); for(int i=2,j=0;i&lt;=n;i++) { s[i]=(s[i]+t*ans)&amp;31; while(j!=0&amp;&amp;s[j+1]!=s[i]) j=f[j]; if(s[j+1]==s[i]) j++; f[i]=j; int len=i,sma=0; while(len&gt;0) { int k=f[len]; int d=len-k,l=len/d-1; int p=i-len+1; // p,p+d,p+2d,...,p+ld // printf(&quot;&gt;&gt; %d %d: %d %d %d\\n&quot;,i,len,p,d,l); if(le[p].count(d)==0) sm[p][d]=a[p]; if(le[p][d]&lt;l) { sm[p][d]+=a[p+l*d]; le[p][d]=l; } sma+=sm[p][d]; len=f[len-l*d]; } ans+=1ll*sma*b[i]; printf(&quot;%lld\\n&quot;,ans); } return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"字符串","slug":"wtMqnxQGh","used":true,"link":"https://Rebxe.github.io/tag/wtMqnxQGh/"}],"title":"【2024NOIP模拟赛73】字符串 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-mo-ni-sai-73-zi-fu-chuan-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":280000,"words":867,"minutes":5},"date":"2024-11-12 16:19:02","dateFormat":"2024-11-12"},{"abstract":"<blockquote>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点，每个点有权值 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 到点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 的有向边边权为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>max</mi><mo>⁡</mo><mo>(</mo><mn>0</mn><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>i</mi></msub><mo>−</mo><msub><mi>b</mi><mi>j</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\max(0,a_i-b_j)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，找到一条从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 出发，经过每个点恰好一次，最后回到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 的路径，使其最大边权最小。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le a_i,b_i\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有 nnn 个点，每个点有权值 aia_iai​ 和 bib_ibi​。 点 iii 到点 jjj 的有向边边权为 max⁡(0,ai−bj)\\max(0,a_i-b_j)max(0,ai​−bj​)，找到一条从 111 出发，经过每个点恰好一次，最后回到 111 的路径，使其最大边权最小。 1≤n≤1061\\le n\\le 10^61≤n≤106，0≤ai,bi≤1090\\le a_i,b_i\\le 10^90≤ai​,bi​≤109。 问题相当于每个点有一个入边 bib_ibi​ 和出边 aia_iai​，求最大边权最小的哈密顿回路。 考虑下界，忽略需要成环的条件，则肯定将 aaa 和 bbb 分别排序后按位置一一匹配，这样是最优的。 这样会形成若干个环，考虑调整匹配使得这些环合并成一个大环。调整匹配的操作一定形如选取一对 i,ji,ji,j，交换 bi,bjb_i,b_jbi​,bj​，将匹配从 (ai,bi),(aj,bj)(a_i,b_i),(a_j,b_j)(ai​,bi​),(aj​,bj​) 变为 (ai,bj),(aj,bi)(a_i,b_j),(a_j,b_i)(ai​,bj​),(aj​,bi​)，而这会合并相邻的两个环。注意到由于要求最大值最小，所以一定有 j=i+1j=i+1j=i+1，否则可以将 [i,j][i,j][i,j] 内的环依次合并，一定不劣。 那么类似最小生成树，将 nnn 对 (i,i+1)(i,i+1)(i,i+1) 产生的贡献放到一起排序，每次选贡献最小的交换即可。 代码如下（题面不太一样）： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; using namespace std; template&lt;typename T&gt; inline void read(T &amp;x) { char c=getchar(); x=0; T w=1; while(c&lt;'0'||c&gt;'9') w=(c=='-'?-w:w),c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); x*=w; } typedef long long ll; const int S=1000005,M=32767; int n,a[S],b[S]; pair&lt;int,int&gt; ta[S],tb[S]; int fa[S]; pair&lt;ll,pair&lt;int,int&gt; &gt; ed[S]; inline void getin(int a[]) { int x,y,z; read(a[1]),read(a[2]),read(x),read(y),read(z); for(int i=3;i&lt;=n;i++) a[i]=(a[i-1]*x%M+a[i-2]*y%M+z)%M; } int fnd(int x){return fa[x]==x?x:fa[x]=fnd(fa[x]);} int main() { freopen(&quot;road.in&quot;,&quot;r&quot;,stdin); freopen(&quot;road.out&quot;,&quot;w&quot;,stdout); read(n); getin(a),getin(b); for(int i=1;i&lt;=n;i++) { ta[i]=make_pair(a[i],i); tb[i]=make_pair(b[i],i); } sort(ta+1,ta+n+1); sort(tb+1,tb+n+1); for(int i=1;i&lt;=n;i++) fa[i]=i; ll ans=0; for(int i=1;i&lt;=n;i++) { int x=ta[i].second,y=tb[i].second; fa[fnd(x)]=fnd(y); ans=max(ans,1ll*a[x]*a[x]-1ll*b[y]*b[y]); } for(int i=1;i&lt;=n-1;i++) { int xi=ta[i].second,yi=tb[i].second; int xj=ta[i+1].second,yj=tb[i+1].second; ed[i]=make_pair(max( 1ll*a[xi]*a[xi]-1ll*b[yj]*b[yj], 1ll*a[xj]*a[xj]-1ll*b[yi]*b[yi]), make_pair(xi,yj)); } sort(ed+1,ed+n); for(int i=1;i&lt;=n-1;i++) { ll w=ed[i].first; int x=ed[i].second.first,y=ed[i].second.second; if(fnd(x)==fnd(y)) continue; ans=max(ans,w); fa[fnd(x)]=fnd(y); } printf(&quot;%lld\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2024NOIP模拟赛68】道路 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-mo-ni-sai-68-dao-lu-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":230000,"words":732,"minutes":4},"date":"2024-11-05 21:34:41","dateFormat":"2024-11-05"},{"abstract":"","content":" 前三题 1h 过了 T4 想了一会，发现一个人一定是在区间赢。那么建一个线段树，求出每个点什么时候擂主一定会赢即可，这个可以用位运算扫描线一个 log 预处理，然后就随便做了。 4e8 感觉很正确，4：44 写完了。 玩了一会小恐龙，又玩了一会冲浪。 太无聊回来检查，用 cmd 命令行编译过了所有大样例。 五点半突然发现 T4 大样例不是极限，测了个极限数据，发现跑 6s。 开始优化，循环展开没什么用，想了一会发现求答案的时候可以直接线段树 build 递推做到线性，预处理有个地方可以 break。 然后就跑了 1s，甚至还有两个瓶颈。 赛后大家都说 1 个 log 过不了，但是我觉得能过。 出分的时候改了三次时间，还好过了。 100+100+100+100100+100+100+100100+100+100+100，希望之后不要坠机。 ","tags":[{"name":2024,"slug":"qfvk1PejDh","used":true,"link":"https://Rebxe.github.io/tag/qfvk1PejDh/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"CSPS 2024 游记","feature":"","link":"https://Rebxe.github.io/post/csps-2024-you-ji/","stats":{"text":"1 min read","time":55000,"words":258,"minutes":1},"date":"2024-11-04 19:10:14","dateFormat":"2024-11-04"},{"abstract":"<blockquote>\n<p>有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，删除 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的代价为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，对于每个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi><mo>∈</mo><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">k\\in[1,n]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">]</span></span></span></span>，求使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 的 LIS（最长上升子序列）长度 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≤</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">\\le k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 的最小代价。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>500</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 500</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le b_i\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个 nnn 的排列 aaa，删除 aia_iai​ 的代价为 bib_ibi​，对于每个 k∈[1,n]k\\in[1,n]k∈[1,n]，求使得 aaa 的 LIS（最长上升子序列）长度 ≤k\\le k≤k 的最小代价。 1≤n≤5001\\le n\\le 5001≤n≤500，1≤bi≤1061\\le b_i\\le 10^61≤bi​≤106。 如果想到分层图那么就输了。 首先，最长链等于最小反链覆盖，所以 aaa 的 LIS 长度为 kkk 相当于至少需要 kkk 个不降子序列覆盖 aaa。 也就是说，若能用 kkk 个不降子序列覆盖 aaa，则 aaa 的 LIS 长度一定 ≤k\\le k≤k。 考虑先删除所有数，再加入代价和最大的数使得 aaa 的 LIS 长度 ≤k\\le k≤k。这相当于找到 ≤k\\le k≤k 个不降子序列使得它们不交且代价和最大。 那么考虑费用流，将 iii 拆为入点 xix_ixi​ 和出点 yiy_iyi​： 源点向 xix_ixi​ 连流量为 ∞\\infin∞，费用为 000 的边； xix_ixi​ 向 yiy_iyi​ 连流量为 111，费用为 −bi-b_i−bi​ 的边； yiy_iyi​ 向汇点连流量为 ∞\\infin∞，费用为 000 的边； 对于满足 i&lt;j,ai&gt;aji&lt;j,a_i&gt;a_ji&lt;j,ai​&gt;aj​ 的 i,ji,ji,j，从 yiy_iyi​ 向 xjx_jxj​ 连流量为 ∞\\infin∞，费用为 000 的边。 然后 kkk 的答案即为 ∑bi\\sum b_i∑bi​ 加上流量 ≤k\\le k≤k 的最小费用，这个可以通过建虚拟汇点，每次从虚拟汇点向汇点增加一条流量为 111，费用为 000 的边即可。 代码如下： #pragma GCC optimize(2) #pragma GCC optimize(3) #pragma GCC optimize(&quot;Ofast&quot;) #pragma GCC optimize(&quot;inline&quot;) #pragma GCC optimize(&quot;-fgcse&quot;) #pragma GCC optimize(&quot;-fgcse-lm&quot;) #pragma GCC optimize(&quot;-fipa-sra&quot;) #pragma GCC optimize(&quot;-ftree-pre&quot;) #pragma GCC optimize(&quot;-ftree-vrp&quot;) #pragma GCC optimize(&quot;-fpeephole2&quot;) #pragma GCC optimize(&quot;-ffast-math&quot;) #pragma GCC optimize(&quot;-fsched-spec&quot;) #pragma GCC optimize(&quot;unroll-loops&quot;) #pragma GCC optimize(&quot;-falign-jumps&quot;) #pragma GCC optimize(&quot;-falign-loops&quot;) #pragma GCC optimize(&quot;-falign-labels&quot;) #pragma GCC optimize(&quot;-fdevirtualize&quot;) #pragma GCC optimize(&quot;-fcaller-saves&quot;) #pragma GCC optimize(&quot;-fcrossjumping&quot;) #pragma GCC optimize(&quot;-fthread-jumps&quot;) #pragma GCC optimize(&quot;-funroll-loops&quot;) #pragma GCC optimize(&quot;-fwhole-program&quot;) #pragma GCC optimize(&quot;-freorder-blocks&quot;) #pragma GCC optimize(&quot;-fschedule-insns&quot;) #pragma GCC optimize(&quot;inline-functions&quot;) #pragma GCC optimize(&quot;-ftree-tail-merge&quot;) #pragma GCC optimize(&quot;-fschedule-insns2&quot;) #pragma GCC optimize(&quot;-fstrict-aliasing&quot;) #pragma GCC optimize(&quot;-fstrict-overflow&quot;) #pragma GCC optimize(&quot;-falign-functions&quot;) #pragma GCC optimize(&quot;-fcse-skip-blocks&quot;) #pragma GCC optimize(&quot;-fcse-follow-jumps&quot;) #pragma GCC optimize(&quot;-fsched-interblock&quot;) #pragma GCC optimize(&quot;-fpartial-inlining&quot;) #pragma GCC optimize(&quot;no-stack-protector&quot;) #pragma GCC optimize(&quot;-freorder-functions&quot;) #pragma GCC optimize(&quot;-findirect-inlining&quot;) #pragma GCC optimize(&quot;-fhoist-adjacent-loads&quot;) #pragma GCC optimize(&quot;-frerun-cse-after-loop&quot;) #pragma GCC optimize(&quot;inline-small-functions&quot;) #pragma GCC optimize(&quot;-finline-small-functions&quot;) #pragma GCC optimize(&quot;-ftree-switch-conversion&quot;) #pragma GCC optimize(&quot;-foptimize-sibling-calls&quot;) #pragma GCC optimize(&quot;-fexpensive-optimizations&quot;) #pragma GCC optimize(&quot;-funsafe-loop-optimizations&quot;) #pragma GCC optimize(&quot;inline-functions-called-once&quot;) #pragma GCC optimize(&quot;-fdelete-null-pointer-checks&quot;) #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;queue&gt; using namespace std; const int S=2005,MS=1000005; const int inf=1e9; int n,a[S],b[S]; int s,t; int esum,to[MS],nxt[MS],h[S]; int c[MS],cost[MS],dis[S]; int cur[S]; bool vis[S]; int mincost; inline void init() { esum=1; s=0,t=n*2+2; for(int i=s;i&lt;=t;i++) h[i]=0; } inline void added(int x,int y,int w,int v) { to[++esum]=y; c[esum]=w; cost[esum]=v; nxt[esum]=h[x]; h[x]=esum; } inline void add(int x,int y,int w,int v) { added(x,y,w,v),added(y,x,0,-v); } inline bool spfa() { for(int i=s;i&lt;=t;i++) { cur[i]=h[i]; dis[i]=inf; vis[i]=false; } queue&lt;int&gt; q; dis[s]=0; vis[s]=true; q.push(s); while(!q.empty()) { int u=q.front(); q.pop(); vis[u]=false; for(int i=h[u];i;i=nxt[i]) { int v=to[i],w=cost[i]; if(c[i]&gt;0&amp;&amp;dis[u]+w&lt;dis[v]) { dis[v]=dis[u]+w; if(!vis[v]) { vis[v]=true; q.push(v); } } } } return dis[t]&lt;inf; } int dfs(int u,int w) { if(u==t) return w; vis[u]=true; int sum=0; for(int &amp;i=cur[u];i;i=nxt[i]) { int v=to[i]; if(c[i]&gt;0&amp;&amp;dis[v]==dis[u]+cost[i]&amp;&amp;!vis[v]) { int re=dfs(v,min(w,c[i])); mincost+=re*cost[i]; c[i]-=re; c[i^1]+=re; w-=re; sum+=re; if(w==0) break; } } vis[u]=false; return sum; } inline int mcmf() { int res=0; mincost=0; while(spfa()) res+=dfs(s,inf); return res; } inline void slove() { cin&gt;&gt;n; for(int i=1;i&lt;=n;i++) cin&gt;&gt;a[i]; int sm=0; for(int i=1;i&lt;=n;i++) cin&gt;&gt;b[i],sm+=b[i]; init(); for(int i=1;i&lt;=n;i++) { add(s,i,inf,0); add(i,i+n,1,-b[i]); add(i+n,n*2+1,inf,0); } for(int i=1;i&lt;=n;i++) { for(int j=i+1;j&lt;=n;j++) { if(a[j]&gt;=a[i]) continue; add(i+n,j,inf,0); } } int ans=0; for(int i=1;i&lt;=n;i++) { add(n*2+1,t,1,0); mcmf(); ans+=mincost; cout&lt;&lt;sm+ans&lt;&lt;' '; } cout&lt;&lt;'\\n'; } int main() { ios::sync_with_stdio(false),cin.tie(0),cout.tie(0); int T; cin&gt;&gt;T; while(T--&gt;0) slove(); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"},{"name":"网络流","slug":"19EjLeSB_D","used":true,"link":"https://Rebxe.github.io/tag/19EjLeSB_D/"}],"title":"【2024NOIP集训娱乐赛6】LIS 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-ji-xun-yu-le-sai-6-lis-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":397000,"words":1185,"minutes":7},"date":"2024-10-24 20:33:28","dateFormat":"2024-10-24"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">n,x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，每次给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a,b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，求：</p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mi>a</mi></mrow><mrow><mi>n</mi><mo>−</mo><mi>b</mi></mrow></munderover><mrow><mo fence=\"true\">(</mo><mfrac linethickness=\"0px\"><mi>i</mi><mi>a</mi></mfrac><mo fence=\"true\">)</mo></mrow><msup><mi>x</mi><mrow><mi>i</mi><mo>−</mo><mi>a</mi></mrow></msup><mrow><mo fence=\"true\">(</mo><mfrac linethickness=\"0px\"><mrow><mi>n</mi><mo>−</mo><mi>i</mi></mrow><mi>b</mi></mfrac><mo fence=\"true\">)</mo></mrow><msup><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>−</mo><mi>b</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{i=a}^{n-b}\\binom{i}{a}x^{i-a}\\binom{n-i}{b}y^{n-i-b}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.1137820000000005em;vertical-align:-1.277669em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8361130000000003em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\">a</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.300005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3365199999999997em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span></span></span><span style=\"top:-3.6769999999999996em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.874664em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\">a</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3365200000000002em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8991079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\">b</span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>98244353</mn></mrow><annotation encoding=\"application/x-tex\">98244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo>&lt;</mo><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">1\\le x,y&lt;998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335400000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le q\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>≤</mo><mn>5000</mn></mrow><annotation encoding=\"application/x-tex\">1\\le a,b\\le 5000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">a+b\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 n,x,yn,x,yn,x,y，qqq 次询问，每次给定 a,ba,ba,b，求： ∑i=an−b(ia)xi−a(n−ib)yn−i−b\\sum\\limits_{i=a}^{n-b}\\binom{i}{a}x^{i-a}\\binom{n-i}{b}y^{n-i-b} i=a∑n−b​(ai​)xi−a(bn−i​)yn−i−b 对 982443539824435398244353 取模。 2≤n≤1092\\le n\\le 10^92≤n≤109，1≤x,y&lt;9982443531\\le x,y&lt;9982443531≤x,y&lt;998244353，1≤q≤2×1051\\le q\\le 2\\times 10^51≤q≤2×105，1≤a,b≤50001\\le a,b\\le 50001≤a,b≤5000，a+b≤na+b\\le na+b≤n。 组合意义： 对 n+1n+1n+1 个球染色（红/绿/白），中间有一个绿球； 绿球左边有恰好 aaa 个红球，绿球左边白球的贡献为 xxx； 绿球右边有恰好 bbb 个红球，绿球右边白球的贡献为 yyy； 那么考虑枚举最左边是什么颜色，有： F(n,a,b)={F(n−1,a−1,b)+xF(n−1,a,b)a&gt;0(nb)yn−b+xF(n−1,a,b)a=0F(n,a,b)=\\begin{cases}F(n-1,a-1,b)+xF(n-1,a,b)&amp;a&gt;0\\\\\\binom{n}{b}y^{n-b}+xF(n-1,a,b)&amp;a=0\\end{cases} F(n,a,b)={F(n−1,a−1,b)+xF(n−1,a,b)(bn​)yn−b+xF(n−1,a,b)​a&gt;0a=0​ 同理，枚举最右边是什么颜色，有： F(n,a,b)={F(n−1,a,b−1)+yF(n−1,a,b)b&gt;0(na)xn−a+yF(n−1,a,b)b=0F(n,a,b)=\\begin{cases}F(n-1,a,b-1)+yF(n-1,a,b)&amp;b&gt;0\\\\\\binom{n}{a}x^{n-a}+yF(n-1,a,b)&amp;b=0\\end{cases} F(n,a,b)={F(n−1,a,b−1)+yF(n−1,a,b)(an​)xn−a+yF(n−1,a,b)​b&gt;0b=0​ 考虑令 F(n,−1,b)=(n+1b)yn+1−bF(n,-1,b)=\\binom{n+1}{b}y^{n+1-b}F(n,−1,b)=(bn+1​)yn+1−b，F(n,a,−1)=(n+1a)xn+1−aF(n,a,-1)=\\binom{n+1}{a}x^{n+1-a}F(n,a,−1)=(an+1​)xn+1−a，则有： F(n,a,b)=F(n−1,a−1,b)+xF(n−1,a,b)=F(n−1,a,b−1)+yF(n−1,a,b)F(n,a,b)=F(n-1,a-1,b)+xF(n-1,a,b)=F(n-1,a,b-1)+yF(n-1,a,b) F(n,a,b)=F(n−1,a−1,b)+xF(n−1,a,b)=F(n−1,a,b−1)+yF(n−1,a,b) 那么： F(n,a,b)=F(n,a,b−1)−F(n,a−1,b)x−yF(n,a,b)=\\frac{F(n,a,b-1)-F(n,a-1,b)}{x-y} F(n,a,b)=x−yF(n,a,b−1)−F(n,a−1,b)​ 特别的，当 x=yx=yx=y 时，有 F(n,a,b)=(n+1a+b+1)xn−a−bF(n,a,b)=\\binom{n+1}{a+b+1}x^{n-a-b}F(n,a,b)=(a+b+1n+1​)xn−a−b。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; using namespace std; const int S=5005; #define p 998244353 inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } int n,x,y; int C[S*2+1],ans[S][S]; inline int F(int a,int b) { if(a&lt;0) return 1ll*C[b]*qpow(y,n+1-b)%p; if(b&lt;0) return 1ll*C[a]*qpow(x,n+1-a)%p; if(x==y) return 1ll*C[a+b+1]*qpow(x,n-a-b)%p; return ans[a][b]; } int main() { freopen(&quot;count.in&quot;,&quot;r&quot;,stdin); freopen(&quot;count.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d%d&quot;,&amp;n,&amp;x,&amp;y); C[0]=1; for(int i=1;i&lt;=S*2+1-3;i++) { C[i]=1ll*C[i-1]*qpow(i,p-2)%p*(n-i+2)%p; } if(x!=y) { int inv=qpow(x-y+p,p-2); for(int i=0;i&lt;=S-3;i++) { for(int j=0;j&lt;=S-3;j++) { ans[i][j]=1ll*(F(i,j-1)-F(i-1,j)+p)*inv%p; } } } int q; scanf(&quot;%d&quot;,&amp;q); while(q--&gt;0) { int a,b; scanf(&quot;%d%d&quot;,&amp;a,&amp;b); printf(&quot;%d\\n&quot;,F(a,b)); } return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2024NOIP模拟赛49】简单题 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-mo-ni-sai-49-jian-dan-ti-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":318000,"words":904,"minutes":6},"date":"2024-10-06 16:19:46","dateFormat":"2024-10-06"},{"abstract":"<blockquote>\n<p>有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条边的有向带边权图，还有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 条“禁止路径”。</p>\n<p>一条禁止路径是一个点的序列，若图上的一条路径<strong>连续地</strong>经过了序列中的点，则称该路径包含了这条禁止路径。</p>\n<p>一条从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的路径合法当且仅当其不包含任何禁止路径。</p>\n<p>求每条合法路径的边权和的最小值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>k</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m,k\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，保证所有禁止路径的长度和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，边权均非负。</p>\n</blockquote>\n","content":" 有一个 nnn 个点 mmm 条边的有向带边权图，还有 kkk 条“禁止路径”。 一条禁止路径是一个点的序列，若图上的一条路径连续地经过了序列中的点，则称该路径包含了这条禁止路径。 一条从 111 到 nnn 的路径合法当且仅当其不包含任何禁止路径。 求每条合法路径的边权和的最小值。 1≤n,m,k≤2×1051\\le n,m,k\\le 2\\times 10^51≤n,m,k≤2×105，保证所有禁止路径的长度和 ≤2×105\\le 2\\times 10^5≤2×105，边权均非负。 对于所有禁止路径建立 AC 自动机，不难发现 AC 自动机上的每个点末尾的那个点是固定的，所以可以把原图的边直接迁移到 AC 自动机上。 直接做很慢，但是考虑瓶颈： 建 AC 自动机：开主席树快速复制 to 即可； 在 AC 自动机上跑 dijkstra： 不妨在建 AC 自动机的时候顺带记录每个 to 的边权。 不难发现 dij 的时候每次更新相当于是遍历的主席树上的一个子树。 根据 dij 的性质，若主席树上一个点之前已经被访问过了，则无需再访问，所以直接给主席树每个点开个 vis 即可； 时间复杂度 O(nlog⁡2n)O(n\\log ^2n)O(nlog2n)（认为所有东西都和 nnn 同阶），代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; #include &lt;map&gt; #include &lt;queue&gt; using namespace std; template&lt;typename T&gt; inline void read(T &amp;x) { x=0; T w=1; char c=getchar(); while(c&lt;'0'||c&gt;'9') w=(c=='-'?-w:w),c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); x*=w; } typedef long long ll; const int S=200005,MS=S*3,TS=MS*20; const ll inf=1e17; int n,m,k,a[S]; map&lt;int,ll&gt; mp[S]; int cnt,ls[TS],rs[TS]; pair&lt;int,ll&gt; val[TS]; int tot,idx[MS]; map&lt;int,ll&gt; son[MS]; bool flg[MS]; int hed,til,que[MS],fail[MS],to[MS]; ll dis[MS]; bool vis[MS],del[TS]; priority_queue&lt;pair&lt;ll,int&gt; &gt; q; void upd(int &amp;u,int lst,int l,int r,int p,pair&lt;int,ll&gt; x) { u=++cnt; val[u]=val[lst],ls[u]=ls[lst],rs[u]=rs[lst]; if(l==r) return val[u]=x,void(); int mid=l+r&gt;&gt;1; if(p&lt;=mid) upd(ls[u],ls[lst],l,mid,p,x); else upd(rs[u],rs[lst],mid+1,r,p,x); } pair&lt;int,ll&gt; quet(int u,int l,int r,int p) { if(u==0) return make_pair(0,inf); if(l==r) return val[u]; int mid=l+r&gt;&gt;1; if(p&lt;=mid) return quet(ls[u],l,mid,p); else return quet(rs[u],mid+1,r,p); } inline void stx(int &amp;u,int p,pair&lt;int,ll&gt; x){upd(u,u,1,n,p,x);} inline pair&lt;int,ll&gt; qux(int u,int p){return quet(u,1,n,p);} inline void ins(int len,bool f) { int u=0; for(int i=1;i&lt;=len;i++) { if(!son[u].count(a[i])) { son[u][a[i]]=++tot; // printf(&quot;%d %d %d\\n&quot;,u,tot,a[i]); idx[tot]=a[i]; } u=son[u][a[i]]; } flg[u]=f; } inline ll getd(int x,int y) { if(!mp[x].count(y)) return inf; return mp[x][y]; } inline void build() { fail[0]=-1; hed=1,til=0; for(auto t:son[0]) { int v=t.second,id=idx[v]; fail[v]=0; flg[v]|=flg[fail[v]]; stx(to[0],id,make_pair(v,inf)); que[++til]=v; } while(hed&lt;=til) { int u=que[hed++]; to[u]=to[fail[u]]; for(auto t:son[u]) { int v=t.second,id=idx[v]; fail[v]=qux(to[fail[u]],id).first; flg[v]|=flg[fail[v]]; // printf(&quot;&gt;&gt; %d %d\\n&quot;,u,v); if(!flg[v]) { stx(to[u],id,make_pair(v,getd(idx[u],id))); } else { stx(to[u],id,make_pair(v,inf)); } que[++til]=v; } } } void dfs(int u,int l,int r,ll d) { if(u==0||del[u]) return; del[u]=true; if(l==r) { int v=val[u].first; ll w=val[u].second; if(d+w&lt;dis[v]) { dis[v]=d+w; q.emplace(-dis[v],v); } return; } int mid=l+r&gt;&gt;1; dfs(ls[u],l,mid,d),dfs(rs[u],mid+1,r,d); } int main() { freopen(&quot;path.in&quot;,&quot;r&quot;,stdin); freopen(&quot;path.out&quot;,&quot;w&quot;,stdout); read(n),read(m),read(k); for(int i=1;i&lt;=m;i++) { int x,y; ll w; read(x),read(y),read(w); mp[x][y]=w; a[1]=x,a[2]=y; ins(2,false); } for(int i=1;i&lt;=k;i++) { int len; read(len); for(int j=1;j&lt;=len;j++) read(a[j]); ins(len,true); } build(); // for(int i=1;i&lt;=tot;i++) // { // printf(&quot;%d(%d) %d\\n&quot;,i,flg[i],fail[i]); // } // puts(&quot;------&quot;); // for(int i=0;i&lt;=tot;i++) // { // for(int j=1;j&lt;=n;j++) // { // if(qux(to[i],j).second!=inf) // printf(&quot;%d %d %lld\\n&quot;, // i, // qux(to[i],j).first, // qux(to[i],j).second); // } // } for(int i=0;i&lt;=tot;i++) dis[i]=inf; if(!son[0].count(1)) return puts(&quot;-1&quot;),0; int srt=son[0][1]; if(flg[srt]) return puts(&quot;-1&quot;),0; // printf(&quot;srt: %d\\n&quot;,srt); dis[srt]=0; q.emplace(-dis[srt],srt); while(!q.empty()) { int u=q.top().second; q.pop(); if(vis[u]) continue; vis[u]=true; dfs(to[u],1,n,dis[u]); } ll ans=inf; for(int i=1;i&lt;=tot;i++) if(idx[i]==n) ans=min(ans,dis[i]); // for(int i=0;i&lt;=tot;i++) // printf(&quot;%d(%d) %lld\\n&quot;,i,idx[i],dis[i]); printf(&quot;%lld\\n&quot;,ans==inf?-1:ans); return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"字符串","slug":"wtMqnxQGh","used":true,"link":"https://Rebxe.github.io/tag/wtMqnxQGh/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【必可2024公益众筹赛1】可爱路径 做题记录","feature":"","link":"https://Rebxe.github.io/post/bi-ke-2024-gong-yi-zhong-chou-sai-1-ke-ai-lu-jing-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":401000,"words":1216,"minutes":7},"date":"2024-09-29 19:33:35","dateFormat":"2024-09-29"},{"abstract":"<blockquote>\n<p>有一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点的有根树，根为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。</p>\n<p>每个点上有一个物品，点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 上物品的价值为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，大小为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。有一个大小为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的背包，一个点上的物品能被放入背包当且仅当该点为根或其父亲的物品已经被放入背包，求最大价值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>5000</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 5000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi mathvariant=\"normal\">∣</mi><msub><mi>a</mi><mi>i</mi></msub><mi mathvariant=\"normal\">∣</mi><mo separator=\"true\">,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le |a_i|,b_i\\le 10^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有一棵 nnn 个点的有根树，根为 111。 每个点上有一个物品，点 uuu 上物品的价值为 aua_uau​，大小为 bub_ubu​。有一个大小为 mmm 的背包，一个点上的物品能被放入背包当且仅当该点为根或其父亲的物品已经被放入背包，求最大价值。 1≤n,m≤50001\\le n,m\\le 50001≤n,m≤5000，1≤∣ai∣,bi≤1041\\le |a_i|,b_i\\le 10^41≤∣ai​∣,bi​≤104。 一个点上的物品若没选则它的整个子树都会被跳过，考虑刻画这个东西。 在 dfs 序上 dp，记录 fi,jf_{i,j}fi,j​ 表示处理完 dfs 序前 iii 的点，物品的大小和为 jjj 的最大价值。 那么转移的时候要么 dfs 序加 111 且将物品放入背包，要么直接跳过子树（dfs 序加上 uuu 的子树大小）并不将物品放入背包。 时间复杂度 O(nm)O(nm)O(nm)。 ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"小技巧","slug":"J5sSduNPX","used":true,"link":"https://Rebxe.github.io/tag/J5sSduNPX/"}],"title":"【2025NOI模拟赛19】b酱的果子 做题记录","feature":"","link":"https://Rebxe.github.io/post/2025noi-mo-ni-sai-19-b-jiang-de-guo-zi-zuo-ti-ji-lu/","stats":{"text":"1 min read","time":56000,"words":237,"minutes":1},"date":"2024-09-29 15:10:47","dateFormat":"2024-09-29"},{"abstract":"<blockquote>\n<p>对于一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 串，每次操作可以选择一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>110</mn></mrow><annotation encoding=\"application/x-tex\">110</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>011</mn></mrow><annotation encoding=\"application/x-tex\">011</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span></span></span></span> 或者选择一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>011</mn></mrow><annotation encoding=\"application/x-tex\">011</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>110</mn></mrow><annotation encoding=\"application/x-tex\">110</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span>。</p>\n<p>对于一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>h</mi><mo>(</mo><mi>a</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">h(a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">h</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">)</span></span></span></span> 表示可以从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 经过若干次操作到达的不同 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 串个数。</p>\n<p>给定一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn><mo>?</mo></mrow><annotation encoding=\"application/x-tex\">01?</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mclose\">?</span></span></span></span> 串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span>，对于所有把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>?</mo></mrow><annotation encoding=\"application/x-tex\">?</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mclose\">?</span></span></span></span> 替换成 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0/1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0</span><span class=\"mord\">/</span><span class=\"mord\">1</span></span></span></span> 得到的串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span>，求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>h</mi><mo>(</mo><mi>t</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">h(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">h</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">t</span><span class=\"mclose\">)</span></span></span></span> 的和，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5\\times 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 对于一个 010101 串，每次操作可以选择一个 110110110 变为 011011011 或者选择一个 011011011 变为 110110110。 对于一个 010101 串 aaa，设 h(a)h(a)h(a) 表示可以从 aaa 经过若干次操作到达的不同 010101 串个数。 给定一个 01?01?01? 串 sss，对于所有把 ??? 替换成 0/10/10/1 得到的串 ttt，求 h(t)h(t)h(t) 的和，对 109+710^9+7109+7 取模。 1≤n≤5×1031\\le n\\le 5\\times 10^31≤n≤5×103。 出题人真菜，O(n2)O(n^2)O(n2) 都不会。 由于操作可逆，考虑对于局面 xxx 设 f(x)f(x)f(x) 表示不断将棋子往后跳直到不能跳的局面。则两个局面 x,yx,yx,y 能互相到达当且仅当 f(x)=f(y)f(x)=f(y)f(x)=f(y)。 答案相当于枚举每一个初始状态，将其的联通块大小加起来。这个其实相当于求有多少个有序状态对 x,yx,yx,y 满足 xxx 可能成为初始状态且 f(x)=f(y)f(x)=f(y)f(x)=f(y)。 观察 f(x)f(x)f(x) 的过程，发现对于每一段连续的 111，若它的长度为偶数，则会不断往右走（火车），否则末尾的那个 111 会留下来。而一个单独 111 被长度为 lenlenlen 的火车撞到的时候，它的位置会往左移 lenlenlen。 那么不妨把火车拆为若干个 111111（车厢），对于一段长度为奇数的连续 111，将“末尾留下来”看作“开头被火车撞到”。 那么考虑同时填 x,yx,yx,y，设 fi,jf_{i,j}fi,j​ 表示 x[1,i−1]x_{[1,i-1]}x[1,i−1]​ 和 y[1,j−1]y_{[1,j-1]}y[1,j−1]​ 填好了，且在火车开过后 xix_ixi​ 对应 yjy_jyj​。 转移考虑往某个序列末尾填数： 填 111111（车厢）则 kkk 会对应原来的 k−2k-2k−2，转移到 fi+2,jf_{i+2,j}fi+2,j​ 或者 fi,j+2f_{i,j+2}fi,j+2​； 填 111 和填 000 则转移到 fi+1,j+1f_{i+1,j+1}fi+1,j+1​； 但是这样会有若干问题，首先是填了 111 后不能马上填 111111，这个可以开个 gi,jg_{i,j}gi,j​ 表示末尾填的是 111 来解决。还有一个问题是先往 xxx 填 111111 再往 yyy 填 111111 和先往 yyy 填 111111 和再往 xxx 填 111111 是一样的，这个容斥一下就行，让 fi,jf_{i,j}fi,j​ 减掉 fi−2,j−2f_{i-2,j-2}fi−2,j−2​。 时间复杂度 O(n2)O(n^2)O(n2)。 代码 #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=5005; #define p 1000000007 int n; char a[S]; int f[S][S],g[S][S]; inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } inline bool ch0(int x){return (a[x]=='0'||a[x]=='?');} inline bool ch1(int x){return (a[x]=='1'||a[x]=='?');} int main() { freopen(&quot;checkers.in&quot;,&quot;r&quot;,stdin); freopen(&quot;checkers.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%s&quot;,&amp;n,a+1); f[1][1]=1; for(int i=1;i&lt;=n+1;i++) { for(int j=1;j&lt;=n+1;j++) { if(i-2&gt;=1&amp;&amp;j-2&gt;=1&amp;&amp;ch1(i-2)&amp;&amp;ch1(i-1)) { add(f[i][j],p-f[i-2][j-2]); } int u=f[i][j],v=g[i][j]; // i - j if(i&lt;=n&amp;&amp;ch1(i)) // 1 { if(j!=n+1) add(g[i+1][j+1],u); if(i+1&lt;=n&amp;&amp;ch1(i+1)) add(f[i+2][j],u); // 11 } if(ch0(i)&amp;&amp;j!=n+1) // 0 { add(f[i+1][j+1],u); add(f[i+1][j+1],v); } if(j+1&lt;=n) { add(f[i][j+2],u); } } } printf(&quot;%d\\n&quot;,(f[n+1][n+1]+g[n+1][n+1])%p); return 0; } ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2024NOIP模拟赛44】跳棋 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-mo-ni-sai-44-tiao-qi-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":263000,"words":902,"minutes":5},"date":"2024-09-24 16:02:44","dateFormat":"2024-09-24"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi><mo separator=\"true\">,</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">m,x,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span></span></span></span>，可以通过如下方式生成一个长 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{[0,m-1]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">0</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">m</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span>：</p>\n<ul>\n<li>\n<p>先将所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 置为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>；</p>\n</li>\n<li>\n<p>执行如下代码：</p>\n<pre><code class=\"language-cpp\">for(int i=x;i&gt;0;i-=i&amp;-i)\n\tfor(int j=i-(i&amp;-i);j&lt;i;j++)\n        a[j]=i*(i^v);\n</code></pre>\n</li>\n</ul>\n<p>现在给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n,m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个按如上方式生成的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>s</mi><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">s_{[1,n]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，每次给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi><mo separator=\"true\">,</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">c,d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">d</span></span></span></span>，求所有长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span> 且满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>p</mi><mi>i</mi></msub><mo>&lt;</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">0\\le p_i&lt;m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335400000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 且 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>⊕</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>c</mi></msubsup><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">\\oplus_{i=1}^cp_i=d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.923056em;vertical-align:-0.258664em;\"></span><span class=\"mord\"><span class=\"mbin\">⊕</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-2.441336em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.258664em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">d</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>c</mi></msubsup><msub><mi>s</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><msub><mi>p</mi><mi>i</mi></msub></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\prod\\limits_{i=1}^c s_{i,p_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.329066em;vertical-align:-0.9776689999999999em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3513970000000004em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∏</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9776689999999999em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 之和，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>7</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 7\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le q\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>x</mi><mi>i</mi></msub><mo>≤</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">0\\le x_i\\le m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>v</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le v\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 m,x,vm,x,vm,x,v，可以通过如下方式生成一个长 mmm 的序列 a[0,m−1]a_{[0,m-1]}a[0,m−1]​： 先将所有 aia_iai​ 置为 000； 执行如下代码： for(int i=x;i&gt;0;i-=i&amp;-i) for(int j=i-(i&amp;-i);j&lt;i;j++) a[j]=i*(i^v); 现在给定 n,mn,mn,m 和 nnn 个按如上方式生成的序列 s[1,n]s_{[1,n]}s[1,n]​。 qqq 次询问，每次给定 c,dc,dc,d，求所有长度为 ccc 且满足 0≤pi&lt;m0\\le p_i&lt;m0≤pi​&lt;m 且 ⊕i=1cpi=d\\oplus_{i=1}^cp_i=d⊕i=1c​pi​=d 的序列 ppp 的 ∏i=1csi,pi\\prod\\limits_{i=1}^c s_{i,p_i}i=1∏c​si,pi​​ 之和，对 998244353998244353998244353 取模。 1≤n≤7×1051\\le n\\le 7\\times 10^51≤n≤7×105，1≤m≤1061\\le m\\le 10^61≤m≤106，1≤q≤1051\\le q\\le 10^51≤q≤105，0≤xi≤m0\\le x_i\\le m0≤xi​≤m，0≤v≤1090\\le v\\le 10^90≤v≤109。 若 mmm 不是 mmm 的次幂则先将其补齐。 不难发现这样生成的序列满足前一半或后一半完全相同，另外一半递归地满足该条件。 具体的，由于每次减去 lowbit，故若 xxx 的最高位为 111 则前一半完全相同，否则后一半全都为 000。 手摸一下会发现两个满足该性质的序列的 XOR 卷积也满足该性质： 卷积的结果要么前一半是原来不同乘相同，要么后一半是，而这样乘出来每一位是相同的； 剩下的一半是相同乘相同加上不同乘不同，相同乘相同一定是一样的，而不同乘不同则递归了； 那么开个变量表示每位是左半相同还是右半相同，再开个数组记录每一位相同那一半的值即可，注意最后会多出一个长度为 111 的段。查询的时候直接找位置所在的段即可。 时间复杂度 O((n+q)log⁡m)O((n+q)\\log m)O((n+q)logm)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; using namespace std; template&lt;typename T&gt; inline void read(T &amp;x) { x=0; T w=1; char c=getchar(); while(c&lt;'0'||c&gt;'9') w=(c=='-'?-w:w),c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); x*=w; } const int S=700005,BS=25; #define p 998244353 int n,m,q,lm; int pre[BS],sfa[BS],sfb[BS]; struct node { int val,a[BS]; inline node(){val=0,memset(a,0,sizeof(a));} inline int&amp; operator[](int x){return a[x];} inline int que(int x) { x^=val; for(int i=lm;i&gt;=0;i--) if(x&gt;&gt;i&amp;1^1) return a[i+1]; return a[0]; } }; node a[S]; inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } inline node operator*(node a,node b) { node res; res.val=a.val^b.val^(m-1); for(int i=lm+1;i&gt;=0;i--) { pre[i]=1ll*a[i]*b[i]%p*(1&lt;&lt;max(i-1,0))%p; if(i&lt;lm+1) add(pre[i],pre[i+1]); } for(int i=0;i&lt;=lm+1;i++) { sfa[i]=1ll*a[i]*(1&lt;&lt;max(i-1,0))%p; sfb[i]=1ll*b[i]*(1&lt;&lt;max(i-1,0))%p; if(i&gt;0) { add(sfa[i],sfa[i-1]); add(sfb[i],sfb[i-1]); } } for(int i=0;i&lt;=lm+1;i++) { if(i&lt;lm+1) add(res[i],pre[i+1]); if(i&gt;0) { add(res[i],1ll*a[i]*sfb[i-1]%p); add(res[i],1ll*b[i]*sfa[i-1]%p); } } add(res[0],1ll*a[0]*b[0]%p); return res; } int main() { freopen(&quot;seq.in&quot;,&quot;r&quot;,stdin); freopen(&quot;seq.out&quot;,&quot;w&quot;,stdout); read(n),read(m),read(q); int tmp=1; while(tmp&lt;m) tmp&lt;&lt;=1,lm++; m=tmp,lm--; for(int i=1;i&lt;=n;i++) { int x,v; read(x),read(v); if(x==m) { a[i].val=0; for(int j=0;j&lt;=lm+1;j++) a[i][j]=1ll*x*(x^v)%p; } else { a[i].val=(m-1)^x; for(int j=lm;j&gt;=0;j--) { if(x&gt;&gt;j&amp;1) { int val=x&amp;((m-1)^((1&lt;&lt;j)-1)); a[i][j+1]=1ll*val*(val^v)%p; } else a[i][j+1]=0; } a[i][0]=0; } } for(int i=2;i&lt;=n;i++) a[i]=a[i]*a[i-1]; while(q--&gt;0) { int c,d; read(c),read(d); printf(&quot;%d\\n&quot;,a[c].que(d)); } return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2025NOI模拟赛15】序列 做题记录","feature":"","link":"https://Rebxe.github.io/post/2025noi-mo-ni-sai-15-xu-lie-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":318000,"words":1005,"minutes":6},"date":"2024-09-10 21:17:15","dateFormat":"2024-09-10"},{"abstract":"<blockquote>\n<p>给定两个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">G</span></span></span></span>，定义 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 的一个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[l,r]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 是合法的当且仅当存在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>r</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">l1,r1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">1</span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mn>1</mn><mo>−</mo><mi>l</mi><mn>1</mn><mo>=</mo><mi>r</mi><mo>−</mo><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">r1-l1=r-l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 且 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>S</mi><mrow><mo>[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">S_{[l,r]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.03853em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span> 重排后可以和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>G</mi><mrow><mo>[</mo><mi>l</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>r</mi><mn>1</mn><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">G_{[l1,r1]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.03853em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">G</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span> 相等。</p>\n<p>对于每个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi><mo>∈</mo><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">k\\in [1,n]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">]</span></span></span></span>，求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>n</mi><msub><mi>s</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">ans_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">n</span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示任意重排 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>G</mi><mrow><mo>[</mo><mi>n</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">G_{[n-k+1,n]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.03853em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">G</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span> 后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 的合法区间个数的最大值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定两个 nnn 的排列 SSS 和 GGG，定义 SSS 的一个区间 [l,r][l,r][l,r] 是合法的当且仅当存在 l1,r1l1,r1l1,r1 满足 r1−l1=r−lr1-l1=r-lr1−l1=r−l 且 S[l,r]S_{[l,r]}S[l,r]​ 重排后可以和 G[l1,r1]G_{[l1,r1]}G[l1,r1]​ 相等。 对于每个 k∈[1,n]k\\in [1,n]k∈[1,n]，求 anskans_kansk​ 表示任意重排 G[n−k+1,n]G_{[n-k+1,n]}G[n−k+1,n]​ 后 SSS 的合法区间个数的最大值。 1≤n≤2×1051\\le n\\le 2\\times 10^51≤n≤2×105。 先将 GiG_iGi​ 变为其在 SSS 中的位置，转化成重排后最大化值域连续区间个数。 设转化后的排列为 aaa。 假设要重排 [x+1,n][x+1,n][x+1,n]，有一个贪心可以最大化答案： 先将 a[x+1,n]a_{[x+1,n]}a[x+1,n]​ 中的数删掉； 为每个 i∈[1,x]i\\in[1,x]i∈[1,x] 计算出一个 010101 变量 fif_ifi​，表示 a[i,x]a_{[i,x]}a[i,x]​ 在去除 a[x+1,n]a_{[x+1,n]}a[x+1,n]​ 这些数后的值域上是否连续，是则为 111； 对于每个满足 fi=1f_i=1fi​=1 的 i∈[1,x]i\\in [1,x]i∈[1,x]，找出所有满足 y∈a[x+1,n]y\\in a_{[x+1,n]}y∈a[x+1,n]​ 且 (min⁡j=ixaj)&lt;y&lt;(max⁡j=ixaj)\\left(\\min\\limits_{j=i}^{x}a_j\\right)&lt;y&lt;\\left(\\max\\limits_{j=i}^{x}a_j\\right)(j=iminx​aj​)&lt;y&lt;(j=imaxx​aj​) 的 yyy，放入集合 AiA_iAi​； 不难发现一个重要的性质： ∀1≤i&lt;j≤x,fi=fj=1\\forall 1\\le i&lt;j\\le x,f_i=f_j=1∀1≤i&lt;j≤x,fi​=fj​=1，都有 Aj⊆AiA_j\\subseteq A_iAj​⊆Ai​。 那么设 idiid_iidi​ 为第 iii 个满足 fi=1f_i=1fi​=1 的 iii，设 Bi=Aidi−Aidi+1B_i=A_{id_i}-A_{id_{i+1}}Bi​=Aidi​​−Aidi+1​​，接下来从大往小遍历每个 iii，将 BiB_iBi​ 按照正序/倒序放到 aaa 的末尾； 具体的，若 (min⁡y∈Biy)−1\\left(\\min\\limits_{y\\in B_i}y\\right)-1(y∈Bi​min​y)−1 在 a[1,x]a_{[1,x]}a[1,x]​ 中出现的位置比 (max⁡y∈Biy)+1\\left(\\max\\limits_{y\\in B_i}y\\right)+1(y∈Bi​max​y)+1 出现的位置靠后，则 BiB_iBi​ 正序排列，否则倒序排列； 这个贪心过程其实相当于，值域上有一些点，这些点把值域分成若干个区间，从 xxx 往前扫，每次将扫到的点的左右两边相邻的还没放入排列的区间拎出来，将左边的区间倒序放入排列末尾，右边的区间则正序，而左右区间之间的相对顺序则看另一个端点在 a[1,x]a_{[1,x]}a[1,x]​ 中出现的位置，靠后的先放。 那么答案分为三部分计算： l,r∈[1,x]l,r\\in [1,x]l,r∈[1,x]：扫描线预处理即可； l,r∈[x+1,n]l,r\\in[x+1,n]l,r∈[x+1,n]：也是扫描线，注意到每个 BiB_iBi​ 会带来 ∣Bi∣×(∣Bi∣+1)2\\frac{|B_i|\\times (|B_i|+1)}{2}2∣Bi​∣×(∣Bi​∣+1)​ 的贡献，那么倒序扫描线每次合并 axa_xax​ 两边的 BiB_iBi​ 即可； l∈[1,x],r∈[x+1,n]l\\in[1,x],r\\in[x+1,n]l∈[1,x],r∈[x+1,n]： 先假设 xxx 固定，考虑暴力计算。 先为每个区间开一个桶 bbb。对于 fi=1f_i=1fi​=1 的 iii，设 li=min⁡i≤y≤xai,ri=max⁡i≤y≤xail_i=\\min\\limits_{i\\le y\\le x}a_i,r_i=\\max\\limits_{i\\le y\\le x}a_ili​=i≤y≤xmin​ai​,ri​=i≤y≤xmax​ai​ 即值域上连续段的左端点和右端点，设 li−1l_i-1li​−1 所在的区间为 lblblb，ri+1r_i+1ri​+1 所在的为 rbrbrb，将 blbb_{lb}blb​ 和 brbb_{rb}brb​ 分别加 111。然后若值域中 [li,ri][l_i,r_i][li​,ri​] 内不全是在 a[1,x]a_{[1,x]}a[1,x]​ 中出现的，则将答案加 111（这个条件是避免和第一类贡献算重）。 最后遍历每个区间 jjj，其对答案的贡献即为 min⁡(2,bj)×(rj−lj+1)\\min(2,b_j)\\times (r_j-l_j+1)min(2,bj​)×(rj​−lj​+1)。 快速维护应该也是扫描线，搞一搞就好了，没想好。 接下来证明贪心的正确性。 放前两种贡献肯定是最优的，而不难发现只有 fi=1f_i=1fi​=1 的 iii 才会有第三种贡献。 对于 fi=1f_i=1fi​=1 的 iii，设 li=min⁡i≤y≤xai,ri=max⁡i≤y≤xail_i=\\min\\limits_{i\\le y\\le x}a_i,r_i=\\max\\limits_{i\\le y\\le x}a_ili​=i≤y≤xmin​ai​,ri​=i≤y≤xmax​ai​ 即值域上连续段的左端点和右端点，不难发现 li−1l_i-1li​−1 所在区间和 ri+1r_i+1ri​+1 所在的区间才有可能对 iii 造成贡献，而一个区间 jjj 对 iii 能造成贡献当且仅当 [li,ri][l_i,r_i][li​,ri​] 中的区间都排在 jjj 的前面。根据这条性质再手模一下不难发现一段区间最多贡献两次。 再理解一下不难发现所有贡献两次的区间这个贪心都能算到至少两次，而只贡献一次的区间这个贪心又一定能算到，所以它是对的。 时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)，没写。 ","tags":[{"name":"贪心","slug":"PR_0Eh8tb","used":true,"link":"https://Rebxe.github.io/tag/PR_0Eh8tb/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2024NOIP模拟赛36】相似 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-mo-ni-sai-36-xiang-si-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":356000,"words":1290,"minutes":6},"date":"2024-09-09 15:39:01","dateFormat":"2024-09-09"},{"abstract":"<blockquote>\n<p>二维平面上有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(x_i,y_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条无向边连接这些点。</p>\n<p>你需要从某个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 开始，不重不漏的经过所有边后回到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span>，请最小化转过的角度之和，求最小的角度和。</p>\n<figure data-type=\"image\" tabindex=\"1\"><img src=\"https://lovely-ckj.github.io/post-images/1725453213342.png\" alt=\"\" loading=\"lazy\"></figure>\n<p>注意最后要转回开始的方向。</p>\n<p>保证所有点的度数都 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≤</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">\\le 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n-1\\le m\\le 2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le x_i,y_i\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>，保证图联通且不存在自环，保证存在欧拉回路。</p>\n</blockquote>\n","content":" 二维平面上有 nnn 个点 (xi,yi)(x_i,y_i)(xi​,yi​)，有 mmm 条无向边连接这些点。 你需要从某个点 sss 开始，不重不漏的经过所有边后回到 sss，请最小化转过的角度之和，求最小的角度和。 注意最后要转回开始的方向。 保证所有点的度数都 ≤4\\le 4≤4。 1≤n≤1051\\le n\\le 10^51≤n≤105，n−1≤m≤2nn-1\\le m\\le 2nn−1≤m≤2n，0≤xi,yi≤1090\\le x_i,y_i\\le 10^90≤xi​,yi​≤109，保证图联通且不存在自环，保证存在欧拉回路。 设 dud_udu​ 为 uuu 的度数，显然 du∈{2,4}d_u\\in\\{2,4\\}du​∈{2,4}。 对于 du=2d_u=2du​=2 的点，在这里转过的角度是固定的，直接累加即可。 对于 du=4d_u=4du​=4 的点，相当于要给出边配对，一共只有三种不同的配对方法。那么先按照最优的方法配对，这样会形成若干个环，我们的目标就是调整配对方法使得最终只剩下一个环且代价最小。 接下来把环看成点，把调整后会合并的两个环连边，边权为调整的代价，跑最小生成树即可。 时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)。 #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;cmath&gt; #include &lt;vector&gt; using namespace std; #define fi first #define se second typedef long double db; const db pi=acos(-1); const int S=100005; struct node { int x,y; }; struct edge { int x,y; db w; }; int n,m; node a[S]; vector&lt;pair&lt;int,int&gt; &gt; g[S]; db b[S]; int fa[S*2]; int tot; edge ed[S]; db cal(node a,node c,node b) { db res=atan2(a.x-c.x,a.y-c.y)-atan2(b.x-c.x,b.y-c.y); if(res&gt;pi) res-=pi*2; if(res&lt;-pi) res+=pi*2; return pi-abs(res*180/pi)/(db)360*2*pi; } int fnd(int x) { return fa[x]==x?x:fa[x]=fnd(fa[x]); } inline void meg(int x,int y) { fa[fnd(x)]=fnd(y); } int main() { freopen(&quot;write.in&quot;,&quot;r&quot;,stdin); freopen(&quot;write.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) scanf(&quot;%d%d&quot;,&amp;a[i].x,&amp;a[i].y); for(int i=1;i&lt;=m;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); g[x].emplace_back(y,i); g[y].emplace_back(x,i); } db ans=0; for(int i=1;i&lt;=m;i++) fa[i]=i; for(int i=1;i&lt;=n;i++) { if(g[i].empty()) continue; if(g[i].size()==2) { int x=g[i][0].fi,xid=g[i][0].se; int y=g[i][1].fi,yid=g[i][1].se; ans+=cal(a[x],a[i],a[y]); meg(xid,yid); } else { db mn1=1e18,mn2=1e18; int id; for(int j=1;j&lt;=3;j++) { int u=g[i][0].fi; int v=g[i][j].fi; int x,y; if(j==1) x=g[i][2].fi,y=g[i][3].fi; if(j==2) x=g[i][1].fi,y=g[i][3].fi; if(j==3) x=g[i][1].fi,y=g[i][2].fi; db pre=cal(a[u],a[i],a[v])+cal(a[x],a[i],a[y]); if(pre&lt;mn1) mn2=mn1,mn1=pre,id=j; else if(pre&lt;mn2) mn2=pre; } ans+=mn1; meg(g[i][0].se,g[i][id].se); int x,y; if(id==1) x=g[i][2].se,y=g[i][3].se; if(id==2) x=g[i][1].se,y=g[i][3].se; if(id==3) x=g[i][1].se,y=g[i][2].se; meg(x,y); b[i]=mn2-mn1; } } for(int i=1;i&lt;=n;i++) { if(g[i].size()&lt;4) continue; int x=fnd(g[i][0].se),y=-1; for(auto t:g[i]) { if(fnd(t.se)!=fnd(g[i][0].se)) y=fnd(t.se); } if(y!=-1) ed[++tot]=(edge){x,y,b[i]}; } sort(ed+1,ed+tot+1,[&amp;](edge x,edge y){ return x.w&lt;y.w; }); for(int i=1;i&lt;=tot;i++) { int x=ed[i].x,y=ed[i].y; db w=ed[i].w; if(fnd(x)==fnd(y)) continue; meg(x,y); ans+=w; } printf(&quot;%Lf\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2023北京集训5】写作与沟通 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-bei-jing-ji-xun-5-xie-zuo-yu-gou-tong-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":294000,"words":900,"minutes":5},"date":"2024-09-04 20:33:26","dateFormat":"2024-09-04"},{"abstract":"<blockquote>\n<p>有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n\\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的矩阵，刚开始所有位置都为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>。</p>\n<p>接下来进行 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 次操作，第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 次会在左上角为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><msub><mi>l</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>y</mi><msub><mi>l</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(xl_i,yl_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，右下角为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><msub><mi>r</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>y</mi><msub><mi>r</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(xr_i,yr_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 的矩形中等概率随机选择一个位置将其 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span>。</p>\n<p>求操作完后矩阵行列式的期望值，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n\\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的矩阵 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 的行列式 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mo>=</mo><msub><mo>∑</mo><mrow><mi>p</mi><mo>∈</mo><msub><mi>S</mi><mi>n</mi></msub></mrow></msub><mo>(</mo><mo>−</mo><mn>1</mn><msup><mo>)</mo><mrow><mtext>inv</mtext><mo>(</mo><mi>p</mi><mo>)</mo></mrow></msup><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><msub><mi>p</mi><mi>i</mi></msub></mrow></msub></mrow><annotation encoding=\"application/x-tex\">|a|=\\sum\\limits_{p\\in S_n}(-1)^{\\text{inv}(p)}\\prod\\limits_{i=1}^n a_{i,p_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.481841em;vertical-align:-1.130444em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7500050000000001em;\"><span style=\"top:-2.105664em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">p</span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.16454285714285719em;\"><span style=\"top:-2.357em;margin-left:-0.05764em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.130444em;\"><span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8879999999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">inv</span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">p</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3513970000000004em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∏</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9776689999999999em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>，其中 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>S</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">S_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列的集合，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mtext>inv</mtext><mo>(</mo><mi>p</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{inv}(p)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">inv</span></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">p</span><span class=\"mclose\">)</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 的逆序对个数。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个 n×nn\\times nn×n 的矩阵，刚开始所有位置都为 000。 接下来进行 nnn 次操作，第 iii 次会在左上角为 (xli,yli)(xl_i,yl_i)(xli​,yli​)，右下角为 (xri,yri)(xr_i,yr_i)(xri​,yri​) 的矩形中等概率随机选择一个位置将其 +1+1+1。 求操作完后矩阵行列式的期望值，对 109+710^9+7109+7 取模。 n×nn\\times nn×n 的矩阵 aaa 的行列式 ∣a∣=∑p∈Sn(−1)inv(p)∏i=1nai,pi|a|=\\sum\\limits_{p\\in S_n}(-1)^{\\text{inv}(p)}\\prod\\limits_{i=1}^n a_{i,p_i}∣a∣=p∈Sn​∑​(−1)inv(p)i=1∏n​ai,pi​​，其中 SnS_nSn​ 为 nnn 的排列的集合，inv(p)\\text{inv}(p)inv(p) 为 ppp 的逆序对个数。 1≤n≤1051\\le n\\le 10^51≤n≤105。 首先转成计数，只需要最后乘上 1∏i(xri−xli+1)(yri−yli+1)\\frac{1}{\\prod\\limits_i(xr_i-xl_i+1)(yr_i-yl_i+1)}i∏​(xri​−xli​+1)(yri​−yli​+1)1​ 即可。 设最终矩阵为 aaa，则不难发现由于 ∑i∑jai,j=n\\sum\\limits_{i}\\sum\\limits_{j}a_{i,j}=ni∑​j∑​ai,j​=n，所以若两次操作加到了同一个位置则行列式为 000。 设第 iii 次加在了 (xi,yi)(x_i,y_i)(xi​,yi​)，设 fxa,bfx_{a,b}fxa,b​ 和 fya,bfy_{a,b}fya,b​ 分别表示 a,ba,ba,b 是否在 (i,xi)(i,x_i)(i,xi​) 和 (i,yi)(i,y_i)(i,yi​) 意义上构成逆序对，则不难发现 a,ba,ba,b 在 (xi,yi)(x_i,y_i)(xi​,yi​) 意义上构成逆序对当且仅当 fxa,b⊕fya,b=1fx_{a,b}\\oplus fy_{a,b}=1fxa,b​⊕fya,b​=1，而一个逆序对的贡献是 ×(−1)\\times(-1)×(−1)，所以两维可以独立做。 那么现在问题变为求 ∑p∈Sn(−1)inv(p)∏i[pi∈[li,ri]]\\sum\\limits_{p\\in S_n}(-1)^{\\text{inv}(p)}\\prod\\limits_{i}[p_i\\in[l_i,r_i]]p∈Sn​∑​(−1)inv(p)i∏​[pi​∈[li​,ri​]]。 不难发现，若存在 pi,pj∈[li,ri]∩[lj,rj]p_i,p_j\\in[l_i,r_i]\\cap[l_j,r_j]pi​,pj​∈[li​,ri​]∩[lj​,rj​]，则将 pi,pjp_i,p_jpi​,pj​ 交换会让逆序对个数改变 111，且交换后还合法，所以会互相抵消。 那么每次选择 lil_ili​ 最小的区间中 rir_iri​ 最小的那个 iii，让 pi:=lip_i:=l_ipi​:=li​，再将所有 lj=lil_j=l_ilj​=li​ 的 ljl_jlj​ 都变为 ri+1r_i+1ri​+1，不难发现这样填出来的方案一定合法，且根据这个构造方法不难看出合法方案最多只有一种，所以有一个有趣的性质就是 (∑p∈Sn(−1)inv(p)∏i[pi∈[li,ri]])∈{−1,1}\\left(\\sum\\limits_{p\\in S_n}(-1)^{\\text{inv}(p)}\\prod\\limits_{i}[p_i\\in[l_i,r_i]]\\right)\\in\\{-1,1\\}(p∈Sn​∑​(−1)inv(p)i∏​[pi​∈[li​,ri​]])∈{−1,1}。 这个贪心用可并堆维护即可，时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; using namespace std; const int S=100005,p=1000000007; template&lt;typename T,int siz&gt; class LTree { private: struct node { T val; int dist,ls,rs; }tr[siz]; int tot; inline int nnde(T val) { tr[++tot]={val,1,0,0}; return tot; } inline void upda(int u) { int &amp;ls=tr[u].ls,&amp;rs=tr[u].rs; if(tr[ls].dist&gt;tr[rs].dist) swap(ls,rs); tr[u].dist=tr[ls].dist+1; } int merge(int x,int y) { if(x==0||y==0) return x+y; if(tr[x].val&gt;tr[y].val) swap(x,y); tr[x].ls=merge(tr[x].ls,y); upda(x); return x; } public: inline void clear() { tr[tot=0]=(node){T(),0,0,0}; } inline void ins(int &amp;rt,T x) { rt=merge(rt,nnde(x)); } inline T top(int rt) { return tr[rt].val; } inline void pop(int &amp;rt) { rt=merge(tr[rt].ls,tr[rt].rs); } inline void meg(int &amp;x,int y) { x=merge(x,y); } }; struct node { int xl,xr,yl,yr; }a[S]; int n; LTree&lt;pair&lt;int,int&gt;,S&gt; tr; int rt[S]; int rex[S],rey[S]; int b[S],c[S]; inline void add(int p,int x) { for(int i=p;i&lt;=n;i+=i&amp;-i) c[i]+=x; } inline int que(int p) { int res=0; for(int i=p;i&gt;=1;i-=i&amp;-i) res+=c[i]; return res; } inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } inline void slove() { scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d%d%d%d&quot;,&amp;a[i].xl,&amp;a[i].xr,&amp;a[i].yl,&amp;a[i].yr); tr.clear(); for(int i=1;i&lt;=n;i++) rt[i]=0; for(int i=1;i&lt;=n;i++) tr.ins(rt[a[i].xl],make_pair(a[i].xr,i)); // for(int i=1;i&lt;=n;i++) // { // printf(&quot;%d %d %d %d\\n&quot;,a[i].xl,a[i].xr,a[i].yl,a[i].yr); // auto pre=tr.top(rt[i]); // printf(&quot;%d: %d\\n&quot;,pre.second,pre.first); // } for(int i=1;i&lt;=n;i++) { auto pre=tr.top(rt[i]); tr.pop(rt[i]); int id=pre.second,r=pre.first; if(r&lt;i) return puts(&quot;0&quot;),void(); rex[id]=i; tr.meg(rt[r+1],rt[i]); } // puts(&quot;FINX&quot;); tr.clear(); for(int i=1;i&lt;=n;i++) rt[i]=0; for(int i=1;i&lt;=n;i++) tr.ins(rt[a[i].yl],make_pair(a[i].yr,i)); for(int i=1;i&lt;=n;i++) { auto pre=tr.top(rt[i]); tr.pop(rt[i]); int id=pre.second,r=pre.first; if(r&lt;i) return puts(&quot;0&quot;),void(); rey[id]=i; tr.meg(rt[r+1],rt[i]); } for(int i=1;i&lt;=n;i++) b[rex[i]]=rey[i]; for(int i=1;i&lt;=n;i++) c[i]=0; int res=1; for(int i=n;i&gt;=1;i--) { res*=que(b[i]-1)&amp;1?-1:1; add(b[i],1); } if(res&lt;0) res+=p; for(int i=1;i&lt;=n;i++) { int pre=1ll*(a[i].xr-a[i].xl+1)*(a[i].yr-a[i].yl+1)%p; res=1ll*res*qpow(pre,p-2)%p; } printf(&quot;%d\\n&quot;,res); } int main() { freopen(&quot;math.in&quot;,&quot;r&quot;,stdin); freopen(&quot;math.out&quot;,&quot;w&quot;,stdout); int T; scanf(&quot;%d&quot;,&amp;T); while(T--&gt;0) slove(); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2023北京集训4】代数 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-bei-jing-ji-xun-4-dai-shu-zuo-ti-ji-lu/","stats":{"text":"8 min read","time":443000,"words":1343,"minutes":8},"date":"2024-09-04 20:21:52","dateFormat":"2024-09-04"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">n,k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 和一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>，求下列代码中有效的 <code>sort</code> 被执行了几次：</p>\n<pre><code class=\"language-cpp\">while(1)\n{\n    bool f=true;\n    for(int i=1;i&lt;=n&amp;&amp;f;i++) f&amp;=p[i]==i;\n    if(f) break;\n    for(int i=1;i&lt;=n-k+1;i++) sort(p+i,p+i+k);\n}\n</code></pre>\n<p>一次 <code>sort</code> 有效当且仅当其改变了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">2\\le k\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 n,kn,kn,k 和一个 nnn 的排列 ppp，求下列代码中有效的 sort 被执行了几次： while(1) { bool f=true; for(int i=1;i&lt;=n&amp;&amp;f;i++) f&amp;=p[i]==i; if(f) break; for(int i=1;i&lt;=n-k+1;i++) sort(p+i,p+i+k); } 一次 sort 有效当且仅当其改变了 ppp。 1≤n≤2×1051\\le n\\le 2\\times 10^51≤n≤2×105，2≤k≤n2\\le k\\le n2≤k≤n。 设 bib_ibi​ 表示 ∑j=1i−1[aj&gt;ai]\\sum\\limits_{j=1}^{i-1}[a_j&gt;a_i]j=1∑i−1​[aj​&gt;ai​]。 考虑若 i=1i\\not=1i​=1，则将 [i,i+k−1][i,i+k-1][i,i+k−1] 排序的过程可以看作一个长 kkk 的滑动窗口，每次把最小的数吐出来，然后喂进去一个数。 那么当区间右端点在 rrr 时，窗口中的数就是 [1,r][1,r][1,r] 中的前 kkk 大值，故加入 r+1r+1r+1 后 br+1b_{r+1}br+1​ 会变成 max⁡(br+1−(k−1),0)\\max(b_{r+1}-(k-1),0)max(br+1​−(k−1),0)。 排好序当且仅当所有 bib_ibi​ 都为 000，那么答案大概就是 ∑i⌈bik−1⌉\\sum\\limits_i \\lceil\\frac{b_i}{k-1}\\rceili∑​⌈k−1bi​​⌉。 但是这样会比实际答案多，因为 i=1i=1i=1 时会同时将 b[1,k]b_{[1,k]}b[1,k]​ 变为 000，那么对于有可能去到 [1,k][1,k][1,k] 的元素 iii，先将答案加上 ⌈bik−1⌉−1\\lceil\\frac{b_i}{k-1}\\rceil-1⌈k−1bi​​⌉−1，开个桶记录一下每一轮的 sort(p+1,p+k+1) 是否有效，最后再统计。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; typedef long long ll; const int S=200005; int n,k,a[S]; int c[S],b[S],t[S]; bool flg[S]; inline void add(int p,int x) { for(int i=p;i&lt;=n;i+=i&amp;-i) c[i]+=x; } inline int que(int p) { int res=0; for(int i=p;i&gt;=1;i-=i&amp;-i) res+=c[i]; return res; } int main() { freopen(&quot;bsort.in&quot;,&quot;r&quot;,stdin); freopen(&quot;bsort.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;k); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); for(int i=1;i&lt;=n;i++) { add(a[i],1); b[i]=i-que(a[i]); t[i]=b[i]/(k-1)+!!(b[i]%(k-1)); } ll ans=0; for(int i=1;i&lt;=n;i++) { if(t[i]&gt;0) { if(i-(k-1)*(t[i]-1)&lt;=k) { ans+=t[i]-1; flg[t[i]]=true; } else ans+=t[i]; } } for(int i=1;i&lt;=n;i++) ans+=flg[i]; printf(&quot;%lld\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2025NOI模拟赛12】冒泡排序 做题记录","feature":"","link":"https://Rebxe.github.io/post/2025noi-mo-ni-sai-12-mou-pao-pai-xu-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":192000,"words":600,"minutes":4},"date":"2024-09-04 15:16:00","dateFormat":"2024-09-04"},{"abstract":"<blockquote>\n<p>有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条边有向图，每个点有一个炸毁代价 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">c_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>、起点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 和终点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span>，你需要花费最小的代价使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 至少要经过 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 次被炸毁的点。</p>\n<p>保证 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 与 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 联通，无解输出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>500</mn></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le 500</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">1\\le k\\le 5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个 nnn 个点 mmm 条边有向图，每个点有一个炸毁代价 cic_ici​。 给定 kkk、起点 sss 和终点 ttt，你需要花费最小的代价使得 sss 到 ttt 至少要经过 kkk 次被炸毁的点。 保证 sss 与 ttt 联通，无解输出 −1-1−1。 1≤n≤2001\\le n\\le 2001≤n≤200，1≤m≤5001\\le m\\le 5001≤m≤500，1≤k≤51\\le k\\le 51≤k≤5。 考虑最优解中 sss 到 ttt 经过最少炸毁点的路径上的炸毁点序列 bbb。对于一个被炸毁的点 uuu，设 sss 到 uuu 最少经过 aua_uau​ 个被炸毁的点，那么若 uuu 在 bbb 中出现就一定是第 aua_uau​ 个出现，因为走去别的炸毁点再走回来一定不优。 那么建 kkk 层图，第 iii 层的点 uuu 拆成入点 ui,0u_{i,0}ui,0​ 和出点 ui,1u_{i,1}ui,1​。 对于一个点 uuu： 在第 iii 层连边 (ui,0,ui,1,cu)(u_{i,0},u_{i,1},c_u)(ui,0​,ui,1​,cu​)； 在第 iii 层连边 (ui,0,ui+1,1,inf⁡)(u_{i,0},u_{i+1,1},\\inf)(ui,0​,ui+1,1​,inf)； 对于原图的一条边 u→vu\\to vu→v： 在第 iii 层连边 (ui,1,vi,0,inf⁡)(u_{i,1},v_{i,0},\\inf)(ui,1​,vi,0​,inf)； 跑 s1,0s_{1,0}s1,0​ 到 tk,1t_{k,1}tk,1​ 的最小割即可。 具体的，若边权为 cuc_ucu​ 的边未被割掉则可以在同层走，否则一定要向上走一层。而根据前面的结论，同一个点的 cuc_ucu​ 边只可能被割掉一条，所以是对的。 参考代码： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;queue&gt; #include &lt;vector&gt; using namespace std; const int S=10005,MS=500005; const int inf=1e8; int n,m,k; int st,ed; vector&lt;int&gt; g[S]; int s,t; int esum=1,to[MS],c[MS],nxt[MS],h[S]; int dep[S],cur[S]; inline void init(int ns,int nt) { for(int i=s;i&lt;=t;i++) h[i]=0; s=ns,t=nt; esum=1; } inline void added(int x,int y,int w) { to[++esum]=y; c[esum]=w; nxt[esum]=h[x]; h[x]=esum; } inline void add(int x,int y,int w) { added(x,y,w),added(y,x,0); } inline bool bfs() { for(int i=s;i&lt;=t;i++) dep[i]=0,cur[i]=h[i]; queue&lt;int&gt; q; dep[s]=1; q.push(s); while(!q.empty()) { int u=q.front(); q.pop(); if(u==t) return true; for(int i=h[u];i;i=nxt[i]) { int v=to[i],w=c[i]; if(w&gt;0&amp;&amp;dep[v]==0) { dep[v]=dep[u]+1; q.push(v); } } } return false; } int dfs(int u,int w) { if(u==t) return w; int sum=0; for(int &amp;i=cur[u];i;i=nxt[i]) { if(c[i]==0) continue; int v=to[i]; if(dep[v]!=dep[u]+1) continue; int r=dfs(v,min(c[i],w)); c[i]-=r; c[i^1]+=r; w-=r; sum+=r; if(w==0) break; } if(sum==0) dep[u]=0; return sum; } inline int dinic() { int res=0; while(bfs()) res+=dfs(s,inf); return res; } inline int id(int tp,int i,int t) { return (tp-1)*n*2+(i-1)*2+t; } int main() { freopen(&quot;apers.in&quot;,&quot;r&quot;,stdin); freopen(&quot;apers.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;k); scanf(&quot;%d%d&quot;,&amp;st,&amp;ed); init(0,k*n*2+1); for(int i=1;i&lt;=n;i++) { int x; scanf(&quot;%d&quot;,&amp;x); for(int j=1;j&lt;=k;j++) { int u=id(j,i,1),v=id(j,i,2); add(u,v,x); } for(int j=1;j&lt;=k-1;j++) { int u=id(j,i,1),v=id(j+1,i,2); add(u,v,inf); } } for(int i=1;i&lt;=m;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); g[x].push_back(y); for(int j=1;j&lt;=k;j++) { int u=id(j,x,2),v=id(j,y,1); add(u,v,inf); } } add(s,id(1,st,1),inf); add(id(k,ed,2),t,inf); queue&lt;int&gt; q; dep[st]=1; q.push(st); while(!q.empty()) { int u=q.front(); q.pop(); if(u==ed) { if(dep[u]&lt;k) return puts(&quot;-1&quot;),0; else break; } for(int v:g[u]) { if(dep[v]==0) { dep[v]=dep[u]+1; q.push(v); } } } printf(&quot;%d\\n&quot;,dinic()); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"},{"name":"网络流","slug":"19EjLeSB_D","used":true,"link":"https://Rebxe.github.io/tag/19EjLeSB_D/"}],"title":"【2023北京集训1】apers 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-bei-jing-ji-xun-1-apers-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":305000,"words":931,"minutes":6},"date":"2024-08-20 20:57:37","dateFormat":"2024-08-20"},{"abstract":"<blockquote>\n<p>给定一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点的无根树和一个正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>，对于每一个在树上选 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 个点涂黑的方案，定义其权值：</p>\n<ul>\n<li>对于树上每个点，求出其所有黑点的距离和，则该方案的权值即为所有点的距离和的最小值；</li>\n</ul>\n<p>求所有方案的权值和。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一棵 nnn 个点的无根树和一个正整数 mmm，对于每一个在树上选 mmm 个点涂黑的方案，定义其权值： 对于树上每个点，求出其所有黑点的距离和，则该方案的权值即为所有点的距离和的最小值； 求所有方案的权值和。 1≤m≤n≤1061\\le m\\le n\\le 10^61≤m≤n≤106。 钦定 111 为根。考虑枚举边，设儿子子树大小为 sss，则这条边的贡献为： ∑i=0⌊m2⌋i×(si)(n−sm−i)+∑i=⌊m2⌋+1m(m−i)×(si)(n−sm−i)\\sum\\limits_{i=0}^{\\lfloor\\frac{m}{2}\\rfloor}i\\times \\binom{s}{i}\\binom{n-s}{m-i}+\\sum\\limits_{i=\\lfloor\\frac{m}{2}\\rfloor+1}^{m}(m-i)\\times \\binom{s}{i}\\binom{n-s}{m-i} i=0∑⌊2m​⌋​i×(is​)(m−in−s​)+i=⌊2m​⌋+1∑m​(m−i)×(is​)(m−in−s​) 即： [m mod 2=0]×m2×(sm2)(n−sm2)+∑i=1⌊m−12⌋i×(si)(n−sm−i)+∑i=1⌊m−12⌋i×(sm−i)(n−si)[m\\text{ mod }2=0]\\times \\frac{m}{2}\\times\\binom{s}{\\frac{m}{2}}\\binom{n-s}{\\frac{m}{2}}+ \\sum\\limits_{i=1}^{\\lfloor\\frac{m-1}{2}\\rfloor} i\\times \\binom{s}{i}\\binom{n-s}{m-i}+\\sum\\limits_{i=1}^{\\lfloor\\frac{m-1}{2}\\rfloor} i\\times \\binom{s}{m-i}\\binom{n-s}{i} [m mod 2=0]×2m​×(2m​s​)(2m​n−s​)+i=1∑⌊2m−1​⌋​i×(is​)(m−in−s​)+i=1∑⌊2m−1​⌋​i×(m−is​)(in−s​) 考虑： ∑i=1⌊m−12⌋i×(si)(n−sm−i)=s×∑i=1⌊m−12⌋(s−1i−1)(n−sm−i)\\sum\\limits_{i=1}^{\\lfloor\\frac{m-1}{2}\\rfloor} i\\times \\binom{s}{i}\\binom{n-s}{m-i}=s\\times\\sum\\limits_{i=1}^{\\lfloor\\frac{m-1}{2}\\rfloor} \\binom{s-1}{i-1}\\binom{n-s}{m-i} i=1∑⌊2m−1​⌋​i×(is​)(m−in−s​)=s×i=1∑⌊2m−1​⌋​(i−1s−1​)(m−in−s​) 那么设一些东西： k:=⌊m−12⌋gs=∑i=1k(s−1i−1)(n−sm−i)s×∑i=1⌊m−12⌋(s−1i−1)(n−sm−i)=s×gsans=[m mod 2=0]×m2×(sm2)(n−sm2)+s×gs+(n−s)×gn−sk:=\\left\\lfloor\\frac{m-1}{2}\\right\\rfloor\\\\ g_s=\\sum\\limits_{i=1}^{k} \\binom{s-1}{i-1}\\binom{n-s}{m-i}\\\\ s\\times\\sum\\limits_{i=1}^{\\lfloor\\frac{m-1}{2}\\rfloor} \\binom{s-1}{i-1}\\binom{n-s}{m-i}=s\\times g_s\\\\ ans=[m\\text{ mod }2=0]\\times \\frac{m}{2}\\times\\binom{s}{\\frac{m}{2}}\\binom{n-s}{\\frac{m}{2}}+s\\times g_s+(n-s)\\times g_{n-s} k:=⌊2m−1​⌋gs​=i=1∑k​(i−1s−1​)(m−in−s​)s×i=1∑⌊2m−1​⌋​(i−1s−1​)(m−in−s​)=s×gs​ans=[m mod 2=0]×2m​×(2m​s​)(2m​n−s​)+s×gs​+(n−s)×gn−s​ 发现 gsg_sgs​ 的组合意义是从 n−1n-1n−1 个东西中选 m−1m-1m−1 个，且前 s−1s-1s−1 个最多只能选 k−1k-1k−1 个的方案数。 那么 gsg_sgs​ 比 gs+1g_{s+1}gs+1​ 多算了前 s−1s-1s−1 个选了 k−1k-1k−1 个且选了 sss 的方案，即 (s−1k−1)(n−s−1m−k−1)\\binom{s-1}{k-1}\\binom{n-s-1}{m-k-1}(k−1s−1​)(m−k−1n−s−1​)，那么减去即可。 ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2024NOIP模拟赛33】树上竞技 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noip-mo-ni-sai-33-shu-shang-jing-ji-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":226000,"words":685,"minutes":4},"date":"2024-08-19 18:57:26","dateFormat":"2024-08-19"},{"abstract":"<blockquote>\n<p>长 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，进行 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 次操作，每次操作等概率选择一对不同的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le i,j\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 都增加 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，求最终序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mo>∑</mo><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>&lt;</mo><mi>j</mi><mo>≤</mo><mi>n</mi></mrow></msub><mo>[</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><msub><mi>a</mi><mi>j</mi></msub><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{1\\le i&lt;j\\le n}[a_i=a_j]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.863782em;vertical-align:-1.113777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7500050000000001em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">&lt;</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathdefault mtight\">n</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.113777em;\"><span></span></span></span></span></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 的期望。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le t\\le 10^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le a_i\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>。</p>\n</blockquote>\n","content":" 长 nnn 的序列 aaa，进行 ttt 次操作，每次操作等概率选择一对不同的 1≤i,j≤n1\\le i,j\\le n1≤i,j≤n，将 aia_iai​ 和 aja_jaj​ 都增加 111，求最终序列 ∑1≤i&lt;j≤n[ai=aj]\\sum\\limits_{1\\le i&lt;j\\le n}[a_i=a_j]1≤i&lt;j≤n∑​[ai​=aj​] 的期望。 2≤n≤1062\\le n\\le 10^62≤n≤106，1≤t≤1071\\le t\\le 10^71≤t≤107，1≤ai≤n1\\le a_i\\le n1≤ai​≤n。 考虑拆贡献，将每一对数相等的概率加起来。不难发现差相同的数对是本质相同的，而且仅需一次卷积就能求出每种差有多少对数。 对于一对数，某次操作改变它们的差的概率为： y=n−2n(n−1)2y=\\frac{n-2}{\\frac{n(n-1)}{2}} y=2n(n−1)​n−2​ 那么差为 mmm 的两个数最终相等的概率即为 [xm](1−2y+yx+yx)t[x^m](1-2y+yx+\\frac{y}{x})^t[xm](1−2y+yx+xy​)t。 考虑快速计算，先整体乘上 xtx^txt，变为 [xm+t](y+(1−2y)x+yx2)t[x^{m+t}](y+(1-2y)x+yx^2)^t[xm+t](y+(1−2y)x+yx2)t。考虑设 f(x)=y+(1−2y)x+yx2f(x)=y+(1-2y)x+yx^2f(x)=y+(1−2y)x+yx2，g(x)=f(x)tg(x)=f(x)^tg(x)=f(x)t，那么答案为 [xm+t]g(x)[x^{m+t}]g(x)[xm+t]g(x)。 开始人类智慧，对 ggg 求导，得到： g(x)′=f(x)′×t×f(x)t−1g(x)′×f(x)=f(x)′×t×g(x)(y+(1−2y)x+yx2)g(x)′=(t−2yt+2ytx)g(x)\\begin{aligned} g(x)&#x27;&amp;=f(x)&#x27;\\times t\\times f(x)^{t-1}\\\\ g(x)&#x27;\\times f(x)&amp;=f(x)&#x27;\\times t\\times g(x)\\\\ (y+(1-2y)x+yx^2)g(x)&#x27;&amp;=(t-2yt+2ytx)g(x)\\\\ \\end{aligned} g(x)′g(x)′×f(x)(y+(1−2y)x+yx2)g(x)′​=f(x)′×t×f(x)t−1=f(x)′×t×g(x)=(t−2yt+2ytx)g(x)​ 设 [xi]g(x)=gi[x^i]g(x)=g_i[xi]g(x)=gi​，那么： (y+(1−2y)x+yx2)∑igi+1(i+1)xi=(t−2yt+2ytx)∑igixiy(i+1)gi+1+(1−2y)igi+y(i−1)gi−1=t(1−2y)gi+2ytgi−1y(i+1)gi+1=t(1−2y)gi+2ytgi−1−(1−2y)igi−y(i−1)gi−1y(i+1)gi+1=(t−i)(1−2y)gi+y(2t−i+1)gi−1gi+1=(t−i)(1−2y)gi+y(2t−i+1)gi−1y(i+1)\\begin{aligned} (y+(1-2y)x+yx^2)\\sum\\limits_i g_{i+1}(i+1)x^i&amp;=(t-2yt+2ytx)\\sum\\limits_{i}g_ix^i\\\\ y(i+1)g_{i+1}+(1-2y)ig_i+y(i-1)g_{i-1}&amp;=t(1-2y)g_i+2ytg_{i-1}\\\\ y(i+1)g_{i+1}&amp;=t(1-2y)g_i+2ytg_{i-1}-(1-2y)ig_i-y(i-1)g_{i-1}\\\\ y(i+1)g_{i+1}&amp;=(t-i)(1-2y)g_i+y(2t-i+1)g_{i-1}\\\\ g_{i+1}&amp;=\\frac{(t-i)(1-2y)g_i+y(2t-i+1)g_{i-1}}{y(i+1)}\\\\ \\end{aligned} (y+(1−2y)x+yx2)i∑​gi+1​(i+1)xiy(i+1)gi+1​+(1−2y)igi​+y(i−1)gi−1​y(i+1)gi+1​y(i+1)gi+1​gi+1​​=(t−2yt+2ytx)i∑​gi​xi=t(1−2y)gi​+2ytgi−1​=t(1−2y)gi​+2ytgi−1​−(1−2y)igi​−y(i−1)gi−1​=(t−i)(1−2y)gi​+y(2t−i+1)gi−1​=y(i+1)(t−i)(1−2y)gi​+y(2t−i+1)gi−1​​​ 那么直接做即可，注意 g0g_0g0​ 和 g1g_1g1​ 要预处理。 部分代码如下： int n,t,a[MS]; int g[S+MS]; int main() { scanf(&quot;%d%d&quot;,&amp;n,&amp;t); int mx=0; for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]),mx=max(mx,a[i]); ploy f1,f2; f1.resize(mx+1,0); f2.resize(mx+1,0); for(int i=1;i&lt;=n;i++) f1[a[i]]++,f2[mx-a[i]]++; ploy res=f1*f2; res[mx]-=n; res[mx]=1ll*res[mx]*qpow(2,p-2)%p; // for(int i=0;i&lt;=mx;i++) printf(&quot;%d &quot;,res[mx+i]); // printf(&quot;\\n&quot;); int y=1ll*(n-2)*qpow(1ll*n*(n-1)/2%p,p-2)%p; int y2=((1-2*y)%p+p)%p; g[0]=qpow(y,t); g[1]=1ll*t*qpow(y,t-1)%p*y2%p; for(int i=1;i&lt;t+mx&amp;&amp;i&lt;t+t;i++) { int x1=(1ll*(t-i)*y2%p+p)%p,x2=(1ll*y*(2*t-i+1)%p+p)%p; int dwn=1ll*y*(i+1)%p; g[i+1]=1ll*(1ll*x1*g[i]%p+1ll*x2*g[i-1]%p)*qpow(dwn,p-2)%p; } // for(int i=0;i&lt;=t+mx;i++) printf(&quot;%d\\n&quot;,g[i]); int ans=0; for(int i=0;i&lt;=mx&amp;&amp;i&lt;=t;i++) add(ans,1ll*g[t+i]*res[mx+i]%p); printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"多项式、生成函数","slug":"XKmkuK_oz","used":true,"link":"https://Rebxe.github.io/tag/XKmkuK_oz/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2024暑期ACM05】游戏 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024-shu-qi-acm05-you-xi-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":353000,"words":1027,"minutes":6},"date":"2024-08-14 16:41:28","dateFormat":"2024-08-14"},{"abstract":"<blockquote>\n<p>你在一个二维平面上，刚开始在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(0,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span></span>。你可以在平面的第一象限（包括坐标轴）中走路，若当前在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(x,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>，则你可以：</p>\n<ul>\n<li>走到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>y</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(x+1,y-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>（前提是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi><mo>−</mo><mn>1</mn><mo>≥</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">y-1\\ge0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7777700000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>）：贡献为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi><msup><mi>y</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">Ay^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>；</li>\n<li>走到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(x+1,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>：贡献为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">By+Cx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathdefault\">x</span></span></span></span>；</li>\n<li>走到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>y</mi><mo>+</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(x+1,y+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>：贡献为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span>；</li>\n</ul>\n<p>定义一条路径的权值为每一步的贡献积。</p>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi><mo separator=\"true\">,</mo><mi>C</mi><mo separator=\"true\">,</mo><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">n,m,A,B,C,D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span>，求从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(0,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span></span> 走到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(n,m)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mclose\">)</span></span></span></span> 的所有路径的权值和，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2.5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le m\\le n\\le 2.5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord\">.</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi><mo separator=\"true\">,</mo><mi>C</mi><mo separator=\"true\">,</mo><mi>D</mi><mo>≤</mo><mn>998244352</mn></mrow><annotation encoding=\"application/x-tex\">0\\le A,B,C,D\\le 998244352</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">2</span></span></span></span>。</p>\n</blockquote>\n","content":" 你在一个二维平面上，刚开始在 (0,0)(0,0)(0,0)。你可以在平面的第一象限（包括坐标轴）中走路，若当前在 (x,y)(x,y)(x,y)，则你可以： 走到 (x+1,y−1)(x+1,y-1)(x+1,y−1)（前提是 y−1≥0y-1\\ge0y−1≥0）：贡献为 Ay2Ay^2Ay2； 走到 (x+1,y)(x+1,y)(x+1,y)：贡献为 By+CxBy+CxBy+Cx； 走到 (x+1,y+1)(x+1,y+1)(x+1,y+1)：贡献为 DDD； 定义一条路径的权值为每一步的贡献积。 给定 n,m,A,B,C,Dn,m,A,B,C,Dn,m,A,B,C,D，求从 (0,0)(0,0)(0,0) 走到 (n,m)(n,m)(n,m) 的所有路径的权值和，对 998244353998244353998244353 取模。 0≤m≤n≤2.5×1050\\le m\\le n\\le 2.5\\times 10^50≤m≤n≤2.5×105，0≤A,B,C,D≤9982443520\\le A,B,C,D\\le 9982443520≤A,B,C,D≤998244352。 (x+1,y+1)(x+1,y+1)(x+1,y+1)：加入一个黑点并不连边，贡献为 DDD； (x+1,y)(x+1,y)(x+1,y)：加入一个白点，并选一个之前的点作为父亲，若连接的是黑点，则贡献为 B+CB+CB+C，否则贡献为 CCC； (x+1,y−1)(x+1,y-1)(x+1,y−1)： 首先 Ay2=A(2(y2)+y)Ay^2=A(2\\binom{y}{2}+y)Ay2=A(2(2y​)+y)； 无序地选择两棵树，让树根的黑点变为白点，并以一个新建的黑点为父亲，贡献为 2A2A2A； 选择一棵树，让树根的黑点变为白点，并以一个新建的白点为父亲，贡献为 AAA； 那么设 fnf_nfn​ 表示根为白点，大小为 nnn 的树的方案数，同理设 gng_ngn​ 表示根为黑点的，考虑最后一个点干了什么： fn=C(n−1)fn−1+Agn−1f_n=C(n-1)f_{n-1}+Ag_{n-1}fn​=C(n−1)fn−1​+Agn−1​； gn=(C(n−1)+B)gn−1+2A∑i=1n−2gign−1−i(n−2i−1)g_n=(C(n-1)+B)g_{n-1}+2A\\sum\\limits_{i=1}^{n-2}g_ig_{n-1-i}\\binom{n-2}{i-1}gn​=(C(n−1)+B)gn−1​+2Ai=1∑n−2​gi​gn−1−i​(i−1n−2​)，最后那个 sigma 是枚举 n−1n-1n−1 所在的树； 显然 f0=f1=g0=0,g1=Df_0=f1=g_0=0,g_1=Df0​=f1=g0​=0,g1​=D，则： fn=C(n−1)fn−1+Agn−1f_n=C(n-1)f_{n-1}+Ag_{n-1}fn​=C(n−1)fn−1​+Agn−1​； gn=(C(n−1)+B)gn−1+2A∑i=0n−1gign−1−i(n−2i−1)=(C(n−1)+B)gn−1+2An−1∑i=0n−1gign−1−i(n−1i)×ig_n=(C(n-1)+B)g_{n-1}+2A\\sum\\limits_{i=0}^{n-1}g_{i}g_{n-1-i}\\binom{n-2}{i-1}=(C(n-1)+B)g_{n-1}+\\frac{2A}{n-1}\\sum\\limits_{i=0}^{n-1}g_{i}g_{n-1-i}\\binom{n-1}{i}\\times ign​=(C(n−1)+B)gn−1​+2Ai=0∑n−1​gi​gn−1−i​(i−1n−2​)=(C(n−1)+B)gn−1​+n−12A​i=0∑n−1​gi​gn−1−i​(in−1​)×i； 显然求出 ggg 后就可以 O(n)O(n)O(n) 求出 fff，而 ggg 可以分治 NTT O(nlog⁡2n)O(n\\log ^2n)O(nlog2n) 求。 注意这个分治 NTT 是自己卷自己的形式。 代码如下： const int S=250005; int fra[S],inv[S]; int n,m,a,b,c,d; int g[S],f[S]; ploy F,G; inline int qinv(int x){return 1ll*inv[x]*fra[x-1]%p;} void slove(int l,int r) { if(l==r) return; int mid=l+r&gt;&gt;1; slove(l,mid); if(l==1) { // [1,mid]*[0,mid] ploy lft,tmp; lft.resize(mid),tmp.resize(mid+1); for(int i=1;i&lt;=mid;i++) lft[i-1]=1ll*g[i]*inv[i-1]%p; for(int i=0;i&lt;=mid;i++) tmp[i]=1ll*g[i]*inv[i]%p; lft=lft*tmp; for(int i=mid+1;i&lt;=r;i++) { int pre=1ll*2*a*qinv(i-1)%p*lft[i-l-1]%p*fra[i-1]%p; add(g[i],pre); } } else { // [l,mid]*[0,r-l] ploy lft,tmp; lft.resize(mid-l+1),tmp.resize(r-l+1); for(int i=l;i&lt;=mid;i++) lft[i-l]=1ll*g[i]*inv[i-1]%p; for(int i=0;i&lt;=r-l;i++) tmp[i]=1ll*g[i]*inv[i]%p; lft=lft*tmp; for(int i=mid+1;i&lt;=r;i++) { int pre=1ll*2*a*qinv(i-1)%p*lft[i-l-1]%p*fra[i-1]%p; add(g[i],pre); } // [1,r-l]*[l,mid] lft.resize(r-l+1),tmp.resize(mid-l+1); lft[0]=0; for(int i=1;i&lt;=r-l;i++) lft[i]=(1ll*g[i]*inv[i-1]%p); for(int i=l;i&lt;=mid;i++) tmp[i-l]=(1ll*g[i]*inv[i]%p); lft=lft*tmp; for(int i=mid+1;i&lt;=r;i++) { int pre=1ll*2*a*qinv(i-1)%p*lft[i-l-1]%p*fra[i-1]%p; add(g[i],pre); } } add(g[mid+1],(1ll*c*mid%p+b)*g[mid]%p); slove(mid+1,r); } int main() { freopen(&quot;frogs.in&quot;,&quot;r&quot;,stdin); freopen(&quot;frogs.out&quot;,&quot;w&quot;,stdout); fra[0]=1; for(int i=1;i&lt;=S-3;i++) fra[i]=1ll*fra[i-1]*i%p; inv[S-3]=qpow(fra[S-3],p-2); for(int i=S-3;i&gt;=1;i--) inv[i-1]=1ll*inv[i]*i%p; scanf(&quot;%d%d%d%d%d%d&quot;,&amp;n,&amp;m,&amp;a,&amp;b,&amp;c,&amp;d); g[0]=0,g[1]=d; slove(1,n); f[0]=f[1]=0; for(int i=2;i&lt;=n;i++) { f[i]=1ll*c*(i-1)%p*f[i-1]%p; add(f[i],1ll*a*g[i-1]%p); } for(int i=0;i&lt;=n;i++) { F.push_back(1ll*f[i]*inv[i]%p); G.push_back(1ll*g[i]*inv[i]%p); } F=exp(F),G=pow2(G,m,m); F=F*G; printf(&quot;%d\\n&quot;,1ll*F[n]*fra[n]%p*inv[m]%p); return 0; } ","tags":[{"name":"多项式、生成函数","slug":"XKmkuK_oz","used":true,"link":"https://Rebxe.github.io/tag/XKmkuK_oz/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2025NOI模拟赛01】青蛙 做题记录","feature":"","link":"https://Rebxe.github.io/post/2025noi-mo-ni-sai-01-qing-wa-zuo-ti-ji-lu/","stats":{"text":"8 min read","time":423000,"words":1266,"minutes":8},"date":"2024-08-08 16:27:52","dateFormat":"2024-08-08"},{"abstract":"<blockquote>\n<p>给定一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span> 点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 边的有向图，Alice 和 Bob 开始博弈。</p>\n<p>刚开始每个点都没有颜色，两个人轮流操作，Alice 先手。第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 轮的人会将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2i-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.74285em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">2i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">i</span></span></span></span> 两个点染上黑色或白色，要求两个点必须一黑一白。</p>\n<p>若最后存在某条边满足其入点为黑色，出点为白色则 Bob 赢，否则 Alice 赢。</p>\n<p>两人都绝顶聪明，求谁赢。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le m\\le 5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个 2n2n2n 点 mmm 边的有向图，Alice 和 Bob 开始博弈。 刚开始每个点都没有颜色，两个人轮流操作，Alice 先手。第 iii 轮的人会将 2i−12i-12i−1 和 2i2i2i 两个点染上黑色或白色，要求两个点必须一黑一白。 若最后存在某条边满足其入点为黑色，出点为白色则 Bob 赢，否则 Alice 赢。 两人都绝顶聪明，求谁赢。 1≤n≤5×1051\\le n\\le 5\\times 10^51≤n≤5×105，0≤m≤5×1050\\le m\\le 5\\times 10^50≤m≤5×105。 不难发现 Bob 赢面很大，所以考虑判断 Alice 能不能赢。 先把每个点的编号减一。设点 iii 最终颜色为 aia_iai​，其中黑色为 111，白色为 000。那么 Alice 赢当且仅当每条边 u→vu\\to vu→v 都满足 au≤ava_u\\le a_vau​≤av​。 考虑新建一个有向图 GGG，GGG 中的连边 u→vu\\to vu→v 表示 au≥ava_u\\ge a_vau​≥av​。对于原图的每条边 u→vu\\to vu→v，GGG 中都会新建边 v→uv\\to uv→u。并且由于 ai=ai⊕1a_i\\not=a_{i\\oplus 1}ai​​=ai⊕1​，所以 au≥ava_u\\ge a_vau​≥av​ 时必然有 av⊕1≥au⊕1a_{v\\oplus 1}\\ge a_{u\\oplus 1}av⊕1​≥au⊕1​，所以 GGG 中还要新建边 u⊕1→v⊕1u\\oplus 1\\to v\\oplus 1u⊕1→v⊕1。 这个时候 ai=ai⊕1a_i\\not=a_{i\\oplus 1}ai​​=ai⊕1​ 的限制已经满足了。观察一下可以发现，对于一条满足两端由不同人染色的边 u→vu\\to vu→v，若 Bob 的点染色时间比 Alice 的晚，则 Alice 一定要防止 Bob 通过这条边赢，所以他染的点的颜色是固定的。具体的，若 Bob 控制的点是 uuu，则 aua_uau​ 必须为 000，在 GGG 中添加边 u⊕1→uu\\oplus1\\to uu⊕1→u；否则添加边 u→u⊕1u\\to u\\oplus 1u→u⊕1。 接下来缩点，缩点后有几种 Bob 赢的情况： uuu 和 u⊕1u\\oplus 1u⊕1 在同一个连通分量； 存在某个连通分量满足其中有至少两个由 Bob 染色的点； 存在某个连通分量满足其中有一个由 Bob 染色的点，且该点不是其连通分量中第一个被染色的点； 某个由 Bob 染色的点可以到达另外一个由 Bob 染色的点； 不难发现这样就是充要的，那么 bfs 一下即可。 时间复杂度 O(n+m)O(n+m)O(n+m)，代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; template&lt;typename T&gt; inline void read(T &amp;x) { x=0; T w=1; char c=getchar(); while(c&lt;'0'||c&gt;'9') w=(c=='-'?-w:w),c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); x=x*w; } const int S=3000005; int n,m; vector&lt;int&gt; g1[S]; int cnt,dfn[S],low[S]; int top,sta[S]; bool vis[S]; int tot,idx[S]; vector&lt;int&gt; vec[S]; vector&lt;int&gt; g[S],gg[S]; bool bb[S],flg[S]; int ind[S],hed,til,que[S*5]; inline bool bob(int x) { return x/2&amp;1; } void dfs(int u) { low[u]=dfn[u]=++cnt; vis[sta[++top]=u]=true; for(int v:g1[u]) { if(dfn[v]==0) dfs(v),low[u]=min(low[u],low[v]); else if(vis[v]) low[u]=min(low[u],dfn[v]); } if(low[u]==dfn[u]) { tot++; while(1) { int v=sta[top--]; vis[v]=false; vec[idx[v]=tot].push_back(v); if(v==u) break; } } } inline void build() { for(int x=0;x&lt;n;x++) { int u=idx[x]; for(int y:g1[x]) { int v=idx[y]; if(u==v) continue; g[u].push_back(v); } } } int main() { freopen(&quot;game.in&quot;,&quot;r&quot;,stdin); freopen(&quot;game.out&quot;,&quot;w&quot;,stdout); read(n),read(m); n*=2; for(int i=1;i&lt;=m;i++) { int x,y; read(x),read(y); if(x==y) continue; x--,y--; g1[y].push_back(x); g1[x^1].push_back(y^1); if(bob(x)==bob(y)) continue; if(bob(x)&amp;&amp;x&gt;y) g1[y].push_back(y^1); if(bob(y)&amp;&amp;x&lt;y) g1[x^1].push_back(x); } // for(int i=0;i&lt;n;i++) for(int v:g1[i]) printf(&quot;%d %d\\n&quot;,i,v); for(int i=0;i&lt;n;i++) if(dfn[i]==0) dfs(i); build(); for(int i=0;i&lt;n;i+=2) if(idx[i]==idx[i^1]) return puts(&quot;Bob&quot;),0; for(int i=1;i&lt;=tot;i++) { if(vec[i].size()==1) bb[i]=bob(vec[i][0]); else { int cnt=0; for(int x:vec[i]) cnt+=bob(x); bb[i]=cnt&gt;0; if(cnt&gt;1) return puts(&quot;Bob&quot;),0; if(cnt==1) { sort(vec[i].begin(),vec[i].end()); if(!bob(vec[i][0])) return puts(&quot;Bob&quot;),0; } } } // puts(&quot;bobo&quot;); for(int i=1;i&lt;=tot;i++) for(int v:g[i]) gg[v].push_back(i); // for(int i=1;i&lt;=tot;i++) // { // printf(&quot;%d %d: %d\\n&quot;,i,vec[i][0],bb[i]); // } hed=1,til=0; for(int i=1;i&lt;=tot;i++) { ind[i]=gg[i].size(); flg[i]=bb[i]; if(ind[i]==0) que[++til]=i; } while(hed&lt;=til) { int u=que[hed++]; for(int v:g[u]) { flg[v]|=flg[u]; if(flg[u]&amp;&amp;bb[v]) return puts(&quot;Bob&quot;),0; if(--ind[v]==0) que[++til]=v; } } puts(&quot;Alice&quot;); return 0; } ","tags":[{"name":"博弈论","slug":"6A-_b3w3J","used":true,"link":"https://Rebxe.github.io/tag/6A-_b3w3J/"},{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2025NOI模拟赛01】图上的游戏 做题记录","feature":"","link":"https://Rebxe.github.io/post/2025noi-mo-ni-sai-02-tu-shang-de-you-xi-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":367000,"words":1180,"minutes":7},"date":"2024-08-05 19:27:20","dateFormat":"2024-08-05"},{"abstract":"<blockquote>\n<p>对于一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 序列，其得分计算方式如下：</p>\n<ul>\n<li>令 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>v</mi><mo>=</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>w</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">v=0,w=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02691em;\">w</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>；</li>\n<li>从前往后依次遍历序列，设当前位为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span>：\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>：<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>v</mi><mo>→</mo><mi>v</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">v\\to v-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>：先 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>v</mi><mo>→</mo><mi>v</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">v\\to v+2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span>，再 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>w</mi><mo>→</mo><mi>w</mi><mo>×</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">w\\to w\\times v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02691em;\">w</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02691em;\">w</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span></span></span></span>；</li>\n</ul>\n</li>\n</ul>\n<p>求所有有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 序列的得分和，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le m\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 对于一个 010101 序列，其得分计算方式如下： 令 v=0,w=1v=0,w=1v=0,w=1； 从前往后依次遍历序列，设当前位为 xxx： x=0x=0x=0：v→v−1v\\to v-1v→v−1； x=1x=1x=1：先 v→v+2v\\to v+2v→v+2，再 w→w×vw\\to w\\times vw→w×v； 求所有有 nnn 个 111，mmm 个 000 的 010101 序列的得分和，对 998244353998244353998244353 取模。 1≤n≤2×1051\\le n\\le 2\\times 10^51≤n≤2×105，0≤m≤1090\\le m\\le 10^90≤m≤109。 转化为格路计数问题： 每一步从 (x,y)(x,y)(x,y) 走到 (x+1,y)(x+1,y)(x+1,y) 或 (x,y+1)(x,y+1)(x,y+1)。 从 (x,y)(x,y)(x,y) 走到 (x+1,y)(x+1,y)(x+1,y) 会让路径权值乘上 2x−y+22x-y+22x−y+2； 从 (x,y)(x,y)(x,y) 走到 (x,y+1)(x,y+1)(x,y+1) 会让路径权值乘上 111； 求从 (0,0)(0,0)(0,0) 走到 (n,m)(n,m)(n,m) 的所有路径权值之和。 考虑把每一步转移放入序列 aaa 中，x+1x+1x+1 为 111，否则为 000，则对于每个 aia_iai​： ai=1a_i=1ai​=1： iii 和它前面的每个 111 都会造成 222 的贡献，故其可以和前面的每个 111 连权值为 222 的无向边 ； iii 和它前面的每个 000 都会造成 −1-1−1 的贡献，故其可以和前面的每个 000 连权值为 −1-1−1 的无向边； iii 还会额外贡献 222 的权值，故其可以和点 000 连权值为 222 的无向边； ai=0a_i=0ai​=0 则只能和点 000 连权值为 111 的无向边； 那么最终会形成以 000 为根的父亲编号比儿子小的一棵树，并且除了点 000 外其它点的儿子 vvv 必定满足 av=1a_v=1av​=1。 那么根据 000 的每个儿子满足 av=0a_v=0av​=0 还是 av=1a_v=1av​=1 计算其子树的答案，最后 EGF 组合起来即可。 设 fnf_nfn​ 表示 av=0a_{v}=0av​=0 且大小为 nnn 的子树的边权积的和（包括 (0,v)(0,v)(0,v) 这条边），gng_ngn​ 表示 av=1a_v=1av​=1 且大小为 nnn 的子树的边权积的和（包括 (0,v)(0,v)(0,v) 这条边），那么考虑最后一个点带来的贡献，有： fn=fn−1×(2(n−2)−1)gn=gn−1×2(n−1)f_n=f_{n-1}\\times(2(n-2)-1)\\\\ g_n=g_{n-1}\\times2(n-1)\\\\ fn​=fn−1​×(2(n−2)−1)gn​=gn−1​×2(n−1) 初值 f0=0,f1=1,g0=0,g1=2f_{0}=0,f_{1}=1,g_{0}=0,g_{1}=2f0​=0,f1​=1,g0​=0,g1​=2。 设 F(x)F(x)F(x) 和 G(x)G(x)G(x) 分别为 fff 和 ggg 的 EGF，则答案即为 [xn+m(n+m)!](F(x)mm!eG(x))\\left[\\frac{x^{n+m}}{(n+m)!}\\right]\\left(\\frac{F(x)^m}{m!}e^{G(x)}\\right)[(n+m)!xn+m​](m!F(x)m​eG(x))。 注意到 [x0]F(x)=0[x^0]F(x)=0[x0]F(x)=0，所以 F(x)F(x)F(x) 可以提出一个 xxx，答案变为 (m+n)!m![xn]((F(x)x)meG(x))\\frac{{(m+n)!}}{m!}\\left[x^{n}\\right]\\left(\\left(\\frac{F(x)}{x}\\right)^me^{G(x)}\\right)m!(m+n)!​[xn]((xF(x)​)meG(x))。 进一步，注意到 eG(x)e^{G(x)}eG(x) 也是很好求的，设 [xnn!]eG(x)=hn[\\frac{x^n}{n!}]e^{G(x)}=h_n[n!xn​]eG(x)=hn​，则考虑最后一个点带来的贡献可以直接求出 hhh： hn=hn−1×(2(n−1)+2)h_{n}=h_{n-1}\\times (2(n-1)+2) hn​=hn−1​×(2(n−1)+2) 其中 h0=1,h1=2h_0=1,h_1=2h0​=1,h1​=2。 设 hhh 的 EGF 为 H(x)H(x)H(x)，则答案即为 (m+n)!m![xn]((F(x)x)mH(x))\\frac{{(m+n)!}}{m!}\\left[x^{n}\\right]\\left(\\left(\\frac{F(x)}{x}\\right)^mH(x)\\right)m!(m+n)!​[xn]((xF(x)​)mH(x))，可以直接 O(nlog⁡n)O(n\\log n)O(nlogn) 算，或者直接快速幂做到 O(nlog⁡2n)O(n\\log ^2n)O(nlog2n)。 ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"多项式、生成函数","slug":"XKmkuK_oz","used":true,"link":"https://Rebxe.github.io/tag/XKmkuK_oz/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2024暑假集训ACM2】G.Competition 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024-shu-jia-ji-xun-acm2-gcompetition-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":282000,"words":954,"minutes":5},"date":"2024-07-11 21:10:02","dateFormat":"2024-07-11"},{"abstract":"<blockquote>\n<p>动物园是一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的网格，初始每个位置都没有动物。</p>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 种动物，每种动物有五个参数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><msub><mi>l</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>y</mi><msub><mi>l</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>x</mi><msub><mi>r</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>y</mi><msub><mi>r</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">xl_i,yl_i,xr_i,yr_i,c_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示这种动物有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">c_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 只且<strong>不适宜</strong>生活在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><msub><mi>l</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>y</mi><msub><mi>l</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(xl_i,yl_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 为左上角，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><msub><mi>r</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>y</mi><msub><mi>r</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(xr_i,yr_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 为右下角的矩形中。</p>\n<p>保证每种动物至少有一个位置适宜生活。</p>\n<p>每只动物需要分配一个适宜生活的位置，每个位置可以容纳无限个动物。</p>\n<p>对于一种分配方案，设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(i,j)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"mclose\">)</span></span></span></span> 有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">c_{i,j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 只动物，则其权值为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>∑</mo><mfrac><mrow><msub><mi>c</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub><mo>(</mo><msub><mi>c</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub><mo>−</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">\\sum \\frac{c_{i,j}(c_{i,j}-1)}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.3773199999999999em;vertical-align:-0.345em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.03232em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.50732em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2818857142857143em;\"><span></span></span></span></span></span></span><span class=\"mopen mtight\">(</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2818857142857143em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。</p>\n<p>求最大权值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le t\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 动物园是一个 n×mn\\times mn×m 的网格，初始每个位置都没有动物。 有 ttt 种动物，每种动物有五个参数 xli,yli,xri,yri,cixl_i,yl_i,xr_i,yr_i,c_ixli​,yli​,xri​,yri​,ci​ 表示这种动物有 cic_ici​ 只且不适宜生活在 (xli,yli)(xl_i,yl_i)(xli​,yli​) 为左上角，(xri,yri)(xr_i,yr_i)(xri​,yri​) 为右下角的矩形中。 保证每种动物至少有一个位置适宜生活。 每只动物需要分配一个适宜生活的位置，每个位置可以容纳无限个动物。 对于一种分配方案，设 (i,j)(i,j)(i,j) 有 ci,jc_{i,j}ci,j​ 只动物，则其权值为 ∑ci,j(ci,j−1)2\\sum \\frac{c_{i,j}(c_{i,j}-1)}{2}∑2ci,j​(ci,j​−1)​。 求最大权值。 1≤n,m≤1031\\le n,m\\le 10^31≤n,m≤103，1≤t≤1061\\le t\\le 10^61≤t≤106。 首先由于 x(x−1)x(x-1)x(x−1) 是凸函数，所以一定是按某个顺序找格子，每次把能放的都放了。 不难注意到一个有用的性质：每种动物都不可能同时覆盖到对角位置（(1,1)(1,1)(1,1) 和 (n,m)(n,m)(n,m)、(1,m)(1,m)(1,m) 和 (n,1)(n,1)(n,1)）*。 设第一个放的位置是 (x,y)(x,y)(x,y)，则剩下动物的矩形必然包含 (x,y)(x,y)(x,y)，之后的位置 (x′,y′)(x&#x27;,y&#x27;)(x′,y′) 若在其左上方则令 (x′,y′)(x&#x27;,y&#x27;)(x′,y′) 变为 (1,1)(1,1)(1,1) 一定不劣，因为包含 (x,y)(x,y)(x,y) 但不包含其左上方某个位置的矩形一定不包含 (1,1)(1,1)(1,1)。 同理，放完 (x,y)(x,y)(x,y) 后只可能在角上放。 根据性质*，放完 (x,y)(x,y)(x,y) 后放两个对角一定是最优的。 那么做几次二位前缀和，枚举 (x,y)(x,y)(x,y) 统计答案即可。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; using namespace std; const int S=1000005,MS=1005; typedef long long ll; template&lt;typename T&gt; inline void read(T &amp;x) { x=0; T w=1; char c=getchar(); while(c&lt;'0'||c&gt;'9') w=(c=='-'?-w:w),c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); x*=w; } int tt,n,m; int lx[S],rx[S],ly[S],ry[S]; ll a[S]; ll sm,c[MS][MS],d[4][MS][MS]; inline void csum(ll c[MS][MS]) { for(int i=1;i&lt;=n;i++) { for(int j=1;j&lt;=m;j++) { c[i][j]+=c[i-1][j]+c[i][j-1]-c[i-1][j-1]; } } } inline void add(int st,int lx,int rx,int ly,int ry,ll w) { d[st][lx][ly]+=w; d[st][lx][ry+1]-=w; d[st][rx+1][ly]-=w; d[st][rx+1][ry+1]+=w; } int main() { freopen(&quot;specie.in&quot;,&quot;r&quot;,stdin); freopen(&quot;specie.out&quot;,&quot;w&quot;,stdout); read(tt),read(n),read(m); for(int i=1;i&lt;=tt;i++) { read(lx[i]),read(ly[i]),read(rx[i]),read(ry[i]),read(a[i]); sm+=a[i]; c[lx[i]][ly[i]]+=a[i]; c[lx[i]][ry[i]+1]-=a[i]; c[rx[i]+1][ly[i]]-=a[i]; c[rx[i]+1][ry[i]+1]+=a[i]; if(lx[i]!=1||ly[i]!=1) add(0,lx[i],rx[i],ly[i],ry[i],a[i]); if(rx[i]!=n||ry[i]!=m) add(1,lx[i],rx[i],ly[i],ry[i],a[i]); if(lx[i]!=1||ry[i]!=m) add(2,lx[i],rx[i],ly[i],ry[i],a[i]); if(rx[i]!=n||ly[i]!=1) add(3,lx[i],rx[i],ly[i],ry[i],a[i]); } csum(c); for(int x=0;x&lt;4;x++) csum(d[x]); ll ans=0; for(int i=1;i&lt;=n;i++) { for(int j=1;j&lt;=m;j++) { ll pre=0; for(int k=0;k&lt;4;k++) { pre=max(pre,d[k][i][j]*(d[k][i][j]-1)/2+(c[i][j]-d[k][i][j])*(c[i][j]-d[k][i][j]-1)/2); } pre+=(sm-c[i][j])*(sm-c[i][j]-1)/2; ans=max(ans,pre); } } printf(&quot;%lld\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2024广东集训01-1】specie 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024-guang-dong-ji-xun-01-1-specie-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":293000,"words":925,"minutes":5},"date":"2024-05-25 19:39:12","dateFormat":"2024-05-25"},{"abstract":"<blockquote>\n<p>给定一个长 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的字符串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 次查询 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>∈</mo><mo>[</mo><msub><mi>L</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>R</mi><mi>i</mi></msub><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">r\\in[L_i,R_i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 的所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 的子串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>s</mi><mrow><mo>[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">s_{[l,r]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span> 有多少个本质不同的回文串。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>q</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,q\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 字符集为小写字母。</p>\n</blockquote>\n","content":" 给定一个长 nnn 的字符串 sss，qqq 次询问，第 iii 次查询 r∈[Li,Ri]r\\in[L_i,R_i]r∈[Li​,Ri​] 的所有 sss 的子串 s[l,r]s_{[l,r]}s[l,r]​ 有多少个本质不同的回文串。 1≤n,q≤2×1051\\le n,q\\le 2\\times 10^51≤n,q≤2×105，sss 字符集为小写字母。 赛时题解 先求出每个点往左往右拓展的长度（二分哈希/Manacher），再建 SAM，扫描线求出 SAM 每个节点中回文串个数。 问题转化为： 给定一棵有点权的有根树和一个节点序列 aaa，qqq 次询问，每次求 a[l,r]a_{[l,r]}a[l,r]​ 到根的路径覆盖到的所有点的点权和。 可以离线。 回滚莫队维护，O(nn)O(n\\sqrt n)O(nn​)。 总复杂度 O(nlog⁡n+nn)O(n\\log n+n\\sqrt n)O(nlogn+nn​)。 赛后题解 最后一步也可以先树剖再启发式合并维护每个点子树中点在 aaa 中出现位置的集合，先把 uuu 的贡献算进其重儿子，启发式合并维护轻儿子的贡献。 具体的，令 uuu 的子树大小为子树中每个点在 aaa 中出现的次数之和，按照这个定义进行重链剖分。 剖分完令 wuw_uwu​ 为 uuu 到其所在重链链顶的点权和，stust_ustu​ 为 uuu 子树中每个点在 aaa 中出现位置的集合，则 stust_ustu​ 直接从 sthevust_{hev_u}sthevu​​ 继承（hevuhev_uhevu​ 为 uuu 的重儿子），然后把 uuu 在 aaa 中的出现位置插入到 stust_ustu​，再遍历 uuu 的轻儿子 vvv，把 x∈stvx\\in st_vx∈stv​ 插入到 stust_ustu​。 每次插入 xxx 找到其前驱后继 lb,rblb,rblb,rb，给 l∈[lb,x],r∈[x,rb]l\\in [lb,x],r\\in [x,rb]l∈[lb,x],r∈[x,rb] 的所有区间 [l,r][l,r][l,r] 增加 wuw_uwu​ 的贡献，这个可以离线再用扫描线维护。 这样由于轻儿子 stvst_vstv​ 的大小总是不超过 stust_ustu​ 的大小，所以时间复杂度是启发式合并的复杂度，总复杂度 O(nlog⁡2n)O(n\\log ^2n)O(nlog2n)。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; #include &lt;vector&gt; #include &lt;queue&gt; #include &lt;set&gt; using namespace std; typedef long long ll; const int S=200005,MS=8000005,V=26; const int bse=31,p1=998244353,p2=1000000007; struct SAM { int cnt,lst; int len[S*2],to[S*2][V],link[S*2]; int rt[S*2]; vector&lt;int&gt; son[S*2]; int rb[S*2],rbs[S*2],siz[S*2]; inline void init() { cnt=lst=0; len[0]=0; memset(to[0],0,sizeof(to[0])); link[0]=-1; } inline void ins(int c) { int u=++cnt; len[u]=len[lst]+1; memset(to[u],0,sizeof(to[u])); int p=lst; while(p!=-1&amp;&amp;to[p][c]==0) to[p][c]=u,p=link[p]; if(p==-1) link[u]=0; else { int q=to[p][c]; if(len[q]==len[p]+1) link[u]=q; else { int cpy=++cnt; len[cpy]=len[p]+1; memcpy(to[cpy],to[q],sizeof(to[q])); link[cpy]=link[q]; link[q]=cpy; while(p!=-1&amp;&amp;to[p][c]==q) to[p][c]=cpy,p=link[p]; link[u]=cpy; } } lst=u; rt[len[u]]=u; } void dfs(int u,int fa) { for(int v:son[u]) dfs(v,u),rb[u]=max(rb[u],rb[v]),rbs[u]+=rbs[v]; } inline void build() { for(int i=1;i&lt;=cnt;i++) son[link[i]].push_back(i); for(int i=1;i&lt;=len[lst];i++) rb[rt[i]]=i,rbs[rt[i]]++; dfs(0,0); } }; struct node { int lb,rb,p,w; }; int n,Q; char a[S]; vector&lt;pair&lt;int,int&gt; &gt; que[S]; SAM sam; int b[S*2],ext[S*2],len[S*2]; vector&lt;pair&lt;pair&lt;int,int&gt;,int&gt; &gt; vec[S]; int tr[S*3]; int idx[S*2]; int hev[S*2],tp[S*2],sm[S*2]; set&lt;int&gt; st[S*2]; vector&lt;node&gt; cge; ll ans[S]; inline void manacher() { int m=n*2+1; for(int i=1;i&lt;=n;i++) b[i*2]=a[i]; for(int i=1;i&lt;=m;i+=2) b[i]=-2; b[0]=-1,b[m+1]=-3; for(int i=1,p=0;i&lt;=m;i++) { ext[i]=1; if(p+ext[p]-1&gt;=i) ext[i]=min(ext[2*p-i],p+ext[p]-i); while(b[i-ext[i]]==b[i+ext[i]]) ext[i]++; if(i+ext[i]&gt;p+ext[p]) p=i; } for(int i=1;i&lt;=n;i++) len[i]=ext[i*2]/2,len[n+i]=ext[i*2+1]/2; } inline void addtr(int p,int x) { p+=n*2; for(int i=p;i&lt;=n*3;i+=i&amp;-i) tr[i]+=x; } inline int quetr(int p) { p+=n*2; int res=0; for(int i=p;i&gt;=1;i-=i&amp;-i) res+=tr[i]; return res; } void dfs1(int u) { hev[u]=-1; for(int v:sam.son[u]) { dfs1(v); if(hev[u]==-1||sam.rbs[v]&gt;sam.rbs[hev[u]]) hev[u]=v; } } void dfs2(int u,int top) { tp[u]=top; sm[u]+=sam.siz[u]; if(hev[u]!=-1) sm[hev[u]]+=sm[u],dfs2(hev[u],top); for(int v:sam.son[u]) if(v!=hev[u]) dfs2(v,v); } void dfs3(int u) { if(hev[u]!=-1) dfs3(hev[u]); int rt=tp[u]; if(idx[u]!=0) { int x=idx[u]; int lb,rb; auto p=st[rt].upper_bound(x); if(p==st[rt].begin()) lb=1; else lb=*prev(p)+1; p=st[rt].lower_bound(x); if(p==st[rt].end()) rb=n; else rb=*p-1; if(lb&lt;=x&amp;&amp;rb&gt;=x) { // ([lb,x],[x,rb]) cge.push_back((node){lb,x,x,sm[u]}); if(rb&lt;n) cge.push_back((node){lb,x,rb+1,-sm[u]}); st[rt].insert(x); } } for(int v:sam.son[u]) { if(v==hev[u]) continue; dfs3(v); for(int x:st[v]) { int lb,rb; auto p=st[rt].upper_bound(x); if(p==st[rt].begin()) lb=1; else lb=*prev(p)+1; p=st[rt].lower_bound(x); if(p==st[rt].end()) rb=n; else rb=*p-1; if(lb&lt;=x&amp;&amp;rb&gt;=x) { // ([lb,x],[x,rb]) cge.push_back((node){lb,x,x,sm[u]}); if(rb&lt;n) cge.push_back((node){lb,x,rb+1,-sm[u]}); st[rt].insert(x); } } } } int main() { freopen(&quot;necklace.in&quot;,&quot;r&quot;,stdin); freopen(&quot;necklace.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%s%d&quot;,a+1,&amp;Q); for(int i=1;i&lt;=Q;i++) { int l,r; scanf(&quot;%d%d&quot;,&amp;l,&amp;r); que[r].emplace_back(l,i); } n=strlen(a+1); for(int i=1;i&lt;=n;i++) a[i]-='a'; sam.init(); for(int i=1;i&lt;=n;i++) sam.ins(a[i]); sam.build(); manacher(); for(int i=1;i&lt;=sam.cnt;i++) { vec[sam.rb[i]].emplace_back(make_pair(sam.len[sam.link[i]]+1,sam.len[i]),i); } priority_queue&lt;pair&lt;int,int&gt; &gt; q; for(int i=1;i&lt;=n;i++) { while(!q.empty()&amp;&amp;-q.top().first&lt;i) addtr(q.top().second,-1),q.pop(); int r=i+len[i]-1,sz=1-i*2; addtr(sz,1); q.push(make_pair(-r,sz)); if(i&gt;1&amp;&amp;len[n+i-1]&gt;0) { int r=i+len[n+i-1]-1,sz=2-i*2; addtr(sz,1); q.push(make_pair(-r,sz)); } for(auto t:vec[i]) { int lb=t.first.first,rb=t.first.second,id=t.second; sam.siz[id]=quetr(rb-i*2)-quetr(lb-1-i*2); // printf(&quot;((%d %d) %d) %d\\n&quot;,lb,rb,i,sam.siz[id]); } } // for(int i=0;i&lt;=sam.cnt;i++) // { // for(int v:sam.son[i]) printf(&quot;%d %d\\n&quot;,i,v); // } // for(int i=0;i&lt;=sam.cnt;i++) printf(&quot;%d &quot;,sam.siz[i]); // printf(&quot;\\n&quot;); // for(int i=1;i&lt;=n;i++) printf(&quot;%d &quot;,sam.rt[i]); // printf(&quot;\\n&quot;); for(int i=1;i&lt;=n;i++) idx[sam.rt[i]]=i; dfs1(0),dfs2(0,0); // for(int i=0;i&lt;=sam.cnt;i++) printf(&quot;%d: (%d %d)\\n&quot;,i,tp[i],sm[i]); for(int i=1;i&lt;=n*3;i++) tr[i]=0; dfs3(0); sort(cge.begin(),cge.end(),[&amp;](node x,node y){return x.p&lt;y.p;}); for(int i=1,j=0;i&lt;=n;i++) { while(j&lt;cge.size()&amp;&amp;cge[j].p==i) addtr(cge[j].lb,cge[j].w),addtr(cge[j].rb+1,-cge[j].w),j++; for(auto t:que[i]) ans[t.second]+=quetr(t.first); } for(int i=1;i&lt;=Q;i++) printf(&quot;%lld\\n&quot;,ans[i]); return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"字符串","slug":"wtMqnxQGh","used":true,"link":"https://Rebxe.github.io/tag/wtMqnxQGh/"}],"title":"【2024NOI模拟赛11】项链 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noi-mo-ni-sai-11-xiang-lian-zuo-ti-ji-lu/","stats":{"text":"10 min read","time":589000,"words":1752,"minutes":10},"date":"2024-02-26 18:29:50","dateFormat":"2024-02-26"},{"abstract":"<blockquote>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个灯泡，每个灯泡有一个参数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示若 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1,i-1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> 中有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≥</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\ge a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 个灯泡点亮了那么第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 个灯泡会自动点亮。</p>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>，求至少手动点亮多少个灯泡才能保证总共有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 个灯泡被点亮。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le n\\le 5\\times 10^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span>，要求线性。</p>\n</blockquote>\n","content":" 有 nnn 个灯泡，每个灯泡有一个参数 aia_iai​ 表示若 [1,i−1][1,i-1][1,i−1] 中有 ≥ai\\ge a_i≥ai​ 个灯泡点亮了那么第 iii 个灯泡会自动点亮。 给定 mmm，求至少手动点亮多少个灯泡才能保证总共有 mmm 个灯泡被点亮。 1≤m≤n≤5×1071\\le m\\le n\\le 5\\times 10^71≤m≤n≤5×107，要求线性。 困难 Div2 C。 注意到 mmm 越小越好，nnn 越大越好。 考虑倒着做。观察到若 an≤m−1a_n\\le m-1an​≤m−1，那么限制可以转化为前 n−1n-1n−1 个灯泡中有 m−1m-1m−1 个被点亮，并且这样转化一定不劣；否则 ana_nan​ 不可能被点亮，可以直接扔掉。 最终会有一个时刻 n=mn=mn=m，这时直接从前往后贪心求出代价即可。 时间复杂度 O(n)O(n)O(n)，代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; inline int read() { int x=0,c=getchar(); while(c&lt;'0'||c&gt;'9') c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') x=x*10+c-'0',c=getchar(); return x; } const int S=50000005; int n,m,a[S]; int main() { freopen(&quot;bs.in&quot;,&quot;r&quot;,stdin); freopen(&quot;bs.out&quot;,&quot;w&quot;,stdout); n=read(),m=read(); a[1]=read(); int k=read(); for(int i=1,j=2;i&lt;=k;i++) { int c=read(),x=read(),y=read(),z=read(); while(c--&gt;0) { a[j]=(1ll*x*a[j-1]+y)%z; j++; } } for(int i=n;i&gt;=1;i--) { if(a[i]&lt;m) m--; if(i==m) break; } int ans=0; for(int i=1,ct=0;i&lt;=m;i++) if(a[i]&gt;=i) ans++; printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2024NOI模拟赛08】二分 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noi-mo-ni-sai-08-er-fen-zuo-ti-ji-lu/","stats":{"text":"2 min read","time":119000,"words":394,"minutes":2},"date":"2024-02-21 16:35:42","dateFormat":"2024-02-21"},{"abstract":"<blockquote>\n<p>给定一张 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条边的简单无向图和一个正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span>，对于这个无向图的所有匹配 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span>，求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>c</mi><mrow><mi mathvariant=\"normal\">∣</mi><mi>S</mi><mi mathvariant=\"normal\">∣</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">c^{|S|}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8879999999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8879999999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mtight\">∣</span></span></span></span></span></span></span></span></span></span></span></span> 的和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mtext>mod </mtext><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">\\text{mod }10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord text\"><span class=\"mord\">mod </span></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 的结果。</p>\n<p>一个可空边集 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 被称为匹配当且仅当 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 中任意两条边没有公共点。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>36</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 36</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">6</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mfrac><mrow><mi>n</mi><mo>(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">0\\le m\\le \\frac{n(n-1)}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>c</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">1\\le c\\le 10^9+6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">6</span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一张 nnn 个点 mmm 条边的简单无向图和一个正整数 ccc，对于这个无向图的所有匹配 SSS，求 c∣S∣c^{|S|}c∣S∣ 的和 mod 109+7\\text{mod }10^9+7mod 109+7 的结果。 一个可空边集 SSS 被称为匹配当且仅当 SSS 中任意两条边没有公共点。 1≤n≤361\\le n\\le 361≤n≤36，0≤m≤n(n−1)20\\le m\\le \\frac{n(n-1)}{2}0≤m≤2n(n−1)​，1≤c≤109+61\\le c\\le 10^9+61≤c≤109+6。 先将点转化为 0-index。 有个很神奇的转化：对于每个 iii，在 2i2i2i 和 2i+12i+12i+1 之间连一条虚边，那么每个匹配都会形成虚实边交错的若干环和链。 不难发现转化后 2i2i2i 和 2i+12i+12i+1 必定是相邻的，那么不妨把它们缩成一个大点，这样就只剩下 n2\\frac{n}{2}2n​ 个点了。统计这些大点组成环和链的方案数再组合起来即可，时间复杂度 O(2n2n2)O(2^\\frac{n}{2}n^2)O(22n​n2)（子集 exp）或 O(3n2)O(3^\\frac{n}{2})O(32n​)（暴力枚举子集）。 具体的，把每个大点内的两个点看作两个插头。对于链的情况，设 fs,xf_{s,x}fs,x​ 表示使用了集合 sss 中的大点，暴露在外的插头为 xxx 的方案数，初始 f{i},2i=f{i},2i+1=1f_{\\{i\\},2i}=f_{\\{i\\},2i+1}=1f{i},2i​=f{i},2i+1​=1；对于环的情况，先把环从编号最小的大点 uuu 的插头 2u2u2u 处断开，设 gs,xg_{s,x}gs,x​ 表示使用了集合 sss 中的大点，暴露在外的插头为 xxx 的方案数，初始 g{i},2i+1=1g_{\\{i\\},2i+1}=1g{i},2i+1​=1，最后再把环接起来。 注意链的方案数要除以二。 O(3n2)O(3^\\frac{n}2)O(32n​) 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=36; const int p=1000000007,inv2=(p+1)/2; int n,m,c; bool a[S][S]; int f[1&lt;&lt;(S/2)][S],g[1&lt;&lt;(S/2)][S]; // f:link g:circle int h[1&lt;&lt;(S/2)],re[1&lt;&lt;S/2]; inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } inline int mlog(int x) { int res=0; while(x&gt;1) res++,x&gt;&gt;=1; return res; } int main() { freopen(&quot;dfs.in&quot;,&quot;r&quot;,stdin); freopen(&quot;dfs.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;c); for(int i=1;i&lt;=m;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); x--,y--; a[x][y]=a[y][x]=true; } n=(n+1)/2; for(int i=0;i&lt;n;i++) f[1&lt;&lt;i][i*2]=f[1&lt;&lt;i][i*2+1]=1,g[1&lt;&lt;i][i*2+1]=1; for(int i=0;i&lt;(1&lt;&lt;n);i++) { for(int u=0;u&lt;n*2;u++) { if(f[i][u]==0&amp;&amp;g[i][u]==0) continue; for(int j=0;j&lt;n;j++) { if(i&gt;&gt;j&amp;1) continue; for(int k=0;k&lt;=1;k++) { int v=j*2+k; if(!a[u][v]) continue; add(f[i|(1&lt;&lt;j)][j*2+(k^1)],1ll*f[i][u]*c%p); } if((1&lt;&lt;j)&lt;(i&amp;-i)) continue; for(int k=0;k&lt;=1;k++) { int v=j*2+k; if(!a[u][v]) continue; add(g[i|(1&lt;&lt;j)][j*2+(k^1)],1ll*g[i][u]*c%p); } } } } for(int i=1;i&lt;(1&lt;&lt;n);i++) { for(int v=0;v&lt;n*2;v++) add(h[i],1ll*f[i][v]*inv2%p); int u=mlog(i&amp;-i)*2; for(int v=0;v&lt;n*2;v++) { if(!a[u][v]) continue; add(h[i],1ll*g[i][v]*c%p); } } re[0]=1; for(int i=1;i&lt;(1&lt;&lt;n);i++) { int st=i&amp;-i; for(int j=(i^st);;j=(j-1)&amp;(i^st)) { add(re[i],1ll*re[i^j^st]*h[j^st]%p); if(j==0) break; } } printf(&quot;%d\\n&quot;,re[(1&lt;&lt;n)-1]); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2024NOI模拟赛07】爆搜 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noi-mo-ni-sai-07-bao-sou-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":289000,"words":914,"minutes":5},"date":"2024-02-21 16:33:43","dateFormat":"2024-02-21"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">n,m,b,c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span>，求满足下列条件长 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>x</mi><mi>m</mi></msub><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">\\{x_1,\\dots,x_m\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span> 的个数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mtext>mod </mtext><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">\\text{mod }998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord text\"><span class=\"mord\">mod </span></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span>：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>∈</mo><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">x_i\\in\\mathbb Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6891em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord mathbb\">Z</span></span></span></span>；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>x</mi><mi>i</mi></msub><mo>≤</mo><msup><mi>b</mi><mi>i</mi></msup><mo>−</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">0\\le x_i\\le b^i-c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.907994em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824664em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span>；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>∑</mo><msub><mi>x</mi><mi>i</mi></msub><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\sum x_i&lt;n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>；</li>\n</ul>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup><mo>≤</mo><mi>c</mi><mo>&lt;</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">-10^8\\le c&lt;b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.950078em;vertical-align:-0.13597em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>b</mi><mo>&lt;</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le b&lt;10^8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>80</mn></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le 80</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">8</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><msup><mi>b</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le b^{m+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">m</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 n,m,b,cn,m,b,cn,m,b,c，求满足下列条件长 mmm 的序列 {x1,…,xm}\\{x_1,\\dots,x_m\\}{x1​,…,xm​} 的个数 mod 998244353\\text{mod }998244353mod 998244353： xi∈Zx_i\\in\\mathbb Zxi​∈Z； 0≤xi≤bi−c0\\le x_i\\le b^i-c0≤xi​≤bi−c； ∑xi&lt;n\\sum x_i&lt;n∑xi​&lt;n； −108≤c&lt;b-10^8\\le c&lt;b−108≤c&lt;b，2≤b&lt;1082\\le b&lt;10^82≤b&lt;108，1≤m≤801\\le m\\le 801≤m≤80，1≤n≤bm+11\\le n\\le b^{m+1}1≤n≤bm+1。 先将 nnn 减一，然后枚举超出上限的位置集合，插板： ∑S(−1)∣S∣(n+m+∣S∣(c−1)−∑i∈Sbim)\\sum\\limits_{S}(-1)^{|S|}\\binom{n+m+|S|(c-1)-\\sum\\limits_{i\\in S}b^i}{m} S∑​(−1)∣S∣(mn+m+∣S∣(c−1)−i∈S∑​bi​) 记 X=n+m+∣S∣(c−1)X=n+m+|S|(c-1)X=n+m+∣S∣(c−1)，枚举 ∣S∣|S|∣S∣ 以及 XXX 与 ∑i∈Sbi\\sum\\limits_{i\\in S}b^ii∈S∑​bi 的 lcp 以确定 XXX 和去掉 ∑i∈Sbi≤X\\sum\\limits_{i\\in S} b^i\\le Xi∈S∑​bi≤X 的限制： ∑∣S∣,lcp(−1)∣S∣(X−∑i∈Sbim)=1m!∑∣S∣,lcp(−1)∣S∣∏i=X−∑i∈Sbi−m+1X−∑i∈Sbii=1m!∑∣S∣,lcp(−1)∣S∣∏i=X−m+1X(i−∑i∈Sbi)\\sum\\limits_{|S|,lcp}(-1)^{|S|}\\binom{X-\\sum\\limits_{i\\in S}b^i}{m}\\\\ =\\frac{1}{m!}\\sum\\limits_{|S|,lcp}(-1)^{|S|}\\prod\\limits_{i=X-\\sum\\limits_{i\\in S}b^i-m+1}^{X-\\sum\\limits_{i\\in S}b^i} i\\\\ =\\frac{1}{m!}\\sum\\limits_{|S|,lcp}(-1)^{|S|}\\prod\\limits_{i=X-m+1}^{X}\\left(i-\\sum\\limits_{i\\in S}b^i\\right)\\\\ ∣S∣,lcp∑​(−1)∣S∣(mX−i∈S∑​bi​)=m!1​∣S∣,lcp∑​(−1)∣S∣i=X−i∈S∑​bi−m+1∏X−i∈S∑​bi​i=m!1​∣S∣,lcp∑​(−1)∣S∣i=X−m+1∏X​(i−i∈S∑​bi) ∏i=X−m+1X(i−∑i∈Sbi)\\prod\\limits_{i=X-m+1}^{X}\\left(i-\\sum\\limits_{i\\in S}b^i\\right)\\\\i=X−m+1∏X​(i−i∈S∑​bi) 是个 mmm 次多项式，算出 (∑i∈Sbi)\\left(\\sum\\limits_{i\\in S}b^i\\right)(i∈S∑​bi) 每个次幂的系数即可计算。 那么设 fi,j,kf_{i,j,k}fi,j,k​ 表示从 {b0,b1,…,bi}\\{b^0,b^1,\\dots,b^i\\}{b0,b1,…,bi} 中选出 jjj 个的和的 kkk 次方和，转移直接二项式定理： fi,j,k=fi−1,j,k+∑p=0kfi−1,j−1,p×bi(k−p)×(kp)f_{i,j,k}=f_{i-1,j,k}+\\sum\\limits_{p=0}^k f_{i-1,j-1,p}\\times b^{i(k-p)}\\times \\binom{k}{p} fi,j,k​=fi−1,j,k​+p=0∑k​fi−1,j−1,p​×bi(k−p)×(pk​) ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2024NOI模拟赛07】签到 做题记录","feature":"","link":"https://Rebxe.github.io/post/2024noi-mo-ni-sai-07-qian-dao-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":197000,"words":571,"minutes":4},"date":"2024-02-21 16:32:09","dateFormat":"2024-02-21"},{"abstract":"","content":"之前一直以为九级意味着银牌，意味着结束，真的九级了才发现只是一个微不足道的开始。 宿舍很舒服，充电很麻烦，23：00 到 8：00 九个小时睡觉时间很爽，自助餐很好吃，酸菜粉丝汤很阴间，有很多牛奶和水果。 讲课很无用只能当熏陶，比赛题目数据很水，100+100+20 肮脏卡线 au： T1 是简单题； T2 猜测 2L2L2L 在一个区间内，过了所有大样例，但是怎么想怎么不对，感觉是假的，具体就是合并两个区间 [l1,r1][l1,r1][l1,r1] 和 [l2,r2][l2,r2][l2,r2] 直接 [min⁡(l1,l2),max⁡(r1,r2)][\\min(l1,l2),\\max(r1,r2)][min(l1,l2),max(r1,r2)]，但是判断了一下发现会出现 l2&gt;r1l2&gt;r1l2&gt;r1 的情况，这时区间会出现空洞； T3 猜测是先向上推再向下推，最后要求每个极长区间都知道，但是一直过不去 n=100n=100n=100，感觉是假的； 感觉想题还是容易进入死胡同出不来，T2 2L2L2L 的取值只有 O(n)O(n)O(n) 个的性质没发现，T3 一直调不出来没有换思路。 娱乐方面学会了七鬼五二三，具体玩法如下： 可以任意多副牌参与游戏，参与游戏的人数任意； 牌型和比较规则： 大小顺序从大到小为七鬼五二三，剩下的按照原来顺序，有花色，花色从大到小为黑桃，红桃，梅花，方块； 牌型有：单张，对子，二带一，三张炸，四张炸，五张炸，王炸（任意多张王）； 单张完全一样后出的小（不能压）； 对子比较方法：设对子为 (x,y)(x,y)(x,y)，则按 xxx 为第一关键字，yyy 为第二关键字来比较，完全一样大则后出的小（不能压）； 二带一比较方法：先按照对子比较方法比较“二”，完全一样再按单张比较方法比较“一”，完全一样则后出的小（不能压）； 炸弹可以压除了炸弹外的所有牌型，炸弹压炸弹则要比大小； 炸弹比较方法： 先比张数：三张炸比四张炸小，四张炸比五张炸小，王炸一个王算两张； 再比最大，最大一样比次大，以此类推，完全一样则后出的小（不能压）； 计分方法： 555 是五分，101010 和 K\\text{K}K 都是十分； 每一轮最后拿到牌权的人拿走这一轮的所有分牌，累加进自己的得分； 摸牌规则： 每一轮结束后由拿牌权的人开始，按出牌顺序依次摸牌； 每个人摸到自己手中有五张牌或牌堆清空为止； 最后一轮特殊规则： 最后一轮能压必须压； 最后一个人手上的所有分牌均不得分，不累加给自己； ","tags":[{"name":"WC","slug":"vQG6fBi1G","used":true,"link":"https://Rebxe.github.io/tag/vQG6fBi1G/"},{"name":2024,"slug":"qfvk1PejDh","used":true,"link":"https://Rebxe.github.io/tag/qfvk1PejDh/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"WC2024 游记","feature":"","link":"https://Rebxe.github.io/post/wc2024-you-ji/","stats":{"text":"3 min read","time":162000,"words":747,"minutes":3},"date":"2024-02-17 21:15:01","dateFormat":"2024-02-17"},{"abstract":"<blockquote>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点，给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条有顺序的无向边和一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，每次询问给定一个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><msub><mi>l</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>r</mi><mi>i</mi></msub><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[l_i,r_i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>，问应用区间内的边后连通块个数是否 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≤</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">\\le k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。</p>\n<p>询问相互独立，强制在线。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le k\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le q\\le 5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有 nnn 个点，给定 mmm 条有顺序的无向边和一个 kkk。 qqq 次询问，每次询问给定一个区间 [li,ri][l_i,r_i][li​,ri​]，问应用区间内的边后连通块个数是否 ≤k\\le k≤k。 询问相互独立，强制在线。 1≤n,m≤2×1051\\le n,m\\le 2\\times 10^51≤n,m≤2×105，1≤k≤n1\\le k\\le n1≤k≤n，1≤q≤5×1051\\le q\\le 5\\times 10^51≤q≤5×105。 考虑求出 frf_rfr​ 表示最大的使得 [fr,r][f_r,r][fr​,r] 合法的左端点。 一个朴素的做法是扫描线，用 LCT 维护。 但是我们不会 LCT。 注意到双指针过程中左端点 lll 扫过的边 (xp,yp)(x_p,y_p)(xp​,yp​) 会对 f[p,n]f_{[p,n]}f[p,n]​ 有贡献，而由于 f[r+1,n]f_{[r+1,n]}f[r+1,n]​ 都不需要这条边，所以只会对 f[p,r]f_{[p,r]}f[p,r]​ 有贡献。 这种一个操作对某个区间有贡献的情况，不妨考虑线段树分治。 不同于一般情况，在本题中线段树分治的同时会加入新的操作，所以本题的线段树分治是半在线的。 具体的，线段树分治时维护一个并查集： 先分治右边再分治左边； 若当前点是叶子，则先令 fl=fl+1f_l=f_{l+1}fl​=fl+1​，然后不断往左推 flf_lfl​ 直到合法； 在推的过程中，在并查集中加入新的边，并把新的边 (xp,yp)(x_p,y_p)(xp​,yp​) 加入区间 [p,l−1][p,l-1][p,l−1]； 在 return 之前清空并查集中在当前节点新加入的所有边； 代码如下： void slove(int u,int l,int r) { int tp=top; for(int x:idx[u]) meg(rx[x],ry[x]); if(l==r) { f[l]=f[l+1]; while(f[l]&gt;1&amp;&amp;cnt&gt;K) { f[l]--; meg(rx[f[l]],ry[f[l]]); add(1,1,m,f[l],l-1,f[l]); } if(cnt&gt;K&amp;&amp;f[l]&gt;=1) f[l]=0; } else { int mid=l+r&gt;&gt;1; slove(u&lt;&lt;1|1,mid+1,r); slove(u&lt;&lt;1,l,mid); } rolbak(tp); } 由于 l∈[p,l−1]l\\not\\in[p,l-1]l​∈[p,l−1]，所以从 lll 去到 l−1l-1l−1 的过程中一定会经过 [p,l−1][p,l-1][p,l−1] 拆分出的线段树上的节点，所以直接清空并查集中在当前节点新加入的所有边是没有问题的。 时间复杂度 O(mlog⁡mlog⁡n)O(m\\log m\\log n)O(mlogmlogn)（log⁡n\\log nlogn 来自并查集），完整代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; const int S=200005; int n,m,K,tp; int rx[S],ry[S]; int cnt,fa[S],hei[S]; int top,fap[S],fax[S],hip[S],hix[S],ctx[S]; vector&lt;int&gt; idx[S&lt;&lt;2]; int f[S]; int q; int fnd(int x) { return fa[x]==x?x:fnd(fa[x]); } inline void meg(int x,int y) { int rx=fnd(x),ry=fnd(y); if(hei[rx]&gt;hei[ry]) swap(rx,ry); if(rx!=ry) { top++; fap[top]=rx,fax[top]=rx; hip[top]=ry,hix[top]=hei[ry]; ctx[top]=cnt; fa[rx]=ry; hei[ry]=max(hei[ry],hei[rx]+1); cnt--; } } inline void rolbak(int tme) { while(top&gt;tme) { fa[fap[top]]=fax[top]; hei[hip[top]]=hix[top]; cnt=ctx[top]; top--; } } void add(int u,int l,int r,int L,int R,int x) { if(l&gt;R||r&lt;L) return; if(l&gt;=L&amp;&amp;r&lt;=R) return idx[u].push_back(x),void(); int mid=l+r&gt;&gt;1; if(L&lt;=mid) add(u&lt;&lt;1,l,mid,L,R,x); if(R&gt;=mid+1) add(u&lt;&lt;1|1,mid+1,r,L,R,x); } void slove(int u,int l,int r) { int tp=top; for(int x:idx[u]) meg(rx[x],ry[x]); if(l==r) { f[l]=f[l+1]; while(f[l]&gt;1&amp;&amp;cnt&gt;K) { f[l]--; meg(rx[f[l]],ry[f[l]]); add(1,1,m,f[l],l-1,f[l]); } if(cnt&gt;K&amp;&amp;f[l]&gt;=1) f[l]=0; } else { int mid=l+r&gt;&gt;1; slove(u&lt;&lt;1|1,mid+1,r); slove(u&lt;&lt;1,l,mid); } rolbak(tp); } int main() { freopen(&quot;darkduck.in&quot;,&quot;r&quot;,stdin); freopen(&quot;darkduck.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d%d%d&quot;,&amp;n,&amp;m,&amp;K,&amp;tp); for(int i=1;i&lt;=m;i++) scanf(&quot;%d%d&quot;,&amp;rx[i],&amp;ry[i]); cnt=n; for(int i=1;i&lt;=n;i++) fa[i]=i,hei[i]=1; f[m+1]=m+1; slove(1,1,m); scanf(&quot;%d&quot;,&amp;q); unsigned lans=0; for(int i=1;i&lt;=q;++i) { int l,r; scanf(&quot;%d%d&quot;,&amp;l,&amp;r); if(tp==1) { l=(l+lans)%m+1; r=(r+lans)%m+1; if(l&gt;r) swap(l,r); } bool fl=l&lt;=f[r]; puts(fl?&quot;Yes&quot;:&quot;No&quot;); lans&lt;&lt;=1; if(fl) ++lans; } return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"分治","slug":"xOdsxnJdt","used":true,"link":"https://Rebxe.github.io/tag/xOdsxnJdt/"}],"title":"【2022NOIP模拟赛20】小Z的作业 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022noip-mo-ni-sai-20-xiao-z-de-zuo-ye-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":351000,"words":1107,"minutes":6},"date":"2023-11-15 10:04:18","dateFormat":"2023-11-15"},{"abstract":"<blockquote>\n<p>求有多少个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的括号序列满足其最长的合法括号子序列长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">2k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。</p>\n<p>你需要对于每个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mo>⌊</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo>⌋</mo></mrow><annotation encoding=\"application/x-tex\">0\\le k\\le \\lfloor\\frac{n}{2}\\rfloor</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌊</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌋</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 求出答案。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 求有多少个长度为 nnn 的括号序列满足其最长的合法括号子序列长度为 2k2k2k。 你需要对于每个 0≤k≤⌊n2⌋0\\le k\\le \\lfloor\\frac{n}{2}\\rfloor0≤k≤⌊2n​⌋ 的 kkk 求出答案。 1≤n≤1061\\le n\\le 10^61≤n≤106。 不妨设括号序列中有 xxx 个 (。 不难发现括号序列匹配之后一定是形如 )))))((( 的。那么设匹配完后 ) 的个数有 yyy 个，则答案就是 n−x−yn-x-yn−x−y。 不难发现若 x≤⌊n2⌋x\\le \\lfloor \\frac{n}{2}\\rfloorx≤⌊2n​⌋ 则 −y-y−y 等于把 ( 看作 111，) 看作 −1-1−1 时的最小前缀和。而若 x&gt;⌊n2⌋x&gt;\\lfloor\\frac{n}{2}\\rfloorx&gt;⌊2n​⌋ 则可以翻转再反转来变成 x≤⌊n2⌋x\\le \\lfloor \\frac{n}{2}\\rfloorx≤⌊2n​⌋ 的情况，所以下面默认 x≤⌊n2⌋x\\le \\lfloor \\frac{n}{2}\\rfloorx≤⌊2n​⌋。 套路地，把 =k=k=k 转变为 ≥k\\ge k≥k。那么枚举 xxx，方案数即为：从 (0,0)(0,0)(0,0) 开始，每次 (+1,+1)(+1,+1)(+1,+1) 或 (+1,−1)(+1,-1)(+1,−1)，和直线 y=k−n+x−1y=k-n+x-1y=k−n+x−1 没有交，走到 (n,2x−n)(n,2x-n)(n,2x−n) 的路径数。 容斥，计算和直线有交的路径数。套路地作出 (n,2x−n)(n,2x-n)(n,2x−n) 关于直线的对称点 (n,2k−n−2)(n,2k-n-2)(n,2k−n−2)，那么和直线有交的路径数就是从 (0,0)(0,0)(0,0) 走到 (n,2k−n−2)(n,2k-n-2)(n,2k−n−2) 的路径数，即 (nk−1)\\binom{n}{k-1}(k−1n​)。 所以方案数就是 (nx)−(nk−1)\\binom{n}{x}-\\binom{n}{k-1}(xn​)−(k−1n​)。 那么 ≥k\\ge k≥k 的答案即为 ∑i=kn−k(nx)−(nk−1)\\sum\\limits_{i=k}^{n-k}\\binom{n}{x}-\\binom{n}{k-1}i=k∑n−k​(xn​)−(k−1n​)。 维护 (nx)\\binom{n}{x}(xn​) 的前缀和后这个东西就可以 O(1)O(1)O(1) 计算，所以总的时间复杂度为 O(n)O(n)O(n)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=1000005,p=998244353; int fra[S],inv[S]; int sum[S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } inline int C(int n,int m) { if(n&lt;0||m&lt;0||n&lt;m) return 0; return 1ll*fra[n]*inv[n-m]%p*inv[m]%p; } inline int calc(int n,int k) { int res=0; for(int i=k;i&lt;=n-k;i++) res=(0ll+res+C(n,i)-C(n,k-1)+p)%p; return res; } inline int calco1(int n,int k) { if(n-k&lt;k) return 0; return ((sum[n-k]-sum[k-1]+p)%p-1ll*(n-k-k+1)*C(n,k-1)%p+p)%p; } int main() { freopen(&quot;merchant.in&quot;,&quot;r&quot;,stdin); freopen(&quot;merchant.out&quot;,&quot;w&quot;,stdout); fra[0]=1; for(int i=1;i&lt;=S-3;i++) fra[i]=1ll*fra[i-1]*i%p; inv[S-3]=qpow(fra[S-3],p-2); for(int i=S-3;i&gt;=1;i--) inv[i-1]=1ll*inv[i]*i%p; int tp; scanf(&quot;%d&quot;,&amp;tp); if(tp==1) { int n,k; scanf(&quot;%d%d&quot;,&amp;n,&amp;k); printf(&quot;%d\\n&quot;,(calc(n,k)-calc(n,k+1)+p)%p); } else { int n; scanf(&quot;%d&quot;,&amp;n); sum[0]=1; for(int i=1;i&lt;=n;i++) sum[i]=(sum[i-1]+C(n,i))%p; int ans=0,mul=1; for(int i=0;i&lt;=n/2;i++) { int pre=(calco1(n,i)-calco1(n,i+1)+p)%p; ans=(ans+1ll*pre*mul%p)%p; mul=1ll*mul*233%p; } printf(&quot;%d\\n&quot;,ans); } return 0; } ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛37】商人 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-37-shang-ren/","stats":{"text":"5 min read","time":265000,"words":827,"minutes":5},"date":"2023-10-26 20:17:37","dateFormat":"2023-10-26"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><msub><mi>l</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>r</mi><mi>i</mi></msub><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[l_i,r_i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>，构造一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>，最小化 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mi>max</mi><mo>⁡</mo><mo>(</mo><mn>0</mn><mo separator=\"true\">,</mo><msub><mi>r</mi><msub><mi>p</mi><mi>i</mi></msub></msub><mo>−</mo><msub><mi>l</mi><msub><mi>p</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></msub><mo>)</mo><mo>−</mo><msub><mi>l</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{i=1}^{n-1}\\max(0,r_{p_i}-l_{p_{i+1}})-l_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.478782em;vertical-align:-0.9776689999999999em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5011130000000001em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9776689999999999em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.041765em;vertical-align:-0.291765em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32808571428571426em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20252142857142857em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.291765em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，输出方案。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 nnn 个区间 [li,ri][l_i,r_i][li​,ri​]，构造一个 nnn 的排列 ppp，最小化 ∑i=1n−1max⁡(0,rpi−lpi+1)−l1\\sum\\limits_{i=1}^{n-1}\\max(0,r_{p_i}-l_{p_{i+1}})-l_1i=1∑n−1​max(0,rpi​​−lpi+1​​)−l1​，输出方案。 1≤n≤5×1051\\le n\\le 5\\times 10^51≤n≤5×105。 考虑拆掉 max⁡\\maxmax，再讨论加回来新增的贡献。 拆掉 max⁡\\maxmax 后，答案为 ∑i=1nri−∑i=1nli−rn\\sum\\limits_{i=1}^n r_i-\\sum\\limits_{i=1}^n l_i-r_ni=1∑n​ri​−i=1∑n​li​−rn​。 那么为了让新增的贡献尽可能少，则我们要让 max⁡(0,rpi−lpi+1)\\max(0,r_{p_i}-l_{p_{i+1}})max(0,rpi​​−lpi+1​​) 取 000 的位置尽可能少，并且要让 rnr_nrn​ 尽可能大。 若两个区间相交，那么在它们之间连一条边。考虑只有一个连通块的情况，显然可以把 lll 最小的和 rrr 最大的两个区间以及它们之间的 “链”拉出来，然后把剩下的区间按照 rrr 从大到小放到前面： 这样没有取 000 的位置且 rnr_nrn​ 最大，显然满足答案最小。 对于有多个连通块的情况，设从左到右第 iii 个连通块的左端点为 lbilb_ilbi​，右端点为 rbirb_irbi​，那么显然新增的贡献至少是 ∑lbi+1−rbi\\sum lb_{i+1}-rb_i∑lbi+1​−rbi​，那么显然按照只有一个连通块的方法构造还是最优的。 时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)（排序）。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; #include &lt;set&gt; #include &lt;deque&gt; using namespace std; typedef long long ll; const int S=500005; struct node { int l,r,id; }a[S]; int n,m; deque&lt;int&gt; res; set&lt;int&gt; st; int ans[S]; int main() { scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) scanf(&quot;%d%d&quot;,&amp;a[i].l,&amp;a[i].r),a[i].id=i; sort(a+1,a+n+1,[&amp;](auto x,auto y){return x.l&lt;y.l;}); for(int i=1,mxr=0;i&lt;=n;i++) { if(a[i].r&gt;mxr) res.push_back(a[i].id),st.insert(a[i].id); mxr=max(mxr,a[i].r); } sort(a+1,a+n+1,[&amp;](auto x,auto y){return x.r&lt;y.r;}); for(int i=1;i&lt;=n;i++) if(!st.count(a[i].id)) res.push_front(a[i].id); sort(a+1,a+n+1,[&amp;](auto x,auto y){return x.id&lt;y.id;}); while(!res.empty()) ans[res.size()]=res.back(),res.pop_back(); ll sum=0; for(int i=1;i&lt;=n-1;i++) sum+=max(0,a[ans[i]].r-a[ans[i+1]].l); sum+=m-a[ans[1]].l; printf(&quot;%lld\\n&quot;,sum); for(int i=1;i&lt;=n;i++) printf(&quot;%d &quot;,ans[i]); printf(&quot;\\n&quot;); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛36】A 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-36-a-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":197000,"words":641,"minutes":4},"date":"2023-10-25 21:20:34","dateFormat":"2023-10-25"},{"abstract":"<blockquote>\n<p>给定两个长 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，每次操作可以选择一个满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le i&lt;n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69862em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 并把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.638891em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span> 改为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>max</mi><mo>⁡</mo><mo>(</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\max(a_i,a_{i+1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，求任意次操作后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo>[</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><msub><mi>b</mi><mi>i</mi></msub><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{i=1}^n[a_i=b_i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.329066em;vertical-align:-0.9776689999999999em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3513970000000004em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9776689999999999em;\"><span></span></span></span></span></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 的最大值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le a_i,b_i\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定两个长 nnn 的序列 aaa 和 bbb，每次操作可以选择一个满足 1≤i&lt;n1\\le i&lt;n1≤i&lt;n 的 iii 并把 aia_iai​ 和 ai+1a_{i+1}ai+1​ 改为 max⁡(ai,ai+1)\\max(a_i,a_{i+1})max(ai​,ai+1​)，求任意次操作后 ∑i=1n[ai=bi]\\sum\\limits_{i=1}^n[a_i=b_i]i=1∑n​[ai​=bi​] 的最大值。 1≤n≤1051\\le n\\le 10^51≤n≤105，1≤ai,bi≤1091\\le a_i,b_i\\le 10^91≤ai​,bi​≤109。 设操作完后的 aaa 序列为 a′a&#x27;a′。 显然操作相当于每个 aia_iai​ 不断往外拓展，设 aia_iai​ 拓展成了 a[li,ri]′a&#x27;_{[l_i,r_i]}a[li​,ri​]′​（没有任何 aj’a_j’aj​’ 由 aia_iai​ 拓展来则把 aia_iai​ 删掉），那么有个结论： 一组 [li,ri][l_i,r_i][li​,ri​] 合法当且仅当 ∀i&lt;j\\forall i&lt;j∀i&lt;j 都有 ri&lt;ljr_i&lt;l_jri​&lt;lj​，即区间不交且相对顺序和 iii 的相对顺序相同。 那么不妨设 ai′a&#x27;_iai′​ 是由 pip_ipi​ 拓展而来的，不难发现 pip_ipi​ 单调递增。 发现钦定 ai′=bia&#x27;_i=b_iai′​=bi​ 的所有 iii 都满足 pip_ipi​ 为 max⁡j≤i,aj=bi{j}\\max\\limits_{j\\le i,a_j=b_i}\\{j\\}j≤i,aj​=bi​max​{j} 或 min⁡j≥i,aj=bi{j}\\min\\limits_{j\\ge i,a_j=b_i}\\{j\\}j≥i,aj​=bi​min​{j} 并不影响答案，那么不妨设这两个位置分别为 lbilb_ilbi​ 和 rbirb_irbi​（不存在则为 −1-1−1）。 又发现 pip_ipi​ 可以为 lbilb_ilbi​ 当且仅当 lbi=−1lb_{i}\\not=-1lbi​​=−1 且 a[lbi,i]a_{[lb_i,i]}a[lbi​,i]​ 中的最大值 ≤bi\\le b_i≤bi​，可以为 rbirb_irbi​ 同理。那么不妨把所有不合法的 lblblb 和 rbrbrb 都赋值为 −1-1−1。 那么不难发现 iii 对答案有贡献当且仅当： lbi=−1lb_i\\not= -1lbi​​=−1 且 pi−1≤lbip_{i-1}\\le lb_ipi−1​≤lbi​； rbi=−1rb_i\\not=-1rbi​​=−1 且 pi−1≤rbip_{i-1}\\le rb_ipi−1​≤rbi​； 因为 lbi=−1lb_i\\not=-1lbi​​=−1 和 rbi=−1rb_i\\not=-1rbi​​=−1 已经解决掉所有值域上的限制，只剩下 [li,ri][l_i,r_i][li​,ri​] 相对顺序的限制。 那么考虑一个朴素的 dp：设 fi,jf_{i,j}fi,j​ 表示处理完 a[1,i]′a&#x27;_{[1,i]}a[1,i]′​ 且 ai′=aja&#x27;_i=a_jai′​=aj​ 时 ∑k=1i[ak′=bk]\\sum\\limits_{k=1}^i[a&#x27;_k=b_k]k=1∑i​[ak′​=bk​] 的最大值。显然有转移： fi,j=fi−1,j若 lbi=−1,fi,lbi=max⁡j≤lbi{fi−1,j}+1若 rbi=−1,fi,rbi=max⁡j≤rbi{fi−1,j}+1f_{i,j}=f_{i-1,j}\\\\ \\text{若 }lb_i\\not=-1,f_{i,lb_i}=\\max\\limits_{j\\le lb_i}\\{f_{i-1,j}\\}+1\\\\ \\text{若 }rb_i\\not=-1,f_{i,rb_i}=\\max\\limits_{j\\le rb_i}\\{f_{i-1,j}\\}+1 fi,j​=fi−1,j​若 lbi​​=−1,fi,lbi​​=j≤lbi​max​{fi−1,j​}+1若 rbi​​=−1,fi,rbi​​=j≤rbi​max​{fi−1,j​}+1 发现可以用树状数组维护前缀 max 解决，时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; using namespace std; const int S=100005; int n,a[S],b[S]; int m,tb[S*2]; int top,sta[S],pre[S],nxt[S]; int pos[S*2],lb[S],rb[S]; int c[S]; inline void add(int p,int val) { for(int i=p;i&lt;=n;i+=i&amp;-i) c[i]=max(c[i],val); } inline int que(int p) { int res=0; for(int i=p;i&gt;=1;i-=i&amp;-i) res=max(res,c[i]); return res; } int main() { freopen(&quot;copy.in&quot;,&quot;r&quot;,stdin); freopen(&quot;copy.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;b[i]); for(int i=1;i&lt;=n;i++) tb[++m]=a[i],tb[++m]=b[i]; sort(tb+1,tb+m+1); m=unique(tb+1,tb+m+1)-tb-1; for(int i=1;i&lt;=n;i++) { a[i]=lower_bound(tb+1,tb+m+1,a[i])-tb; b[i]=lower_bound(tb+1,tb+m+1,b[i])-tb; } sta[top=0]=0; for(int i=1;i&lt;=n;i++) { while(top&gt;0&amp;&amp;a[sta[top]]&lt;a[i]) top--; pre[i]=sta[top]; sta[++top]=i; } sta[top=0]=n+1; for(int i=n;i&gt;=1;i--) { while(top&gt;0&amp;&amp;a[sta[top]]&lt;a[i]) top--; nxt[i]=sta[top]; sta[++top]=i; } for(int i=1;i&lt;=m;i++) pos[i]=-1; for(int i=1;i&lt;=n;i++) { pos[a[i]]=i; lb[i]=pos[b[i]]; if(lb[i]!=-1&amp;&amp;nxt[lb[i]]&lt;=i) lb[i]=-1; } for(int i=1;i&lt;=m;i++) pos[i]=-1; for(int i=n;i&gt;=1;i--) { pos[a[i]]=i; rb[i]=pos[b[i]]; if(rb[i]!=-1&amp;&amp;pre[rb[i]]&gt;=i) rb[i]=-1; } // for(int i=1;i&lt;=n;i++) printf(&quot;%d %d\\n&quot;,lb[i],rb[i]); for(int i=1;i&lt;=n;i++) { if(rb[i]!=-1) add(rb[i],que(rb[i])+1); if(lb[i]!=-1&amp;&amp;lb[i]!=rb[i]) add(lb[i],que(lb[i])+1); } printf(&quot;%d\\n&quot;,que(n)); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOIP模拟赛22】摘抄文档 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noip-mo-ni-sai-22-zhai-chao-wen-dang-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":371000,"words":1133,"minutes":7},"date":"2023-09-19 19:50:21","dateFormat":"2023-09-19"},{"abstract":"<blockquote>\n<p>给定一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个节点的<strong>无标号</strong>基环树和颜色数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>，给每个节点染上 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 种颜色中的一种，求有多少种本质不同的染色方案。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>3</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">3\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一棵 nnn 个节点的无标号基环树和颜色数 mmm，给每个节点染上 mmm 种颜色中的一种，求有多少种本质不同的染色方案。 3≤n≤1053\\le n\\le 10^53≤n≤105，1≤m≤1091\\le m\\le 10^91≤m≤109。 首先有根树的方案数是好算的，把儿子按同构情况分类（判断同构使用树哈希），同一类用插板法处理即可。因为： (nm)≡∏i=n mod p−m+1n mod pim!(modp)\\dbinom{n}{m}\\equiv \\dfrac{\\prod\\limits_{i=n\\text{ mod }p-m+1}^{n\\text{ mod }p} i}{m!}\\pmod{p} (mn​)≡m!i=n mod p−m+1∏n mod p​i​(modp) 且组合数的 ∑m=O(n)\\sum m=O(n)∑m=O(n)，所以有根树的方案数可以在 O(n)O(n)O(n) 的时间复杂度内算出。 对于基环树，找出环后求出环上每一个点的子树的答案和哈希值，然后套 Burnside 引理即可。 具体考虑枚举循环移位的次数，用序列哈希判断循环移位后是否同构。设移位了 iii 次，则会形成 gcd⁡(∣cir∣,i)\\gcd(|cir|,i)gcd(∣cir∣,i) 个置换环（circircir 为环上节点按顺序形成的序列）。设置换环集合为 SSS，则由于同一个置换环中的所有元素必定同构，所以只需要算 ∏x∈Sfx1\\prod\\limits_{x\\in S}f_{x_1}x∈S∏​fx1​​ 即可，其中 fuf_ufu​ 表示 uuu 子树的答案。 而注意到 cir1∼gcd⁡(∣cir∣,i)cir_{1\\sim \\gcd(|cir|,i)}cir1∼gcd(∣cir∣,i)​ 一定在不同的置换环中，所以 Burnside 引理中的 ∣Xg∣|X^g|∣Xg∣ 即为 ∏j=1gcd⁡(∣cir∣,i)fcirj\\prod\\limits_{j=1}^{\\gcd(|cir|,i)}f_{cir_j}j=1∏gcd(∣cir∣,i)​fcirj​​。 时间复杂度 O(n)O(n)O(n)，代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; typedef unsigned long long ull; const int S=300005,p=1000000007; const ull bse=114513,mask=1145143191981ull; int inv[S]; int n,m; vector&lt;int&gt; g[S],son[S]; bool vis[S],ins[S]; int top,sta[S]; vector&lt;int&gt; cir; ull h[S]; int res[S]; ull mul[S],sum[S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } inline int C(int n,int m) { int res=1; for(int i=n;i&gt;=n-m+1;i--) res=1ll*res*((i%p+p)%p)%p; for(int i=1;i&lt;=m;i++) res=1ll*res*inv[i]%p; return res; } void dfs(int u) { vis[u]=true; sta[++top]=u; ins[u]=true; for(int v:g[u]) { if(vis[v]) { if(ins[v]) { while(1) { cir.push_back(sta[top--]); if(sta[top+1]==v) break; } } } else dfs(v); if(!cir.empty()) return; } top--; ins[u]=false; } inline ull shift(ull x) { x^=mask; x^=x&lt;&lt;13; x^=x&gt;&gt;7; x^=x&lt;&lt;17; x^=mask; return x; } void calc(int u) { for(int v:son[u]) calc(v); sort(son[u].begin(),son[u].end(),[&amp;](int x,int y){return h[x]&lt;h[y];}); h[u]=1145141; for(int v:son[u]) h[u]+=shift(h[v]); res[u]=m; for(int i=0,cnt=0;i&lt;son[u].size();i++) { cnt++; if(i==son[u].size()-1||h[son[u][i]]!=h[son[u][i+1]]) { res[u]=1ll*res[u]*C(res[son[u][i]]+cnt-1,cnt)%p; cnt=0; } } } inline int gcd(int x,int y) { if(x==0||y==0) return x+y; int t=x%y; while(t!=0) x=y,y=t,t=x%y; return y; } int main() { freopen(&quot;color.in&quot;,&quot;r&quot;,stdin); freopen(&quot;color.out&quot;,&quot;w&quot;,stdout); mul[0]=1; for(int i=1;i&lt;=S-3;i++) inv[i]=qpow(i,p-2),mul[i]=mul[i-1]*bse; scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) { int x; scanf(&quot;%d&quot;,&amp;x); g[x].push_back(i); } for(int i=1;i&lt;=n;i++) { if(!vis[i]) { while(top&gt;0) ins[sta[top--]]=false; dfs(i); if(cir.size()&gt;0) break; } } int len=cir.size(); for(int i=0;i&lt;len/2;i++) swap(cir[i],cir[len-i-1]); for(int i=1;i&lt;=n;i++) vis[i]=false; for(int i=0;i&lt;len;i++) vis[cir[i]]=true; for(int i=1;i&lt;=n;i++) { if(vis[i]) continue; for(int v:g[i]) son[i].push_back(v); } for(int i=0;i&lt;len;i++) { int u=cir[i],r=cir[(i+1)%len]; for(int v:g[u]) if(v!=r) son[u].push_back(v); calc(u); } sum[0]=h[cir[0]]; for(int i=1;i&lt;len;i++) sum[i]=sum[i-1]*bse+h[cir[i]]; int ans=0,cnt=0; for(int i=0;i&lt;len;i++) { ull pre=sum[len-1]; if(i&gt;0) pre=(sum[len-1]-sum[i-1]*mul[len-i])*mul[i]+sum[i-1]; if(pre==sum[len-1]) { cnt++; int now=1,g=gcd(len,i); for(int j=0;j&lt;g;j++) now=1ll*now*res[cir[j]]%p; ans=(ans+now)%p; } } ans=1ll*ans*qpow(cnt,p-2)%p; printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛27】美术作业 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-27-mei-zhu-zuo-ye-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":357000,"words":1084,"minutes":6},"date":"2023-09-07 20:52:40","dateFormat":"2023-09-07"},{"abstract":"<blockquote>\n<p>有一个正 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 边形，你要在上面走路。经过顶点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 和顶点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.74285em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>（顶点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">n+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 为顶点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>）之间的边的代价是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。</p>\n<p>这个正 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 边形上有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">n-3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span></span></span></span> 条对角线，这些对角线把这个多边形剖成了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mi mathvariant=\"normal\">−</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">n−2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mord\">−</span><span class=\"mord\">2</span></span></span></span> 个三角形，经过每条对角线的代价都是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。</p>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，每次问从顶点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 走到顶点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的代价。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5.2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5.2\\times 10^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mord\">.</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le q\\le 2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个正 nnn 边形，你要在上面走路。经过顶点 iii 和顶点 i+1i+1i+1（顶点 n+1n+1n+1 为顶点 111）之间的边的代价是 111。 这个正 nnn 边形上有 n−3n-3n−3 条对角线，这些对角线把这个多边形剖成了 n−2n−2n−2 个三角形，经过每条对角线的代价都是 111。 有 qqq 次询问，每次问从顶点 xix_ixi​ 走到顶点 yiy_iyi​ 的代价。 1≤n≤5.2×1041\\le n\\le 5.2\\times 10^41≤n≤5.2×104，1≤q≤2n1\\le q\\le 2n1≤q≤2n。 首先有一个结论，由于是三角剖分，所以一定存在某一条对角线满足它两边的顶点数都至少有 n3\\frac{n}{3}3n​ 个。 证明如图： 那么分治，每次找到两边顶点数最接近的一条对角线，以它的两个端点 x,yx,yx,y 出发跑最短路，用 xi→x→yix_i\\to x\\to y_ixi​→x→yi​、xi→y→yix_i\\to y\\to y_ixi​→y→yi​ 的最短路更新第 iii 次询问的答案。然后删掉这条边，两边内部分治下去。 由于有那个结论，所以分治层数是 O(log⁡23n)O\\left(\\log_{\\frac{2}{3}}n\\right)O(log32​​n) 的，那么时间复杂度为 O(nlog⁡n)O(n\\log n)O(nlogn)。 为了避免死循环，可以在顶点数 ≤500\\le 500≤500 的时候暴力。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; #include &lt;queue&gt; using namespace std; const int S=52005,BS=500; struct ed{int x,y;}; struct que{int x,y,id;}; int n,q; vector&lt;int&gt; g[S]; vector&lt;que&gt; qs[S]; int idx[S],dis[2][S]; int ans[S*2]; inline void bfs(int x,int st,vector&lt;int&gt; &amp;V,vector&lt;ed&gt; &amp;E) { for(int &amp;u:V) g[u].clear(),dis[x][u]=n+1; for(int i=1;i&lt;V.size();i++) g[V[i-1]].push_back(V[i]),g[V[i]].push_back(V[i-1]); g[V.back()].push_back(V[0]),g[V[0]].push_back(V.back()); for(auto &amp;u:E) g[u.x].push_back(u.y),g[u.y].push_back(u.x); dis[x][st]=0; queue&lt;int&gt; q; q.push(st); while(!q.empty()) { int u=q.front(); q.pop(); for(int &amp;v:g[u]) if(dis[x][u]+1&lt;dis[x][v]) dis[x][v]=dis[x][u]+1,q.push(v); } } void slove(vector&lt;int&gt; V,vector&lt;ed&gt; E,vector&lt;que&gt; Q) { if(Q.size()==0) return; if(V.size()&lt;=BS) { for(int &amp;u:V) qs[u].clear(); for(auto &amp;u:Q) qs[u.x].push_back(u); for(int &amp;u:V) { bfs(0,u,V,E); for(auto &amp;v:qs[u]) ans[v.id]=min(ans[v.id],dis[0][v.y]); } return; } for(int i=0;i&lt;V.size();i++) idx[V[i]]=i; for(auto &amp;u:E) if(idx[u.x]&gt;idx[u.y]) swap(u.x,u.y); for(auto &amp;u:Q) if(idx[u.x]&gt;idx[u.y]) swap(u.x,u.y); int mx=-1,x=-1,y=-1; for(auto &amp;u:E) { int cnt=idx[u.y]-idx[u.x]; int pre=min(cnt,(int)V.size()-cnt); if(pre&gt;mx) mx=pre,x=u.x,y=u.y; } bfs(0,x,V,E),bfs(1,y,V,E); for(auto &amp;u:Q) { ans[u.id]=min({ans[u.id], dis[0][u.x]+dis[0][u.y], dis[1][u.x]+dis[1][u.y] }); } vector&lt;int&gt; tV; vector&lt;ed&gt; tE; vector&lt;que&gt; tQ; for(int i=idx[x];i&lt;=idx[y];i++) tV.push_back(V[i]); for(auto &amp;u:E) if(idx[u.x]&gt;=idx[x]&amp;&amp;idx[u.y]&lt;=idx[y]&amp;&amp;(u.x!=x||u.y!=y)) tE.push_back(u); for(auto &amp;u:Q) if(idx[u.x]&gt;idx[x]&amp;&amp;idx[u.y]&lt;idx[y]&amp;&amp;(u.x!=x&amp;&amp;u.y!=y)) tQ.push_back(u); slove(tV,tE,tQ); for(int i=0;i&lt;V.size();i++) idx[V[i]]=i; tV.clear(),tE.clear(),tQ.clear(); for(int i=0;i&lt;=idx[x];i++) tV.push_back(V[i]); for(int i=idx[y];i&lt;V.size();i++) tV.push_back(V[i]); for(auto &amp;u:E) if(((idx[u.x]&lt;=idx[x]||idx[u.x]&gt;=idx[y])&amp;&amp;(idx[u.y]&lt;=idx[x]||idx[u.y]&gt;=idx[y]))&amp;&amp;(u.x!=x||u.y!=y)) tE.push_back(u); for(auto &amp;u:Q) if(((idx[u.x]&lt;=idx[x]||idx[u.x]&gt;=idx[y])&amp;&amp;(idx[u.y]&lt;=idx[x]||idx[u.y]&gt;=idx[y]))&amp;&amp;(u.x!=x&amp;&amp;u.y!=y)) tQ.push_back(u); slove(tV,tE,tQ); } int main() { freopen(&quot;drive.in&quot;,&quot;r&quot;,stdin); freopen(&quot;drive.out&quot;,&quot;w&quot;,stdout); vector&lt;int&gt; V; vector&lt;ed&gt; E; vector&lt;que&gt; Q; scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) V.push_back(i); for(int i=1;i&lt;=n-3;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); E.push_back({x,y}); } scanf(&quot;%d&quot;,&amp;q); for(int i=1;i&lt;=q;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); Q.push_back({x,y,i}); ans[i]=n+1; } slove(V,E,Q); for(int i=1;i&lt;=q;i++) printf(&quot;%d\\n&quot;,ans[i]); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"分治","slug":"xOdsxnJdt","used":true,"link":"https://Rebxe.github.io/tag/xOdsxnJdt/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2023NOI模拟赛26】开开车 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-26-kai-kai-che-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":374000,"words":1113,"minutes":7},"date":"2023-09-05 16:50:57","dateFormat":"2023-09-05"},{"abstract":"<blockquote>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1,m]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mclose\">]</span></span></span></span> 中均匀随机的整数随机变量 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{1\\sim n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">∼</span><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，求一个最大的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">ans</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">s</span></span></span></span> 满足找不出：</p>\n<ul>\n<li>一组非负整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>y</mi><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">y_{1\\sim n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">∼</span><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi><mo>=</mo><mo>∑</mo><msub><mi>x</mi><mi>i</mi></msub><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">ans=\\sum x_iy_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</li>\n</ul>\n<p>满足有解。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>50</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">50\\le n\\le 10^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le m\\le 10^8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有 nnn 个在 [1,m][1,m][1,m] 中均匀随机的整数随机变量 a1∼na_{1\\sim n}a1∼n​，求一个最大的 ansansans 满足找不出： 一组非负整数 y1∼ny_{1\\sim n}y1∼n​ 满足 ans=∑xiyians=\\sum x_iy_ians=∑xi​yi​。 满足有解。 50≤n≤10750\\le n\\le 10^750≤n≤107，2≤m≤1082\\le m\\le 10^82≤m≤108。 设 mn=min⁡{ai}mn=\\min\\{a_i\\}mn=min{ai​}，考虑以 mnmnmn 为模跑同余最短路，则 disi+k×mndis_i+k\\times mndisi​+k×mn 都能被表示出来，所以答案为 max⁡{disi−mn}\\max\\{dis_i-mn\\}max{disi​−mn}。 由于数据随机，所以 mnmnmn 的期望为 mn+1\\frac{m}{n+1}n+1m​，同余最短路时间复杂度为 O(mn+1nlog⁡mn+1)O(\\frac{m}{n+1}n\\log \\frac{m}{n+1})O(n+1m​nlogn+1m​) 但是跑不满，所以能过。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;random&gt; #include &lt;queue&gt; using namespace std; const int S=10000005,MS=2000005; int n,m,seed,a[S]; int dis[MS]; bool vis[MS]; priority_queue&lt;pair&lt;int,int&gt;&gt; q; int main() { scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;seed); mt19937 rng(seed); auto get=[&amp;]() { uniform_int_distribution&lt;int&gt; qwq(2,m); return qwq(rng); }; int mn=m; for(int i=1;i&lt;=n;i++) mn=min(mn,a[i]=get()); for(int i=0;i&lt;mn;i++) dis[i]=1e9; dis[0]=0; q.push(make_pair(0,0)); while(!q.empty()) { int u=q.top().second; q.pop(); if(vis[u]) continue; vis[u]=true; for(int i=1;i&lt;=n;i++) { int v=(u+a[i])%mn; if(dis[u]+a[i]&lt;dis[v]) { dis[v]=dis[u]+a[i]; q.push(make_pair(-dis[v],v)); } } } int ans=0; for(int i=0;i&lt;mn;i++) ans=max(ans,dis[i]-mn); printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2023NOIP模拟赛09】补幺梨 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noip-mo-ni-sai-09-bu-yao-li-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":129000,"words":392,"minutes":3},"date":"2023-08-08 21:10:34","dateFormat":"2023-08-08"},{"abstract":"<blockquote>\n<p>给定两个正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">n,k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 和一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的整数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，你需要进行任意次下列操作把所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 变成 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>：</p>\n<ul>\n<li>选择一段长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 的区间 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[l,r]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 和一个正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">E</span></span></span></span>，把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mo>[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{[l,r]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span> 中所有小于等于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 的数改为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>；</li>\n</ul>\n<p>最小化所有操作的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 的和。</p>\n<p>对于每一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 的前缀 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>i</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{[1,i]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span>，你要求出它的答案 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_{i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，输出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>f</mi><mi>i</mi></msub><mn>2</mn><msup><mn>3</mn><mrow><mi>n</mi><mo>−</mo><mi>i</mi></mrow></msup><mspace></mspace><mspace width=\"0.6666666666666666em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo>(</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{i=1}^nf_i23^{n-i}\\mod (10^9+7)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.329066em;vertical-align:-0.9776689999999999em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3513970000000004em;\"><span style=\"top:-2.122331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.0000050000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9776689999999999em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord\">3</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824664em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mathdefault mtight\">i</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6666666666666666em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">)</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le a_i\\le 2\\times 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>，时间复杂度要求线性。</p>\n</blockquote>\n","content":" 给定两个正整数 n,kn,kn,k 和一个长度为 nnn 的整数序列 aia_iai​，你需要进行任意次下列操作把所有 aia_iai​ 变成 000： 选择一段长度为 kkk 的区间 [l,r][l,r][l,r] 和一个正整数 EEE，把 a[l,r]a_{[l,r]}a[l,r]​ 中所有小于等于 EEE 的数改为 000； 最小化所有操作的 EEE 的和。 对于每一个 aaa 的前缀 a[1,i]a_{[1,i]}a[1,i]​，你要求出它的答案 fif_{i}fi​，输出 ∑i=1nfi23n−imod (109+7)\\sum\\limits_{i=1}^nf_i23^{n-i}\\mod (10^9+7)i=1∑n​fi​23n−imod(109+7)。 1≤n≤1071\\le n\\le 10^71≤n≤107，1≤ai≤2×1091\\le a_i\\le 2\\times 10^91≤ai​≤2×109，时间复杂度要求线性。 原题 n≤2.5×106n\\le 2.5\\times 10^6n≤2.5×106 时限 0.25 S0.25\\text{ S}0.25 S 放了 O(nlog⁡n)O(n\\log n)O(nlogn) 过。 考虑一个朴素的 dp，设 fif_ifi​ 为 a[1,i]a_{[1,i]}a[1,i]​ 的答案。由于每次操作可以看作花费 max⁡l≤i≤rai\\max\\limits_{l\\le i\\le r} a_il≤i≤rmax​ai​ 的代价把满足 r−l+1≤kr-l+1\\le kr−l+1≤k 的 a[l,r]a_{[l,r]}a[l,r]​ 变成 000，所以转移可以考虑枚举把 aia_iai​ 变成 000 的那次操作的 lll： fi=min⁡j=max⁡(1,i−k+1)i{fj−1max⁡j≤p≤iap}f_i=\\min\\limits_{j=\\max(1,i-k+1)}^{i} \\{f_{j-1}\\max\\limits_{j\\le p\\le i} a_p\\} fi​=j=max(1,i−k+1)mini​{fj−1​j≤p≤imax​ap​} 显然 fif_ifi​ 单调递增，所以只统计满足 ap&gt;max⁡p&lt;l≤iala_p&gt;\\max\\limits_{p&lt;l\\le i} a_lap​&gt;p&lt;l≤imax​al​ 的 fp−1+apf_{p-1}+a_pfp−1​+ap​ 的最小值即可。 这样的 ppp 可以很方便地用单调队列维护，但是发现由于单调队列中既会加入会删除，fp−1+apf_{p-1}+a_pfp−1​+ap​ 只能 O(log⁡n)O(\\log n)O(logn) 维护。 考虑优化，发现满足 p≤i,i−p≤kp\\le i,i-p\\le kp≤i,i−p≤k 的 ppp 才对 fif_ifi​ 有贡献，所以考虑按 kkk 分块（[1,k][1,k][1,k]、[k+1,2k][k+1,2k][k+1,2k] 等等为一块）。设 SSS 为合法的 ppp 构成的集合，则： 贡献可以分为块内贡献和块间（iii 所在块和上一块）贡献； 块内贡献：正着扫，SSS 中只会加入新元素； 块间贡献：倒着扫，SSS 中同样只会加入新元素； 注意要先处理块间贡献。 时间复杂度 O(n)O(n)O(n)，实测 10710^7107 只跑了 0.9 S0.9\\text{ S}0.9 S，不知道为什么原题不开 n≤107n\\le 10^7n≤107 时限 1 S1\\text{ S}1 S。 还可以双栈。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;set&gt; using namespace std; char buf[1&lt;&lt;23],*p1=buf,*p2=buf,obuf[1&lt;&lt;23],*O=obuf; #define getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;21,stdin),p1==p2)?EOF:*p1++) inline int read() { int x=0,f=1;char ch=getchar(); while(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();} while(isdigit(ch)) x=x*10+(ch^48),ch=getchar(); return x*f; } const int S=10000005,p=1000000007; const long long inf=1e17; int n,k,a[S],_23[S]; long long f[S]; int top,sta[S]; long long stb[S]; int mx[S],tot,mxp[S]; int main() { freopen(&quot;op.in&quot;,&quot;r&quot;,stdin); freopen(&quot;op.out&quot;,&quot;w&quot;,stdout); n=read(),k=read(); for(int i=1;i&lt;=n;i++) a[i]=read(); _23[0]=1; for(int i=1;i&lt;=n;i++) _23[i]=1ll*_23[i-1]*23%p; #define R(x) (min(n,((x-1)/k+1)*k)) f[0]=0; for(int i=1;i&lt;=n;i++) f[i]=inf; for(int l=1;l&lt;=n;l=R(l)+1) { int r=R(l); // 上一块 - 当前块 if(l&gt;1) { int l2=l-k,r2=l-1; mx[l-1]=0; for(int i=l;i&lt;=r;i++) mx[i]=max(mx[i-1],a[i]); tot=0; for(int i=r2,mx=0;i&gt;=l2;i--) if(a[i]&gt;mx) mx=a[i],mxp[++tot]=i; long long mn=inf; for(int i=r,lb=1,rb=-1;i&gt;=l;i--) { int p=i-k; while(lb&lt;=tot&amp;&amp;mxp[lb]&gt;=p) { if(mx[i]&lt;=a[mxp[lb]]) { if(rb==-1) rb=lb; else mn=min(mn,f[mxp[lb]]+a[mxp[lb-1]]); } lb++; } if(rb==-1&amp;&amp;mx[i]&lt;=a[mxp[lb-1]]) rb=lb-1; if(rb!=-1) { while(rb-1&lt;=tot&amp;&amp;a[mxp[rb-1]]&gt;=mx[i]) { mn=min(mn,f[mxp[rb]]+a[mxp[rb-1]]); rb--; } } f[i]=min(f[i],min(mn,min( f[p]+max(a[mxp[lb-1]],mx[i]), rb!=-1?f[mxp[rb]]+mx[i]:inf ))); } } // 当前块内 top=0,sta[0]=l-1,stb[0]=inf; for(int i=l;i&lt;=r;i++) { while(top&gt;0&amp;&amp;a[sta[top]]&lt;a[i]) top--; top++; sta[top]=i,stb[top]=min(stb[top-1],f[sta[top-1]]+a[i]); f[i]=min(f[i],stb[top]); } } int ans=0; for(int i=1;i&lt;=n;i++) ans=(ans+1ll*f[i]%p*_23[n-i]%p)%p; printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"小技巧","slug":"J5sSduNPX","used":true,"link":"https://Rebxe.github.io/tag/J5sSduNPX/"}],"title":"【2023成都集训模拟赛04】op 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-cheng-du-ji-xun/","stats":{"text":"7 min read","time":374000,"words":1167,"minutes":7},"date":"2023-07-19 15:02:50","dateFormat":"2023-07-19"},{"abstract":"<blockquote>\n<p>给定两个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的整数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，求出最大的正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 使得存在某个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>l</mi><mo>≤</mo><mi>n</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1\\le l\\le n-k+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mo>[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>l</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{[l,l+k-1]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7857599999999999em;vertical-align:-0.3551999999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mbin mtight\">+</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span> 内出现过的所有数的出现次数都不小于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">0\\le a_i\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1\\le b_i\\le n+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>≥</mo><msub><mi>b</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">b_i\\ge b_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.902771em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定两个长度为 nnn 的整数序列 aia_iai​ 和 bib_ibi​，求出最大的正整数 kkk 使得存在某个 1≤l≤n−k+11\\le l\\le n-k+11≤l≤n−k+1 使得 a[l,l+k−1]a_{[l,l+k-1]}a[l,l+k−1]​ 内出现过的所有数的出现次数都不小于 bkb_kbk​。 1≤n≤1061\\le n\\le 10^61≤n≤106，0≤ai≤n0\\le a_i\\le n0≤ai​≤n，1≤bi≤n+11\\le b_i\\le n+11≤bi​≤n+1，bi≥bi+1b_i\\ge b_{i+1}bi​≥bi+1​。 考虑对所有合法的区间的长度取 max。 对于一个区间 [l,r][l,r][l,r]，由于 bbb 单调递减，所以所有满足在 [l,r][l,r][l,r] 中出现次数小于 br−l+1b_{r-l+1}br−l+1​ 的 aia_iai​ 都不能选，那么把这些 aia_iai​ 删掉后： 若 [l,r][l,r][l,r] 分裂成若干个小区间，则每个区间可以递归下去处理； 若 [l,r][l,r][l,r] 没有分裂，则 [l,r][l,r][l,r] 是一个合法的答案； 考虑优化。不难发现，由于 bbb 单调递减，所以只需要找到某一个 x∈[l,r]x\\in [l,r]x∈[l,r] 满足 axa_xax​ 在 [l,r][l,r][l,r] 中出现次数小于 br−l+1b_{r-l+1}br−l+1​ 然后递归处理 [l,x−1][l,x-1][l,x−1] 和 [x+1,r][x+1,r][x+1,r] 即可。 但是这样做的时间复杂度是 O(n2)O(n^2)O(n2) 的，继续优化。 考虑启发式分裂，把这样的 axa_xax​ 看作代表元，那么所有跨过 xxx 的区间的贡献都是 000，不用考虑。而可以通过类似 meet-in-middle 的方法，从 lll 和 rrr 同时向中间遍历，快速找到代表元，这样的时间复杂度就是 O(nlog⁡n)O(n\\log n)O(nlogn) 的。 具体实现流程 在处理 [1,n][1,n][1,n] 前把所有 aia_iai​ 扔进桶里。 处理 [l,r][l,r][l,r] 时： 若 l&gt;rl&gt;rl&gt;r，直接返回； 从 lll 和 rrr 出发往中间遍历找到代表元 axa_xax​； 若找不到满足条件的 axa_xax​，扫一遍把 a[l,r]a_{[l,r]}a[l,r]​ 从桶中删除，否则： 若 x−l+1&lt;r−x+1x-l+1&lt;r-x+1x−l+1&lt;r−x+1： 扫一遍，在桶中删除 a[l,x−1]a_{[l,x-1]}a[l,x−1]​； 分治处理 [x+1,r][x+1,r][x+1,r]，注意处理后桶中的 a[x+1,r]a_{[x+1,r]}a[x+1,r]​ 已经被删除； 扫一遍，在桶中加入 a[l,x−1]a_{[l,x-1]}a[l,x−1]​ 并分治处理 [l,x−1][l,x-1][l,x−1]； 否则处理方法也类似，注意要先分治处理 [l,x−1][l,x-1][l,x−1]； 时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)，代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=1000005; int n,a[S],b[S]; int app[S]; int ans; void slove(int l,int r) { if(r&lt;l) return; int p1=l,p2=r,pp=-1; while(p1&lt;=p2) { if(app[a[p1]]&lt;b[r-l+1]) { pp=p1; break; } if(app[a[p2]]&lt;b[r-l+1]) { pp=p2; break; } p1++; p2--; } if(pp==-1) { for(int i=l;i&lt;=r;i++) app[a[i]]--; ans=max(ans,r-l+1); return; } app[a[pp]]--; if(pp-l&lt;r-pp) { for(int i=l;i&lt;pp;i++) app[a[i]]--; slove(pp+1,r); for(int i=l;i&lt;pp;i++) app[a[i]]++; slove(l,pp-1); } else { for(int i=pp+1;i&lt;=r;i++) app[a[i]]--; slove(l,pp-1); for(int i=pp+1;i&lt;=r;i++) app[a[i]]++; slove(pp+1,r); } } int main() { scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;b[i]); for(int i=1;i&lt;=n;i++) app[a[i]]++; slove(1,n); printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"分治","slug":"xOdsxnJdt","used":true,"link":"https://Rebxe.github.io/tag/xOdsxnJdt/"},{"name":"小技巧","slug":"J5sSduNPX","used":true,"link":"https://Rebxe.github.io/tag/J5sSduNPX/"}],"title":"【2023NOIP模拟赛06】我是 C 题 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noip-mo-ni-sai-06-wo-shi-c-ti-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":280000,"words":930,"minutes":5},"date":"2023-07-17 20:40:52","dateFormat":"2023-07-17"},{"abstract":"<blockquote>\n<p>给定一个正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，每次等概率从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的所有因子中选择一个，设其为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">d</span></span></span></span>，将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mfrac><mi>n</mi><mi>d</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{n}{d}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.040392em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">d</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。</p>\n<p>求期望多少次 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>24</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^{24}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span></span>，输入会给出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的所有不同的质因子 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>p</mi><mrow><mn>1</mn><mo>∼</mo><mi>m</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">p_{1\\sim m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">∼</span><span class=\"mord mathdefault mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个正整数 nnn，每次等概率从 nnn 的所有因子中选择一个，设其为 ddd，将 nnn 变为 nd\\frac{n}{d}dn​。 求期望多少次 nnn 变为 111，对 109+710^9+7109+7 取模。 1≤n≤10241\\le n\\le 10^{24}1≤n≤1024，输入会给出 nnn 的所有不同的质因子 p1∼mp_{1\\sim m}p1∼m​。 设 dpidp_idpi​ 表示 n=in=in=i 时的答案，那么有： dpi=∑d∣i,d≤idpdk+1dpi=∑d∣i,d&lt;idpdk+dpik+1(k−1)dpik=∑d∣i,d&lt;idpdk+1dpi=k+∑d∣i,d&lt;idpdk−1\\begin{aligned} dp_{i}&amp;=\\frac{\\sum\\limits_{d|i,d\\le i}dp_d}{k}+1\\\\ dp_{i}&amp;=\\frac{\\sum\\limits_{d|i,d&lt;i}dp_d}{k}+\\frac{dp_i}{k}+1\\\\ \\frac{(k-1)dp_i}{k}&amp;=\\frac{\\sum\\limits_{d|i,d&lt;i}dp_d}{k}+1\\\\ dp_{i}&amp;=\\frac{k+\\sum\\limits_{d|i,d&lt;i}dp_d}{k-1}\\\\ \\end{aligned} dpi​dpi​k(k−1)dpi​​dpi​​=kd∣i,d≤i∑​dpd​​+1=kd∣i,d&lt;i∑​dpd​​+kdpi​​+1=kd∣i,d&lt;i∑​dpd​​+1=k−1k+d∣i,d&lt;i∑​dpd​​​ 设 n=∏i=1mpiein=\\prod\\limits_{i=1}^m p_i^{e_i}n=i=1∏m​piei​​，那么显然可重集 {e1,e2,…,em}\\{e_1,e_2,\\dots,e_m\\}{e1​,e2​,…,em​} 相同的 nnn 的 dpndp_ndpn​ 是相同的。 注意到由于 {e1,e2,…,em}\\{e_1,e_2,\\dots,e_m\\}{e1​,e2​,…,em​} 是可重集，所以不妨钦定 ei≤ei+1e_i\\le e_{i+1}ei​≤ei+1​，不同的 {e1,e2,…,em}\\{e_1,e_2,\\dots,e_m\\}{e1​,e2​,…,em​} 最多只有 ∏i=1mlog⁡∏j=1ipj(n)\\prod\\limits_{i=1}^m\\log_{\\prod\\limits_{j=1}^ip_j}(n)i=1∏m​logj=1∏i​pj​​(n) 个，实际上只有大概 2×1052\\times 10^52×105 个。 那么设 dp{e1,e2,…,em}dp_{\\{e_1,e_2,\\dots,e_m\\}}dp{e1​,e2​,…,em​}​ 为可重集为 {e1,e2,…,em}\\{e_1,e_2,\\dots,e_m\\}{e1​,e2​,…,em​} 时的答案，则转移是一个高维前缀和，可以设 f{e1,e2,…,em},i=∑{e1′,e2′,…,em′}∏j=1i[ej′≤ej]∏j=i+1m[ej′=ej]dp{e1′,e2′,…,em′}f_{\\{e_1,e_2,\\dots,e_m\\},i}=\\sum\\limits_{\\{e&#x27;_1,e&#x27;_2,\\dots,e&#x27;_m\\}}\\prod\\limits_{j=1}^i[e&#x27;_j\\le e_j]\\prod\\limits_{j=i+1}^m[e&#x27;_j=e_j]dp_{\\{e&#x27;_1,e&#x27;_2,\\dots,e&#x27;_m\\}}f{e1​,e2​,…,em​},i​={e1′​,e2′​,…,em′​}∑​j=1∏i​[ej′​≤ej​]j=i+1∏m​[ej′​=ej​]dp{e1′​,e2′​,…,em′​}​，则有转移： f{e1,e2,…,em},i=f{e1,e2,…,em},i−1+f{e1,e2,…,ei−1,…,em},i+f{e1,e2,…,em},0f_{\\{e_1,e_2,\\dots,e_m\\},i}=f_{\\{e_1,e_2,\\dots,e_m\\},i-1}+f_{\\{e_1,e_2,\\dots,e_i-1,\\dots,e_m\\},i}+f_{\\{e_1,e_2,\\dots,e_m\\},0} f{e1​,e2​,…,em​},i​=f{e1​,e2​,…,em​},i−1​+f{e1​,e2​,…,ei​−1,…,em​},i​+f{e1​,e2​,…,em​},0​ 则 dp{e1,e2,…,em}=f{e1,e2,…,em},0dp_{\\{e_1,e_2,\\dots,e_m\\}}=f_{\\{e_1,e_2,\\dots,e_m\\},0}dp{e1​,e2​,…,em​}​=f{e1​,e2​,…,em​},0​。 由于转移需要的是 f{e1,e2,…,em},m−dp{e1,e2,…,em}f_{\\{e_1,e_2,\\dots,e_m\\},m}-dp_{\\{e_1,e_2,\\dots,e_m\\}}f{e1​,e2​,…,em​},m​−dp{e1​,e2​,…,em​}​，所以不妨先令 f{e1,e2,…,em},0=0f_{\\{e_1,e_2,\\dots,e_m\\},0}=0f{e1​,e2​,…,em​},0​=0，做完高维前缀和再加回去。 时间复杂度 O(2×105×20)O(2\\times 10^5\\times 20)O(2×105×20)。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstring&gt; #include &lt;vector&gt; #include &lt;map&gt; using namespace std; const int SS=105,STS=200005,S=25,p=1000000007; struct sta { vector&lt;int&gt; v; inline void push(int x){v.push_back(x);} inline int size(){return v.size();} inline void sort(){::sort(v.begin(),v.end());} inline int&amp; operator[](int x){return v[x];} inline void delbeg(){v.erase(v.begin());} inline bool operator&lt;(const sta &amp;b)const { if(v.size()!=b.v.size()) return v.size()&lt;b.v.size(); for(int i=0;i&lt;v.size();i++) if(v[i]!=b.v[i]) return v[i]&lt;b.v[i]; return false; } }; char str[SS]; __int128 n,a[S]; int m; int tot; map&lt;sta,int&gt; idx; int f[STS][S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } int DP(sta &amp;st) { if(idx.find(st)!=idx.end()) return f[idx[st]][0]; idx[st]=++tot; int id=tot; if(st.size()==0) return f[id][0]=0; for(int i=1;i&lt;=st.size();i++) { sta nst=st; nst[i-1]--,nst.sort(); if(nst[0]!=0) DP(nst),f[id][i]=(f[id][i-1]+f[idx[nst]][i])%p; else nst.delbeg(),DP(nst),f[id][i]=(f[id][i-1]+f[idx[nst]][i-1])%p; } int ml=1; for(int i=0;i&lt;st.size();i++) ml=1ll*ml*(st[i]+1)%p; f[id][0]=1ll*qpow(ml-1+p,p-2)*(f[id][st.size()]+ml)%p; for(int i=1;i&lt;=st.size();i++) f[id][i]=(f[id][i]+f[id][0])%p; return f[id][0]; } int main() { freopen(&quot;div.in&quot;,&quot;r&quot;,stdin); freopen(&quot;div.out&quot;,&quot;w&quot;,stdout); ios::sync_with_stdio(0); cin.tie(0),cout.tie(0); while(cin&gt;&gt;str&gt;&gt;m) { int len=strlen(str); n=0; for(int i=0;i&lt;len;i++) n=n*10+str[i]-'0'; sta st; for(int i=1;i&lt;=m;i++) { cin&gt;&gt;str; len=strlen(str); a[i]=0; for(int j=0;j&lt;len;j++) a[i]=a[i]*10+str[j]-'0'; int cnt=0; while(n%a[i]==0) n/=a[i],cnt++; st.push(cnt); } st.sort(); cout&lt;&lt;DP(st)&lt;&lt;'\\n'; } return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛24】随机除法 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-24-sui-ji-chu-fa-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":402000,"words":1155,"minutes":7},"date":"2023-07-05 16:29:42","dateFormat":"2023-07-05"},{"abstract":"<blockquote>\n<p>给定一张 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条边的无向图（没有重边和自环），求有多少种给边定向的方式满足定向后的图是一个 DAG。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>20</mn><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mfrac><mrow><mi>n</mi><mo>(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 20,1\\le m\\le \\frac{n(n-1)}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一张 nnn 个点 mmm 条边的无向图（没有重边和自环），求有多少种给边定向的方式满足定向后的图是一个 DAG。 1≤n≤20,1≤m≤n(n−1)21\\le n\\le 20,1\\le m\\le \\frac{n(n-1)}{2}1≤n≤20,1≤m≤2n(n−1)​。 考虑拓扑的过程，每一轮会删掉所有入度为 000 的点，这些点在拓扑序中可以任意调换顺序。 由于确定了拓扑序就可以唯一确定定向方式，所以问题变成求有多少种本质不同的拓扑序。 设 fif_ifi​ 表示把集合 iii 中的点单独拿出来拓扑有多少种本质不同的拓扑序，设 gi=[集合 i 中的点之间没有连边]g_i=[\\text{集合 }i\\text{ 中的点之间没有连边}]gi​=[集合 i 中的点之间没有连边]，那么有一个错误的转移： fi=∑j⊂ifjgi−jf_{i}=\\sum\\limits_{j\\subset i}f_jg_{i-j} fi​=j⊂i∑​fj​gi−j​ 即枚举最后一次删掉了哪些点。 这样显然会算重，因为同时删掉 nnn 个点的情况会被算 ∑i=1n(ni)\\sum\\limits_{i=1}^n\\binom{n}{i}i=1∑n​(in​) 次。 那么考虑容斥，弄一个容斥系数 hih_ihi​ 使得 ∑i=1n(ni)hi=1\\sum\\limits_{i=1}^n\\binom{n}{i}h_i=1i=1∑n​(in​)hi​=1。根据二项式定理可知 ∑i=1n(ni)(−1)i−1=[n=0]\\sum\\limits_{i=1}^n\\binom{n}{i}(-1)^{i-1}=[n\\not=0]i=1∑n​(in​)(−1)i−1=[n​=0]，所以 hi=(−1)i−1h_i=(-1)^{i-1}hi​=(−1)i−1 即可。 那么正确的转移就是： fi=∑j⊂ifjgi−j(−1)∣i−j∣−1f_{i}=\\sum\\limits_{j\\subset i}f_jg_{i-j}(-1)^{|i-j|-1} fi​=j⊂i∑​fj​gi−j​(−1)∣i−j∣−1 直接转移是 O(3n)O(3^n)O(3n) 的，但是注意到这个东西是半在线子集卷积，所以可以用 FWT 做到 O(n22n)O(n^22^n)O(n22n)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=25,p=1000000007,inv2=500000004; int n,m; bool a[S][S]; int g[1&lt;&lt;20]; int popc[1&lt;&lt;20],SC[S][1&lt;&lt;20],SA[S][1&lt;&lt;20]; inline void FWT(int n,int a[]) { for(int len=2;len&lt;=n;len&lt;&lt;=1) { int mid=len&gt;&gt;1; for(int l=0;l&lt;=n-len;l+=len) { for(int k=0;k&lt;mid;k++) { int x=a[l+k],y=a[l+mid+k]; a[l+k]=x; a[l+mid+k]=(x+y)%p; } } } } inline void IFWT(int n,int a[]) { for(int len=2;len&lt;=n;len&lt;&lt;=1) { int mid=len&gt;&gt;1; for(int l=0;l&lt;=n-len;l+=len) { for(int k=0;k&lt;mid;k++) { int x=a[l+k],y=a[l+mid+k]; a[l+k]=x; a[l+mid+k]=(y-x+p)%p; } } } } int main() { freopen(&quot;jump.in&quot;,&quot;r&quot;,stdin); freopen(&quot;jump.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=m;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); a[x][y]=a[y][x]=true; } for(int i=0;i&lt;(1&lt;&lt;n);i++) for(int j=0;j&lt;n;j++) popc[i]+=i&gt;&gt;j&amp;1; for(int i=0;i&lt;(1&lt;&lt;n);i++) { bool flg=true; for(int j=1;j&lt;=n;j++) { if(i&gt;&gt;(j-1)&amp;1^1) continue; for(int k=1;k&lt;=n;k++) { if(i&gt;&gt;(k-1)&amp;1^1) continue; flg&amp;=!a[j][k]; } } if(flg) g[i]=popc[i]&amp;1?1:p-1; else g[i]=0; } SC[0][0]=1; for(int i=0;i&lt;=n;i++) for(int j=0;j&lt;(1&lt;&lt;n);j++) SA[i][j]=(popc[j]==i)*g[j]; FWT(1&lt;&lt;n,SC[0]); for(int i=0;i&lt;=n;i++) FWT(1&lt;&lt;n,SA[i]); for(int i=1;i&lt;=n;i++) for(int j=0;j&lt;=i-1;j++) for(int k=0;k&lt;(1&lt;&lt;n);k++) SC[i][k]=(SC[i][k]+1ll*SC[j][k]*SA[i-j][k]%p)%p; IFWT(1&lt;&lt;n,SC[n]); printf(&quot;%d\\n&quot;,SC[n][(1&lt;&lt;n)-1]); return 0; } ","tags":[{"name":"FWT","slug":"UjstJwYTZ","used":true,"link":"https://Rebxe.github.io/tag/UjstJwYTZ/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛23】有限空间跳跃理论 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-23-you-xian-kong-jian-tiao-yue-li-lun-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":297000,"words":930,"minutes":5},"date":"2023-07-05 11:57:24","dateFormat":"2023-07-05"},{"abstract":"<blockquote>\n<p>给定一个以 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 为根的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点的树，编号在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[0,n-1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> 范围内，第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 个点上的权值为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 的东西。</p>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 个客人前来买东西，第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 个客人只能买 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">ct_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 子树点上的东西，且一个客人只能买一个东西，一个东西只能被卖给一个客人。</p>\n<p>你需要最大化卖出的东西的权值和。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>3</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 3\\times 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，时间复杂度要求低于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">)</span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个以 000 为根的 nnn 个点的树，编号在 [0,n−1][0,n-1][0,n−1] 范围内，第 iii 个点上的权值为 iii 的东西。 有 mmm 个客人前来买东西，第 iii 个客人只能买 ctict_icti​ 子树点上的东西，且一个客人只能买一个东西，一个东西只能被卖给一个客人。 你需要最大化卖出的东西的权值和。 1≤n,m≤3×1061\\le n,m\\le 3\\times 10^61≤n,m≤3×106，时间复杂度要求低于 O(nlog⁡n)O(n\\log n)O(nlogn)。 首先有个显然的贪心，客人按照 ctict_icti​ 的深度从大到小依次选择子树内权值最大的东西买走。 这等价于按照权值从大到小考虑每个点，选择所有能买它的客人中 ctict_icti​ 深度最大的那一位被他买走。 并查集维护即可，但是我不会并查集。 #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; inline int read() { int c=0,s=0; while(c&lt;'0'||c&gt;'9') c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') s=s*10+c-'0',c=getchar(); return s; } const int S=3000005; int n,m,fat[S],cnt[S]; int fa[S]; int fnd(int u){return fa[u]==u?u:fa[u]=fnd(fa[u]);} int main() { freopen(&quot;shop.in&quot;,&quot;r&quot;,stdin); freopen(&quot;shop.out&quot;,&quot;w&quot;,stdout); n=read(),m=read(); for(int i=1;i&lt;=n-1;i++) fat[i]=read(); for(int i=1;i&lt;=m;i++) cnt[read()]++; for(int i=0;i&lt;=n-1;i++) fa[i]=i; long long ans=0; for(int i=n-1;i&gt;=0;i--) { int u=i; while(fnd(u)!=0&amp;&amp;cnt[fnd(u)]==0) { int ru=fnd(u); fa[ru]=fat[ru]; } int ru=fnd(u); if(cnt[ru]&gt;0) { ans+=i; if(--cnt[ru]==0) fa[ru]=fnd(fat[ru]); } } printf(&quot;%lld\\n&quot;,ans); return 0; } ","tags":[{"name":"贪心","slug":"PR_0Eh8tb","used":true,"link":"https://Rebxe.github.io/tag/PR_0Eh8tb/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2023NOI模拟赛22】商店 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-22-shang-dian-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":129000,"words":434,"minutes":3},"date":"2023-07-03 15:19:11","dateFormat":"2023-07-03"},{"abstract":"","content":"Day 0 飞机餐不好吃，辣椒酱是薄荷味的。 送了个耳机很高兴。 晚上吃了南京大排档。 Day 1 开幕式无聊。 试机前1h不知道有试机题，看到别人都在做题后遂发现桌子上的纸上的网址，然 http 打成 https 花了 15 min，刚想没多久就被老师催去吃饭了，所以没写试机题。 下午第一题看数据范围以为是 O(n)O(n)O(n) GSAM，于是跳过；第二题感觉是 Min-Max 容斥，但是推了个 O(n5)O(n^5)O(n5) 不会优化；第三题不会。 喜提 54+23+32=10954+23+32=10954+23+32=109。 赛后发现第一题直接枚举 border 长度即可，我是傻逼。 被苹果先生吊打了 /ll Day 2 讲座无聊。 讲座出来面到了 qjm 和 cxy，然后在学校里逛了一下。 T1 是傻逼 LCT 板子，但是 FHQ Treap 也能做，但是不会维护 size，于是 65pts。 T2 不会，35pts，T3 不会，25pts。 喜提 65+35+2565+35+2565+35+25。 又被苹果先生吊打了。 饭卡还剩好多钱，批发可乐，最后只剩 8 毛钱了。 晚上去看天安门广场，结果没有预约，所以去了王府井。 领略到了北京出租车司机的喜感。 Day 3 早上去圆明园随机游走，中午吃了个烤鸭，吃撑了。 飞机延期了，没有飞机餐，所以很饿。 晚上回到学校已经九点半了。 ","tags":[{"name":2023,"slug":"duHpjt30p","used":true,"link":"https://Rebxe.github.io/tag/duHpjt30p/"},{"name":"PKU","slug":"Jt9rN7EEz","used":true,"link":"https://Rebxe.github.io/tag/Jt9rN7EEz/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"PKUSC2023 游记","feature":"","link":"https://Rebxe.github.io/post/pkusc2023-you-ji/","stats":{"text":"2 min read","time":86000,"words":377,"minutes":2},"date":"2023-05-06 22:02:35","dateFormat":"2023-05-06"},{"abstract":"<blockquote>\n<p>有一个边长为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 的立方体，你要用绳子绑紧这个立方体。绳子需要被绑成一个圈，并且不能经过立方体的顶点。绳子在绑的时候还需要被拉直，即立方体在平面上无限展开后绳子在上面的印记是若干直线。</p>\n<p>现在把立方体放到三维空间中，使得各棱与坐标轴平行。给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a,b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，你需要找到一种绑法，使得绳子的某部分平行于向量 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(a,b,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span></span>，并且绳子最短。记 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 为绳子长度，请输出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>l</mi><mn>2</mn></msup><mi mathvariant=\"normal\">mod</mi><mo>⁡</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">l^2\\operatorname{mod} 10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span>，容易证明这是整数。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span> 组数据。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>T</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le T\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>18</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le a,b\\le 10^{18}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个边长为 111 的立方体，你要用绳子绑紧这个立方体。绳子需要被绑成一个圈，并且不能经过立方体的顶点。绳子在绑的时候还需要被拉直，即立方体在平面上无限展开后绳子在上面的印记是若干直线。 现在把立方体放到三维空间中，使得各棱与坐标轴平行。给定 a,ba,ba,b，你需要找到一种绑法，使得绳子的某部分平行于向量 (a,b,0)(a,b,0)(a,b,0)，并且绳子最短。记 lll 为绳子长度，请输出 l2mod⁡109+7l^2\\operatorname{mod} 10^9+7l2mod109+7，容易证明这是整数。TTT 组数据。 1≤T≤1051\\le T\\le 10^51≤T≤105，0≤a,b≤10180\\le a,b\\le 10^{18}0≤a,b≤1018。 和之前的一道题『环』类似。 不妨先让 gcd⁡(a,b)=1\\gcd(a,b)=1gcd(a,b)=1。 考虑让正方体在平面上从 (0,0)(0,0)(0,0) 开始，沿着直线 (a,b)(a,b)(a,b) 滚动，即向上、向右滚且满足每一步底面都覆盖直线。由于 gcd⁡(a,b)=1\\gcd(a,b)=1gcd(a,b)=1 所以滚动一定是以滚过一个 a×ba\\times ba×b 的长方形为周期，那么只需要求最少滚 rrr 个周期满足滚完之后正方体每个面都是原来的面，lll 即为 r×a2+b2r\\times\\sqrt{a^2+b^2}r×a2+b2​。 考虑把正方体的每个面标号，那么滚动就可以看成置换，则只需要求出沿对角线滚过 a×ba\\times ba×b 的长方形对应的置换 ppp 即可。 考虑设向上滚的置换为 xxx，向右滚的置换为 yyy，先来考虑 8×38\\times 38×3 的长方形，显然有 p=xxxyxxxyxxy=x(xxy)x(xxy)(xxy)p=xxxyxxxyxxy=x(xxy)x(xxy)(xxy)p=xxxyxxxyxxy=x(xxy)x(xxy)(xxy)，不妨把 xxyxxyxxy 看作 y′y&#x27;y′，那么我们就成功把问题规模从 8×38\\times 38×3 缩小到了 2×32\\times 32×3。 发现这样做相当于把向右一格对应成向上两格再向右一格，类似辗转相除： 那么滚过 a×ba\\times ba×b 的长方形对应的置换 ppp 可以这样求： a=0a=0a=0 则 p=yp=yp=y，b=0b=0b=0 则 p=xp=xp=x； a≥ba\\ge ba≥b 则令 a=amod⁡ba=a\\operatorname{mod} ba=amodb，y=x⌊ab⌋yy=x^{\\lfloor\\frac{a}{b}\\rfloor}yy=x⌊ba​⌋y，递归； b&gt;ab&gt;ab&gt;a，则令 b=bmod⁡ab=b\\operatorname{mod} ab=bmoda，x=y⌊ab⌋xx=y^{\\lfloor\\frac{a}{b}\\rfloor}xx=y⌊ba​⌋x，递归； 求出 ppp 之后暴力枚举计算 rrr 即可。 代码如下： // Problem: #207. 打包 // Contest: Hydro // URL: http://oiclass.com/d/AKNOI/p/207 // Memory Limit: 256 MB // Time Limit: 1000 ms // // Powered by CP Editor (https://cpeditor.org) #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; using namespace std; const int p=1000000007; struct node { int a[7]; inline node(){memset(a,0,sizeof(a));} inline node(int x,int b,int c,int d,int e,int f){a[1]=x,a[2]=b,a[3]=c,a[4]=d,a[5]=e,a[6]=f;} inline int &amp;operator[](int x){return a[x];} inline node operator*(node b) { node re; for(int i=1;i&lt;=6;i++) re[i]=b[a[i]]; return re; } inline void operator=(node b){for(int i=1;i&lt;=6;i++) a[i]=b[i];} inline node operator^(long long y) { node res(1,2,3,4,5,6),x=*this; for(;y&gt;0;y&gt;&gt;=1,x=x*x) res=y&amp;1?res*x:res; return res; } inline bool operator!=(node b) { for(int i=1;i&lt;=6;i++) if(a[i]!=b[i]) return true; return false; } inline void print(){for(int i=1;i&lt;=6;i++) printf(&quot;%d &quot;,a[i]);} }; node x,y,res; inline long long gcd(long long x,long long y) { if(x==0||y==0) return x+y; long long t=x%y; while(t!=0) x=y,y=t,t=x%y; return y; } void exgcd(long long a,long long b) { if(a==0) return res=y,void(); if(b==0) return res=x,void(); if(a&gt;b) { y=(x^(a/b))*y; exgcd(a%b,b); } else { x=(y^(b/a))*x; exgcd(a,b%a); } } inline void slove() { long long a,b; scanf(&quot;%lld%lld&quot;,&amp;a,&amp;b); long long g=gcd(a,b); a/=g,b/=g; x=node(6,2,5,4,1,3),y=node(2,3,4,1,5,6); exgcd(a,b); // res.print(),printf(&quot;\\n&quot;); int ans=1; node pre=res; while(pre!=node(1,2,3,4,5,6)) { pre=pre*res; ans++; } // printf(&quot;%d\\n&quot;,ans); // res.print(),printf(&quot;\\n&quot;); node tmp=res*res; // tmp.print(),printf(&quot;\\n&quot;); a%=p,b%=p; printf(&quot;%lld\\n&quot;,(a*a%p+b*b%p)%p*ans%p*ans%p); } int main() { int T; scanf(&quot;%d&quot;,&amp;T); while(T--&gt;0) slove(); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"},{"name":"数论","slug":"3Mw3ZQABXP","used":true,"link":"https://Rebxe.github.io/tag/3Mw3ZQABXP/"}],"title":"【2023NOI模拟赛21】打包 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-21-da-bao-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":333000,"words":1092,"minutes":6},"date":"2023-05-04 19:19:18","dateFormat":"2023-05-04"},{"abstract":"<blockquote>\n<p>有个  <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条边的 DAG，你要加不超过 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 条边，使得加完之后还是一个 DAG，并且 这个 DAG 的字典序最小拓扑序字典序最大。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>k</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m,k\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有个 nnn 个点 mmm 条边的 DAG，你要加不超过 kkk 条边，使得加完之后还是一个 DAG，并且 这个 DAG 的字典序最小拓扑序字典序最大。 1≤n,m,k≤1051\\le n,m,k\\le 10^51≤n,m,k≤105。 求出给定 DAG 的字典序最小拓扑序显然只需要把拓扑排序的队列换成小根堆，那么考虑贪心。 称原图拓扑排序所用的小根堆为 qqq，那么某一时刻若 qqq 中有 &gt;1&gt;1&gt;1 个点且加边的次数还没用完则可以通过加边来延后 qqq 中最小的点被删除的时间。设这个最小的点是 uuu，那么把 uuu 从 qqq 中删除，加入到一个大根堆 q2q2q2 中。注意到这样操作相当于是加了一条指向 uuu 的边。 当 qqq 中没有元素且 q2q2q2 中还有元素时，为了保证图还是 DAG 我们就不得不让 q2q2q2 中的某个点被删掉了，显然把 q2q2q2 中最大的点删掉是最优的。设这个点是 uuu，那么指向 uuu 的边一定是由当前拓扑序中最后一个点 vvv 连过来的，那么把边 v→uv\\to uv→u 加入答案序列中即可。 最后有一个细节，第一层一定要留一个点在 qqq 中，因为无法加边。以后的每一层，qqq 中还剩下一个点 uuu 时，若 q2q2q2 也非空，且最大的点为 vvv，并且还能加边，那么： u&gt;vu&gt;vu&gt;v 此时延后 uuu 被删除的时间是没有意义的，因为加入 q2q2q2 后它马上就会从 q2q2q2 中取出，所以直接顺其自然； u&lt;vu&lt;vu&lt;v 此时延后 uuu 被删除的时间显然是更优的，那么把 uuu 从 qqq 中删除，加入 q2q2q2； 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;set&gt; #include &lt;vector&gt; #include &lt;queue&gt; using namespace std; const int S=100005; int n,m,k; set&lt;pair&lt;int,int&gt;&gt; st; vector&lt;int&gt; g[S]; int ind[S]; int cnt,a[S]; vector&lt;pair&lt;int,int&gt;&gt; ans; int main() { freopen(&quot;destroy.in&quot;,&quot;r&quot;,stdin); freopen(&quot;destroy.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;k); for(int i=1;i&lt;=m;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); if(st.count(make_pair(x,y))) continue; st.insert(make_pair(x,y)); g[x].push_back(y); ind[y]++; } priority_queue&lt;int&gt; q,q2; for(int i=1;i&lt;=n;i++) if(ind[i]==0) q.push(-i); while(k&gt;0&amp;&amp;q.size()&gt;1) q2.push(-q.top()),q.pop(),k--; while(!q.empty()||!q2.empty()) { int u; if(!q.empty()) u=-q.top(),q.pop(); else { u=q2.top(); q2.pop(); ans.push_back(make_pair(a[cnt],u)); } a[++cnt]=u; for(int v:g[u]) { if(--ind[v]==0) q.push(-v); } while(k&gt;0&amp;&amp;q.size()&gt;1) q2.push(-q.top()),q.pop(),k--; if(k&gt;0&amp;&amp;!q.empty()&amp;&amp;!q2.empty()&amp;&amp;-q.top()&lt;q2.top()) { q2.push(-q.top()),q.pop(); k--; } } for(int i=1;i&lt;=n;i++) printf(&quot;%d &quot;,a[i]); printf(&quot;\\n&quot;); printf(&quot;%d\\n&quot;,ans.size()); for(pair&lt;int,int&gt; u:ans) { printf(&quot;%d %d\\n&quot;,u.first,u.second); } return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2023武汉集训模拟赛7】灭国 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-wu-han-ji-xun-mo-ni-sai-7-mie-guo-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":220000,"words":772,"minutes":4},"date":"2023-04-15 16:54:14","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>有一个长为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，刚开始 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">a_i=i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>。还有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点的无向图 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">G</span></span></span></span>，刚开始 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">G</span></span></span></span> 中没有边。</p>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 个操作，每一次给定一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>x</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le x&lt;n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span>，在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">G</span></span></span></span> 中连一条 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mi>x</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{x+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.638891em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">x</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span> 之间的边，然后交换 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mi>x</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{x+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.638891em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">x</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">G</span></span></span></span> 中的最大团的大小。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个长为 nnn 的序列 aaa，刚开始 ai=ia_i=iai​=i。还有一个 nnn 个点的无向图 GGG，刚开始 GGG 中没有边。 有 mmm 个操作，每一次给定一个 1≤x&lt;n1\\le x&lt;n1≤x&lt;n 的 xxx，在 GGG 中连一条 axa_xax​ 和 ax+1a_{x+1}ax+1​ 之间的边，然后交换 axa_xax​ 和 ax+1a_{x+1}ax+1​。 求 GGG 中的最大团的大小。 1≤n,m≤2×1051\\le n,m\\le 2\\times 10^51≤n,m≤2×105。 由于最大团等于补图的最大独立集，所以考虑补图。 不妨先给补图 HHH 重定向，强制让编号小的连向编号大的，那么注意到 HHH 中若有 x→yx\\to yx→y，y→zy\\to zy→z 这两条边那么也一定有 x→zx\\to zx→z 这条边，即 HHH 是一个偏序关系图。注意到偏序关系图的最大独立集等于最长反链，最长反链等于最小链覆盖，最小链覆盖可以通过把 uuu 拆成入点和出点跑二分图最大匹配做，那么问题就转化为求 HHH 的拆点二分图最大匹配。 考虑先贪心匹配，注意到若当前匹配了 kkk 对点，那么所有度数 &gt;k&gt;k&gt;k 且未匹配的左部点一定能匹配。这一部分可以用 set 简单维护，时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)。 最后停下来时有 n−kn-kn−k 个左部点，它们的度数一定都 ≤k\\le k≤k，由于度数 ≤k\\le k≤k 的点最多只有 ⌊mn−k⌋\\lfloor\\frac{m}{n-k}\\rfloor⌊n−km​⌋ 个，所以有 n−k≤mn-k\\le \\sqrt mn−k≤m​ 即未匹配的点是 O(m)O(\\sqrt m)O(m​) 的。那么用并查集维护一下匈牙利找边的过程即可。 时间复杂度 O(nlog⁡n+nm)O(n\\log n+n\\sqrt m)O(nlogn+nm​)。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; #include &lt;set&gt; using namespace std; const int S=200005,mod=1145143; int n,m; int a[S]; vector&lt;int&gt; to[S]; set&lt;int&gt; st; int tp,sta[S]; bool flg[S]; int blg[S],fa[S]; inline int read() { int s=0,c=getchar(); while(c&lt;'0'||c&gt;'9') c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') s=s*10+c-48,c=getchar(); return s; } int fnd(int x) { return fa[x]==x?x:fa[x]=fnd(fa[x]); } bool dfs(int u) { for(int v=fnd(u+1),i=-1;v&lt;=n;v=fnd(v+1)) { while(i+1&lt;to[u].size()&amp;&amp;to[u][i+1]&lt;=v) i++; if(i==-1||v!=to[u][i]) { int tmp=blg[v]; blg[v]=u; fa[fnd(v)]=fnd(v+1); if(tmp==0||dfs(tmp)) return true; blg[v]=tmp; } } return false; } int main() { freopen(&quot;sugar.in&quot;,&quot;r&quot;,stdin); freopen(&quot;sugar.out&quot;,&quot;w&quot;,stdout); n=read(),m=read(); for(int i=1;i&lt;=n;i++) a[i]=i; for(int i=1;i&lt;=m;i++) { int ix=read(); int x=a[ix],y=a[ix+1]; to[x].push_back(y),to[y].push_back(x); swap(a[ix],a[ix+1]); } for(int i=1;i&lt;=n;i++) { sort(to[i].begin(),to[i].end()); to[i].erase(unique(to[i].begin(),to[i].end()),to[i].end()); vector&lt;int&gt; tmp; for(int j:to[i]) if(j&gt;i) tmp.push_back(j); to[i]=tmp; } int ans=n; for(int i=1;i&lt;=n;i++) st.insert(i); for(int i=1;i&lt;=n;i++) { if(st.count(i)) st.erase(i); for(int v:to[i]) if(st.count(v)) st.erase(v),sta[++tp]=v; if(!st.empty()) { blg[*st.begin()]=i,flg[i]=true,ans--; st.erase(st.begin()); } while(tp&gt;0) st.insert(sta[tp--]); } for(int i=1;i&lt;=n;i++) { if(!flg[i]) { for(int j=1;j&lt;=n+1;j++) fa[j]=j; ans-=dfs(i); } } printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"}],"title":"【2023武汉集训模拟赛03】嘉心糖 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-wu-han-ji-xun-mo-ni-sai-03-jia-xin-tang-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":267000,"words":871,"minutes":5},"date":"2023-04-15 16:33:52","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>定义⼀个序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 是连续的，当且仅当序列中最大值和最小值的差为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>m</mi><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">−</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">|m|−1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">m</span><span class=\"mord\">∣</span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>。</p>\n<p>有⼀个⻓度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>，按照以下规则⽣成数组 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span>，其中 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo>{</mo><mi>L</mi><mi mathvariant=\"normal\">∣</mi><mo>[</mo><msub><mi>p</mi><mi>i</mi></msub><mi mathvariant=\"normal\">−</mi><mi>L</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><msub><mi>p</mi><mi>i</mi></msub><mi mathvariant=\"normal\">−</mi><mi>L</mi><mo>+</mo><mn>2</mn><mo>…</mo><msub><mi>p</mi><mi>i</mi></msub><mo>]</mo><mtext> 连续</mtext><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">T_i=\\max\\{L|[p_i−L+1,p_i−L+2\\dots p_i]\\text{ 连续}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">{</span><span class=\"mord mathdefault\">L</span><span class=\"mord\">∣</span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">−</span><span class=\"mord mathdefault\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">−</span><span class=\"mord mathdefault\">L</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mord text\"><span class=\"mord\"> </span><span class=\"mord cjk_fallback\">连续</span></span><span class=\"mclose\">}</span></span></span></span>，也就是以 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 为右端点的最长连续子串长度，显然 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub><mo>≥</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">T_i\\ge1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。</p>\n<p>现在给你 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span> 数组，你需要知道有多少 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 可以生成指定的数组 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span>。对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模。</p>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">Q</span></span></span></span> 组数据。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5\\times 10^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>Q</mi><mo>≤</mo><mn>100</mn></mrow><annotation encoding=\"application/x-tex\">1\\le Q\\le 100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">Q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" 定义⼀个序列 mmm 是连续的，当且仅当序列中最大值和最小值的差为 ∣m∣−1|m|−1∣m∣−1。 有⼀个⻓度为 nnn 的排列 ppp，按照以下规则⽣成数组 TTT，其中 Ti=max⁡{L∣[pi−L+1,pi−L+2…pi] 连续}T_i=\\max\\{L|[p_i−L+1,p_i−L+2\\dots p_i]\\text{ 连续}\\}Ti​=max{L∣[pi​−L+1,pi​−L+2…pi​] 连续}，也就是以 iii 为右端点的最长连续子串长度，显然 Ti≥1T_i\\ge1Ti​≥1。 现在给你 TTT 数组，你需要知道有多少 ppp 可以生成指定的数组 TTT。对 998244353998244353998244353 取模。 有 QQQ 组数据。 1≤n≤5×1041\\le n\\le 5\\times 10^41≤n≤5×104，1≤Q≤1001\\le Q\\le 1001≤Q≤100。 不难发现若两个集合 AAA、BBB 连续且 A∩B=∅A\\cap B\\not=\\varnothingA∩B​=∅，那么 A∪BA\\cup BA∪B 一定连续，所以两个极长连续区间要么没有交集要么互相包含。那么首先判掉区间关系不合法的情况（注意 Tn=nT_n\\not=nTn​​=n 也不行），然后按照包含关系建出树，设 dpudp_udpu​ 为 uuu 的子树的答案，那么有转移： dpu=f∣sonu∣+1∏v∈sonudpvdp_u=f_{|son_u|+1}\\prod\\limits_{v\\in son_u}dp_v dpu​=f∣sonu​∣+1​v∈sonu​∏​dpv​ 其中 fnf_nfn​ 表示长度为 nnn 的形如 {1,1,1,1,…,1,n}\\{1,1,1,1,\\dots,1,n\\}{1,1,1,1,…,1,n} 的 TTT 的答案，总的答案即为 dpndp_ndpn​。 这样转移相当于把儿子代表的区间看作一个点，因为这一段在序列和值域上都是独立的。 那么求出 fff 即可求出答案，但是直接在 ppp 上面 dp 不好做。 这里有个神奇的转化，考虑 ppp 的逆排列 p′p&#x27;p′ 即满足 ppi′=ip&#x27;_{p_i}=ippi​′​=i 的排列，那么 ppp 上的一段连续的区间 [l,r][l,r][l,r] 对应的 p′p&#x27;p′ 上的区间 [min⁡{pl,pl+1,…,pr},max⁡{pl,pl+1,…,pr}][\\min\\{p_l,p_{l+1},\\dots,p_r\\},\\max\\{p_l,p_{l+1},\\dots,p_r\\}][min{pl​,pl+1​,…,pr​},max{pl​,pl+1​,…,pr​}] 也是连续的， 且这段区间中的最大值是 rrr，最小值是 lll。不难发现 ppp 和 p′p&#x27;p′ 是双射的，那么 fnf_nfn​ 就相当于 p′p&#x27;p′ 中所有连续区间都包含最大值 nnn 的排列 p′p&#x27;p′ 的数量。 容易发现 f1=1,f2=2,f3=2f_1=1,f_2=2,f_3=2f1​=1,f2​=2,f3​=2。接下来考虑 fn→fn+1f_n\\to f_{n+1}fn​→fn+1​ 的转移（n≥3n\\ge 3n≥3），考虑新插入一个最小值 000： 插入之前 p′p&#x27;p′ 已经合法：此时唯一的要求是 000 不能和 111 相邻，则 (n−1)×fn→fn(n-1)\\times f_{n}\\to f_n(n−1)×fn​→fn​； 插入之前 p′p&#x27;p′ 不合法：那么要让插入之后的 p′p&#x27;p′ 合法，由于只能插入一个 000，所以插入之前只能有一个极长的不合法连续区间，设它的长度为 xxx，那么要求这个区间中没有 111 且没有 nnn，所以区间的取值共有 n−x−1n-x-1n−x−1 种，并且插入 000 后要让这个区间的子连续段要么长度为 111 要么经过 000，所以区间内部的方案数为 (n−x−1)×fx+1(n-x-1)\\times f_{x+1}(n−x−1)×fx+1​。插入完之后要把这个区间放回去，把它看作一个点，那么外部的方案数即为 fn−x+1f_{n-x+1}fn−x+1​，所以有转移 ∑x=2n−2(n−x−1)fx+1fn−x+1→fn+1\\sum\\limits_{x=2}^{n-2}(n-x-1)f_{x+1}f_{n-x+1}\\to f_{n+1}x=2∑n−2​(n−x−1)fx+1​fn−x+1​→fn+1​； 接下来开始推式子： fn+1=(n−1)×fn+∑x=2n−2(n−x−1)fx+1fn−x+1=(n−1)×fn+∑x=3n−1fx(n−x)fn−x+2=(n−1)×fn+∑x=3nfx(n−x)fn−x+2设 gx=xfx+2 , hx={0x&lt;3fxx≥3=(n−1)×fn+∑i=0nhign−i\\begin{aligned} f_{n+1}&amp;=(n-1)\\times f_n+\\sum\\limits_{x=2}^{n-2} (n-x-1)f_{x+1}f_{n-x+1}\\\\ &amp;=(n-1)\\times f_n+\\sum\\limits_{x=3}^{n-1} f_{x}(n-x)f_{n-x+2}\\\\ &amp;=(n-1)\\times f_n+\\sum\\limits_{x=3}^{n} f_{x}(n-x)f_{n-x+2}\\\\ \\text{设 }g_x=xf_{x+2}\\text{ , }h_x=\\begin{cases}0&amp;x&lt;3\\\\f_x&amp;x\\ge3\\end{cases}\\\\ &amp;=(n-1)\\times f_n+\\sum\\limits_{i=0}^{n} h_ig_{n-i}\\\\ \\end{aligned} fn+1​设 gx​=xfx+2​ , hx​={0fx​​x&lt;3x≥3​​=(n−1)×fn​+x=2∑n−2​(n−x−1)fx+1​fn−x+1​=(n−1)×fn​+x=3∑n−1​fx​(n−x)fn−x+2​=(n−1)×fn​+x=3∑n​fx​(n−x)fn−x+2​=(n−1)×fn​+i=0∑n​hi​gn−i​​ 那么直接分治 NTT O(nlog⁡2n)O(n\\log ^2n)O(nlog2n) 维护，[l,mid][l,mid][l,mid] 贡献到 [mid+1,r][mid+1,r][mid+1,r] 的时候要注意算上 i∈[l,mid]i\\in[l,mid]i∈[l,mid] 的 fif_ifi​ 和 gig_igi​ 的贡献，并且注意边界。 代码如下： // Problem: #187. count // Contest: Hydro // URL: http://oiclass.com/d/AKNOI/p/187 // Memory Limit: 512 MB // Time Limit: 3000 ms // // Powered by CP Editor (https://cpeditor.org) #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int MS=50005,S=500005; const int p=998244353,ginv=332748118; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } inline int getlen(int n) { int res=1; while(res&lt;n) res&lt;&lt;=1; return res; } int lst_n,lst_rev[S]; inline void NTT(int n,int a[],int tpe) { if(lst_n!=n) { lst_n=n; for(int i=0;i&lt;n;i++) lst_rev[i]=(lst_rev[i&gt;&gt;1]&gt;&gt;1)|(i&amp;1)*(n&gt;&gt;1); } for(int i=0;i&lt;n;i++) if(lst_rev[i]&lt;i) swap(a[i],a[lst_rev[i]]); int g=tpe==1?3:ginv; for(int mid=1;mid&lt;n;mid&lt;&lt;=1) { int len=mid&lt;&lt;1,Wn=qpow(g,(p-1)/len); for(int l=0;l&lt;n-len+1;l+=len) { for(int k=0,Wk=1;k&lt;mid;k++,Wk=1ll*Wk*Wn%p) { int x=a[l+k],y=1ll*a[l+mid+k]*Wk%p; a[l+k]=(x+y)%p,a[l+mid+k]=(x-y+p)%p; } } } } inline void DFT(int n,int a[]){NTT(n,a,1);} inline void IDFT(int n,int a[]) { NTT(n,a,-1); int inv=qpow(n,p-2); for(int i=0;i&lt;n;i++) a[i]=1ll*a[i]*inv%p; } int f[S]; int h[S],g[S]; int q,n,a[MS]; void calc(int l,int r) { if(r&lt;=3||l&gt;r) return; if(l==r) return f[l]=(f[l]+1ll*(l-2)*f[l-1]%p)%p,void(); int mid=l+r&gt;&gt;1; calc(l,mid); // printf(&quot;calc([%d %d] -&gt; %d):\\n&quot;,l,r,mid); for(int i=l;i&lt;=mid;i++) h[i-l]=i&lt;3?0:f[i]; for(int i=0;i&lt;=r-l-1;i++) g[i]=1ll*i*f[i+2]%p; int lh=mid-l,lg=r-l-1; // for(int i=0;i&lt;=lh;i++) printf(&quot;%d &quot;,h[i]); // printf(&quot;\\n&quot;); // for(int i=0;i&lt;=lg;i++) printf(&quot;%d &quot;,g[i]); // printf(&quot;\\n&quot;); int rl=getlen(lh+lg+1); for(int i=lh+1;i&lt;rl;i++) h[i]=0; for(int i=lg+1;i&lt;rl;i++) g[i]=0; DFT(rl,h),DFT(rl,g); for(int i=0;i&lt;rl;i++) g[i]=1ll*h[i]*g[i]%p; IDFT(rl,g); for(int i=mid+1;i&lt;=r;i++) f[i]=(f[i]+g[i-l-1])%p; // printf(&quot;res: &quot;); // for(int i=mid+1;i&lt;=r;i++) printf(&quot;%d:%d &quot;,i-l-1,g[i-l-1]); // printf(&quot;\\n\\n&quot;); for(int i=l-2;i&lt;=mid-2;i++) h[i-l+2]=1ll*i*f[i+2]%p; for(int i=0;i&lt;=r-l+1;i++) g[i]=i&lt;3||i&gt;=l?0:f[i]; lh=mid-l,lg=r-l+1; // for(int i=0;i&lt;=lh;i++) printf(&quot;%d &quot;,h[i]); // printf(&quot;\\n&quot;); // for(int i=0;i&lt;=lg;i++) printf(&quot;%d &quot;,g[i]); // printf(&quot;\\n&quot;); rl=getlen(lh+lg+1); for(int i=lh+1;i&lt;rl;i++) h[i]=0; for(int i=lg+1;i&lt;rl;i++) g[i]=0; DFT(rl,h),DFT(rl,g); for(int i=0;i&lt;rl;i++) g[i]=1ll*h[i]*g[i]%p; IDFT(rl,g); for(int i=mid+1;i&lt;=r;i++) f[i]=(f[i]+g[i-l+1])%p; // printf(&quot;res: &quot;); // for(int i=mid+1;i&lt;=r;i++) printf(&quot;%d &quot;,g[i-l+1]); // printf(&quot;\\n***************\\n&quot;); calc(mid+1,r); } int dfs(int r) { int l=r-a[r]+1,res=1; int cnt=0; for(int i=r-1;i&gt;=l;i--) { if(i-a[i]+1&lt;l) return 0; res=1ll*res*dfs(i)%p; cnt++; i=i-a[i]+1; } res=1ll*res*f[cnt+1]%p; return res; } int main() { freopen(&quot;count.in&quot;,&quot;r&quot;,stdin); freopen(&quot;count.out&quot;,&quot;w&quot;,stdout); f[1]=1,f[2]=2,f[3]=2; // for(int i=4;i&lt;=100;i++) // { // f[i]=1ll*(i-2)*f[i-1]%p; // for(int j=0;j&lt;=i-1;j++) // { // h[j]=j&lt;3?0:f[j]; // g[j]=1ll*j*f[j+2]%p; // } // for(int j=0;j&lt;=i-1;j++) // { // f[i]=(f[i]+1ll*h[j]*g[i-1-j]%p)%p; // } // } calc(1,MS-3); // for(int i=1;i&lt;=20;i++) printf(&quot;%d &quot;,f[i]); // printf(&quot;\\n&quot;); scanf(&quot;%d%d&quot;,&amp;q,&amp;n); while(q--) { for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); if(a[n]!=n) puts(&quot;0&quot;); else printf(&quot;%d\\n&quot;,dfs(n)); } return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"多项式、生成函数","slug":"XKmkuK_oz","used":true,"link":"https://Rebxe.github.io/tag/XKmkuK_oz/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛13】count 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-13-count-zuo-ti-ji-lu/","stats":{"text":"12 min read","time":698000,"words":2140,"minutes":12},"date":"2023-04-15 16:18:28","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>你有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mo>…</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">1,2,\\dots N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span></span></span></span>。</p>\n<p>你可以进行<strong>一次</strong>如下操作：选择一个<strong>非负</strong>整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，以及 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 个不交的区间 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>l</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>r</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>l</mi><mn>2</mn></msub><mo>&lt;</mo><msub><mi>r</mi><mn>2</mn></msub><mo>&lt;</mo><mo>⋯</mo><mo>&lt;</mo><msub><mi>l</mi><mi>k</mi></msub><mo>&lt;</mo><msub><mi>r</mi><mi>k</mi></msub><mo>≤</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">1\\le l_1&lt;r_1&lt;l_2&lt;r_2&lt;\\dots&lt;l_k&lt;r_k\\le N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6891em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6891em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span>，然后对每个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">1\\le i\\le k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.79549em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>，将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>P</mi><msub><mi>l</mi><mi>i</mi></msub></msub><mo separator=\"true\">,</mo><msub><mi>P</mi><mrow><msub><mi>l</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>P</mi><mrow><msub><mi>l</mi><mi>i</mi></msub><mo>+</mo><mn>2</mn></mrow></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>P</mi><msub><mi>r</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">P_{l_i},P_{l_i+1},P_{l_i+2},\\dots,P_{r_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.93343em;vertical-align:-0.2501em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2501em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2501em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2501em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139199999999997em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2501em;\"><span></span></span></span></span></span></span></span></span></span> 替换为它们的升序排列。</p>\n<p>你想知道 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span></span></span></span> 在操作完后可能有多少种不同的情况。由于情况数可能很多，所以你只想得到其对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模后的结果。请你帮帮你自己求出答案！</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>N</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le N\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 你有一个 1,2,…N1,2,\\dots N1,2,…N 的排列 PPP。 你可以进行一次如下操作：选择一个非负整数 kkk，以及 kkk 个不交的区间 1≤l1&lt;r1&lt;l2&lt;r2&lt;⋯&lt;lk&lt;rk≤N1\\le l_1&lt;r_1&lt;l_2&lt;r_2&lt;\\dots&lt;l_k&lt;r_k\\le N1≤l1​&lt;r1​&lt;l2​&lt;r2​&lt;⋯&lt;lk​&lt;rk​≤N，然后对每个 1≤i≤k1\\le i\\le k1≤i≤k 的 iii，将 Pli,Pli+1,Pli+2,…,PriP_{l_i},P_{l_i+1},P_{l_i+2},\\dots,P_{r_i}Pli​​,Pli​+1​,Pli​+2​,…,Pri​​ 替换为它们的升序排列。 你想知道 PPP 在操作完后可能有多少种不同的情况。由于情况数可能很多，所以你只想得到其对 998244353998244353998244353 取模后的结果。请你帮帮你自己求出答案！ 1≤N≤2×1051\\le N\\le 2\\times 10^51≤N≤2×105。 考虑设 dpidp_{i}dpi​ 表示 P[1,i]P_{[1,i]}P[1,i]​ 在操作之后有多少种不同的情况，考虑转移。一个区间 [l,r][l,r][l,r] 只能通过操作 [l,r][l,r][l,r] 来排序当且仅当不存在 kkk 满足 l≤k≤r−1l\\le k\\le r-1l≤k≤r−1 且排序 [l,k][l,k][l,k] 再排序 [k+1,r][k+1,r][k+1,r] 得到的序列和排序 [l,r][l,r][l,r] 相同。不妨称满足条件的区间是 ”好的“ 那么设 SiS_iSi​ 表示所有满足 [j,i][j,i][j,i] 是好的的 jjj 的集合，那么有转移 dpi=∑j∈Sidpj−1dp_i=\\sum\\limits_{j\\in S_i}dp_{j-1}dpi​=j∈Si​∑​dpj−1​，初始状态 dp0=1dp_0=1dp0​=1。 考虑求解 SiS_iSi​，显然有一个 O(n2)O(n^2)O(n2) 的算法： 对于每个 iii，从 iii 开始往前遍历，并维护当前 SiS_iSi​ 中最长的区间 [l,i][l,i][l,i] 和其中的最小值 valvalval。刚开始 Si={i},l=i,val=aiS_i=\\{i\\},l=i,val=a_iSi​={i},l=i,val=ai​，每遍历到一个位置 jjj： 若 Pj&lt;valP_j&lt;valPj​&lt;val，什么也不做； 若 Pj&gt;valP_j&gt;valPj​&gt;val，表明排序 [j,i][j,i][j,i] 之后会有一些 [l,i][l,i][l,i] 中的元素跑到 PjP_jPj​ 前面，由于 [l,i][l,i][l,i] 已经是好的了，所以这是排序 [j,x][j,x][j,x] 再排序 [x+1,i][x+1,i][x+1,i] 所做不到的，那么更新 l=jl=jl=j，并把 jjj 加入 SiS_iSi​，更新 valvalval； 观察到许多 SiS_iSi​ 是有大量重复的，考虑利用这种高重复性优化时间复杂度。设 xxx 为满足 Px&lt;PiP_x&lt;P_iPx​&lt;Pi​ 且 x&lt;ix&lt;ix&lt;i 的最大的 xxx，yyy 为满足 Py&gt;PiP_y&gt;P_iPy​&gt;Pi​ 且 y&lt;xy&lt;xy&lt;x 的最大的 yyy。那么有 [x+1,i]∈Si[x+1,i]\\in S_i[x+1,i]∈Si​ 且 [y+1,x]∉Si[y+1,x]\\notin S_i[y+1,x]∈/​Si​。 更进一步，设 zzz 为 [y+1,x][y+1,x][y+1,x] 中最小值的位置，由于 Py&gt;Pi,Pi&gt;Px,Px≥PzP_y&gt;P_i,P_i&gt;P_x,P_x\\ge P_zPy​&gt;Pi​,Pi​&gt;Px​,Px​≥Pz​，所以有 Pz&lt;PyP_z&lt;P_yPz​&lt;Py​，那么有 [y+1,z]∈Sz[y+1,z]\\in S_z[y+1,z]∈Sz​。并且观察到从 iii 和从 zzz 开始遍历到 yyy 时都有 l=y,val=Pzl=y,val=P_zl=y,val=Pz​，所以 Sz−[y+1,z]+[x+1,i]=SiS_z-[y+1,z]+[x+1,i]=S_iSz​−[y+1,z]+[x+1,i]=Si​。 那么二分 + ST 表找到 x,y,zx,y,zx,y,z，拿个前缀和维护转移即可。时间复杂度 O(nlog⁡n)O(n\\log n)O(nlogn)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=200005,BS=20; const int p=998244353; int n,a[S]; int tot,sta[S],premn[S]; int mlog[S],mn[S][BS+5],mx[S][BS+5]; int sum[S],dp[S]; inline int quemn(int l,int r) { int k=mlog[r-l+1]; int x=mn[l][k],y=mn[r-(1&lt;&lt;k)+1][k]; return a[x]&lt;a[y]?x:y; } inline int quemx(int l,int r) { int k=mlog[r-l+1]; int x=mx[l][k],y=mx[r-(1&lt;&lt;k)+1][k]; return a[x]&gt;a[y]?x:y; } inline int fnd(int x,int val) { int l=1,r=x,res=0; while(l&lt;=r) { int mid=l+r&gt;&gt;1; if(a[quemx(mid,x)]&gt;val) res=mid,l=mid+1; else r=mid-1; } return res; } inline int quesm(int l,int r) { return (sum[r]-(l==0?0:sum[l-1])+p)%p; } int main() { freopen(&quot;bai.in&quot;,&quot;r&quot;,stdin); freopen(&quot;bai.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); sta[tot=0]=0; for(int i=1;i&lt;=n;i++) { while(tot&gt;0&amp;&amp;a[sta[tot]]&gt;a[i]) tot--; premn[i]=sta[tot]; sta[++tot]=i; } mlog[0]=-1; for(int i=1;i&lt;=n;i++) mlog[i]=mlog[i&gt;&gt;1]+1,mn[i][0]=mx[i][0]=i; for(int j=1;j&lt;=mlog[n];j++) { for(int i=1;i&lt;=n-(1&lt;&lt;j)+1;i++) { int x=mn[i][j-1],y=mn[i+(1&lt;&lt;j-1)][j-1]; mn[i][j]=a[x]&lt;a[y]?x:y; x=mx[i][j-1],y=mx[i+(1&lt;&lt;j-1)][j-1]; mx[i][j]=a[x]&gt;a[y]?x:y; } } sum[0]=dp[0]=1; for(int i=1;i&lt;=n;i++) { int x=premn[i],y=fnd(x,a[i]); if(y==0) dp[i]=quesm(x,i-1); else { int z=quemn(y+1,x); dp[i]=((dp[z]-quesm(y,z-1)+p)%p+quesm(x,i-1))%p; } sum[i]=(sum[i-1]+dp[i])%p; } printf(&quot;%d\\n&quot;,dp[n]); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛11】白 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-11-bai-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":409000,"words":1293,"minutes":7},"date":"2023-04-15 16:13:03","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>你在打游戏。在这个游戏中你有一个怒气值，其初始为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">A</span></span></span></span>，你的目标是通过 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 次操作将其变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span>。这 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 次操作决定了你在一次游戏中的得分，这个得分初始为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，每次操作你可以：</p>\n<ul>\n<li>发怒，这会使你怒气值 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span>，然后将得分乘上当前怒气值。</li>\n<li>冷静，这会使你怒气值 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">−</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">−1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>，而不改变得分。</li>\n</ul>\n<p>你想知道如果你使用所有能够达成目标的操作序列都各进行一次游戏，你的得分总和会是多少。特别地，如果无论如何都无法达成目标，则总和为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>。由于这个总和可能很大，所以你只想得到其对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模后的结果。请你帮帮你自己求出答案！</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>N</mi><mo separator=\"true\">,</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le N,A,B\\le 2\\times 10^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 你在打游戏。在这个游戏中你有一个怒气值，其初始为 AAA，你的目标是通过 NNN 次操作将其变为 BBB。这 NNN 次操作决定了你在一次游戏中的得分，这个得分初始为 111，每次操作你可以： 发怒，这会使你怒气值 +1+1+1，然后将得分乘上当前怒气值。 冷静，这会使你怒气值 −1−1−1，而不改变得分。 你想知道如果你使用所有能够达成目标的操作序列都各进行一次游戏，你的得分总和会是多少。特别地，如果无论如何都无法达成目标，则总和为 000。由于这个总和可能很大，所以你只想得到其对 998244353998244353998244353 取模后的结果。请你帮帮你自己求出答案！ 0≤N,A,B≤2×1070\\le N,A,B\\le 2\\times 10^70≤N,A,B≤2×107。 首先 N+A+BN+A+BN+A+B 若不为偶数就不存在可以达成目标的操作序列，直接输出 000。 观察到由于 0≤A,B0\\le A,B0≤A,B，所以若怒气值降到负数则之后一定升到 000，让得分为 000。所以若把发怒看作 (，冷静看作 )，那么在操作序列对应的括号序列前面加上 AAA 个 (，后面加上 BBB 个 ) 则这个括号序列一定合法。 考虑 A=B=0A=B=0A=B=0 的情况，发现答案为 1×3×5×...×(N−1)=(N−1)!!1\\times 3\\times 5\\times...\\times (N-1)=(N-1)!!1×3×5×...×(N−1)=(N−1)!!。这个东西有个组合意义：NNN 个互不相同的东西分成 N2\\frac{N}{2}2N​ 个互不区分的无序二元组的方案数。那么考虑构建双射，对于一种分组方案，在这一组中小的那个位置填上 (，大的那个位置填 )，则这样填出来的一定是合法括号序列。 考虑一个括号序列有多少种分组方案与之对应。可以从右向左考虑，遇到 ) 就先加入一个集合 SSS，遇到 ( 就随便从 SSS 中选一个位置和它组成一个二元组。设某一次遇到 ( 的位置为 iii，所以 ∣S∣|S|∣S∣ 就是 iii 之后 ) 的个数 cnt)[i+1,n]cnt)_{[i+1,n]}cnt)[i+1,n]​ 减掉 iii 之后 ( 的个数 cnt([i+1,n]cnt(_{[i+1,n]}cnt([i+1,n]​；那么由于 A=B=0A=B=0A=B=0，所以 cnt([1,i]−cnt)[1,i]=cnt)[i+1,n]−cnt([i+1,n]=∣S∣cnt(_{[1,i]}-cnt)_{[1,i]}=cnt)_{[i+1,n]}-cnt(_{[i+1,n]}=|S|cnt([1,i]​−cnt)[1,i]​=cnt)[i+1,n]​−cnt([i+1,n]​=∣S∣。因为一个括号序列的分组方案数是 ∏∣S∣\\prod|S|∏∣S∣，所以一个括号序列对应的分组方案就是它的分数！ 加上 AAA 和 BBB 的条件，问题就变成了： 有 A+N+BA+N+BA+N+B 个元素，现在要把它们两两配对成 A+N+B2\\frac{A+N+B}{2}2A+N+B​ 个互不区分的无序二元组，求满足以下条件的配对方案个数： AAA 中的元素不能两两配对； BBB 中的元素不能两两配对； 如果只有 BBB 中元素不能两两配对的限制那么很好做，答案即为 (N+A)B‾(N+A−B−1)!!(N+A)^{\\underline{B}}(N+A-B-1)!!(N+A)B​(N+A−B−1)!!，即最后 BBB 个元素的配对方案乘上剩下 N+A−BN+A-BN+A−B 个元素的配对方案。若考虑上 AAA 的限制其实也很简单，只需要枚举有多少个二元组是 AAA 中元素互相配对的就行了： 1A!∑i=0⌊A2⌋(−1)i(A2i)(2i−1)!!(N+A−2i)B‾(N+A−2i−B−1)!!\\frac{1}{A!}\\sum\\limits_{i=0}^{\\lfloor\\frac{A}{2}\\rfloor}(-1)^i\\binom{A}{2i}(2i-1)!!(N+A-2i)^{\\underline{B}}(N+A-2i-B-1)!! A!1​i=0∑⌊2A​⌋​(−1)i(2iA​)(2i−1)!!(N+A−2i)B​(N+A−2i−B−1)!! 乘上 1A!\\frac{1}{A!}A!1​ 是为了去掉在括号前面添加的那 AAA 个 ( 的贡献。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=40000005; const int p=998244353; int n,a,b; int fra[S],inv[S],fra2[S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } inline int C(int n,int m) { if(n&lt;0||m&lt;0||n&lt;m) return 0; return 1ll*fra[n]*inv[n-m]%p*inv[m]%p; } int main() { freopen(&quot;fa.in&quot;,&quot;r&quot;,stdin); freopen(&quot;fa.out&quot;,&quot;w&quot;,stdout); fra[0]=1; for(int i=1;i&lt;=S-3;i++) fra[i]=1ll*fra[i-1]*i%p; inv[S-3]=qpow(fra[S-3],p-2); for(int i=S-3;i&gt;=1;i--) inv[i-1]=1ll*inv[i]*i%p; fra2[0]=fra2[1]=1; for(int i=2;i&lt;=S-3;i++) fra2[i]=1ll*fra2[i-2]*i%p; scanf(&quot;%d%d%d&quot;,&amp;n,&amp;a,&amp;b); if(n+a+b&amp;1) return puts(&quot;0&quot;),0; int ans=0; for(int i=0;i*2&lt;=a&amp;&amp;n+a-i*2&gt;=b;i++) { int val=1ll*C(a,i*2)*(i==0?1:fra2[i*2-1])%p; val=1ll*val*fra[n+a-i*2]%p*inv[n+a-i*2-b]%p; val=1ll*val*(n+a-i*2-b==0?1:fra2[n+a-i*2-b-1])%p; if(i&amp;1) ans=(ans-val+p)%p; else ans=(ans+val)%p; } ans=1ll*ans*inv[a]%p; printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛11】發 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-11-fa-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":371000,"words":1319,"minutes":7},"date":"2023-04-15 16:11:56","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>鸽子的老家是一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个节点的树，节点编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\sim n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>。这是鸽子三年来第一次回老家，鸽子发现树的边受了些损伤。设损伤的边集为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>P</mi><mo>(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">P(a,b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\">)</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span> 之间简单路径的边集，鸽子用下面这个函数表示树的受损程度：</p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>S</mi><mo>)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>a</mi><mn>2</mn></msub><mo>&lt;</mo><mo>⋯</mo><mo>&lt;</mo><msub><mi>a</mi><mi>m</mi></msub><mo>≤</mo><mi>n</mi></mrow></munder><mrow><mo fence=\"true\">[</mo><mrow><mo fence=\"true\">(</mo><munder><mo>∏</mo><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>≤</mo><mi>m</mi></mrow></munder><mi mathvariant=\"normal\">∣</mi><mi>P</mi><mo>(</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>j</mi></msub><mo>)</mo><mo>∩</mo><mi>S</mi><mi mathvariant=\"normal\">∣</mi><mo fence=\"true\">)</mo></mrow><mo>≥</mo><mn>1.24280373</mn><msup><mn>9</mn><mrow><mo>(</mo><mi>m</mi><mi mathvariant=\"normal\">−</mi><mn>1</mn><mo>)</mo><mo>(</mo><mi>m</mi><mi mathvariant=\"normal\">−</mi><mn>2</mn><mo>)</mo></mrow></msup><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">f(S)=\\sum\\limits_{1\\le a_1&lt;a_2&lt;⋯&lt;a_m\\le n}\\left[\\left(\\prod\\limits_{1\\le i,j\\le m}|P(a_i,a_j)\\cap S|\\right)\\ge 1.242803739^{(m−1)(m−2)}\\right]\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.163777em;vertical-align:-1.413777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.882887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mrel mtight\">&lt;</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mrel mtight\">&lt;</span><span class=\"minner mtight\">⋯</span><span class=\"mrel mtight\">&lt;</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.16454285714285719em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mrel mtight\">≤</span><span class=\"mord mathdefault mtight\">n</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.367213em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">[</span></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">(</span></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.8723309999999997em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathdefault mtight\">m</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∏</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.413777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">∣</span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">)</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span><span class=\"mord\">.</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">8</span><span class=\"mord\">0</span><span class=\"mord\">3</span><span class=\"mord\">7</span><span class=\"mord\">3</span><span class=\"mord\"><span class=\"mord\">9</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">m</span><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">m</span><span class=\"mord mtight\">−</span><span class=\"mord mtight\">2</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">]</span></span></span></span></span></span></span></p>\n</blockquote>\n<blockquote>\n<p>鸽子会告诉你树边 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>e</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>e</mi><mrow><mi>n</mi><mi mathvariant=\"normal\">−</mi><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">e_1,e_2,\\dots,e_{n−1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.638891em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>你需要依次求出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mo>{</mo><msub><mi>e</mi><mn>1</mn></msub><mo>}</mo><mo>)</mo><mo separator=\"true\">,</mo><mi>f</mi><mo>(</mo><mo>{</mo><msub><mi>e</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo>}</mo><mo>)</mo><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>f</mi><mo>(</mo><mo>{</mo><msub><mi>e</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>e</mi><mrow><mi>n</mi><mi mathvariant=\"normal\">−</mi><mn>1</mn></mrow></msub><mo>}</mo><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">f(\\{e_1\\}),f(\\{e_1,e_2\\}),\\dots,f(\\{e_1,e_2,\\dots,e_{n−1}\\})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mclose\">)</span></span></span></span>，答案对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1914270647</mn></mrow><annotation encoding=\"application/x-tex\">1914270647</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">9</span><span class=\"mord\">1</span><span class=\"mord\">4</span><span class=\"mord\">2</span><span class=\"mord\">7</span><span class=\"mord\">0</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">7</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>10</mn></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le 10</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" 鸽子的老家是一棵 nnn 个节点的树，节点编号为 1∼n1\\sim n1∼n。这是鸽子三年来第一次回老家，鸽子发现树的边受了些损伤。设损伤的边集为 SSS，P(a,b)P(a,b)P(a,b) 表示节点 aaa 和 bbb 之间简单路径的边集，鸽子用下面这个函数表示树的受损程度： f(S)=∑1≤a1&lt;a2&lt;⋯&lt;am≤n[(∏1≤i,j≤m∣P(ai,aj)∩S∣)≥1.242803739(m−1)(m−2)]f(S)=\\sum\\limits_{1\\le a_1&lt;a_2&lt;⋯&lt;a_m\\le n}\\left[\\left(\\prod\\limits_{1\\le i,j\\le m}|P(a_i,a_j)\\cap S|\\right)\\ge 1.242803739^{(m−1)(m−2)}\\right] f(S)=1≤a1​&lt;a2​&lt;⋯&lt;am​≤n∑​[(1≤i,j≤m∏​∣P(ai​,aj​)∩S∣)≥1.242803739(m−1)(m−2)] 鸽子会告诉你树边 e1,e2,…,en−1e_1,e_2,\\dots,e_{n−1}e1​,e2​,…,en−1​。 你需要依次求出 f({e1}),f({e1,e2}),…,f({e1,e2,…,en−1})f(\\{e_1\\}),f(\\{e_1,e_2\\}),\\dots,f(\\{e_1,e_2,\\dots,e_{n−1}\\})f({e1​}),f({e1​,e2​}),…,f({e1​,e2​,…,en−1​})，答案对 191427064719142706471914270647 取模。 1≤n≤1051\\le n\\le 10^51≤n≤105，1≤m≤101\\le m\\le 101≤m≤10。 诈骗题。 首先考虑依照没坏的边把原图分成多个连通块，这些连通块之间通过坏掉的边形成一棵树。那么选出的 mmm 个点一定不能在同一个连通块中，否则会有某个 ∣P(ai,aj)∩S∣|P(a_i,a_j)\\cap S|∣P(ai​,aj​)∩S∣ 为 000。 观察到这样的 (i,j)(i,j)(i,j) 一共有 (m2)=m(m−1)2\\binom{m}{2}=\\frac{m(m-1)}{2}(2m​)=2m(m−1)​ 对，由于 mmm 个点组成的是一个树形结构，最多有 m−1m-1m−1 对点的 ∣P(ai,aj)∩S∣|P(a_i,a_j)\\cap S|∣P(ai​,aj​)∩S∣ 是 111。并且由于 1.2428037392&lt;21.242803739^2&lt;21.2428037392&lt;2，那么有： 2(m2)−(m−1)=2m(m−1)2−(m−1)=2(m−1)(m−2)2≥2(m−1)(m−2)2≥(1.2428037392)(m−1)(m−2)2≥1.242803739(m−1)(m−2)2^{\\binom{m}{2}-(m-1)}=2^{\\frac{m(m-1)}{2}-(m-1)}=2^{\\frac{(m-1)(m-2)}{2}}\\ge 2^{\\frac{(m-1)(m-2)}{2}}\\ge (1.242803739^2)^{\\frac{(m-1)(m-2)}{2}}\\ge 1.242803739^{(m-1)(m-2)} 2(2m​)−(m−1)=22m(m−1)​−(m−1)=22(m−1)(m−2)​≥22(m−1)(m−2)​≥(1.2428037392)2(m−1)(m−2)​≥1.242803739(m−1)(m−2) 所以只要选出的 mmm 个点不属于一个连通块就行了，1.2428037391.2428037391.242803739 就是诈骗的。 考虑怎么求出 f({e1}),f({e1,e2}),…,f({e1,e2,…,en−1})f(\\{e_1\\}),f(\\{e_1,e_2\\}),\\dots,f(\\{e_1,e_2,\\dots,e_{n−1}\\})f({e1​}),f({e1​,e2​}),…,f({e1​,e2​,…,en−1​})，显然可以倒过来变成加边，然后用退背包退掉合并前连通块的贡献。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=100005,MS=15; const long long p=1914270647; int n,m; int xs[S],ys[S]; int fa[S],siz[S]; long long dp[MS],pd[MS]; long long ans[S]; int fnd(int u) { return fa[u]==u?u:fa[u]=fnd(fa[u]); } inline void meg(int x,int y) { int rx=fnd(x),ry=fnd(y); fa[rx]=ry; siz[ry]+=siz[rx]; } inline void add(long long &amp;x,long long y) { x+=y; if(x&gt;=p) x-=p; } int main() { freopen(&quot;hometown.in&quot;,&quot;r&quot;,stdin); freopen(&quot;hometown.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n-1;i++) scanf(&quot;%d%d&quot;,&amp;xs[i],&amp;ys[i]); for(int i=1;i&lt;=n;i++) fa[i]=i,siz[i]=1; dp[0]=1; for(int i=1;i&lt;=n;i++) for(int j=m;j&gt;=1;j--) add(dp[j],dp[j-1]); for(int i=n-1;i&gt;=1;i--) { ans[i]=dp[m]; int x=xs[i],y=ys[i]; int sx=siz[fnd(x)],sy=siz[fnd(y)]; for(int j=0;j&lt;=m;j++) { pd[j]=dp[j]; if(j&gt;=1) add(pd[j],p-pd[j-1]*sx%p); } for(int j=0;j&lt;=m;j++) dp[j]=pd[j]; for(int j=0;j&lt;=m;j++) { pd[j]=dp[j]; if(j&gt;=1) add(pd[j],p-pd[j-1]*sy%p); } for(int j=0;j&lt;=m;j++) dp[j]=pd[j]; for(int j=m;j&gt;=1;j--) add(dp[j],dp[j-1]*(sx+sy)%p); meg(x,y); } for(int i=1;i&lt;=n-1;i++) printf(&quot;%lld\\n&quot;,ans[i]); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛10】鸽子的老家 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-10-ge-zi-de-lao-jia-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":322000,"words":985,"minutes":6},"date":"2023-04-15 16:09:36","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>有⼀个⻓度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span>，每⼀位为 <code>*</code> 或 <code>+</code>，你需要选择⼀个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 的⼦序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span>，使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>t</mi><mo>)</mo><mspace></mspace><mspace width=\"0.6666666666666666em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">f(t) \\mod 2^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">t</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6666666666666666em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 最⼤。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>t</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">f(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">t</span><span class=\"mclose\">)</span></span></span></span> 表示依次遍历 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 中元素后的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 值：<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 开始，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为 <code>*</code> 则 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 乘 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span> ，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为 <code>+</code> 则 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 加 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> ，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 初始为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>。</p>\n<p>注意：⼀个序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 的⼦序列，当且仅当 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 可以通过删除 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span></span></span></span> 中⼀些位置的元素得到。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>k</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,k\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有⼀个⻓度为 nnn 的序列 sss，每⼀位为 * 或 +，你需要选择⼀个 sss 的⼦序列 ttt，使得 f(t)mod 2kf(t) \\mod 2^kf(t)mod2k 最⼤。 f(t)f(t)f(t) 表示依次遍历 ttt 中元素后的 xxx 值：iii 从 111 开始，如果 tit_iti​ 为 * 则 xxx 乘 222 ，如果 tit_iti​ 为 + 则 xxx 加 111 ，xxx 初始为 000。 注意：⼀个序列 ttt 为 sss 的⼦序列，当且仅当 ttt 可以通过删除 sss 中⼀些位置的元素得到。 1≤n,k≤1061\\le n,k\\le 10^61≤n,k≤106。 先维护出一个数组 aaa，求出每个 + 后面 * 的个数 xxx，即这个 + 最多可以贡献到 2x2^x2x，然后让 ax→ax+1a_x\\to a_x+1ax​→ax​+1。 接下来贪心的进位，按 iii 从小到大遍历 aaa，若 ai≥3a_i\\ge 3ai​≥3 则让 ai+1→ai+1+1a_{i+1}\\to a_{i+1}+1ai+1​→ai+1​+1，ai→ai−2a_i\\to a_i-2ai​→ai​−2，注意到这样可以让来自相邻两个 * 的 + 在 aaa 上留下连续的一段 111 或者 222，并且可以避免进了不需要进的位的情况。 然后就可以求出答案了，从高位往低位贪心，设当前是第 iii 位，那么： 存在 j≥ij\\ge ij≥i 满足 aj=0a_j\\not=0aj​​=0：那么直接让这一位的 111 贡献给第 iii 位，ansi=1ans_i=1ansi​=1，并且让 aj=0a_j=0aj​=0。注意到由于来自相邻两个 * 的 + 在 aaa 上留下连续的一段 111 或者 222，这些 + 会在答案中留下连续的一段 111，所以这样”强扯“过来是可行的，相当于把最后一个 * 从子序列中删去； 不存在 j≥ij\\ge ij≥i 满足 aj=0a_j\\not=0aj​​=0：那么要么 ansi=0ans_i=0ansi​=0，要么找到 111111211111121111112 这样的一段 aaa 进位到 aia_iai​，由于进位之后这些位置都会变成 000，所以直接暴力找即可； 由于高位为 111 一定更优，所以这样贪心是对的，时间复杂度 O(n)O(n)O(n)。 代码如下： // Problem: #A. sequence // Contest: Hydro // URL: http://oiclass.com/d/AKNOI/p/185?tid=63fd6c6355e89e02d91afefd // Memory Limit: 512 MB // Time Limit: 1000 ms // // Powered by CP Editor (https://cpeditor.org) #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=1000005; int n,k; char str[S]; int sum[S],a[S*2]; int ans[S]; int main() { freopen(&quot;sequence.in&quot;,&quot;r&quot;,stdin); freopen(&quot;sequence.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;k); k--; scanf(&quot;%s&quot;,str+1); sum[n]=str[n]=='*'; for(int i=n-1;i&gt;=1;i--) sum[i]=sum[i+1]+(str[i]=='*'); for(int i=1;i&lt;=n;i++) if(str[i]=='+') a[sum[i]]++; for(int i=0;i&lt;=n*2;i++) { if(a[i]&gt;=3) { a[i+1]+=a[i]/2-(a[i]&amp;1^1); a[i]=1+(a[i]&amp;1^1); } } for(int i=k,j=n*2;i&gt;=0;i--) { while(j&gt;=i&amp;&amp;a[j]==0) j--; if(j&gt;=i) a[j]=0,ans[i]=1; else { int res=-1; for(int l=i-1;l&gt;=0;l--) { if(a[l]==0) break; if(a[l]==2) { res=l; break; } } if(res!=-1) { for(int l=res;l&lt;=i-1;l++) a[l]=0; ans[i]=1; } } } bool flg=false; for(int i=k;i&gt;=0;i--) { if(ans[i]==1) flg=true; if(flg) printf(&quot;%d&quot;,ans[i]); } if(!flg) puts(&quot;0&quot;); else printf(&quot;\\n&quot;); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛13】sequence 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-13-sequence-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":227000,"words":772,"minutes":4},"date":"2023-04-15 16:06:31","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>小L初学的时候学到了如下的点分治算法:</p>\n<ul>\n<li>初始时当前连通块是整棵树。</li>\n<li>首先，在当前连通块中找到任意一个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 作为该次的分治中心（不必是重心）。</li>\n<li>其次，把点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 在当前连通块中删去，可以得到若干个连通块。对于每个连通块再递归进行这样的操作。</li>\n</ul>\n<p>不难发现，这个点分治在最坏情况下递归层数可以达到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">)</span></span></span></span> 层。现在，好奇的小 L 想要知道，对于一棵给定的包含 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个节点的树，他有多少种不同的点分治方案呢？因为答案可能很大，你只需要输出它对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 取模的值即可。</p>\n<p>两种点分治方案不同当且仅当某一个连通块所选的点分治中心不同。</p>\n<p>为了避免因为大家所学算法的具体细节不同出现歧义，我们还提供了一份暴力代码来具体描述这个算法。</p>\n<pre><code class=\"language-cpp\">const int mod=1e9+7;\nconst int maxn=5005;\nbool vis[maxn];\nvector&lt;int&gt; e[maxn];\nint n;\ninline void view_all(vector&lt;int&gt; &amp;cur,int x,int fa)\n{\n\tcur.push_back(x);\n\tfor(int p: e[x])\n\t{\n\t\tif (vis[p]) continue;\n\t\tif (p == fa) continue;\n\t\tview_all(cur, p, x);\n\t}\n}\ninline int calc(int x)\n{\n\tvector&lt;int&gt; cur;\n\tint ans = 0;\n\tview_all(cur, x, -1);\n\tfor(auto = w : cur)\n\t{\n\t\tint res = 1;\n\t\tvis[w] = 1;\n\t\tfor(auto p: e[w])\n\t\t{\n\t\t\tif (vis[p]) continue;\n\t\t\tres = 1ll * res * calc(p) % mod;\n\t\t}\n\t\tvis[w] = 0;\n\t\tans = (ans + res) % mod;\n\t}\n\treturn ans;\n}\ninline int get_ans()\n{\n\treturn calc(1);\n}\n</code></pre>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5000</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" 小L初学的时候学到了如下的点分治算法: 初始时当前连通块是整棵树。 首先，在当前连通块中找到任意一个点 uuu 作为该次的分治中心（不必是重心）。 其次，把点 uuu 在当前连通块中删去，可以得到若干个连通块。对于每个连通块再递归进行这样的操作。 不难发现，这个点分治在最坏情况下递归层数可以达到 O(n)O(n)O(n) 层。现在，好奇的小 L 想要知道，对于一棵给定的包含 nnn 个节点的树，他有多少种不同的点分治方案呢？因为答案可能很大，你只需要输出它对 109+710^9+7109+7 取模的值即可。 两种点分治方案不同当且仅当某一个连通块所选的点分治中心不同。 为了避免因为大家所学算法的具体细节不同出现歧义，我们还提供了一份暴力代码来具体描述这个算法。 const int mod=1e9+7; const int maxn=5005; bool vis[maxn]; vector&lt;int&gt; e[maxn]; int n; inline void view_all(vector&lt;int&gt; &amp;cur,int x,int fa) { cur.push_back(x); for(int p: e[x]) { if (vis[p]) continue; if (p == fa) continue; view_all(cur, p, x); } } inline int calc(int x) { vector&lt;int&gt; cur; int ans = 0; view_all(cur, x, -1); for(auto = w : cur) { int res = 1; vis[w] = 1; for(auto p: e[w]) { if (vis[p]) continue; res = 1ll * res * calc(p) % mod; } vis[w] = 0; ans = (ans + res) % mod; } return ans; } inline int get_ans() { return calc(1); } 1≤n≤50001\\le n\\le 50001≤n≤5000。 考虑原树上的一条边 (u,v)(u,v)(u,v)： 考虑断掉 (u,v)(u,v)(u,v) 后对点分树的影响，设断掉 (u,v)(u,v)(u,v) 后 uuu 子树中的点为绿点，vvv 子树中的点为红点，那么由于所有红点和所有绿点只有一条边相连，所以断边前的点分树一定只有一条极长链是既包含绿点又包含红点的： 那么假设这条链是这样的： 断边之后为了保证祖先-后代关系，就一定要这样连： 即每个点的新父亲都是它所有祖先中最深的和它颜色一样的点。 注意到由于保证了祖先-后代关系，所以同一个点分树断不同的边得到的结果是互不相同的，同一个点分树断相同的边得到的结果是相同的。 考虑把这个操作倒过来，合并两棵子树。观察到这个操作对 uuu 和 vvv 这两个点在对应点分树中的子孙都没有影响，所以把 uuu、vvv 到它的子树的点分树的根的链画出来： 那么为了保证不同的两棵小点分树合并出来的点分树不同，相同两棵小点分树合并出来的点分树相同，同样需要保证合并后的祖先-后代关系一致，那么类似归并排序，只要保证这两条链的相对顺序就行了。设绿色链的长度为 xxx，红色链的长度为 yyy，那么合并的方案数即为 (x+yx)\\binom{x+y}{x}(xx+y​)。 考虑用树上背包维护合并的过程，设 dpu,xdp_{u,x}dpu,x​ 表示 uuu 的子树合并完毕，uuu 在点分树中到根的链长度为 xxx 的点分树个数，那么对于每个 uuu 的儿子 vvv，有转移： ∑i=1x∑j=x−isizvdpv,j(x−1i−1)→dpu,x\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=x-i}^{siz_v}dp_{v,j}\\binom{x-1}{i-1}\\to dp_{u,x} i=1∑x​j=x−i∑sizv​​dpv,j​(i−1x−1​)→dpu,x​ 即枚举 uuu 的祖先中有多少个属于 vvv 的点分树的点。注意到这样时间复杂度是 O(n3)O(n^3)O(n3) 的，注意到组合数与 jjj 无关，所以可以做后缀和，这样就可以优化到 O(n2)O(n^2)O(n2)，足以通过本题。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=5005,p=1000000007; int C[S][S]; int n; int esum,to[S*2],nxt[S*2],h[S]; int siz[S],dp[S][S],pd[S]; inline void add(int x,int y) { to[++esum]=y; nxt[esum]=h[x]; h[x]=esum; } inline void addd(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } void dfs(int u,int fa) { siz[u]=1,dp[u][1]=1; for(int i=h[u];i;i=nxt[i]) { int v=to[i]; if(v==fa) continue; dfs(v,u); for(int j=1;j&lt;=siz[u];j++) { for(int k=0;k&lt;=siz[v];k++) { addd(pd[j+k],1ll*dp[u][j]*dp[v][k]%p*C[j+k-1][j-1]%p); } } siz[u]+=siz[v]; for(int j=1;j&lt;=siz[u];j++) dp[u][j]=pd[j],pd[j]=0; } for(int i=siz[u]-1;i&gt;=0;i--) addd(dp[u][i],dp[u][i+1]); } int main() { freopen(&quot;dianfen.in&quot;,&quot;r&quot;,stdin); freopen(&quot;dianfen.out&quot;,&quot;w&quot;,stdout); for(int i=0;i&lt;=S-3;i++) { C[i][0]=1; for(int j=1;j&lt;=i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%p; } scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n-1;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); add(x,y),add(y,x); } dfs(1,0); printf(&quot;%d\\n&quot;,dp[1][1]); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛09】点分治 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-09-dian-fen-zhi-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":349000,"words":1285,"minutes":6},"date":"2023-04-15 14:48:38","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>罗曼诺夫统一了全世界，开创了人类的新纪元。</p>\n<p>为了让子民们和罗曼诺夫一样卷，罗曼诺夫决定把一年设为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 天，当中只有一天放假，也就是罗曼诺夫的生日。</p>\n<p>然而，罗曼诺夫飞升之后，他的继承人却误解了罗曼诺夫的意思，没能继承罗曼诺夫的卷志。每一个继承人登基时都会把自己的生日设为假日，并且如果存在一天，它前后都是假日，那么这天也会被自动设为假日。 <strong>把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 天看做一个环，也就是说第一天和第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 天相邻</strong>。</p>\n<p>我们假设每年会换一个继承人，所有人的生日都独立在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 天中随机。</p>\n<p>工作日逐渐减少，人民无所事事。当一年之中只剩下小于等于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span></span></span></span> 天工作日的时候，国家终于崩溃了。</p>\n<p>天上的罗曼诺夫预料到了这一切。请你帮他算一下，在亡国之前，每一年的<strong>权值</strong>之和的期望。</p>\n<p>定义一年的权值为这一年中假期的总天数的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 次方。</p>\n<p>更加严谨的描述：从初始全都不是假日开始，令计数器 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">cnt=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> ，一直执行以下操作：</p>\n<ul>\n<li>在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 天中均匀随机一天，把它设为假日。</li>\n<li>把两边都是假日的日期也变成假日。</li>\n<li>设此时假日的个数为 <em>s</em> 。如果 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>D</mi><mi mathvariant=\"normal\">−</mi><mi>s</mi><mo>≤</mo><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">D−s\\le K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord\">−</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span></span></span></span> 那么退出循环，否则 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><msup><mo>←</mo><mo>+</mo></msup><msup><mi>s</mi><mi>t</mi></msup></mrow><annotation encoding=\"application/x-tex\">cnt\\leftarrow^+ s^t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.771331em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mrel\">←</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7935559999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7935559999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">t</span></span></span></span></span></span></span></span></span></span></span> 并返回第一步。</li>\n</ul>\n<p>求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">t</span></span></span></span> 的期望，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>K</mi><mo>&lt;</mo><mi>D</mi><mo>≤</mo><mn>2000</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le K&lt;D\\le 2000,0\\le t\\le 10^8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72243em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 罗曼诺夫统一了全世界，开创了人类的新纪元。 为了让子民们和罗曼诺夫一样卷，罗曼诺夫决定把一年设为 DDD 天，当中只有一天放假，也就是罗曼诺夫的生日。 然而，罗曼诺夫飞升之后，他的继承人却误解了罗曼诺夫的意思，没能继承罗曼诺夫的卷志。每一个继承人登基时都会把自己的生日设为假日，并且如果存在一天，它前后都是假日，那么这天也会被自动设为假日。 把 DDD 天看做一个环，也就是说第一天和第 DDD 天相邻。 我们假设每年会换一个继承人，所有人的生日都独立在 DDD 天中随机。 工作日逐渐减少，人民无所事事。当一年之中只剩下小于等于 KKK 天工作日的时候，国家终于崩溃了。 天上的罗曼诺夫预料到了这一切。请你帮他算一下，在亡国之前，每一年的权值之和的期望。 定义一年的权值为这一年中假期的总天数的 ttt 次方。 更加严谨的描述：从初始全都不是假日开始，令计数器 cnt=0cnt=0cnt=0 ，一直执行以下操作： 在 DDD 天中均匀随机一天，把它设为假日。 把两边都是假日的日期也变成假日。 设此时假日的个数为 s 。如果 D−s≤KD−s\\le KD−s≤K 那么退出循环，否则 cnt←+stcnt\\leftarrow^+ s^tcnt←+st 并返回第一步。 求 cntcntcnt 的期望，对 998244353998244353998244353 取模。 0≤K&lt;D≤2000,0≤t≤1080\\le K&lt;D\\le 2000,0\\le t\\le 10^80≤K&lt;D≤2000,0≤t≤108。 注意到共有 iii 天假日时有 jjj 段独立的连续假日段所有情况的概率都是一样的，所以可以设 dpi,jdp_{i,j}dpi,j​ 表示共有 iii 天假日时，有 jjj 段独立的连续假日段的所有情况的总概率，并且暂时先不考虑选择的假日之前被选过的情况。 设 calc⁡(i,j)\\operatorname{calc}(i,j)calc(i,j) 表示有 iii 天假日，分成 jjj 段独立的连续假日段的方案数，即 dpi,jdp_{i,j}dpi,j​ 中共有多少种情况，显然可以用插板法快速求出，那么每种情况的概率即为 ech=dpi,jcalc⁡(i,j)ech=\\frac{dp_{i,j}}{\\operatorname{calc}(i,j)}ech=calc(i,j)dpi,j​​。 转移考虑下一次选择作为假日的是哪一天，首先所有转移的方案数和为 all=(D−i)×calc⁡(i,j)all=(D-i)\\times \\operatorname{calc}(i,j)all=(D−i)×calc(i,j)，接下来分类讨论： 若下一次选择的日期把两个连续段连了起来： 消去长度为 333 的工作日段的方案数为 de3=j×calc⁡(i+3,j−1)de3=j\\times\\operatorname{calc}(i+3,j-1)de3=j×calc(i+3,j−1)，有转移 echD−i×de3→dpi+3,j−1\\frac{ech}{D-i}\\times de3\\to dp_{i+3,j-1} D−iech​×de3→dpi+3,j−1​ 消去长度为 222 的工作日段的方案数为 de2=2×j×calc⁡(i+2,j−1)de2=2\\times j\\times\\operatorname{calc}(i+2,j-1)de2=2×j×calc(i+2,j−1)，有转移 echD−i×de2→dpi+2,j−1\\frac{ech}{D-i}\\times de2\\to dp_{i+2,j-1} D−iech​×de2→dpi+2,j−1​ 若下一次选择的日期并入了某个连续段： 紧挨着之前的连续段的方案数为 wi1=2×j×calc⁡(i+1,j)wi1=2\\times j\\times \\operatorname{calc}(i+1,j)wi1=2×j×calc(i+1,j)，有转移 echD−i×wi1→dpi+1,j\\frac{ech}{D-i}\\times wi1\\to dp_{i+1,j} D−iech​×wi1→dpi+1,j​ 和之前某个连续段之间只间隔一天的方案数为 wi2=2×j×calc⁡(i+2,j)wi2=2\\times j\\times \\operatorname{calc}(i+2,j)wi2=2×j×calc(i+2,j)，有转移 echD−i×wi2→dpi+2,j\\frac{ech}{D-i}\\times wi2\\to dp_{i+2,j} D−iech​×wi2→dpi+2,j​ 下一次选择的日期单独开一个连续段的方案数即为 lft=all−de3−de2−wi1−wi2lft=all-de3-de2-wi1-wi2lft=all−de3−de2−wi1−wi2，有转移 echD−i×lft→dpi+1,j+1\\frac{ech}{D-i}\\times lft\\to dp_{i+1,j+1} D−iech​×lft→dpi+1,j+1​ 最后计算答案考虑期望在有 iii 天假期时停留多少轮即可，利用等比数列求和公式推导，有： ans=∑i=1D−K−1∑j=1idpi,j×it×∑k=0∞(iD)k=∑i=1D−K−1∑j=1idpi,j×it×11−iD\\begin{aligned} ans&amp;=\\sum\\limits_{i=1}^{D-K-1}\\sum\\limits_{j=1}^{i} dp_{i,j}\\times i^t\\times\\sum\\limits_{k=0}^{\\infin}\\left(\\frac{i}{D}\\right)^k\\\\ &amp;=\\sum\\limits_{i=1}^{D-K-1}\\sum\\limits_{j=1}^{i} dp_{i,j}\\times i^t\\times\\frac{1}{1-\\frac{i}{D}}\\\\ \\end{aligned} ans​=i=1∑D−K−1​j=1∑i​dpi,j​×it×k=0∑∞​(Di​)k=i=1∑D−K−1​j=1∑i​dpi,j​×it×1−Di​1​​ 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=2005; const int p=998244353; int D,K,t; int C[S][S],dp[S][S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } inline int inv(int x) { return qpow(x,p-2); } inline int calc(int n,int m) { int val=D-n; if(val==0&amp;&amp;m==0) return 1; if(val-m&lt;=0||m&lt;=0) return 0; return C[val-m-1][m-1]; } int main() { freopen(&quot;holiday.in&quot;,&quot;r&quot;,stdin); freopen(&quot;holiday.out&quot;,&quot;w&quot;,stdout); C[0][0]=1; for(int i=1;i&lt;=S-3;i++) { C[i][0]=1; for(int j=1;j&lt;=i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%p; } scanf(&quot;%d%d%d&quot;,&amp;D,&amp;K,&amp;t); dp[1][1]=1; for(int i=1;i&lt;=D-K-2;i++) { for(int j=1;j&lt;=i;j++) { if(dp[i][j]==0) continue; int all=1ll*(D-i)*calc(i,j)%p; int ech=1ll*dp[i][j]*inv(calc(i,j))%p; int de3=1ll*j*calc(i+3,j-1)%p; int de2=1ll*2*j*calc(i+2,j-1)%p; int wi1=1ll*2*j*calc(i+1,j)%p; int wi2=1ll*2*j*calc(i+2,j)%p; int lft=(((long long)all-de3-de2-wi1-wi2)%p+p)%p; add(dp[i+3][j-1],1ll*ech*inv(D-i)%p*de3%p); add(dp[i+2][j-1],1ll*ech*inv(D-i)%p*de2%p); add(dp[i+1][j],1ll*ech*inv(D-i)%p*wi1%p); add(dp[i+2][j],1ll*ech*inv(D-i)%p*wi2%p); add(dp[i+1][j+1],1ll*ech*inv(D-i)%p*lft%p); } } int ans=0; for(int i=1;i&lt;=D-K-1;i++) { int sum=0; for(int j=1;j&lt;=i;j++) add(sum,dp[i][j]); add(ans,1ll*sum*qpow(i,t)%p*inv((1-1ll*i*inv(D)%p+p)%p)%p); } printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛08】节日 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-08-jie-ri-zuo-ti-ji-lu/","stats":{"text":"9 min read","time":484000,"words":1636,"minutes":9},"date":"2023-04-15 14:46:48","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>罗曼诺夫跑去打炉石，发现对面很菜，所以想要计算自己一发能干掉几个。</p>\n<p>对方有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个随从，生命值分别是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_1,a_2,a_3,\\dots,a_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 。罗曼诺夫发动一次技能，会连续攻击 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 次，每次在当前生命值为正的随从中随机选择一个，使得它的生命值减 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。当一个随从的生命值降到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 时它就死掉了。</p>\n<p>问期望能干掉几个随从，答案模 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 输出。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>15</mn><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>m</mi><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>200</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mo>∑</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 15,1\\le m,a_i\\le 200,m\\le \\sum a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mord\">5</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.00001em;vertical-align:-0.25001em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 罗曼诺夫跑去打炉石，发现对面很菜，所以想要计算自己一发能干掉几个。 对方有 nnn 个随从，生命值分别是 a1,a2,a3,…,ana_1,a_2,a_3,\\dots,a_na1​,a2​,a3​,…,an​ 。罗曼诺夫发动一次技能，会连续攻击 mmm 次，每次在当前生命值为正的随从中随机选择一个，使得它的生命值减 111。当一个随从的生命值降到 000 时它就死掉了。 问期望能干掉几个随从，答案模 998244353998244353998244353 输出。 1≤n≤15,1≤m,ai≤200,m≤∑ai1\\le n\\le 15,1\\le m,a_i\\le 200,m\\le \\sum a_i1≤n≤15,1≤m,ai​≤200,m≤∑ai​。 考虑按时间 dp，设 fi,stf_{i,st}fi,st​ 表示进行了 iii 次操作，死掉的怪物集合是 ststst 概率。fi,stf_{i,st}fi,st​ 一定是形如 ABnx(n−1)y(n−2)z…\\frac{AB}{n^{x}(n-1)^{y}(n-2)^{z}\\dots}nx(n−1)y(n−2)z…AB​ 这样的，其中 AAA 是 u∈stu\\in stu∈st 的部分的方案数，BBB 是 u∈stu\\not\\in stu​∈st 的部分的方案数。注意到 BBB 不好计算，那么先不管它，让 fi,stf_{i,st}fi,st​ 只计算 Anx(n−1)y(n−2)z…\\frac{A}{n^{x}(n-1)^{y}(n-2)^{z}\\dots}nx(n−1)y(n−2)z…A​。 那么有 f0,0=1f_{0,0}=1f0,0​=1，转移枚举第 iii 次操作伤害了哪个小怪： 伤害了 u∉stu\\notin stu∈/​st，那么这部分的贡献属于 BBB，不管： fi,st→fi+1,stf_{i,st}\\to f_{i+1,st} fi,st​→fi+1,st​ 伤害了 u∈stu\\in stu∈st，那么这部分的贡献属于 AAA，有： fi,st×(i−∣st∣aj−1)(n−∣st∣)i+1×(n−∣st∣−1)i+1→fi+1,st+{j}\\frac{f_{i,st}\\times \\binom{i-|st|}{a_j-1}}{(n-|st|)^{i+1}}\\times (n-|st|-1)^{i+1}\\to f_{i+1,st+\\{j\\}} (n−∣st∣)i+1fi,st​×(aj​−1i−∣st∣​)​×(n−∣st∣−1)i+1→fi+1,st+{j}​ 乘的神秘次幂是为了方便计算 1nx(n−1)y(n−2)z…\\frac{1}{n^{x}(n-1)^{y}(n-2)^{z}\\dots}nx(n−1)y(n−2)z…1​，注意到最后 fm,stf_{m,st}fm,st​ 会多乘 (n−∣st∣)m(n-|st|)^m(n−∣st∣)m，那么进行完转移后需要让 fm,st→fm,st(n−∣st∣)mf_{m,st}\\to \\frac{f_{m,st}}{(n-|st|)^m}fm,st​→(n−∣st∣)mfm,st​​。 最后需要考虑计算 BBB，可以设 dpi,jdp_{i,j}dpi,j​ 表示 u∈iu\\in iu∈i 的怪物都没死，剩下的不管的方案数，背包转移即可。注意到这样的时间复杂度是 O(nm2n)O(nm2^n)O(nm2n) 的，过不了，但是注意到可以 meet-in-middle 把时间复杂度变成 O(nm2⌈n2⌉)O(nm2^{\\lceil\\frac{n}{2}\\rceil})O(nm2⌈2n​⌉)，这样就能过了。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int N=20,M=205,BS=1&lt;&lt;15; const int p=998244353; int n,m,a[N]; int C[M][M],cnt[BS],sum[BS],mylog[BS]; int pw[M][M],qw[M][M]; int f[M][BS],dp[BS][M],pd[BS][M]; inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1ll*res*x%p:res; return res; } int main() { scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); C[0][0]=1; for(int i=1;i&lt;=m;i++) { C[i][0]=1; for(int j=1;j&lt;=m;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%p; } for(int i=0;i&lt;=(1&lt;&lt;n)-1;i++) { for(int j=1;j&lt;=n;j++) { if(i&gt;&gt;j-1&amp;1) { cnt[i]++; sum[i]+=a[j]; } } } mylog[0]=-1; for(int i=1;i&lt;=(1&lt;&lt;n)-1;i++) mylog[i]=mylog[i&gt;&gt;1]+1; pw[0][0]=qw[0][0]=1; for(int i=1;i&lt;=m;i++) { pw[0][i]=qw[0][i]=1; pw[i][0]=1,qw[i][0]=1; int tp=qpow(i,p-2); for(int j=1;j&lt;=m;j++) { pw[i][j]=1ll*pw[i][j-1]*i%p; qw[i][j]=1ll*qw[i][j-1]*tp%p; } } f[0][0]=1; for(int i=0;i&lt;=m-1;i++) { for(int j=0;j&lt;=(1&lt;&lt;n)-1;j++) { if(f[i][j]==0||sum[j]&gt;i) continue; add(f[i+1][j],f[i][j]); for(int k=1;k&lt;=n;k++) { if((j&gt;&gt;k-1&amp;1^1)&amp;&amp;sum[j]+a[k]&lt;=i+1) { add(f[i+1][j|(1&lt;&lt;k-1)], 1ll*f[i][j]*C[i-sum[j]][a[k]-1]%p *qw[n-cnt[j]][i+1]%p*pw[n-cnt[j]-1][i+1]%p ); } } } } for(int i=0;i&lt;=(1&lt;&lt;n)-1;i++) { f[m][i]=1ll*f[m][i]*qw[n-cnt[i]][m]%p; // 除掉算多的次幂 } int lim=n/2; dp[0][0]=1; for(int i=1;i&lt;=(1&lt;&lt;lim)-1;i++) { int id=mylog[i&amp;-i]+1; for(int j=0;j&lt;=m;j++) { for(int k=0;k&lt;=j&amp;&amp;k&lt;a[id];k++) { add(dp[i][j],1ll*dp[i^(i&amp;-i)][j-k]*C[j][k]%p); } } } pd[0][0]=1; for(int i=1;i&lt;=(1&lt;&lt;n-lim)-1;i++) { int id=mylog[i&amp;-i]+lim+1; for(int j=0;j&lt;=m;j++) { for(int k=0;k&lt;=j&amp;&amp;k&lt;a[id];k++) { add(pd[i][j],1ll*pd[i^(i&amp;-i)][j-k]*C[j][k]%p); } } } int ans=0; for(int i=1;i&lt;=(1&lt;&lt;n)-1;i++) { if(sum[i]&gt;m) continue; int stdp=(i^((1&lt;&lt;n)-1))&amp;((1&lt;&lt;lim)-1); int stpd=(i^((1&lt;&lt;n)-1))&gt;&gt;lim; for(int j=0;j&lt;=m-sum[i];j++) { int pre=1ll*dp[stdp][j]*pd[stpd][m-sum[i]-j]%p *C[m-sum[i]][j]%p *f[m][i]%p; add(ans,1ll*cnt[i]*pre%p); } } printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023NOI模拟赛08】游戏 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-08-you-xi-zuo-ti-ji-lu/","stats":{"text":"8 min read","time":435000,"words":1324,"minutes":8},"date":"2023-04-15 14:44:58","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>罗曼诺夫发明了一种新的排序方法，所以决定用它来出道题。给定一个排列，这个排序算法会执行以下步骤：</p>\n<ol>\n<li>从排列的开头开始，判断每一对相邻的数是否大小关系正确；</li>\n<li>如果存在相邻的一对数大小关系不正确：\n<ol>\n<li>把较小的那个数丢到排列开头；</li>\n<li>回到步骤一；</li>\n</ol>\n</li>\n<li>排列有序了，结束；</li>\n</ol>\n<p>比如一个排序过程是</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>4</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn><mo>→</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4,1,3,2\\to1,4,3,2\\to3,1,4,2\\to1,3,4,2\\to2,1,3,4\\to1,2,3,4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>4</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>→</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn><mo>→</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4,1,3,2\\to1,4,3,2\\to3,1,4,2\\to1,3,4,2\\to2,1,3,4\\to1,2,3,4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span></span></span></span></p>\n<p>对于排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> ，设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mo>(</mo><mi>p</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">F(p)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">p</span><span class=\"mclose\">)</span></span></span></span> 表示把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 排序会需要进行多少次步骤二。比如 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mo>(</mo><mo>{</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>}</mo><mo>)</mo><mo>=</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">F(\\{4,1,3,2\\})=5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mopen\">{</span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">}</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">5</span></span></span></span>。</p>\n<p>类似字符串，可以定义两个排列（允许长度不同）的字典序比较。</p>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span></span></span></span> ，求字典序最小的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>，使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>F</mi><mo>(</mo><mi>p</mi><mo>)</mo><mo>=</mo><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">F(p)=K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">p</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span></span></span></span> 。可以证明解必定存在。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>K</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>18</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le K\\le 10^{18}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 罗曼诺夫发明了一种新的排序方法，所以决定用它来出道题。给定一个排列，这个排序算法会执行以下步骤： 从排列的开头开始，判断每一对相邻的数是否大小关系正确； 如果存在相邻的一对数大小关系不正确： 把较小的那个数丢到排列开头； 回到步骤一； 排列有序了，结束； 比如一个排序过程是 4,1,3,2→1,4,3,2→3,1,4,2→1,3,4,2→2,1,3,4→1,2,3,44,1,3,2\\to1,4,3,2\\to3,1,4,2\\to1,3,4,2\\to2,1,3,4\\to1,2,3,44,1,3,2→1,4,3,2→3,1,4,2→1,3,4,2→2,1,3,4→1,2,3,4 4,1,3,2→1,4,3,2→3,1,4,2→1,3,4,2→2,1,3,4→1,2,3,44,1,3,2\\to1,4,3,2\\to3,1,4,2\\to1,3,4,2\\to2,1,3,4\\to1,2,3,44,1,3,2→1,4,3,2→3,1,4,2→1,3,4,2→2,1,3,4→1,2,3,4 对于排列 ppp ，设 F(p)F(p)F(p) 表示把 ppp 排序会需要进行多少次步骤二。比如 F({4,1,3,2})=5F(\\{4,1,3,2\\})=5F({4,1,3,2})=5。 类似字符串，可以定义两个排列（允许长度不同）的字典序比较。 给定 KKK ，求字典序最小的排列 ppp，使得 F(p)=KF(p)=KF(p)=K 。可以证明解必定存在。 1≤K≤10181\\le K\\le 10^{18}1≤K≤1018。 不难发现排序的过程是从前往后依次把每一个前缀排序，那么每个前缀都可以归纳为这样的形式： 1 2 3 4 5 6 7 ... n+1 n 设这样的序列的操作次数为 f(n)f(n)f(n)，那么有： {f(1)=1f(n)=1+∑i=2n−1f(i−1)\\begin{cases} f(1)=1\\\\ f(n)=1+\\sum\\limits_{i=2}^{n-1}f(i-1) \\end{cases} ⎩⎨⎧​f(1)=1f(n)=1+i=2∑n−1​f(i−1)​ 易得 f(n)=2n−1f(n)=2^{n-1}f(n)=2n−1。 接下来开个栈构造即可。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=1005,BS=62; int ta,tb,a[S],b[S]; int main() { freopen(&quot;sorting.in&quot;,&quot;r&quot;,stdin); freopen(&quot;sorting.out&quot;,&quot;w&quot;,stdout); long long n; scanf(&quot;%lld&quot;,&amp;n); int id=0; long long m=n; for(int i=0;m&gt;0;i++) { if(n&gt;&gt;i&amp;1) { b[++tb]=++id; a[++ta]=++id; m-=1ll&lt;&lt;i; } else { while(tb&gt;0&amp;&amp;ta&lt;=i) a[++ta]=b[tb--]; if(tb==0&amp;&amp;ta&lt;=i) a[++ta]=++id; } } for(int i=1;i&lt;=ta;i++) printf(&quot;%d &quot;,a[i]); for(int i=tb;i&gt;=1;i--) printf(&quot;%d &quot;,b[i]); printf(&quot;\\n&quot;); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛08】排序 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-08-pai-xu-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":201000,"words":660,"minutes":4},"date":"2023-04-15 14:30:59","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>有一个初始为空的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，你可以通过如下方式生成一个序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，刚开始 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span> 为空。</p>\n<p>接下来进行 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 次操作，第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 次可选的操作如下：</p>\n<ul>\n<li>把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 放入 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 的开头；</li>\n<li>把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 放入 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 的末尾；</li>\n</ul>\n<p>接下来再进行 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 次操作，每次操作可以是下面两种中的一种：</p>\n<ul>\n<li>把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 开头元素从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 中删除，并将其放入 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span> 的最后；</li>\n<li>把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 末尾元素从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 中删除，并将其放入 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span> 的最后；</li>\n</ul>\n<p>对于给定的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>k</mi><mo separator=\"true\">,</mo><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">n,k,p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>，请求出所有不同的可以由以上过程生成的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span> 中有多少个满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">b_k=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>（质数）取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le k\\le n\\le 5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup><mo>≤</mo><mi>p</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">10^8\\le p\\le 2\\times 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.950078em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个初始为空的序列 aaa，你可以通过如下方式生成一个序列 bbb，刚开始 bbb 为空。 接下来进行 nnn 次操作，第 iii 次可选的操作如下： 把 iii 放入 aaa 的开头； 把 iii 放入 aaa 的末尾； 接下来再进行 nnn 次操作，每次操作可以是下面两种中的一种： 把 aaa 开头元素从 aaa 中删除，并将其放入 bbb 的最后； 把 aaa 末尾元素从 aaa 中删除，并将其放入 bbb 的最后； 对于给定的 n,k,pn,k,pn,k,p，请求出所有不同的可以由以上过程生成的序列 bbb 中有多少个满足 bk=1b_k=1bk​=1，对 ppp（质数）取模。 1≤k≤n≤5×1051\\le k\\le n\\le 5\\times 10^51≤k≤n≤5×105，108≤p≤2×10910^8\\le p\\le 2\\times 10^9108≤p≤2×109。 注意到进行完 111 和 222 操作之后的序列 aaa 一定是长这样的： 不难发现 333 和 444 操作一定是先取完某一边，取的时候穿插着取另一边，然后取 111，最后剩下的随便取。观察到以 111 为中心的左边和右边的序列是本质相同的，所以可以假设取完的是左边。 不难发现，这样序列 bbb 就会分成两部分，1∼k1\\sim k1∼k 是一部分，k+1∼nk+1\\sim nk+1∼n 是另一部分。前一部分的要求是能划分为两个单调下降的子序列，后一部分可以乱取，方案数为 2n−k−12^{n-k-1}2n−k−1。设第一部分中属于左边的子序列为 AAA，属于右边的子序列为 BBB，那么两部分唯一的限制即为第二部分中属于右边的最后一个元素要小于 BBB 的最后一个元素： 考虑计算第一部分的方案数，为了防止记重，对于一个 b[1,k]b_{[1,k]}b[1,k]​ 的合法方案，不妨从左往右依次考虑，若 bib_ibi​ 可以接到 AAA 的后面则直接接上去，否则再接到 BBB 的后面。容易证明若 b[1,k]b_{[1,k]}b[1,k]​ 合法则 AAA 和 BBB 则可以分完 b[1,k]b_{[1,k]}b[1,k]​，那么考虑设 dpi,jdp_{i,j}dpi,j​ 表示序列长度为 iii，序列中的数两两不同，BBB 的最后一个数是第 jjj 小的方案数。那么考虑 i+1i+1i+1 是在值域中哪里插入的，分为两种情况： 在值域的末尾（比当前最小值小）：此时一定要接在 AAA 的最后，所以转移到 dpi+1,j+1dp_{i+1,j+1}dpi+1,j+1​； 不在值域的末尾，但比当前第 jjj 小数要小：此时一定要接在 BBB 的最后，所以转移到 dpi+1,2≤k≤jdp_{i+1,2\\le k\\le j}dpi+1,2≤k≤j​； 注意到这两种转移很像，所以可以合并为 dpi,jdp_{i,j}dpi,j​ 转移到 dpi+1,2≤k≤j+1dp_{i+1,2\\le k\\le j+1}dpi+1,2≤k≤j+1​。 考虑 dpi,jdp_{i,j}dpi,j​ 可以从哪里转移到： 如图所示，所以有新的转移 dpi,j=dpi,j+1+dpi−1,j−1dp_{i,j}=dp_{i,j+1}+dp_{i-1,j-1}dpi,j​=dpi,j+1​+dpi−1,j−1​，边界条件 dp1,2=1dp_{1,2}=1dp1,2​=1（BBB 为空默认它里面最小的是第 i+1i+1i+1 小的），那么 dpi,jdp_{i,j}dpi,j​ 相当于从 (1,2)(1,2)(1,2) 开始，只能往下和往右上走，不越过直线 y=x+1y=x+1y=x+1，走到 (i,j)(i,j)(i,j) 的方案数。又发现 dp∗,1dp_{*,1}dp∗,1​ 一定是 000，所以可以令 dpi,j′=dpi,j−1dp&#x27;_{i,j}=dp_{i,j-1}dpi,j′​=dpi,j−1​ 即往下移，那么 dpi,jdp_{i,j}dpi,j​ 就相当于是 (1,1)(1,1)(1,1) 往下往右上走，不越过直线 y=xy=xy=x 走到 (i,j−1)(i,j-1)(i,j−1) 的方案数： 发现这样很丑，不好计算，那么计算 dpa,b′dp&#x27;_{a,b}dpa,b′​ 的时候令 pdi,j=dpi,a−j+1′pd_{i,j}=dp&#x27;_{i,a-j+1}pdi,j​=dpi,a−j+1′​ 即把整体”反过来“，dpa,b′=pda,a−b+1dp&#x27;_{a,b}=pd_{a,a-b+1}dpa,b′​=pda,a−b+1​ 就相当于从 (1,a)(1,a)(1,a) 往下往右走，不越过直线 y=a−x+1y=a-x+1y=a−x+1 走到 (a,b)(a,b)(a,b) 的方案数： 再重新对 pdi,jpd_{i,j}pdi,j​ 建系，dpa,b′dp&#x27;_{a,b}dpa,b′​ 就相当于从 (1,1)(1,1)(1,1) 往上往右走，不越过直线 y=xy=xy=x 走到 (a,a−b+1)(a,a-b+1)(a,a−b+1) 的方案数： 遇到格路计数问题，先设 calc⁡(x,y)\\operatorname{calc}(x,y)calc(x,y) 为从 (1,1)(1,1)(1,1) 向右向上走到 (x,y)(x,y)(x,y) 的方案数，即 (x+y−2x−1)\\binom{x+y-2}{x-1}(x−1x+y−2​)。 这是个经典问题，考虑容斥，用所有方案数减去越过直线 y=xy=xy=x 的方案。所有方案数即为 calc⁡(a,a−b+1)\\operatorname{calc}(a,a-b+1)calc(a,a−b+1)，而越过直线的方案数可以考虑以 y=x+1y=x+1y=x+1 为对称轴把 (a,a−b+1)(a,a-b+1)(a,a−b+1) ”翻折“到 (a−b,a+1)(a-b,a+1)(a−b,a+1)： 这样由于第一次越过直线 y=xy=xy=x 的位置 (x0,y0)(x_0,y_0)(x0​,y0​) 一定在直线 y=x+1y=x+1y=x+1 上，所以把 (x0,y0)(x_0,y_0)(x0​,y0​) 之后的路径翻折就可以到达 (a−b,a+1)(a-b,a+1)(a−b,a+1)，而且每个不同的 (x0,y0)(x_0,y_0)(x0​,y0​) 对应的路径都不一样，翻折后当然也不一样： 所以每种越过直线 y=xy=xy=x 的路径都可以转换为从 (1,1)(1,1)(1,1) 向上向右走到 (a−b,a+1)(a-b,a+1)(a−b,a+1) 的路径，方案数为 calc⁡(a−b,a+1)\\operatorname{calc}(a-b,a+1)calc(a−b,a+1)，那么从 (1,1)(1,1)(1,1) 向上向右走到 (a,a−b+1)(a,a-b+1)(a,a−b+1) 且不越过直线 y=xy=xy=x 的方案数即为 calc⁡(a,a−b+1)−calc⁡(a−b,a+1)\\operatorname{calc}(a,a-b+1)-\\operatorname{calc}(a-b,a+1)calc(a,a−b+1)−calc(a−b,a+1)。 这样我们就可以 O(1)O(1)O(1) 计算 dpi,jdp_{i,j}dpi,j​ 了，dpi,jdp_{i,j}dpi,j​ 即为 calc⁡(i,i−j+2)−calc⁡(i−j+1,i+1)\\operatorname{calc}(i,i-j+2)-\\operatorname{calc}(i-j+1,i+1)calc(i,i−j+2)−calc(i−j+1,i+1)。 那么可以枚举 jjj，答案即为 2n−k−1∑i=2k(i−1+n−ki−1)(calc⁡(k−1,k−i+1)−calc⁡(k−i,k))2^{n-k-1}\\sum\\limits_{i=2}^{k}\\binom{i-1+n-k}{i-1}\\left(\\operatorname{calc}(k-1,k-i+1)-\\operatorname{calc}(k-i,k)\\right)2n−k−1i=2∑k​(i−1i−1+n−k​)(calc(k−1,k−i+1)−calc(k−i,k))。 #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;deque&gt; #include &lt;set&gt; using namespace std; typedef long long ll; const int S=1000005; int n,m; ll p,fra[S],inv[S]; inline ll qpow(ll x,ll y) { ll res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?res*x%p:res; return res; } inline ll C(int n,int m) { if(n&lt;0||m&lt;0||n&lt;m) return 0; return fra[n]*inv[n-m]%p*inv[m]%p; } inline void add(ll &amp;x,ll y) { x+=y; if(x&gt;=p) x-=p; } inline ll calc(int x,int y) { if(x&lt;1||y&lt;1) return 0; return C(x+y-2,x-1); } inline ll calcpd(int i,int j) { return (calc(i,i-j+1)-calc(i-j,i+1)+p)%p; } int main() { scanf(&quot;%d%d%lld&quot;,&amp;n,&amp;m,&amp;p); if(m==1) return printf(&quot;%d\\n&quot;,qpow(2,n-2)),0; fra[0]=1; for(int i=1;i&lt;=S-3;i++) fra[i]=fra[i-1]*i%p; inv[S-3]=qpow(fra[S-3],p-2); for(int i=S-3;i&gt;=1;i--) inv[i-1]=inv[i]*i%p; ll ans=0; for(int i=2;i&lt;=m;i++) { ll prex=C(i-1+n-m,i-1)*calcpd(m-1,i-1)%p; add(ans,prex); } printf(&quot;%lld\\n&quot;,ans*qpow(2,n-m-1)%p); return 0; } ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2023 NOI 模拟赛 04】小 F 与游戏 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-noi-mo-ni-sai-04-xiao-f-yu-you-xi-zuo-ti-ji-lu/","stats":{"text":"10 min read","time":585000,"words":2011,"minutes":10},"date":"2023-04-15 14:22:54","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p>给定一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的正整数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_1,a_2,… ,a_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，令 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>n</mi><mo>)</mo><mo>=</mo><mi>x</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><msub><mi>a</mi><mi>n</mi></msub><mo separator=\"true\">,</mo><mi>f</mi><mo>(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>i</mi><mo>)</mo><mo>=</mo><mo>(</mo><mi>x</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><msub><mi>a</mi><mi>i</mi></msub><mo>)</mo><mo>+</mo><mi>f</mi><mo>(</mo><mi>x</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">f(x,n)= x\\ mod\\ a_n,f(x, i) =(x\\ mod\\ a_i)+ f(x\\ mod\\ a_i,i+ 1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">d</span><span class=\"mspace\"> </span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">d</span><span class=\"mspace\"> </span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">d</span><span class=\"mspace\"> </span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</p>\n<p>求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 为非负整数时，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator=\"true\">,</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">f(x,1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 的最大值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>13</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le a_i\\le 10^{13}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个长度为 nnn 的正整数序列 a1,a2,…,ana_1,a_2,… ,a_na1​,a2​,…,an​，令 f(x,n)=x mod an,f(x,i)=(x mod ai)+f(x mod ai,i+1)f(x,n)= x\\ mod\\ a_n,f(x, i) =(x\\ mod\\ a_i)+ f(x\\ mod\\ a_i,i+ 1)f(x,n)=x mod an​,f(x,i)=(x mod ai​)+f(x mod ai​,i+1)。 求 xxx 为非负整数时，f(x,1)f(x,1)f(x,1) 的最大值。 1≤n≤2×1051\\le n\\le 2\\times 10^51≤n≤2×105，1≤ai≤10131\\le a_i\\le 10^{13}1≤ai​≤1013。 记 xi=xmod a1mod a2mod …mod aix_i=x\\mod a_1\\mod a_2\\mod\\dots\\mod a_ixi​=xmoda1​moda2​mod…modai​，ansi=f(x)−f(xi,i+1)ans_i=f(x)-f(x_i,i+1)ansi​=f(x)−f(xi​,i+1) 也就是前缀和。 设状态 (i,r,S)(i,r,S)(i,r,S) 表示考虑了 a[1,i]a_{[1,i]}a[1,i]​，xi∈[0,r]x_i\\in[0,r]xi​∈[0,r] 且 ansi=ixi+Sans_i=ix_i+Sansi​=ixi​+S，那么显然这个状态下最大的 ansians_iansi​ 为 ir+Sir+Sir+S。 这是图解，最大的 ansians_iansi​ 即为 iii 前面那个楼梯的面积： 考虑转移，有两种情况： r≤ai+1r\\le a_{i+1}r≤ai+1​：无事发生，转移到 (i+1,r,S)(i+1,r,S)(i+1,r,S)； r&gt;ai+1r&gt;a_{i+1}r&gt;ai+1​：需要取模，分成两种子情况： xi≤r−(rmod ai+1)x_i\\le r-(r\\mod a_{i+1})xi​≤r−(rmodai+1​)：蓝色部分，转移到 (i+1,ai+1−1,S+i(r−(rmod ai+1)−ai+1)(i+1,a_{i+1}-1,S+i(r-(r\\mod a_{i+1})-a_{i+1})(i+1,ai+1​−1,S+i(r−(rmodai+1​)−ai+1​)； xi&gt;r−(rmod ai+1)x_i&gt; r-(r\\mod a_{i+1})xi​&gt;r−(rmodai+1​)：红色部分，转移到 (i+1,rmod ai+1,S+i(r−(rmod ai+1))(i+1,r\\mod a_{i+1},S+i(r-(r\\mod a_{i+1}))(i+1,rmodai+1​,S+i(r−(rmodai+1​))； 图解（绿色是第一种转移 SSS 增加的部分，黄色是第二种）: 不难发现，第二种转移的 rrr 是固定的，那么只需要将 SSS 取 max⁡\\maxmax 即可，所以每个 iii 最多只会贡献一种新状态，并且由于最多取模 log⁡V\\log VlogV 次（VVV 是值域），所以状态数是 nlog⁡Vn\\log VnlogV 的，用 set 优化转移可以做到 O(nlog⁡V+nlog⁡(nlog⁡V))O(n\\log V+n\\log(n\\log V))O(nlogV+nlog(nlogV)) 的时间复杂度。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;set&gt; using namespace std; const int S=200005; inline void fio(string name) { freopen((name+&quot;.in&quot;).c_str(),&quot;r&quot;,stdin); freopen((name+&quot;.out&quot;).c_str(),&quot;w&quot;,stdout); } struct node { long long r,s; inline bool operator&lt;(node b) const { return r==b.r?s&gt;b.s:r&gt;b.r; } }; int n,m; long long a[S]; set&lt;node&gt; dp; int main() { fio(&quot;mod&quot;); scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%lld&quot;,&amp;a[i]); dp.insert((node){a[1]-1,0}); for(int i=2;i&lt;=n;i++) { long long mx=-114; for(node u:dp) { if(u.r&lt;a[i]) break; dp.insert((node){u.r%a[i],u.s+(i-1)*(u.r-u.r%a[i])}); mx=max(mx,u.s+(i-1)*(u.r-u.r%a[i]-a[i])); } while((*dp.begin()).r&gt;=a[i]) dp.erase(dp.begin()); if(mx!=-114) dp.insert((node){a[i]-1,mx}); } long long ans=0; for(node u:dp) ans=max(ans,n*u.r+u.s); printf(&quot;%lld\\n&quot;,ans); return 0; } ","tags":[{"name":"杂题","slug":"IgZHugXcl","used":true,"link":"https://Rebxe.github.io/tag/IgZHugXcl/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023 NOI 模拟赛 01】膜 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023-noi-mo-ni-sai-01-mo-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":258000,"words":786,"minutes":5},"date":"2023-04-15 11:54:58","dateFormat":"2023-04-15"},{"abstract":"<blockquote>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 条有向边，每条有向边 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">u_i,v_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>u</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>v</mi><mi>i</mi></msub><mo>≤</mo><msub><mi>u</mi><mi>i</mi></msub><mo>+</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">1\\le u_i&lt;v_i\\le u_i+k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6891em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 组询问，每次给定两个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>≤</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x\\le y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，判断是否能从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 走到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，强制在线。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 2\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">1\\le k\\le 200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" nnn 个点，mmm 条有向边，每条有向边 ui,viu_i,v_iui​,vi​ 满足 1≤ui&lt;vi≤ui+k1\\le u_i&lt;v_i\\le u_i+k1≤ui​&lt;vi​≤ui​+k。qqq 组询问，每次给定两个点 x,yx,yx,y 满足 x≤yx\\le yx≤y，判断是否能从 xxx 走到 yyy，强制在线。 1≤n,m≤2×1051\\le n,m\\le 2\\times10^51≤n,m≤2×105，1≤k≤2001\\le k\\le 2001≤k≤200。 对于一个区间 [l,r][l,r][l,r]，设 mid=⌊l+r2⌋mid=\\lfloor\\frac{l+r}{2}\\rfloormid=⌊2l+r​⌋，则想要从 [l,mid][l,mid][l,mid] 去 [mid+1,r][mid+1,r][mid+1,r] 就一定要经过 [mid,min⁡(mid+k,r)][mid,\\min(mid+k,r)][mid,min(mid+k,r)] 中的至少一个点，所以可以分治预处理出每个区间中左半部分的点能到 [mid,min⁡(mid+k,r)][mid,\\min(mid+k,r)][mid,min(mid+k,r)] 中的哪些点，右半部分的点能由哪些点到达，用 bitset 维护一下。查询的时候直接找到对应的区间把 bitset 按位与一下即可。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;bitset&gt; #include &lt;vector&gt; using namespace std; const int S=200005; int n,m,k; vector&lt;int&gt; g[S]; bitset&lt;205&gt; dp[25][S]; int q; void init(int l,int r,int d) { if(l==r) return; int mid=l+r&gt;&gt;1; for(int i=mid;i&lt;=min(mid+k,r);i++) dp[d][i][i-mid]=1; for(int u=mid-1;u&gt;=l;u--) for(int v:g[u]) if(v&lt;=r) dp[d][u]|=dp[d][v]; for(int u=mid;u&lt;=r;u++) for(int v:g[u]) if(v&lt;=r) dp[d][v]|=dp[d][u]; init(l,mid,d+1),init(mid+1,r,d+1); } bool que(int l,int r,int d,int s,int t) { int mid=l+r&gt;&gt;1; if(t&lt;=mid) return que(l,mid,d+1,s,t); else if(mid&lt;s) return que(mid+1,r,d+1,s,t); return (dp[d][s]&amp;dp[d][t]).any(); } int main() { scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;k); for(int i=1;i&lt;=m;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); g[x].push_back(y); } init(1,n,0); scanf(&quot;%d&quot;,&amp;q); int c=0; while(q--) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); x=((1ll*c*c)^x)%n+1,y=((1ll*c*c)^y)%n+1; if(x&gt;y) swap(x,y); if(x==y||que(1,n,0,x,y)) c++,puts(&quot;Yes&quot;); else puts(&quot;No&quot;); } return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2022 NOIP 多校联测 2】划船 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-duo-xiao-lian-ce-2-hua-chuan-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":185000,"words":557,"minutes":4},"date":"2023-04-14 19:26:37","dateFormat":"2023-04-14"},{"abstract":"","content":"Day -3 到酒店隔离了。 饭好贵，25 块。 Day -2 早餐是自助餐，拿了好多牛肉。 晚餐 18 块的刀削面结块了，好难吃。 世界杯 0:00:00:0，笑死。 Day -1 早餐禁止堂食了，打包好的难吃死了。 Day 0 说好的 7 点出发，结果番禺封了，只好 6：20 偷渡。 酒店的早餐打包去考场吃，难吃死了。 T1 20 min 写完了，没什么好说的。 T2 想了好久，显然 2n−22n-22n−2 直接让每个栈管两种颜色，空出来一个辅助栈。 2n−12n-12n−1 类似，每个栈管两个，多一个辅助栈，如果不得不有一个栈管三个，那么就找到一个不会出现 1,2,3,21,2,3,21,2,3,2 这种情况的栈放进去，找不到就用辅助栈。 感觉很对，过了大样例。 时间复杂度大概是 m(n+log⁡m)m(n+\\log m)m(n+logm)，有点悬。 T3 11：50 左右才看 T3，一眼缩点然后树形 dp，开始疯狂敲键盘。 小样例过了，大样例 WA+RE，没调出来。。。 T4 想 T2 的时候顺便写了个 O(n2q)O(n^2q)O(n2q) 暴力。 大众分了/ll 我的 300300300/ll 自估：100+[15,100]+[0,100]+8=[123,308]100+[15,100]+[0,100]+8=[123,308]100+[15,100]+[0,100]+8=[123,308] infoj：100+35+20+8=163100+35+20+8=163100+35+20+8=163 为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？为什么不先写 T3？ T2 思路是对的，T3 也是，都写挂了，笑死。 CCF 太强了 100+35+0+8=143100 + 35 + 0 + 8 = 143100+35+0+8=143 ","tags":[{"name":2022,"slug":"GJvEuJsM-","used":true,"link":"https://Rebxe.github.io/tag/GJvEuJsM-/"},{"name":"NOIP","slug":"rs_nI3vFV","used":true,"link":"https://Rebxe.github.io/tag/rs_nI3vFV/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"NOIP 2022 游记","feature":"","link":"https://Rebxe.github.io/post/noip-2022-you-ji/","stats":{"text":"3 min read","time":153000,"words":628,"minutes":3},"date":"2023-04-14 19:20:42","dateFormat":"2023-04-14"},{"abstract":"<blockquote>\n<p>给定一个字符串 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，你每次可以交换 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 的相邻两个字符，问最少进行多少次交换才能使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 变为回文串。数据保证一定能够在有限次交换操作后使得 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> 变为回文串。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le |a|\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个字符串 aaa，你每次可以交换 aaa 的相邻两个字符，问最少进行多少次交换才能使得 aaa 变为回文串。数据保证一定能够在有限次交换操作后使得 aaa 变为回文串。 1≤∣a∣≤1061\\le |a|\\le 10^61≤∣a∣≤106。 设 pip_ipi​ 表示最后第 iii 个位置的字符原来是哪个位置上的，显然答案就是 ppp 的逆序对个数，并且确定了 p[1,⌊n2⌋]p_{[1,\\lfloor\\frac{n}{2}\\rfloor]}p[1,⌊2n​⌋]​ 就可以确定 p[⌊n2⌋+1,n]p_{[\\lfloor\\frac{n}{2}\\rfloor+1,n]}p[⌊2n​⌋+1,n]​。 这里有个结论：p[1,⌊n2⌋]p_{[1,\\lfloor\\frac{n}{2}\\rfloor]}p[1,⌊2n​⌋]​ 一定是递增的。 证明： 若存在 1≤i&lt;⌊n2⌋1\\le i&lt; \\lfloor\\frac{n}{2}\\rfloor1≤i&lt;⌊2n​⌋ 满足 pi&gt;pi+1p_i&gt;p_{i+1}pi​&gt;pi+1​，则我们可以交换 pip_ipi​ 和 pi+1p_{i+1}pi+1​，此时逆序对个数一定会减 111，相应的我们也要交换 pn−i+1p_{n-i}+1pn−i​+1 和 pn−ip_{n-i}pn−i​，这会让逆序对个数加 111 或者减 111，所以这样调整一定是不劣的。 那么乱贪就行了，代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; #include &lt;deque&gt; using namespace std; const int S=1000005; int n; char a[S]; deque&lt;int&gt; q[30]; int c[S],res[S]; inline void add(int x,int val) { for(int i=x;i&lt;=n;i+=i&amp;-i) c[i]+=val; } inline int que(int x) { int res=0; for(int i=x;i&gt;=1;i-=i&amp;-i) res+=c[i]; return res; } int main() { scanf(&quot;%s&quot;,a+1); n=strlen(a+1); for(int i=1;i&lt;=n;i++) a[i]=a[i]-'a'+1; for(int i=1;i&lt;=n;i++) q[a[i]].push_back(i); for(int i=1;i&lt;=n/2;i++) { int mnval=1e8,idx=0; for(int j=1;j&lt;=26;j++) { if(q[j].size()&gt;1) { int pre=abs(q[j].front()-i); if(pre&lt;mnval) mnval=pre,idx=j; } } res[i]=q[idx].front(); res[n-i+1]=q[idx].back(); q[idx].pop_front(); q[idx].pop_back(); } if(n&amp;1) for(int j=1;j&lt;=26;j++) if(q[j].size()&gt;=1) res[n/2+1]=q[j].front(); long long ans=0; for(int i=n;i&gt;=1;i--) { ans+=que(res[i]); add(res[i],1); } printf(&quot;%lld\\n&quot;,ans); return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022 NOIP 模拟赛 46】Palindrome 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-46-palindrome-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":168000,"words":538,"minutes":3},"date":"2023-04-14 19:01:42","dateFormat":"2023-04-14"},{"abstract":"<blockquote>\n<p>你有一个随机生成器，每次会均匀随机地生成一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[0,m]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mclose\">]</span></span></span></span> 之间的整数。你用这个随机生成器生成了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span> 个整数，你想知道你生成的前 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个整数的和比后 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个整数的和大的概率是多少。你只需求出这个概率对质数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span></span></span></span> 取模后的结果即可。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 2\\times 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 你有一个随机生成器，每次会均匀随机地生成一个 [0,m][0,m][0,m] 之间的整数。你用这个随机生成器生成了 2n2n2n 个整数，你想知道你生成的前 nnn 个整数的和比后 nnn 个整数的和大的概率是多少。你只需求出这个概率对质数 PPP 取模后的结果即可。 1≤n,m≤2×1031\\le n,m\\le 2\\times 10^31≤n,m≤2×103。 考虑计算两部分和相同的方案数 resresres，答案即为 1−res(m+1)2n2\\frac{1-\\frac{res}{(m+1)^{2n}}}{2}21−(m+1)2nres​​。 转化问题，resresres 相当于前 nnn 个数在 [0,m][0,m][0,m] 中，后 nnn 个数在 [−m,0][-m,0][−m,0] 中，序列总和为 000 的方案数。 给后 nnn 个数整体加上 mmm，那么 resresres 相当于所有 2n2n2n 个数都在 [0,m][0,m][0,m] 中，序列总和为 nmnmnm 的方案数。 这是典题，枚举有多少个数爆表了容斥一下即可。 res=∑i=0n(−1)i(2ni)(2n+nm−i(m+1)−12n−1)res=\\sum\\limits_{i=0}^n (-1)^i\\binom{2n}{i}\\binom{2n+nm-i(m+1)-1}{2n-1} res=i=0∑n​(−1)i(i2n​)(2n−12n+nm−i(m+1)−1​) 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; inline void fio(string name) { freopen((name+&quot;.in&quot;).c_str(),&quot;r&quot;,stdin); freopen((name+&quot;.out&quot;).c_str(),&quot;w&quot;,stdout); } const int S=5000005; int p,T; int fra[S],inv[S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=(y&amp;1)?1ll*res*x%p:res; return res; } inline int C(int n,int m) { if(n&lt;0||m&lt;0||n&lt;m) return 0; return 1ll*fra[n]*inv[n-m]%p*inv[m]%p; } inline void slove() { int n,m; scanf(&quot;%d%d&quot;,&amp;n,&amp;m); int ans=0; for(int i=0,f=0;i&lt;=n;i++,f=1-f) { int pre=1ll*C(n*2,i)*C(n*2+n*m-i*(m+1)-1,n*2-1)%p; if(f==0) ans=(ans+pre)%p; else ans=(ans-pre+p)%p; } printf(&quot;%d\\n&quot;,1ll*(1+p-1ll*ans*qpow(qpow(m+1,n*2),p-2)%p)%p*qpow(2,p-2)%p); } int main() { fio(&quot;Y&quot;); scanf(&quot;%d%d&quot;,&amp;p,&amp;T); fra[0]=1; for(int i=1;i&lt;=S-3;i++) fra[i]=1ll*fra[i-1]*i%p; inv[S-3]=qpow(fra[S-3],p-2); for(int i=S-3;i&gt;=1;i--) inv[i-1]=1ll*inv[i]*i%p; while(T--) slove(); return 0; } ","tags":[{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 42】Y 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-42-y-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":181000,"words":572,"minutes":4},"date":"2023-04-14 18:53:09","dateFormat":"2023-04-14"},{"abstract":"<blockquote>\n<p>zzh 有一个矩形，这个矩形被划分成了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 个区域，每个区域中都写了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 或 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 。</p>\n<p>zzh 可以对这个矩形进行翻转操作，翻转操作定义如下：</p>\n<p>选择一条只经过区域边界，从矩形左上角到矩形右下角的<strong>最短路</strong>，然后将这条路径下方的所有区域中的数翻转（<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>）。</p>\n<p>请问最少需要多少次操作可以将这个矩阵中的所有数变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>，保证一定有解。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 5\\times 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" zzh 有一个矩形，这个矩形被划分成了 n×mn\\times mn×m 个区域，每个区域中都写了 000 或 111 。 zzh 可以对这个矩形进行翻转操作，翻转操作定义如下： 选择一条只经过区域边界，从矩形左上角到矩形右下角的最短路，然后将这条路径下方的所有区域中的数翻转（000 变为 111, 111 变为 000）。 请问最少需要多少次操作可以将这个矩阵中的所有数变为 000，保证一定有解。 1≤n,m≤5×1031\\le n,m\\le 5\\times 10^31≤n,m≤5×103。 首先可以证明一定有解，考虑贪心，每次选择顶着最上面的 111 的路径： 路径不包含所有 111 一定不会更优，而包含更多的 000 也不会更优，所以这样一定是最优的，并且 iii 次操作至少可以清空左上到右下的 iii 条斜对角线，所以答案是 O(n)O(n)O(n) 级别的。 考虑计算答案，一种显然的做法是直接模拟贪心，实现优秀则可以 O(nm)O(nm)O(nm) 解决本题，但还有更优美的做法。 考虑用从右上到左下的最短路去截取我们选择的路径，显然这样的最短路会和每一条我们选择的路径产生恰好一个交点：（重合部分不算） 由于我们选取的路径一定有至少一个位置满足路径内部的状态与外部不同，并且从右上到左下的最短路一定可以在这些位置与我们选取的路径相交，所以所有从右上到左下的最短路中这些位置的最多个数即为答案。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;set&gt; using namespace std; inline void fio(string name) { freopen((name+&quot;.in&quot;).c_str(),&quot;r&quot;,stdin); freopen((name+&quot;.out&quot;).c_str(),&quot;w&quot;,stdout); } const int S=2005; int n,m; char tmp[S]; int a[S][S]; int dp[S][S]; int main() { fio(&quot;flip&quot;); scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) { scanf(&quot;%s&quot;,tmp+1); for(int j=1;j&lt;=m;j++) a[i][j]=tmp[j]-'0'; } for(int i=1;i&lt;=n;i++) { for(int j=m;j&gt;=1;j--) { dp[i][j]=max(dp[i-1][j]+(a[i][j]!=a[i-1][j]),dp[i][j+1]+(a[i][j]!=a[i][j+1])); } } printf(&quot;%d\\n&quot;,dp[n][1]); return 0; } ","tags":[{"name":"杂题","slug":"IgZHugXcl","used":true,"link":"https://Rebxe.github.io/tag/IgZHugXcl/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022 NOIP 模拟赛 40】翻转 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-40-fan-zhuan-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":157000,"words":612,"minutes":3},"date":"2023-04-14 17:15:00","dateFormat":"2023-04-14"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">n,d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">d</span></span></span></span> 和一个长为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，每次操作可以将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2\\le i\\le n-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.79549em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 加上 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 或者减掉 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，求最少多少次操作可以使得对于所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1\\le i\\le n-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.79549em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 都有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∣</mi><msub><mi>a</mi><mi>i</mi></msub><mo>−</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">|a_i-a_{i+1}|\\le d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">d</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>300</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>≤</mo><mi>d</mi><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 300,0\\le d,a_i\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 n,dn,dn,d 和一个长为 nnn 的序列 aaa，每次操作可以将 2≤i≤n−12\\le i\\le n-12≤i≤n−1 的 aia_iai​ 加上 111 或者减掉 111，求最少多少次操作可以使得对于所有 1≤i≤n−11\\le i\\le n-11≤i≤n−1 都有 ∣ai−ai+1∣≤d|a_i-a_{i+1}|\\le d∣ai​−ai+1​∣≤d。 2≤n≤300,0≤d,ai≤1092\\le n\\le 300,0\\le d,a_i\\le 10^92≤n≤300,0≤d,ai​≤109。 首先显然有朴素的 O(nV2)O(nV^2)O(nV2) dp，设 dpi,jdp_{i,j}dpi,j​ 表示前 iii 个 aaa，修改后 ai=ja_i=jai​=j 的最少操作次数，单调队列即可优化到 O(nV)O(nV)O(nV)，但是这样过不了。 不难发现有用的状态很少，设 SSS 表示有用的 jjj 的集合，有一个结论就是 S={ai+jd ∣ 1≤i≤n,−n≤j≤n}S=\\{a_i+jd\\,|\\,1\\le i\\le n,-n\\le j\\le n\\}S={ai​+jd∣1≤i≤n,−n≤j≤n}。 证明如下： 设操作之后的序列为 bbb，考虑最小值 bib_ibi​，显然 bib_ibi​ 要么是 aia_iai​，要么是 bi−1−db_{i-1}-dbi−1​−d，要么是 bi+1−db_{i+1}-dbi+1​−d，仿照这样归纳证明 j∈[1,i−1]j\\in[1,i-1]j∈[1,i−1] 和 j∈[i+1,n]j\\in[i+1,n]j∈[i+1,n] 即可。 这样时间复杂度是 O(n3)O(n^3)O(n3) 的，足以通过此题。 #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; using namespace std; inline void fio(string name) { freopen((name+&quot;.in&quot;).c_str(),&quot;r&quot;,stdin); freopen((name+&quot;.out&quot;).c_str(),&quot;w&quot;,stdout); } const int S=305; int n; long long d,a[S]; int tot; long long b[S*S*2]; int h,t,que[S*S*2]; long long dp[S][S*S*2]; inline long long absll(long long x) { return x&lt;0?-x:x; } int main() { fio(&quot;climb&quot;); scanf(&quot;%d%lld&quot;,&amp;n,&amp;d); for(int i=1;i&lt;=n;i++) scanf(&quot;%lld&quot;,&amp;a[i]); for(int i=1;i&lt;=n;i++) for(int j=-n;j&lt;=n;j++) b[++tot]=a[i]+d*j; sort(b+1,b+tot+1); tot=unique(b+1,b+tot+1)-b-1; memset(dp,127,sizeof(dp)); long long inf=dp[0][0]; dp[1][lower_bound(b+1,b+tot+1,a[1])-b]=0; for(int i=2;i&lt;=n;i++) { h=1,t=0; int j=1; for(int k=1;k&lt;=tot;k++) { while(j&lt;=tot&amp;&amp;absll(b[j]-b[k])&lt;=d) { while(h&lt;=t&amp;&amp;dp[i-1][que[t]]&gt;=dp[i-1][j]) t--; que[++t]=j++; } while(h&lt;=t&amp;&amp;absll(b[que[h]]-b[k])&gt;d) h++; if(h&lt;=t&amp;&amp;dp[i-1][que[h]]!=inf) dp[i][k]=dp[i-1][que[h]]+absll(b[k]-a[i]); } } long long ans=dp[n][lower_bound(b+1,b+tot+1,a[n])-b]; printf(&quot;%lld\\n&quot;,ans==inf?-1:ans); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 39】六出祁山 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-39-liu-chu-qi-shan-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":214000,"words":647,"minutes":4},"date":"2023-04-14 17:12:00","dateFormat":"2023-04-14"},{"abstract":"<blockquote>\n<p>小 A 有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个数绕成一个环，他们分别是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>⋯</mo><mtext> </mtext><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_1,a_2,\\cdots,a_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>每一轮，小A可以选择某个数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>， 把它变成 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">-a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，并让两个相邻的数加上 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>小 A 想知道，她最少经过几轮操作可以让所有的数都是<strong>非负整数</strong>呢？</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi mathvariant=\"normal\">∣</mi><msub><mi>a</mi><mi>i</mi></msub><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le |a_i|\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 小 A 有 nnn 个数绕成一个环，他们分别是 a1,a2,⋯ ,ana_1,a_2,\\cdots,a_na1​,a2​,⋯,an​。 每一轮，小A可以选择某个数 aia_iai​， 把它变成 −ai-a_i−ai​，并让两个相邻的数加上 aia_iai​。 小 A 想知道，她最少经过几轮操作可以让所有的数都是非负整数呢？ 2≤n≤1052\\le n\\le 10^52≤n≤105，0≤∣ai∣≤1050\\le |a_i|\\le 10^50≤∣ai​∣≤105。 不考虑环的限制，考虑在序列上的情况。不难发现，这样一次操作的本质其实是交换了相邻两个位置的前缀和，所以设 sumisum_isumi​ 为 ∑j=1iaj\\sum\\limits_{j=1}^ia_jj=1∑i​aj​ 则一次操作为交换 sumi,sumi+1sum_i,sum_{i+1}sumi​,sumi+1​，目标即为让所有 sumi≥0sum_i\\ge0sumi​≥0 并且对于所有 1≤i≤n−11\\le i\\le n-11≤i≤n−1 有 sumi≤sumi+1sum_i\\le sum_{i+1}sumi​≤sumi+1​。 考虑这个性质拓展到环上，我们把原序列复制无数次，钦定某个位置的前缀和为 000，并求出整个序列的前缀和 sumisum_isumi​： 这样一次操作就相当于交换所有满足 xmod⁡n=ix\\operatorname{mod}n=ixmodn=i 的 sumxsum_xsumx​ 和 sumx+1sum_{x+1}sumx+1​： 考虑固定 n−1n-1n−1 这个位置，即以它为参照系，假定它不会移动，那么交换中间那些前缀和肯定没有影响，考虑操作 i=n−1i=n-1i=n−1 的情况： 这里平移了是因为我们认为 n−1n-1n−1 是不动的，那么操作就变成了把 sum0sum_0sum0​ 加上 sumn−1sum_{n-1}sumn−1​ 然后放到 n−1n-1n−1 的前面。 同理，操作 i=n−2i=n-2i=n−2 就相当于把 sumn−2sum_{n-2}sumn−2​ 减去 sumn−1sum_{n-1}sumn−1​，然后放到最前面： 那么有个显然的贪心策略：把所有 sumi&lt;0sum_i&lt;0sumi​&lt;0 和 sumi&gt;sumn−1sum_i&gt;sum_{n-1}sumi​&gt;sumn−1​ 的 sumisum_isumi​ 都通过不断减去 sumn−1sum_{n-1}sumn−1​ 使得 0≤sumi≤sumn−10\\le sum_i\\le sum_{n-1}0≤sumi​≤sumn−1​，最后再通过交换来排序。 直接做不好维护，不妨先把 sumi&lt;0sum_i&lt;0sumi​&lt;0 的换到最前面，sumi&gt;sumn−1sum_i&gt;sum_{n-1}sumi​&gt;sumn−1​ 的换到最后面，这样一定不会让答案变大。然后考虑贪心： 显然先处理 sumi&lt;0sum_i&lt;0sumi​&lt;0 的再处理 sumi&gt;sumn−1sum_i&gt;sum_{n-1}sumi​&gt;sumn−1​ 的是最优的； 绕圈的时候不“超车”是最优的； 那么用树状数组维护即可，可以结合代码理解： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; using namespace std; inline void fio(string name) { freopen((name+&quot;.in&quot;).c_str(),&quot;r&quot;,stdin); freopen((name+&quot;.out&quot;).c_str(),&quot;w&quot;,stdout); } const int S=1000005; int n,a[S]; long long s,ans,sum[S],b[S]; int c[S]; long long c2[S]; long long ned[S],nxt[S]; int id[S]; inline void add(int pos) { for(int i=pos;i&lt;=n;i+=i&amp;-i) c[i]++; } inline int que(int pos) { int res=0; for(int i=pos;i&gt;=1;i-=i&amp;-i) res+=c[i]; return res; } inline void add2(int pos,long long val) { for(int i=pos;i&lt;=n;i+=i&amp;-i) c2[i]+=val; } inline long long que2(int pos) { long long res=0; for(int i=pos;i&gt;=1;i-=i&amp;-i) res+=c2[i]; return res; } inline bool cmp1(int x,int y) { int tpex=sum[x]&lt;0?0:(sum[x]&lt;=s?1:2); int tpey=sum[y]&lt;0?0:(sum[y]&lt;=s?1:2); if(tpex!=tpey) return tpex&lt;tpey; return x&lt;y; } inline bool cmp2(int x,int y) { int tpex=sum[x]&lt;0?2:(sum[x]&lt;=s?1:0); int tpey=sum[y]&lt;0?2:(sum[y]&lt;=s?1:0); if(tpex!=tpey) return tpex&lt;tpey; if(ned[x]!=ned[y]) return tpex==2?ned[x]&lt;ned[y]:ned[x]&gt;ned[y]; else return x&lt;y; } inline void slove() { for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]),sum[i]=sum[i-1]+a[i]; s=sum[n],ans=0; if(s==0) { for(int i=1;i&lt;=n;i++) if(sum[i]!=0) return void(puts(&quot;-1&quot;)); return void(puts(&quot;0&quot;)); } if(s&lt;0) return void(puts(&quot;-1&quot;)); for(int i=1;i&lt;=n-1;i++) id[i]=i; sort(id+1,id+n,cmp1); for(int i=1;i&lt;=n-1;i++) nxt[i]=sum[id[i]]; for(int i=1;i&lt;=n-1;i++) sum[i]=nxt[i]; for(int i=1;i&lt;=n;i++) c[i]=0; for(int i=n-1;i&gt;=1;i--) { ans+=que(id[i]-1); add(id[i]); } for(int i=1;i&lt;=n-1;i++) { if(sum[i]&lt;0) ned[i]=(-sum[i]+s-1)/s; else if(sum[i]&lt;=s) ned[i]=0; else ned[i]=(sum[i]-1)/s; } int cntsm=0,cntbg=0; for(int i=1;i&lt;=n-1;i++) cntsm+=sum[i]&gt;=0,cntbg+=sum[i]&lt;=s; for(int i=1;i&lt;=n-1;i++) b[i]=ned[i]; sort(b+1,b+n); int m=unique(b+1,b+n)-b-1; for(int i=1;i&lt;=n;i++) c[i]=c2[i]=0; for(int i=1;i&lt;=n-1;i++) { if(sum[i]&lt;0) { int id=lower_bound(b+1,b+m,ned[i])-b; add(id),add2(id,ned[i]); int sm=upper_bound(b+1,b+m,ned[i]-1)-b-1; ans+=ned[i]*que(sm)-que2(sm)+(ned[i]-1)*cntsm+ned[i]+n-1-cntbg; } } for(int i=1;i&lt;=n;i++) c[i]=c2[i]=0; for(int i=n-1;i&gt;=1;i--) { if(sum[i]&lt;0) { int id=lower_bound(b+1,b+m,ned[i])-b; add(id),add2(id,ned[i]); int sm=upper_bound(b+1,b+m,ned[i]-1)-b-1; ans+=(ned[i]-1)*que(sm)-que2(sm); } } for(int i=1;i&lt;=n;i++) c[i]=c2[i]=0; for(int i=n-1;i&gt;=1;i--) { if(sum[i]&gt;s) { int id=lower_bound(b+1,b+m,ned[i])-b; add(id),add2(id,ned[i]); int sm=upper_bound(b+1,b+m,ned[i]-1)-b-1; ans+=ned[i]*que(sm)-que2(sm)+(ned[i]-1)*cntbg+ned[i]; } } for(int i=1;i&lt;=n;i++) c[i]=c2[i]=0; for(int i=1;i&lt;=n-1;i++) { if(sum[i]&gt;s) { int id=lower_bound(b+1,b+m,ned[i])-b; add(id),add2(id,ned[i]); int sm=upper_bound(b+1,b+m,ned[i]-1)-b-1; ans+=(ned[i]-1)*que(sm)-que2(sm); } } for(int i=1;i&lt;=n-1;i++) nxt[i]=sum[i]&lt;0?sum[i]+s*ned[i]:sum[i]-s*ned[i]; for(int i=1;i&lt;=n-1;i++) id[i]=i; sort(id+1,id+n,cmp2); for(int i=1;i&lt;=n-1;i++) b[i]=sum[i]=nxt[id[i]]; sort(b+1,b+n); for(int i=1;i&lt;=n;i++) c[i]=0; for(int i=n-1;i&gt;=1;i--) { int id=lower_bound(b+1,b+n,sum[i])-b; ans+=que(id-1); add(id); } printf(&quot;%lld\\n&quot;,ans); } int main() { fio(&quot;elasticity&quot;); while(1) { scanf(&quot;%d&quot;,&amp;n); if(n==0) break; slove(); } return 0; } ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022 NOIP 模拟赛 38】数环 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-38-shu-huan-zuo-ti-ji-lu/","stats":{"text":"9 min read","time":500000,"words":1529,"minutes":9},"date":"2023-04-14 17:08:59","dateFormat":"2023-04-14"},{"abstract":"<blockquote>\n<p>小 C 将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>×</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">r\\times c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span> 堆石子摆成一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><mo>×</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">r\\times c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span> 的矩形 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，每一轮玩家可以从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span></span></span></span> 行中选择任意几行（至少一行），然后从选择的行中各选择非空的一堆石子，拿走其中的一个石子，形式化的说，你可以选择若干正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>i</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>i</mi><mn>2</mn></msub><mo>&lt;</mo><mo>⋯</mo><mo>&lt;</mo><msub><mi>i</mi><mi>k</mi></msub><mo>≤</mo><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">1\\leq i_1&lt;i_2&lt;\\dots&lt;i_k\\leq r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.80952em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.80952em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"minner\">⋯</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.80952em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span></span></span></span>，然后选择 正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>j</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>j</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>j</mi><mi>k</mi></msub><mo>≤</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">1\\leq j_1,j_2,\\dots,j_k\\leq c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05724em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05724em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05724em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">c</span></span></span></span>，然后将所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><msub><mi>i</mi><mi>l</mi></msub><mo separator=\"true\">,</mo><msub><mi>j</mi><mi>l</mi></msub></mrow></msub><mtext>  </mtext><mo>(</mo><mn>1</mn><mo>≤</mo><mi>l</mi><mo>≤</mo><mi>k</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">a_{i_l,j_l}\\ \\ (1\\leq l\\leq k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15122857142857138em;\"><span></span></span></span></span></span></span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3487714285714287em;margin-left:-0.05724em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15122857142857138em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span> 减一，且保证操作完后非负 。不能操作的人输。你先手操作。</p>\n<p>现在有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 堆石子摆成了一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的矩形，第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 行第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 列有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{i,j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 个石子，小 C 会在这个矩形中随机选择一个子矩形进行游戏。</p>\n<p>你想要知道你获胜的概率乘以 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mfrac><mrow><mi>n</mi><mi>m</mi><mo>(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>(</mo><mi>m</mi><mo>+</mo><mn>1</mn><mo>)</mo></mrow><mn>4</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{nm(n+1)(m+1)}{4}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mord mathdefault mtight\">m</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">m</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> 的值，可以证明这一定是个整数。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>3000</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 3000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><msub><mi>a</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">0\\le a_{i,j}\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.922078em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 小 C 将 r×cr\\times cr×c 堆石子摆成一个 r×cr\\times cr×c 的矩形 aaa，每一轮玩家可以从 rrr 行中选择任意几行（至少一行），然后从选择的行中各选择非空的一堆石子，拿走其中的一个石子，形式化的说，你可以选择若干正整数 1≤i1&lt;i2&lt;⋯&lt;ik≤r1\\leq i_1&lt;i_2&lt;\\dots&lt;i_k\\leq r1≤i1​&lt;i2​&lt;⋯&lt;ik​≤r，然后选择 正整数 1≤j1,j2,…,jk≤c1\\leq j_1,j_2,\\dots,j_k\\leq c1≤j1​,j2​,…,jk​≤c，然后将所有 ail,jl (1≤l≤k)a_{i_l,j_l}\\ \\ (1\\leq l\\leq k)ail​,jl​​ (1≤l≤k) 减一，且保证操作完后非负 。不能操作的人输。你先手操作。 现在有 n×mn\\times mn×m 堆石子摆成了一个 n×mn\\times mn×m 的矩形，第 iii 行第 jjj 列有 ai,ja_{i,j}ai,j​ 个石子，小 C 会在这个矩形中随机选择一个子矩形进行游戏。 你想要知道你获胜的概率乘以 nm(n+1)(m+1)4\\frac{nm(n+1)(m+1)}{4}4nm(n+1)(m+1)​ 的值，可以证明这一定是个整数。 1≤n,m≤30001\\le n,m\\le 30001≤n,m≤3000，0≤ai,j≤1090\\le a_{i,j}\\le 10^90≤ai,j​≤109。 首先不难发现答案就是先手必胜子矩形个数，并且不难证明一个子矩形是先手必胜当且仅当这个子矩形有至少一行的和为奇数。 考虑容斥，问题转化为求有多少个子矩形所有行的和都是偶数。 设 sumi,j=∑k=1jaimod⁡2sum_{i,j}=\\sum\\limits_{k=1}^ja_i\\operatorname{mod}2sumi,j​=k=1∑j​ai​mod2，那么若固定了子矩形的上边界 lblblb 和下边界 rbrbrb，那么子矩形 (lb,x,rb,y)(lb,x,rb,y)(lb,x,rb,y) 合法当且仅当 sumlb,x−1=sumlb,y,sumlb+1,x−1=sumlb,y,…,sumrb,x−1=sumrb,ysum_{lb,x-1}=sum_{lb,y},sum_{lb+1,x-1}=sum_{lb,y},\\dots,sum_{rb,x-1}=sum_{rb,y}sumlb,x−1​=sumlb,y​,sumlb+1,x−1​=sumlb,y​,…,sumrb,x−1​=sumrb,y​。 那么维护若干个等价类，每个等价类的贡献即为 siz(siz−1)2\\frac{siz(siz-1)}{2}2siz(siz−1)​。 考虑如何快速维护等价类，显然下边界往上推一位相当于去掉最后一位的影响，也就是在 trie 上合并两棵子树，那么维护一下即可。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout); const int MS=3005; int n,m,a[MS][MS]; int cnt=1,siz[MS*MS],son[MS*MS][2]; long long pre,ans; void dfs(int u) { if(son[u][0]!=0) dfs(son[u][0]); if(son[u][1]!=0) dfs(son[u][1]); siz[u]+=siz[son[u][0]]+siz[son[u][1]]; pre+=1ll*siz[u]*(siz[u]-1)/2; } int meg(int x,int y) { if(x==0||y==0) return x+y; son[x][0]=meg(son[x][0],son[y][0]); son[x][1]=meg(son[x][1],son[y][1]); pre+=1ll*siz[x]*siz[y]; siz[x]+=siz[y]; return x; } int main() { fio(&quot;matrix&quot;); int T; scanf(&quot;%d&quot;,&amp;T); scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) { for(int j=1;j&lt;=m;j++) { scanf(&quot;%d&quot;,&amp;a[i][j]); a[i][j]&amp;=1,a[i][j]^=a[i][j-1]; } } for(int i=0;i&lt;=m;i++) { int u=1; for(int j=n;j&gt;=1;j--) { if(son[u][a[j][i]]==0) son[u][a[j][i]]=++cnt; u=son[u][a[j][i]]; } siz[u]++; } dfs(1); int rt=1; for(int i=n;i&gt;=1;i--) { pre-=1ll*m*(m+1)/2; ans+=pre; rt=meg(son[rt][0],son[rt][1]); } printf(&quot;%lld\\n&quot;,1ll*n*(n+1)/2*m*(m+1)/2-ans); return 0; } ","tags":[{"name":"博弈论","slug":"6A-_b3w3J","used":true,"link":"https://Rebxe.github.io/tag/6A-_b3w3J/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2022 NOIP 模拟赛 34】矩阵博弈 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-34-ju-zhen-bo-yi-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":269000,"words":887,"minutes":5},"date":"2023-04-08 09:07:48","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>求满足以下条件的长为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 的个数：</p>\n<ul>\n<li>对于所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1\\le i\\le n-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.79549em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mi mathvariant=\"normal\">mod</mi><mo>⁡</mo><msub><mi>p</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>≤</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">p_i\\operatorname{mod} p_{i+1}\\le2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.902771em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span>；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>p</mi><mi>n</mi></msub><mi mathvariant=\"normal\">mod</mi><mo>⁡</mo><msub><mi>p</mi><mn>1</mn></msub><mo>≤</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">p_n\\operatorname{mod}p_1\\le 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span>；</li>\n</ul>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 求满足以下条件的长为 nnn 的排列 ppp 的个数： 对于所有 1≤i≤n−11\\le i\\le n-11≤i≤n−1 有 pimod⁡pi+1≤2p_i\\operatorname{mod} p_{i+1}\\le2pi​modpi+1​≤2； pnmod⁡p1≤2p_n\\operatorname{mod}p_1\\le 2pn​modp1​≤2； 1≤n≤1061\\le n\\le 10^61≤n≤106。 首先去掉 111 和 222 之后，完美的排列显然可以分成两段下降的序列 AAA 和 BBB，它们之间需要用 111 和 222 拼起来。 观察到显然 {x,x−1,x−2,…,3,2,1}\\{x,x-1,x-2,\\dots,3,2,1\\}{x,x−1,x−2,…,3,2,1} 这样的一段连续序列一定是合法的，那么去掉 111 和 222 之后的序列 {n,n−1,n−2,…,5,4,3}\\{n,n-1,n-2,\\dots,5,4,3\\}{n,n−1,n−2,…,5,4,3} 一定可以分成若干段，第 1,3,5,7,9,…1,3,5,7,9,\\dots1,3,5,7,9,… 段分给 AAA 并且互相连接，第 2,4,6,8,10,…2,4,6,8,10,\\dots2,4,6,8,10,… 段分给 BBB 并且互相连接。 考虑动态规划，设 dpidp_idpi​ 表示 [i+1,n][i+1,n][i+1,n] 划分好了，最后一段以 iii 开头的方案数，那么考虑以 iii 开头的那一段前面是哪一段，有转移： dpi=1+∑i∣jdpj−1+dpj+dpj+1dp_{i}=1+\\sum\\limits_{i|j}dp_{j-1}+dp_j+dp_{j+1} dpi​=1+i∣j∑​dpj−1​+dpj​+dpj+1​ 其中 +1+1+1 是因为 [i+1,n][i+1,n][i+1,n] 划分为一整段一定是合法的。 最后的答案即为 2n×∑i=1n−1dpi2n\\times\\sum\\limits_{i=1}^{n-1}dp_i2n×i=1∑n−1​dpi​，因为 [1,i][1,i][1,i] 这一段需要另外算，并且 AAA 和 BBB 可以任意交换顺序且环可以转。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout) const int S=1000005,p=1000000007; int n,dp[S]; inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } int main() { fio(&quot;permutation&quot;); scanf(&quot;%d&quot;,&amp;n); if(n&lt;=2) return printf(&quot;%d\\n&quot;,n),0; int ans=1; for(int i=n-1;i&gt;=3;i--) { int tmp=1; for(int j=i;j&lt;=n;j+=i) add(tmp,((long long)dp[j-1]+dp[j]+dp[j+1])%p); dp[i]=tmp; add(ans,dp[i]); } printf(&quot;%d\\n&quot;,1ll*ans*2%p*n%p); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 29】排列 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-29-pai-lie-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":177000,"words":574,"minutes":3},"date":"2023-04-08 09:03:26","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>奆 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>ζ</mi></mrow><annotation encoding=\"application/x-tex\">\\zeta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07378em;\">ζ</span></span></span></span> 有一颗 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点有标号的树，点从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\sim n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 标号，边从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim n-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 标号为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>u</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>v</mi><mi>i</mi></msub><mo>(</mo><mi>i</mi><mo>&lt;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">u_i,v_i(i\\lt n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">)</span></span></span></span>。</p>\n<p>现在他想在这棵树的基础上构造一些新的树</p>\n<p>具体的，他想知道在能构造出的所有 <strong><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点有标号无根树</strong>中，恰好的有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 条边与原树相同的数量</p>\n<p>并且对于每个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo>]</mo><mo>∩</mo><mi mathvariant=\"double-struck\">Z</mi></mrow><annotation encoding=\"application/x-tex\">x\\in[0,n-1]\\cap \\mathbb{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span></span></span></span>，输出答案 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">mod</mi><mo>⁡</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">\\operatorname{mod} 10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 的结果。</p>\n</blockquote>\n","content":" 奆 ζ\\zetaζ 有一颗 nnn 个点有标号的树，点从 1∼n1\\sim n1∼n 标号，边从 1∼n−11\\sim n-11∼n−1 标号为 ui,vi(i&lt;n)u_i,v_i(i\\lt n)ui​,vi​(i&lt;n)。 现在他想在这棵树的基础上构造一些新的树 具体的，他想知道在能构造出的所有 nnn 个点有标号无根树中，恰好的有 xxx 条边与原树相同的数量 并且对于每个 x∈[0,n−1]∩Zx\\in[0,n-1]\\cap \\mathbb{Z}x∈[0,n−1]∩Z，输出答案 mod⁡109+7\\operatorname{mod} 10^9+7mod109+7 的结果。 原题：CF917D Stranger Trees 首先若求出 f(i)f(i)f(i) 表示钦定 iii 条边固定的方案数，设 ans(i)ans(i)ans(i) 为恰好 iii 条边相同的方案数，显然有： ans(i)=∑j=in−1(−1)j−i(ji)f(j)ans(i)=\\sum\\limits_{j=i}^{n-1}(-1)^{j-i}\\binom{j}{i}f(j) ans(i)=j=i∑n−1​(−1)j−i(ij​)f(j) 考虑求出 f(i)f(i)f(i)，钦定了 iii 条边固定就相当于有 n−in-in−i 个连通块，有个结论： 有 mmm 个点，每个点有 aia_iai​ 种连边方式的树有 (∑ai)m−2∏ai(\\sum a_i)^{m-2}\\prod a_i(∑ai​)m−2∏ai​。 证明： 考虑生成出来的树的长度为 m−2m-2m−2 的 prufer 序列，显然每个位置可以任选。iii 的度即为它在 prufer 序列中出现的次数 +1+1+1，所以每个点的贡献是 ai出现次数+1a_i^{\\text{出现次数}+1}ai出现次数+1​，把 +1+1+1 拉出来，变成 (∏ai出现次数)(∏ai)(\\prod a_i^{\\text{出现次数}})(\\prod a_i)(∏ai出现次数​)(∏ai​)。 所有情况下的 ∏ai出现次数\\prod a_i^{\\text{出现次数}}∏ai出现次数​ 之和显然和 (∑ai)m−2(\\sum a_i)^{m-2}(∑ai​)m−2 是等价的，得证。 那么考虑设 dpu,i,jdp_{u,i,j}dpu,i,j​ 表示 uuu 的子树，选了 iii 条边，包含 uuu 的连通块大小为 jjj 的 ∑∏siz\\sum\\prod siz∑∏siz（jjj 没有乘进去）。 dpu,i,j=∑k=0i∑l=1jdpu,i−k−1,j−l×dpv,k,l+∑k=0i−1∑ldpu,i−k,j×l×dpv,k,ldp_{u,i,j}=\\sum\\limits_{k=0}^i\\sum\\limits_{l=1}^j dp_{u,i-k-1,j-l}\\times dp_{v,k,l}+\\sum\\limits_{k=0}^{i-1}\\sum\\limits_l dp_{u,i-k,j}\\times l\\times dp_{v,k,l} dpu,i,j​=k=0∑i​l=1∑j​dpu,i−k−1,j−l​×dpv,k,l​+k=0∑i−1​l∑​dpu,i−k,j​×l×dpv,k,l​ 考虑优化，压掉一维，设 fu,i=∑jdpu,i,j,gu,i=∑jj×dpu,i,jf_{u,i}=\\sum\\limits_{j}dp_{u,i,j},g_{u,i}=\\sum\\limits_{j}j\\times dp_{u,i,j}fu,i​=j∑​dpu,i,j​,gu,i​=j∑​j×dpu,i,j​，考虑转移，有： fu,i=∑jdpu,i,j=∑j∑k=0i−1∑l=1jdpu,i−k−1,j−l×dpv,k,l+∑j∑k=0i∑ldpu,i−k,j×l×dpv,k,l=∑k=0i−1fu,i−k−1×fv,k+∑k=0ifu,i−k×gv,k\\begin{aligned} f_{u,i}&amp;=\\sum\\limits_{j}dp_{u,i,j}\\\\ &amp;=\\sum\\limits_{j}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=1}^j dp_{u,i-k-1,j-l}\\times dp_{v,k,l}+\\sum\\limits_{j}\\sum\\limits_{k=0}^i\\sum\\limits_l dp_{u,i-k,j}\\times l\\times dp_{v,k,l}\\\\ &amp;=\\sum\\limits_{k=0}^{i-1} f_{u,i-k-1}\\times f_{v,k}+\\sum\\limits_{k=0}^{i}f_{u,i-k}\\times g_{v,k} \\end{aligned} fu,i​​=j∑​dpu,i,j​=j∑​k=0∑i−1​l=1∑j​dpu,i−k−1,j−l​×dpv,k,l​+j∑​k=0∑i​l∑​dpu,i−k,j​×l×dpv,k,l​=k=0∑i−1​fu,i−k−1​×fv,k​+k=0∑i​fu,i−k​×gv,k​​ gu,i=∑jj×dpu,i,j=∑jj∑k=0i−1∑l=1jdpu,i−k−1,j−l×dpv,k,l+∑jj∑k=0i∑ldpu,i−k,j×l×dpv,k,l=∑j∑k=0i−1∑l=1j(j−l+l)×dpu,i−k−1,j−l×dpv,k,l+∑k=0igu,i−k×gv,k=∑j∑k=0i−1∑l=1j(j−l)×dpu,i−k−1,j−l×dpv,k,l+∑j∑k=0i−1∑l=1jl×dpu,i−k−1,j−l×dpv,k,l+∑k=0igu,i−k−1×gv,k=∑k=0i−1gu,i−k−1×fv,k+∑k=0i−1fu,i−k−1×gv,k+∑k=0igu,i−k×gv,k=∑k=0i−1gu,i−k−1×fv,k+fu,i−k−1×gv,k+∑k=0igu,i−k×gv,k\\begin{aligned} g_{u,i}&amp;=\\sum\\limits_{j}j\\times dp_{u,i,j}\\\\ &amp;=\\sum\\limits_{j}j\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=1}^j dp_{u,i-k-1,j-l}\\times dp_{v,k,l}+\\sum\\limits_{j}j\\sum\\limits_{k=0}^{i}\\sum\\limits_l dp_{u,i-k,j}\\times l\\times dp_{v,k,l}\\\\ &amp;=\\sum\\limits_{j}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=1}^j (j-l+l)\\times dp_{u,i-k-1,j-l}\\times dp_{v,k,l}+\\sum\\limits_{k=0}^{i}g_{u,i-k}\\times g_{v,k}\\\\ &amp;=\\sum\\limits_{j}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=1}^j (j-l)\\times dp_{u,i-k-1,j-l}\\times dp_{v,k,l}+\\sum\\limits_{j}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=1}^j l\\times dp_{u,i-k-1,j-l}\\times dp_{v,k,l}+\\sum\\limits_{k=0}^{i}g_{u,i-k-1}\\times g_{v,k}\\\\ &amp;=\\sum\\limits_{k=0}^{i-1}g_{u,i-k-1}\\times f_{v,k}+\\sum\\limits_{k=0}^{i-1}f_{u,i-k-1}\\times g_{v,k}+\\sum\\limits_{k=0}^{i}g_{u,i-k}\\times g_{v,k}\\\\ &amp;=\\sum\\limits_{k=0}^{i-1}g_{u,i-k-1}\\times f_{v,k}+f_{u,i-k-1}\\times g_{v,k}+\\sum\\limits_{k=0}^{i}g_{u,i-k}\\times g_{v,k} \\end{aligned} gu,i​​=j∑​j×dpu,i,j​=j∑​jk=0∑i−1​l=1∑j​dpu,i−k−1,j−l​×dpv,k,l​+j∑​jk=0∑i​l∑​dpu,i−k,j​×l×dpv,k,l​=j∑​k=0∑i−1​l=1∑j​(j−l+l)×dpu,i−k−1,j−l​×dpv,k,l​+k=0∑i​gu,i−k​×gv,k​=j∑​k=0∑i−1​l=1∑j​(j−l)×dpu,i−k−1,j−l​×dpv,k,l​+j∑​k=0∑i−1​l=1∑j​l×dpu,i−k−1,j−l​×dpv,k,l​+k=0∑i​gu,i−k−1​×gv,k​=k=0∑i−1​gu,i−k−1​×fv,k​+k=0∑i−1​fu,i−k−1​×gv,k​+k=0∑i​gu,i−k​×gv,k​=k=0∑i−1​gu,i−k−1​×fv,k​+fu,i−k−1​×gv,k​+k=0∑i​gu,i−k​×gv,k​​ 代码如下： // Problem: #148. 构树 // Contest: Hydro // URL: http://oiclass.com/d/tigao/p/148 // Memory Limit: 256 MB // Time Limit: 4000 ms // // Powered by CP Editor (https://cpeditor.org) #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout); const int MS=8005,S=100005,p=1000000007; int n; int esum,to[S],nxt[S],h[MS]; int siz[MS]; vector&lt;int&gt; f[MS],g[MS]; int tmpf[MS],tmpg[MS]; int ml[MS],fra[MS],inv[MS]; int ans[MS]; inline void add(int x,int y) { to[++esum]=y; nxt[esum]=h[x]; h[x]=esum; } inline void addd(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=(y&amp;1)?1ll*res*x%p:res; return res; } inline int C(int n,int m) { return 1ll*fra[n]*inv[n-m]%p*inv[m]%p; } void dfs(int u,int fa) { siz[u]=1; f[u].push_back(1),g[u].push_back(1); for(int i=h[u];i;i=nxt[i]) { int v=to[i]; if(v==fa) continue; dfs(v,u); for(int j=0;j&lt;=n;j++) tmpf[j]=tmpg[j]=0; for(int j=0;j&lt;=siz[u]-1;j++) { for(int k=0;k&lt;=siz[v]-1;k++) { addd(tmpf[j+k+1],1ll*f[u][j]*f[v][k]%p); addd(tmpf[j+k],1ll*f[u][j]*g[v][k]%p); addd(tmpg[j+k+1],(1ll*g[u][j]*f[v][k]+1ll*f[u][j]*g[v][k])%p); addd(tmpg[j+k],1ll*g[u][j]*g[v][k]%p); } } siz[u]+=siz[v]; for(int j=0;j&lt;=siz[u]-1;j++) { if(j&lt;f[u].size()) f[u][j]=tmpf[j],g[u][j]=tmpg[j]; else f[u].push_back(tmpf[j]),g[u].push_back(tmpg[j]); } } } int main() { fio(&quot;tree&quot;); scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n-1;i++) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); add(x,y),add(y,x); } dfs(1,0); ml[0]=1; for(int i=1;i&lt;=n;i++) ml[i]=1ll*ml[i-1]*n%p; fra[0]=1; for(int i=1;i&lt;=n;i++) fra[i]=1ll*fra[i-1]*i%p; inv[n]=qpow(fra[n],p-2); for(int i=n;i&gt;=1;i--) inv[i-1]=1ll*inv[i]*i%p; for(int i=0;i&lt;=n-1;i++) ans[i]=i!=n-1?1ll*ml[n-i-2]*g[1][i]%p:1; for(int i=0;i&lt;=n-1;i++) { int pre=0; for(int j=i;j&lt;=n-1;j++) { if(j-i&amp;1^1) addd(pre,1ll*C(j,i)*ans[j]%p); else addd(pre,p-1ll*C(j,i)*ans[j]%p); } printf(&quot;%d &quot;,pre); } printf(&quot;\\n&quot;); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 28】构树 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-28-gou-shu-zuo-ti-ji-lu/","stats":{"text":"12 min read","time":683000,"words":1973,"minutes":12},"date":"2023-04-08 08:59:29","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>小可可又在造数据，只不过这次是一个联通图。</p>\n<p>小可可要造一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个点的联通图，由于她非常懒，于是决定每次在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1, n]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mclose\">]</span></span></span></span> 中独立地等概率随机两个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u, v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span></span></span></span>（可以相同），然后将 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u, v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 之间连一条边。</p>\n<p>小可可发现要等到整张图联通需要不少时间，于是问你期望连多少次边后整张图联通，答案对一个质数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 取模。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>100</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" 小可可又在造数据，只不过这次是一个联通图。 小可可要造一个 nnn 个点的联通图，由于她非常懒，于是决定每次在 [1,n][1, n][1,n] 中独立地等概率随机两个点 u,vu, vu,v（可以相同），然后将 u,vu, vu,v 之间连一条边。 小可可发现要等到整张图联通需要不少时间，于是问你期望连多少次边后整张图联通，答案对一个质数 ppp 取模。 1≤n≤1001\\le n\\le 1001≤n≤100。 设 dpn,kdp_{n, k}dpn,k​ 表示 nnn 个点的图，经过 kkk 次之后仍然不联通的概率。 枚举与 111 联通的点个数，有： dpn,k=∑i=1n−1∑j=0k(n−1i−1)(kj)(1−dpi,j)(i2n2)j((n−i)2n2)k−j=∑i=1n−1∑j=0k(n−1i−1)(kj)(i2n2)j((n−i)2n2)k−j−(n−1i−1)(kj)dpi,j(i2n2)j((n−i)2n2)k−j=∑i=1n−1(n−1i−1)(i2+(n−i)2n2)k−∑i=1n−1∑j=0k(n−1i−1)(kj)dpi,j(i2n2)j((n−i)2n2)k−j\\begin{aligned} dp_{n, k} =&amp;\\sum\\limits_{i = 1}^{n - 1} \\sum\\limits_{j = 0}^k \\binom{n - 1}{i - 1} \\binom{k}{j} (1 - dp_{i, j}) \\left( \\frac{i^2}{n^2} \\right) ^j \\left( \\frac{(n - i)^2}{n^2} \\right) ^{k - j}\\\\ &amp;= \\sum\\limits_{i = 1}^{n - 1} \\sum\\limits_{j = 0}^k \\binom{n - 1}{i - 1} \\binom{k}{j} \\left( \\frac{i^2}{n^2} \\right) ^j \\left( \\frac{(n - i)^2}{n^2} \\right) ^{k - j} - \\binom{n - 1}{i - 1} \\binom{k}{j} dp_{i, j} \\left( \\frac{i^2}{n^2} \\right) ^j \\left( \\frac{(n - i)^2}{n^2} \\right) ^{k - j}\\\\ &amp;= \\sum\\limits_{i = 1}^{n - 1} \\binom{n - 1}{i - 1} \\left( \\frac{i^2 + (n - i)^2}{n^2} \\right) ^k - \\sum\\limits_{i = 1}^{n - 1} \\sum\\limits_{j = 0}^k \\binom{n - 1}{i - 1} \\binom{k}{j} dp_{i, j} \\left( \\frac{i^2}{n^2} \\right) ^j \\left( \\frac{(n - i)^2}{n^2} \\right) ^{k - j} \\end{aligned} dpn,k​=​i=1∑n−1​j=0∑k​(i−1n−1​)(jk​)(1−dpi,j​)(n2i2​)j(n2(n−i)2​)k−j=i=1∑n−1​j=0∑k​(i−1n−1​)(jk​)(n2i2​)j(n2(n−i)2​)k−j−(i−1n−1​)(jk​)dpi,j​(n2i2​)j(n2(n−i)2​)k−j=i=1∑n−1​(i−1n−1​)(n2i2+(n−i)2​)k−i=1∑n−1​j=0∑k​(i−1n−1​)(jk​)dpi,j​(n2i2​)j(n2(n−i)2​)k−j​ 归纳证明 dpn,k=∑l=0n2−1fn,l(ln2)kdp_{n, k} = \\sum\\limits_{l = 0}^{n^2 - 1} f_{n, l} \\left( \\frac{l}{n^2} \\right) ^kdpn,k​=l=0∑n2−1​fn,l​(n2l​)k，其中 fn,lf_{n, l}fn,l​ 是递推得出的系数。 等式前面一部分形式已经符合此形式，考虑后面一部分： =∑i=1n−1∑j=0k(n−1i−1)(kj)dpi,j(i2n2)j((n−i)2n2)k−j=∑i=1n−1(n−1i−1)∑l=0i2−1fi,l∑j=0k(kj)(li2)j(i2n2)j((n−i)2n2)k−j=∑i=1n−1(n−1i−1)∑l=0i2−1fi,l(l+(n−i)2n2)k\\begin{aligned} &amp;= \\sum\\limits_{i = 1}^{n - 1} \\sum\\limits_{j = 0}^k \\binom{n - 1}{i - 1} \\binom{k}{j} dp_{i, j} \\left( \\frac{i^2}{n^2} \\right) ^j \\left( \\frac{(n - i)^2}{n^2} \\right) ^{k - j}\\\\ &amp;= \\sum\\limits_{i = 1}^{n - 1} \\binom{n - 1}{i - 1} \\sum\\limits_{l = 0}^{i^2 - 1} f_{i, l} \\sum\\limits_{j = 0}^k \\binom{k}{j} \\left( \\frac{l}{i^2} \\right) ^j \\left( \\frac{i^2}{n^2} \\right) ^j \\left( \\frac{(n - i)^2}{n^2} \\right) ^{k - j}\\\\ &amp;= \\sum\\limits_{i = 1}^{n - 1} \\binom{n - 1}{i - 1} \\sum\\limits_{l = 0}^{i^2 - 1} f_{i, l} \\left( \\frac{l + (n - i)^2}{n^2} \\right) ^k \\end{aligned} ​=i=1∑n−1​j=0∑k​(i−1n−1​)(jk​)dpi,j​(n2i2​)j(n2(n−i)2​)k−j=i=1∑n−1​(i−1n−1​)l=0∑i2−1​fi,l​j=0∑k​(jk​)(i2l​)j(n2i2​)j(n2(n−i)2​)k−j=i=1∑n−1​(i−1n−1​)l=0∑i2−1​fi,l​(n2l+(n−i)2​)k​ 于是 ∑l=0n2−1fn,l(ln2)k=∑i=1n−1(n−1i−1)(i2+(n−i)2n2)k−∑i=1n−1∑l=0i2−1fi,l(n−1i−1)(l+(n−i)2n2)k\\sum\\limits_{l = 0}^{n^2 - 1} f_{n, l} \\left( \\frac{l}{n^2} \\right) ^k=\\sum\\limits_{i = 1}^{n - 1} \\binom{n - 1}{i - 1} \\left( \\frac{i^2 + (n - i)^2}{n^2} \\right) ^k-\\sum\\limits_{i = 1}^{n - 1} \\sum\\limits_{l = 0}^{i^2 - 1} f_{i, l} \\binom{n - 1}{i - 1}\\left( \\frac{l + (n - i)^2}{n^2} \\right) ^k l=0∑n2−1​fn,l​(n2l​)k=i=1∑n−1​(i−1n−1​)(n2i2+(n−i)2​)k−i=1∑n−1​l=0∑i2−1​fi,l​(i−1n−1​)(n2l+(n−i)2​)k 那么可以 O(n4)O(n^4)O(n4) 求出 f(n,l)f(n,l)f(n,l)。 答案即为 ∑i=0n2−1∑k=0+∞fn,i(in2)k=∑i=0n2−1fn,in2n2−i\\sum\\limits_{i = 0}^{n^2 - 1} \\sum\\limits_{k = 0}^{+\\infty} f_{n, i} \\left( \\frac{i}{n^2} \\right) ^k = \\sum\\limits_{i = 0}^{n^2 - 1} f_{n, i} \\frac{n^2}{n^2 - i}i=0∑n2−1​k=0∑+∞​fn,i​(n2i​)k=i=0∑n2−1​fn,i​n2−in2​。 ","tags":[{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 25】取啊 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-25-qu-a-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":377000,"words":1097,"minutes":7},"date":"2023-04-08 08:51:10","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 和两个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的正整数数列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a,b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，以如下方式生成一棵树：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 的父亲 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><msub><mi>a</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">fa_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 在 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>u</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1,u-1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">u</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> 中取，取到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 的概率是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mfrac><msub><mi>a</mi><mi>i</mi></msub><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>u</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>a</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{a_i}{\\sum\\limits_{j=1}^{u-1}a_j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.427099em;vertical-align:-1.715607em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7114919999999999em;\"><span style=\"top:-2.19em;\"><span class=\"pstrut\" style=\"height:3.0873235em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop op-limits mtight\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.553319285714286em;\"><span style=\"top:-1.8629092857142857em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:2.75em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-2.7500050000000003em;\"><span class=\"pstrut\" style=\"height:2.75em;\"></span><span><span class=\"mop op-symbol small-op mtight\">∑</span></span></span><span style=\"top:-3.7000050000000004em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:2.75em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">u</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1689764285714286em;\"><span></span></span></span></span></span><span class=\"mspace mtight\" style=\"margin-right:0.19516666666666668em;\"></span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2818857142857143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.3173235em;\"><span class=\"pstrut\" style=\"height:3.0873235em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4974235em;\"><span class=\"pstrut\" style=\"height:3.0873235em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.715607em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><msub><mi>a</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">fa_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 之间有一条长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>u</mi></msub><mo>+</mo><msub><mi>b</mi><mrow><mi>f</mi><msub><mi>a</mi><mi>u</mi></msub></mrow></msub></mrow><annotation encoding=\"application/x-tex\">b_u+b_{fa_u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.16454285714285719em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 的边。</li>\n</ul>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 组询问，每次给出两个点 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 之间的期望距离对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 取模的结果。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>q</mi><mo>≤</mo><mn>3</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n,q\\le 3\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>≤</mo><mn>3</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le a_i,b_i\\le 3\\times 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定 nnn 和两个长度为 nnn 的正整数数列 a,ba,ba,b，以如下方式生成一棵树： uuu 的父亲 faufa_ufau​ 在 [1,u−1][1,u-1][1,u−1] 中取，取到 iii 的概率是 ai∑j=1u−1aj\\frac{a_i}{\\sum\\limits_{j=1}^{u-1}a_j}j=1∑u−1​aj​ai​​； uuu 和 faufa_ufau​ 之间有一条长度为 bu+bfaub_u+b_{fa_u}bu​+bfau​​ 的边。 qqq 组询问，每次给出两个点 x,yx,yx,y，求 x,yx,yx,y 之间的期望距离对 109+710^9+7109+7 取模的结果。 2≤n,q≤3×1052\\le n,q\\le 3\\times 10^52≤n,q≤3×105，1≤ai,bi≤3×1031\\le a_i,b_i\\le 3\\times 10^31≤ai​,bi​≤3×103。 首先由于期望是线性的，所以设 lenilen_ileni​ 为 iii 到 111 的期望距离，那么 x,yx,yx,y 之间的期望距离即为 lenx+leny−2lenlca⁡(x,y)len_x+len_y-2len_{\\operatorname{lca}(x,y)}lenx​+leny​−2lenlca(x,y)​。 设 si=∑j=1iajs_i=\\sum\\limits_{j=1}^{i}a_jsi​=j=1∑i​aj​，lenilen_ileni​ 显然即为 ∑j=1i−1ajsi−1(lenj+bi+bj)\\sum\\limits_{j=1}^{i-1} \\frac{a_j}{s_{i-1}}(len_{j}+b_i+b_j)j=1∑i−1​si−1​aj​​(lenj​+bi​+bj​)，可以前缀和快速求。 考虑求解 2lenlca⁡(x,y)2len_{\\operatorname{lca}(x,y)}2lenlca(x,y)​，显然求 lenlca⁡(x,y)len_{\\operatorname{lca}(x,y)}lenlca(x,y)​ 再乘上 222 即可。不妨钦定 x&lt;yx&lt;yx&lt;y，那么一定有 lca⁡(x,y)&lt;x\\operatorname{lca}(x,y)&lt;xlca(x,y)&lt;x，考虑让 yyy 在树上不断往父亲跳，跳到 y′≤xy&#x27;\\le xy′≤x 时停下。设 y′=iy&#x27;=iy′=i 的概率是 f(i)f(i)f(i)，那么有 f(i)=aisxf(i)=\\frac{a_i}{s_x}f(i)=sx​ai​​，归纳证明如下： 显然从 x+1x+1x+1 开始跳，跳一步就会停下，跳到 iii 的概率是 aisx\\frac{a_i}{s_x}sx​ai​​； 考虑从 kkk（k≥x+2k\\ge x+2k≥x+2）开始跳，设下一步跳到 p≤xp\\le xp≤x 的概率是 www，跳到 p&gt;xp&gt;xp&gt;x 的概率是 vvv。若 p≤xp\\le xp≤x 则概率就是 w×apsxw\\times \\frac{a_p}{s_x}w×sx​ap​​，否则由于 ppp 跳到 p′≤xp&#x27;\\le xp′≤x 的概率是 ap′sx\\frac{a_{p&#x27;}}{s_x}sx​ap′​​，所以 ppp 跳到 p′≤xp&#x27;\\le xp′≤x 的概率是 v×ap′sxv\\times \\frac{a_{p&#x27;}}{s_x}v×sx​ap′​​。那么最后跳到 ppp 的概率就是 w×apsx+v×apsx=apsxw\\times \\frac{a_p}{s_x}+v\\times \\frac{a_p}{s_x}=\\frac{a_p}{s_x}w×sx​ap​​+v×sx​ap​​=sx​ap​​。 那么若最后 yyy 跳到了 xxx 则 lenlca⁡(x,y)len_{\\operatorname{lca}(x,y)}lenlca(x,y)​ 就是 lenxlen_xlenx​，否则设最后跳到了 ppp 则变成求 lenlca⁡(x,p)len_{\\operatorname{lca}(x,p)}lenlca(x,p)​，可以让 xxx 不断往父亲跳解决。所以设 dpxdp_xdpx​ 表示 lenlca⁡(x,y)len_{\\operatorname{lca}(x,y)}lenlca(x,y)​（y&gt;xy&gt;xy&gt;x）的期望值，那么有转移： dpx=axsx×lenx+∑i=1x−1aisx×dpidp_{x}=\\frac{a_x}{s_x}\\times len_x+\\sum\\limits_{i=1}^{x-1} \\frac{a_i}{s_x}\\times dp_i dpx​=sx​ax​​×lenx​+i=1∑x−1​sx​ai​​×dpi​ 可以用前缀和快速求，那么做完了。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout) const int S=300005,p=1000000007; int n,q,a[S],b[S]; int sm[S],len[S],dp[S]; inline int qpow(int x,int y=p-2) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=(y&amp;1)?1ll*res*x%p:res; return res; } int main() { fio(&quot;name&quot;); scanf(&quot;%d%d&quot;,&amp;n,&amp;q); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;b[i]); for(int i=1;i&lt;=n;i++) sm[i]=(sm[i-1]+a[i])%p; len[1]=0; for(int i=2,val=1ll*a[1]*b[1]%p;i&lt;=n;i++) { len[i]=(1ll*val*qpow(sm[i-1])%p+b[i])%p; val=(val+1ll*a[i]*(len[i]+b[i])%p)%p; } dp[1]=0; for(int i=2,val=0;i&lt;=n;i++) { dp[i]=1ll*(val+1ll*a[i]*len[i]%p)*qpow(sm[i])%p; val=(val+1ll*a[i]*dp[i]%p)%p; } while(q--) { int x,y; scanf(&quot;%d%d&quot;,&amp;x,&amp;y); if(x==y) { puts(&quot;0&quot;); continue; } if(x&gt;y) swap(x,y); printf(&quot;%d\\n&quot;,((len[x]+len[y])%p-2ll*dp[x]%p+p)%p); } return 0; } ","tags":[{"name":"概率、期望","slug":"zrK8Q1S2G","used":true,"link":"https://Rebxe.github.io/tag/zrK8Q1S2G/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 25】名字 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-25-ming-zi-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":324000,"words":1009,"minutes":6},"date":"2023-04-08 08:49:37","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>定义：</p>\n</blockquote>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mo>(</mo><mn>102</mn><msup><mn>3</mn><mi>i</mi></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>)</mo><mtext> </mtext><mi>x</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mo>(</mo><mn>102</mn><msup><mn>5</mn><mi>i</mi></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">A_i=(1023^i\\ mod\\ 10^9)\\ xor\\ (1025^i\\ mod\\ 10^9)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1246639999999999em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord\">3</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8746639999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">d</span><span class=\"mspace\"> </span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">x</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord\">5</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8746639999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">d</span><span class=\"mspace\"> </span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<blockquote>\n<p>求：</p>\n</blockquote>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><msub><mi>l</mi><mn>1</mn></msub></mrow><msub><mi>r</mi><mn>1</mn></msub></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mi>i</mi><mo separator=\"true\">,</mo><msub><mi>l</mi><mn>2</mn></msub><mo>)</mo></mrow><msub><mi>r</mi><mn>2</mn></msub></munderover><mrow><mo fence=\"true\">{</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>{</mo><msub><mi>A</mi><mrow><mi>i</mi><mo>⋯</mo><mi>j</mi></mrow></msub><mo>}</mo><mo>−</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>{</mo><msub><mi>A</mi><mrow><mi>i</mi><mo>⋯</mo><mi>j</mi></mrow></msub><mo>}</mo><mo fence=\"true\">}</mo></mrow></mrow><annotation encoding=\"application/x-tex\">sum=\\sum_{i=l_1}^{r_1}\\sum_{j=max(i,l_2)}^{r_2}\\left \\{ max\\{A_{i\\cdots j}\\}-min\\{A_{i\\cdots j}\\} \\right \\}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.1785020000000004em;vertical-align:-1.5160049999999998em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6624970000000003em;\"><span style=\"top:-1.847887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.311105em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.402213em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6624970000000006em;\"><span style=\"top:-1.8089950000000001em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\">m</span><span class=\"mord mathdefault mtight\">a</span><span class=\"mord mathdefault mtight\">x</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.311105em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5160049999999998em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">{</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">x</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"minner mtight\">⋯</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">n</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">A</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"minner mtight\">⋯</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mclose delimcenter\" style=\"top:0em;\">}</span></span></span></span></span></span></p>\n<blockquote>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span></span></span></span> 组询问。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>40000</mn><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><msub><mi>L</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>R</mi><mn>1</mn></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><msub><mi>L</mi><mn>2</mn></msub><mo>≤</mo><msub><mi>R</mi><mn>2</mn></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le t\\le 40000,1\\le L_1\\le R_1\\le10^5,1\\le L_2\\le R_2\\le10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">4</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 定义： Ai=(1023i mod 109) xor (1025i mod 109)A_i=(1023^i\\ mod\\ 10^9)\\ xor\\ (1025^i\\ mod\\ 10^9) Ai​=(1023i mod 109) xor (1025i mod 109) 求： sum=∑i=l1r1∑j=max(i,l2)r2{max{Ai⋯j}−min{Ai⋯j}}sum=\\sum_{i=l_1}^{r_1}\\sum_{j=max(i,l_2)}^{r_2}\\left \\{ max\\{A_{i\\cdots j}\\}-min\\{A_{i\\cdots j}\\} \\right \\} sum=i=l1​∑r1​​j=max(i,l2​)∑r2​​{max{Ai⋯j​}−min{Ai⋯j​}} ttt 组询问。 1≤t≤40000,1≤L1≤R1≤105,1≤L2≤R2≤1051\\le t\\le 40000,1\\le L_1\\le R_1\\le10^5,1\\le L_2\\le R_2\\le10^51≤t≤40000,1≤L1​≤R1​≤105,1≤L2​≤R2​≤105。 洛谷原题 在线算法，瓶颈在建出 ST 表，时间复杂度 O(nlog⁡n+q)O(n\\log n+q)O(nlogn+q)，吊打所有奇奇怪怪数据结构做法。 首先有： ∑l=l1r1∑r=max⁡(l,l2)r2{max⁡{A[l,r]}−min⁡{A[l,r]}}=∑l=l1r1∑r=max⁡(l,l2)r2max⁡{A[l,r]}−∑l=l1r1∑r=max⁡(l,l2)r2min⁡{A[l,r]}=∑l=l1r1∑r=max⁡(l,l2)r2max⁡{A[l,r]}+∑l=l1r1∑r=max⁡(l,l2)r2max⁡{−A[l,r]}\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\{\\max\\{A_{[l,r]}\\}-\\min\\{A_{[l,r]}\\}\\}\\\\ =\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\max\\{A_{[l,r]}\\}-\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\min\\{A_{[l,r]}\\}\\\\ =\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\max\\{A_{[l,r]}\\}+\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\max\\{-A_{[l,r]}\\} l=l1​∑r1​​r=max(l,l2​)∑r2​​{max{A[l,r]​}−min{A[l,r]​}}=l=l1​∑r1​​r=max(l,l2​)∑r2​​max{A[l,r]​}−l=l1​∑r1​​r=max(l,l2​)∑r2​​min{A[l,r]​}=l=l1​∑r1​​r=max(l,l2​)∑r2​​max{A[l,r]​}+l=l1​∑r1​​r=max(l,l2​)∑r2​​max{−A[l,r]​} 那么只需要会求 ∑l=l1r1∑r=max⁡(l,l2)r2max⁡{A[l,r]}\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\max\\{A_{[l,r]}\\}l=l1​∑r1​​r=max(l,l2​)∑r2​​max{A[l,r]​} 就行了，记 f(L,R)=∑[l,r]⊆[L,R]max⁡{A[l,r]}f(L,R)=\\sum\\limits_{[l,r]\\subseteq [L,R]}\\max\\{A_{[l,r]}\\}f(L,R)=[l,r]⊆[L,R]∑​max{A[l,r]​} 并且由于 ∑l=l1r1∑r=max⁡(l,l2)r2max⁡{A[l,r]}=f(l1,r2)−f(l1,l2−1)−f(r1+1,r2)+f(r1+1,l2−1)\\sum\\limits_{l=l_1}^{r_1}\\sum\\limits_{r=\\max(l,l_2)}^{r_2}\\max\\{A_{[l,r]}\\}=f(l_1,r_2)-f(l_1,l_2-1)-f(r_1+1,r_2)+f(r_1+1,l_2-1)l=l1​∑r1​​r=max(l,l2​)∑r2​​max{A[l,r]​}=f(l1​,r2​)−f(l1​,l2​−1)−f(r1​+1,r2​)+f(r1​+1,l2​−1)，所以只要会求 f(L,R)f(L,R)f(L,R) 就行了。 考虑怎么求解 f(L,R)f(L,R)f(L,R)，考虑 [L,R][L,R][L,R] 中最左边的最大值的位置 ppp，它的地位是无法撼动的，所有包含 ppp 的区间最大值都是 ApA_pAp​，所以它的贡献为 (p−L+1)(R−p+1)Ap(p-L+1)(R-p+1)A_p(p−L+1)(R−p+1)Ap​。 除去包含 ppp 的区间后，只剩下 [l,r]⊆[L,p−1][l,r]\\subseteq [L,p-1][l,r]⊆[L,p−1] 和 [l,r]⊆[p+1,R][l,r]\\subseteq [p+1,R][l,r]⊆[p+1,R] 的区间了。 考虑求 [l,r]⊆[p+1,R][l,r]\\subseteq [p+1,R][l,r]⊆[p+1,R] 的贡献，设 dpi,jdp_{i,j}dpi,j​ 为 r=j,l∈[i,j]r=j,l\\in[i,j]r=j,l∈[i,j] 的 [l,r][l,r][l,r] 的贡献，设 A0=∞,pmxi=max⁡0≤j&lt;i,Aj≥AijA_0=\\infin,pmx_i=\\max\\limits_{0\\le j&lt;i,A_j\\ge A_i} jA0​=∞,pmxi​=0≤j&lt;i,Aj​≥Ai​max​j，那么有转移 dpi,j=dpi,pmxi+(j−pmxi)Ajdp_{i,j}=dp_{i,pmx_i}+(j-pmx_i)A_jdpi,j​=dpi,pmxi​​+(j−pmxi​)Aj​，[l,r]⊆[p+1,R][l,r]\\subseteq [p+1,R][l,r]⊆[p+1,R] 的贡献显然即为 ∑i=p+1Rdpp+1,i\\sum\\limits_{i=p+1}^R dp_{p+1,i}i=p+1∑R​dpp+1,i​。 观察到由于 ApA_pAp​ 是 A[L,R]A_{[L,R]}A[L,R]​ 中的最大值，所以把 ∑i=p+1Rdpp+1,i=∑i=p+1Rdp1,i−dp1,p=−(R−p)dp1,p+∑i=p+1Rdp1,i\\sum\\limits_{i=p+1}^R dp_{p+1,i}=\\sum\\limits_{i=p+1}^Rdp_{1,i}-dp_{1,p}=-(R-p) dp_{1,p}+\\sum\\limits_{i=p+1}^Rdp_{1,i}i=p+1∑R​dpp+1,i​=i=p+1∑R​dp1,i​−dp1,p​=−(R−p)dp1,p​+i=p+1∑R​dp1,i​，那么预处理出 dp1,idp_{1,i}dp1,i​ 和它的前缀和即可。 [l,r]⊆[L,p−1][l,r]\\subseteq [L,p-1][l,r]⊆[L,p−1] 的贡献也差不多，倒着求一遍 dpdpdp 即可。 用单调栈求 dp1,idp_{1,i}dp1,i​ 和前缀和的时间复杂度是 O(n)O(n)O(n) 的，预处理 ST 表的时间复杂度是 O(nlog⁡n)O(n\\log n)O(nlogn) 的，两个东西查询都是 O(1)O(1)O(1) 的，所以时间复杂度为 O(nlog⁡n+q)O(n\\log n+q)O(nlogn+q)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout) const int S=100005,p=1000000000; int n,a[S]; int top1,top2,sta1[S],sta2[S]; int pmn[S],pmx[S],smn[S],smx[S]; long long fmn[S],fmx[S],gmn[S],gmx[S]; long long sfmn[S],sfmx[S],sgmn[S],sgmx[S]; int mylog[S],mn[S][25],mx[S][25]; inline int quemn(int l,int r) { int k=mylog[r-l+1]; return a[mn[l][k]]&lt;a[mn[r-(1&lt;&lt;k)+1][k]]?mn[l][k]:mn[r-(1&lt;&lt;k)+1][k]; } inline int quemx(int l,int r) { int k=mylog[r-l+1]; return a[mx[l][k]]&gt;a[mx[r-(1&lt;&lt;k)+1][k]]?mx[l][k]:mx[r-(1&lt;&lt;k)+1][k]; } inline void slove(int l,int r,long long &amp;mns,long long &amp;mxs,int p) { int mnp=quemn(l,r); mns+=1ll*p*a[mnp]*(mnp-l+1)*(r-mnp+1); mns+=1ll*p*((sgmn[mnp-1]-sgmn[l-1]-gmn[mnp]*(mnp-l))+(sfmn[r]-sfmn[mnp]-fmn[mnp]*(r-mnp))); int mxp=quemx(l,r); mxs+=1ll*p*a[mxp]*(mxp-l+1)*(r-mxp+1); mxs+=1ll*p*((sgmx[mxp-1]-sgmx[l-1]-gmx[mxp]*(mxp-l))+(sfmx[r]-sfmx[mxp]-fmx[mxp]*(r-mxp))); } int main() { fio(&quot;c&quot;); n=100000; for(int i=1,pw1=1023,pw2=1025;i&lt;=n;i++) { a[i]=pw1^pw2; pw1=1ll*pw1*1023%p,pw2=1ll*pw2*1025%p; } for(int i=1;i&lt;=n;i++) { while(top1&gt;0&amp;&amp;a[sta1[top1]]&gt;a[i]) top1--; while(top2&gt;0&amp;&amp;a[sta2[top2]]&lt;a[i]) top2--; pmn[i]=sta1[top1],pmx[i]=sta2[top2]; sta1[++top1]=sta2[++top2]=i; } sta1[top1=0]=sta2[top2=0]=n+1; for(int i=n;i&gt;=1;i--) { while(top1&gt;0&amp;&amp;a[sta1[top1]]&gt;a[i]) top1--; while(top2&gt;0&amp;&amp;a[sta2[top2]]&lt;a[i]) top2--; smn[i]=sta1[top1],smx[i]=sta2[top2]; sta1[++top1]=sta2[++top2]=i; } for(int i=1;i&lt;=n;i++) fmn[i]=fmn[pmn[i]]+1ll*a[i]*(i-pmn[i]),fmx[i]=fmx[pmx[i]]+1ll*a[i]*(i-pmx[i]); for(int i=n;i&gt;=1;i--) gmn[i]=gmn[smn[i]]+1ll*a[i]*(smn[i]-i),gmx[i]=gmx[smx[i]]+1ll*a[i]*(smx[i]-i); for(int i=1;i&lt;=n;i++) sfmn[i]=sfmn[i-1]+fmn[i],sfmx[i]=sfmx[i-1]+fmx[i]; for(int i=1;i&lt;=n;i++) sgmn[i]=sgmn[i-1]+gmn[i],sgmx[i]=sgmx[i-1]+gmx[i]; mylog[0]=-1; for(int i=1;i&lt;=n;i++) mylog[i]=mylog[i&gt;&gt;1]+1,mn[i][0]=mx[i][0]=i; for(int j=1;j&lt;=mylog[n];j++) { for(int i=1;i&lt;=n-(1&lt;&lt;j)+1;i++) { mn[i][j]=a[mn[i][j-1]]&lt;a[mn[i+(1&lt;&lt;j-1)][j-1]]?mn[i][j-1]:mn[i+(1&lt;&lt;j-1)][j-1]; mx[i][j]=a[mx[i][j-1]]&gt;a[mx[i+(1&lt;&lt;j-1)][j-1]]?mx[i][j-1]:mx[i+(1&lt;&lt;j-1)][j-1]; } } int q; scanf(&quot;%d&quot;,&amp;q); while(q--) { int l1,r1,l2,r2; scanf(&quot;%d%d%d%d&quot;,&amp;l1,&amp;r1,&amp;l2,&amp;r2); if(l1&gt;r2) { puts(&quot;0&quot;); continue; } long long mns=0,mxs=0; slove(l1,r2,mns,mxs,1); if(l1&lt;l2) slove(l1,l2-1,mns,mxs,-1); if(r1&lt;r2) slove(r1+1,r2,mns,mxs,-1); if(r1&lt;l2-1) slove(r1+1,l2-1,mns,mxs,1); printf(&quot;%lld\\n&quot;,mxs-mns); } return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2022 NOIP 模拟赛 24】求和 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-24-qiu-he-zuo-ti-ji-lu/","stats":{"text":"11 min read","time":636000,"words":1812,"minutes":11},"date":"2023-04-08 08:45:34","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>Byteland 的选民们要进行总统选举。一共有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 位选民和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 位候选人，编号分别从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 和从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 。</p>\n<p>每位选民有一个<strong>非空</strong>的喜欢的候选人的列表，这个列表是按照喜欢程度排序的。比如说一位选民的列表是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>{</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>7</mn><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">\\{2,4,7\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">}</span></span></span></span> ，那么他最喜欢的候选人是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span> 号候选人，次喜欢的是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span></span></span></span> 号候选人，再次是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 号候选人，其余候选人都不喜欢。</p>\n<p>选举会进行若干轮，具体规则如下：</p>\n<ul>\n<li>每一轮，每位选民会投给某位在自己列表中的候选人恰好一票。</li>\n<li>第一轮，每位选民会投给自己最喜欢的候选人。</li>\n<li>从第二轮开始，每位选民会投给<strong>自己列表</strong>中<strong>上一轮</strong>票数最多的候选人。如果有多位在列表中的候选人票数都是 最多的，那么会投给<strong>这些人</strong>中最喜欢的那一位（即按照票数为第一关键字，喜欢程度为第二关键字排序）。</li>\n<li>如果每位选民在第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 轮 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>i</mi><mo>&gt;</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(i\\gt 1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 投给的候选人都和在第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.74285em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 轮投给的候选人一样，那么选举会在第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 轮结束后停止，并且 <strong>random</strong> 一位候选人作为总统。</li>\n</ul>\n<p>聪明的你一定发现了这个选举没有什么蛋用，但是你只关心选举进行的轮数。</p>\n<p>你需要构造出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n,m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 和每一位选民的喜欢的候选人的列表，使得最终选举进行的轮数尽可能多。</p>\n<p>你还需要保证 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>&lt;</mo><mi>n</mi><mo>≤</mo><mn>1000</mn></mrow><annotation encoding=\"application/x-tex\">1\\le m&lt;n\\leq 1000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，所有人的喜欢的候选人的列表大小 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 之和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\leq 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" Byteland 的选民们要进行总统选举。一共有 nnn 位选民和 mmm 位候选人，编号分别从 111 到 nnn 和从 111 到 mmm 。 每位选民有一个非空的喜欢的候选人的列表，这个列表是按照喜欢程度排序的。比如说一位选民的列表是 {2,4,7}\\{2,4,7\\}{2,4,7} ，那么他最喜欢的候选人是 222 号候选人，次喜欢的是 444 号候选人，再次是 777 号候选人，其余候选人都不喜欢。 选举会进行若干轮，具体规则如下： 每一轮，每位选民会投给某位在自己列表中的候选人恰好一票。 第一轮，每位选民会投给自己最喜欢的候选人。 从第二轮开始，每位选民会投给自己列表中上一轮票数最多的候选人。如果有多位在列表中的候选人票数都是 最多的，那么会投给这些人中最喜欢的那一位（即按照票数为第一关键字，喜欢程度为第二关键字排序）。 如果每位选民在第 iii 轮 (i&gt;1)(i\\gt 1)(i&gt;1) 投给的候选人都和在第 i−1i-1i−1 轮投给的候选人一样，那么选举会在第 iii 轮结束后停止，并且 random 一位候选人作为总统。 聪明的你一定发现了这个选举没有什么蛋用，但是你只关心选举进行的轮数。 你需要构造出 n,mn,mn,m 和每一位选民的喜欢的候选人的列表，使得最终选举进行的轮数尽可能多。 你还需要保证 1≤m&lt;n≤10001\\le m&lt;n\\leq 10001≤m&lt;n≤1000，所有人的喜欢的候选人的列表大小 kkk 之和 ≤105\\leq 10^5≤105。 猜测每个点的列表不会很长（因为太长不好构造），那么尝试构造 k≤2k\\le 2k≤2 的答案。这时每个 k=2k=2k=2 的选民都可以看成一条边，候选人则可以看成点，不妨规定每条边出发的点优先级低于指向的点。 不难发现投票的过程相当于是「上一轮最多票的人」不断改变，那么考虑构造一条链，让「上一轮最多票的人」在这条链上一个一个点地跳，先来考虑有 222 个点的情况，显然可以这样构造：（没有出发点的边是 k=1k=1k=1 的选民） 若这样构造「上一轮的票」会这样变化： [0,0]→[3,0]→[3,0][0,0]\\to[3,0]\\to[3,0] [0,0]→[3,0]→[3,0] 共变化 333 轮。 考虑 444 个点的情况： 若这样构造「上一轮的票」会这样变化： [0,0,0,0]→[2,2,3,0]→[2,1,4,0]→[3,0,4,0]→[3,0,4,0][0,0,0,0]\\to[2,2,3,0]\\to[2,1,4,0]\\to [3,0,4,0]\\to [3,0,4,0] [0,0,0,0]→[2,2,3,0]→[2,1,4,0]→[3,0,4,0]→[3,0,4,0] 共变化 555 轮。 不难发现，这样构造刚开始「上一轮的票」是 [2,2,2,…,2,2,3,0][2,2,2,\\dots,2,2,3,0][2,2,2,…,2,2,3,0] 这样的，两轮后变成了 [2,2,2,…,3,0,4,0][2,2,2,\\dots,3,0,4,0][2,2,2,…,3,0,4,0]，333 往前移动了两个点，并且后面的点对前面的点和总轮数没有任何影响，所以这样构造的总轮数是 m+1m+1m+1。 不难发现，若有 mmm 个点就会有 2m−12m-12m−1 条边，所以最多可以有 500500500 个点，总轮数为 501501501，足以通过本题。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; int main() { freopen(&quot;t.out&quot;,&quot;w&quot;,stdout); int k=250-1; printf(&quot;%d %d\\n&quot;,k*4+3,(k+1)*2); for(int i=1;i&lt;=k;i++) { printf(&quot;1 %d\\n&quot;,i*2-1); printf(&quot;1 %d\\n&quot;,i*2-1); printf(&quot;2 %d %d\\n&quot;,i*2,i*2-1); printf(&quot;2 %d %d\\n&quot;,i*2,i*2+1); } printf(&quot;1 %d\\n&quot;,(k+1)*2-1); printf(&quot;1 %d\\n&quot;,(k+1)*2-1); printf(&quot;2 %d %d\\n&quot;,(k+1)*2-1,(k+1)*2); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022 NOIP 模拟赛 22】选举 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-22-xuan-ju-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":269000,"words":1051,"minutes":5},"date":"2023-04-08 08:44:05","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>给出长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 的两个序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><msup><mn>2</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{[0,2^k-1]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8081799999999999em;vertical-align:-0.3776199999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34479999999999994em;\"><span style=\"top:-2.49738em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">0</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7820285714285713em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3776199999999999em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mrow><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><msup><mn>2</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">b_{[0,2^k-1]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0720599999999998em;vertical-align:-0.3776199999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34479999999999994em;\"><span style=\"top:-2.49738em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">0</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7820285714285713em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3776199999999999em;\"><span></span></span></span></span></span></span></span></span></span>，求一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>c</mi><mrow><mo>[</mo><mn>0</mn><mo separator=\"true\">,</mo><msup><mn>2</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn><mo>]</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">c_{[0,2^k-1]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8081799999999999em;vertical-align:-0.3776199999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34479999999999994em;\"><span style=\"top:-2.49738em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">[</span><span class=\"mord mtight\">0</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7820285714285713em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3776199999999999em;\"><span></span></span></span></span></span></span></span></span></span>，满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>c</mi><mi>p</mi></msub><mo>=</mo><msub><mi>max</mi><mo>⁡</mo><mrow><mi>i</mi><mi mathvariant=\"normal\">∣</mi><mi>j</mi><mo>=</mo><mi>p</mi></mrow></msub><mo>{</mo><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><msub><mi>b</mi><mi>j</mi></msub><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">c_p=\\max\\limits_{i|j=p}\\{a_i+b_j\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.716em;vertical-align:-0.966em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.43055999999999994em;\"><span style=\"top:-2.009em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mord mtight\">∣</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\">p</span></span></span></span><span style=\"top:-2.7em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.966em;\"><span></span></span></span></span></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mn>17</mn></mrow><annotation encoding=\"application/x-tex\">1\\le k\\le 17</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">7</span></span></span></span>。</p>\n</blockquote>\n","content":" 给出长度为 2k2^k2k 的两个序列 a[0,2k−1]a_{[0,2^k-1]}a[0,2k−1]​ 和 b[0,2k−1]b_{[0,2^k-1]}b[0,2k−1]​，求一个长度为 2k2^k2k 的序列 c[0,2k−1]c_{[0,2^k-1]}c[0,2k−1]​，满足 cp=max⁡i∣j=p{ai+bj}c_p=\\max\\limits_{i|j=p}\\{a_i+b_j\\}cp​=i∣j=pmax​{ai​+bj​}。 1≤k≤171\\le k\\le 171≤k≤17。 考虑枚举 iii，不难发现，iii 为 111 的二进制位 jjj 都能随便选。那么只要用某种方法求出 mxxmx_xmxx​ 表示 iii 为 111 的二进制位可以乱选且其他二进制位和 xxx 一致的 jjj 中最大的 bjb_jbj​，就可以更新 ci∣xc_{i|x}ci∣x​。 不难发现，只要在枚举 iii 的第 ppp 位为 111 时，枚举 iii 的补集的子集 jjj，令 mxj∣i→max⁡(mxj∣i,mxj∣i−2p)mx_{j|i}\\to \\max(mx_{j|i},mx_{j|i-2^p})mxj∣i​→max(mxj∣i​,mxj∣i−2p​) 即让这一位为 111 的 mxmxmx 加上这一位为 000 的 mxmxmx 的贡献就可以快速维护 mxmxmx。 维护 mxmxmx 的时间复杂度是 O(3k)O(3^k)O(3k) 的，更新答案的时间复杂度也是 O(3k)O(3^k)O(3k) 的，足以通过此题。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; const int S=300005; int k,n; long long a[S],b[S]; long long mx[20][S],ans[S]; void slove(int pos,int cnt,int sta) { int inv=n-1^sta; if(pos==k) { for(int T=inv;;T=inv&amp;(T-1)) { ans[T|sta]=max(ans[T|sta],a[sta]+mx[cnt][T|sta]); if(T==0) break; } return; } slove(pos+1,cnt,sta); sta|=1&lt;&lt;pos; inv=n-1^sta; for(int T=inv;;T=inv&amp;(T-1)) { mx[cnt+1][T|sta]=max(mx[cnt][T|sta],mx[cnt][T|sta^(1&lt;&lt;pos)]); if(T==0) break; } slove(pos+1,cnt+1,sta); } int main() { scanf(&quot;%d&quot;,&amp;k); n=1&lt;&lt;k; for(int i=0;i&lt;=n-1;i++) scanf(&quot;%lld&quot;,&amp;a[i]); for(int i=0;i&lt;=n-1;i++) scanf(&quot;%lld&quot;,&amp;b[i]),mx[1][i]=b[i]; slove(0,1,0); for(int i=0;i&lt;=n-1;i++) printf(&quot;%lld &quot;,ans[i]); printf(&quot;\\n&quot;); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 19】卷积之王 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-19-juan-ji-zhi-wang-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":161000,"words":507,"minutes":3},"date":"2023-04-08 08:04:57","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个人，等概率随机一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列作为他们的编号。每两个人都会进行且仅进行一场比赛，编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">i,j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 的两个人（<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi><mo>&lt;</mo><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">i&lt;j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69862em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span>）比赛时，编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 的人有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 的概率获胜，编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 的人有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>−</mo><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">1-p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span> 的概率获胜。</p>\n<p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>k</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">f(k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span> 表示能把这 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个人分成两个集合 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi><mo separator=\"true\">,</mo><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">S,T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>S</mi><mi mathvariant=\"normal\">∣</mi><mo>=</mo><mi>k</mi><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">∣</mi><mi>T</mi><mi mathvariant=\"normal\">∣</mi><mo>=</mo><mi>n</mi><mo>−</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">|S|=k,|T|=n-k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 且对于所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi><mo>∈</mo><mi>S</mi><mo separator=\"true\">,</mo><mi>v</mi><mo>∈</mo><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">u\\in S,v\\in T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">u</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 比赛都是 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">u</span></span></span></span> 获胜的概率。</p>\n<p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>g</mi><mo>(</mo><mn>1</mn><mo>)</mo><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>g</mi><mo>(</mo><mi>i</mi><mo>)</mo><mo>=</mo><mi>g</mi><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><msup><mo>)</mo><mn>2</mn></msup><mo>+</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">g(1)=1,g(i)=g(i-1)^2+2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span>，你需要求出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mi>f</mi><mo>(</mo><mi>k</mi><mo>)</mo><mi>g</mi><mo>(</mo><mi>k</mi><mo>)</mo><mi mathvariant=\"normal\">mod</mi><mo>⁡</mo><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{k=1}^{n-1}f(k)g(k)\\operatorname{mod}998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.503226em;vertical-align:-1.002113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5011130000000001em;\"><span style=\"top:-2.097887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.000005em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.002113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>p</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0&lt;p&lt;1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68354em;vertical-align:-0.0391em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335400000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。</p>\n</blockquote>\n","content":" 有 nnn 个人，等概率随机一个 nnn 的排列作为他们的编号。每两个人都会进行且仅进行一场比赛，编号为 i,ji,ji,j 的两个人（i&lt;ji&lt;ji&lt;j）比赛时，编号为 iii 的人有 ppp 的概率获胜，编号为 jjj 的人有 1−p1-p1−p 的概率获胜。 设 f(k)f(k)f(k) 表示能把这 nnn 个人分成两个集合 S,TS,TS,T 满足 ∣S∣=k,∣T∣=n−k|S|=k,|T|=n-k∣S∣=k,∣T∣=n−k 且对于所有 u∈S,v∈Tu\\in S,v\\in Tu∈S,v∈T，uuu 和 vvv 比赛都是 uuu 获胜的概率。 设 g(1)=1,g(i)=g(i−1)2+2g(1)=1,g(i)=g(i-1)^2+2g(1)=1,g(i)=g(i−1)2+2，你需要求出 ∑k=1n−1f(k)g(k)mod⁡998244353\\sum\\limits_{k=1}^{n-1}f(k)g(k)\\operatorname{mod}998244353k=1∑n−1​f(k)g(k)mod998244353。 2≤n≤1062\\le n\\le 10^62≤n≤106，0&lt;p&lt;10&lt;p&lt;10&lt;p&lt;1。 首先易证明若能选出 kkk 个人做胜者，那么这 kkk 个人的集合一定是唯一的。 那么设 fn,kf_{n,k}fn,k​ 表示 nnn 个人中能选出 kkk 个人做胜者的概率，那么考虑编号为 nnn 的人被分到哪一组，有： fn,k=fn−1,k−1×pn−k+fn−1,k×qkf_{n,k}=f_{n-1,k-1}\\times p^{n-k}+f_{n-1,k}\\times q^{k} fn,k​=fn−1,k−1​×pn−k+fn−1,k​×qk 其中 q=1−pq=1-pq=1−p。 换一个角度，考虑编号为 111 的人被分到哪一组，有： fn,k=fn−1,k−1×qn−k+fn−1,k×pkf_{n,k}=f_{n-1,k-1}\\times q^{n-k}+f_{n-1,k}\\times p^{k} fn,k​=fn−1,k−1​×qn−k+fn−1,k​×pk 那么有： fn−1,k−1×pn−k+fn−1,k×qk=fn−1,k−1×qn−k+fn−1,k×pkfn−1,k−1×(pn−k−qn−k)=fn−1,k×(pk−qk)fn−1,k−1×pn−k−qn−kpk−qk=fn−1,kfn−1,k=∏i=1kpn−i−qn−ipi−qifn,k=∏i=1kpn+1−i−qn+1−ipi−qif_{n-1,k-1}\\times p^{n-k}+f_{n-1,k}\\times q^{k}=f_{n-1,k-1}\\times q^{n-k}+f_{n-1,k}\\times p^{k}\\\\ f_{n-1,k-1}\\times (p^{n-k}-q^{n-k})=f_{n-1,k}\\times (p^{k}-q^{k})\\\\ f_{n-1,k-1}\\times \\frac{p^{n-k}-q^{n-k}}{p^{k}-q^{k}}=f_{n-1,k}\\\\ f_{n-1,k}=\\prod\\limits_{i=1}^{k}\\frac{p^{n-i}-q^{n-i}}{p^{i}-q^{i}}\\\\ f_{n,k}=\\prod\\limits_{i=1}^{k}\\frac{p^{n+1-i}-q^{n+1-i}}{p^{i}-q^{i}}\\\\ fn−1,k−1​×pn−k+fn−1,k​×qk=fn−1,k−1​×qn−k+fn−1,k​×pkfn−1,k−1​×(pn−k−qn−k)=fn−1,k​×(pk−qk)fn−1,k−1​×pk−qkpn−k−qn−k​=fn−1,k​fn−1,k​=i=1∏k​pi−qipn−i−qn−i​fn,k​=i=1∏k​pi−qipn+1−i−qn+1−i​ 这样就可以 O(nlog⁡n)O(n\\log n)O(nlogn) 递推出 fn,[1,n−1]f_{n,[1,n-1]}fn,[1,n−1]​，求出答案了。 但是有个特殊情况，当 p=12p=\\frac{1}{2}p=21​ 时，分母为 000，无法计算，所以需要额外讨论。 不难发现 p=12p=\\frac{1}{2}p=21​ 时，编号的大小关系对比赛结果没有任何影响，所以有 fn,k=(nk)×12k(n−k)f_{n,k}=\\binom{n}{k}\\times\\frac{1}{2^{k(n-k)}}fn,k​=(kn​)×2k(n−k)1​。 那么这题就真的做完了。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;queue&gt; #include &lt;cstring&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout) const int S=1000005,p=998244353; int n,P,Q; int fra[S],inv[S]; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=(y&amp;1)?1ll*res*x%p:res; return res; } inline int C(int n,int m) { return 1ll*fra[n]*inv[n-m]%p*inv[m]%p; } int main() { fio(&quot;contest&quot;); scanf(&quot;%d&quot;,&amp;n); int a,b; scanf(&quot;%d%d&quot;,&amp;a,&amp;b); P=1ll*a*qpow(b,p-2)%p,Q=(1-P+p)%p; if(P!=Q) { int g=1,f=1,ans=0; for(int i=1;i&lt;=n-1;i++) { int up=(qpow(P,n+1-i)-qpow(Q,n+1-i)+p)%p; int dwn=(qpow(P,i)-qpow(Q,i)+p)%p; f=1ll*f*up%p*qpow(dwn,p-2)%p; ans=(ans+1ll*f*g%p)%p; g=(1ll*g*g%p+2)%p; } printf(&quot;%d\\n&quot;,ans); } else { fra[0]=1; for(int i=1;i&lt;=n;i++) fra[i]=1ll*fra[i-1]*i%p; inv[n]=qpow(fra[n],p-2); for(int i=n;i&gt;=1;i--) inv[i-1]=1ll*inv[i]*i%p; int g=1,ans=0; for(int i=1;i&lt;=n-1;i++) { ans=(ans+1ll*C(n,i)*qpow(qpow(2,1ll*i*(n-i)%(p-2))%p,p-2)*g%p)%p; g=(1ll*g*g%p+2)%p; } printf(&quot;%d\\n&quot;,ans); } return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 18】比赛 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-18-bi-sai-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":376000,"words":1129,"minutes":7},"date":"2023-04-08 08:02:27","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_1,a_2,\\dots,a_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，你可以选择两个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>≥</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">\\ge 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span> 的正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，然后将每一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 之中某一个取模得到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p>求 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 中最少有多少种不同的数值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le a_i\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span></p>\n</blockquote>\n","content":" 给定 nnn 个整数 a1,a2,…,ana_1,a_2,\\dots,a_na1​,a2​,…,an​，你可以选择两个 ≥2\\ge 2≥2 的正整数 x,yx,yx,y，然后将每一个 aia_iai​ 对 x,yx,yx,y 之中某一个取模得到 bib_ibi​。 求 bib_ibi​ 中最少有多少种不同的数值。 1≤n≤2×1051\\le n\\le 2\\times 10^51≤n≤2×105 1≤ai≤1091\\le a_i\\le 10^91≤ai​≤109 首先答案肯定要么是 111 要么是 222，因为我们可以对 222 取模。 若已经知道了两个通过取模同一个数 xxx 来得到 bib_ibi​ 的 v1,v2v1,v2v1,v2，那么就可以知道 x∣(∣v1−v2∣)x|(|v1-v2|)x∣(∣v1−v2∣)。而若取三个数 v1,v2,v3v1,v2,v3v1,v2,v3，则至少有两个数是通过取模同一个数来得到 bib_ibi​ 的。 所以只需要选出极差最小且两两不同的三个数，枚举它们两两的差值的因子做 xxx，检验是否合法即可。 检验某个 xxx 的时间复杂度是 O(n+log⁡V)O(n+\\log V)O(n+logV) 的，所以时间复杂度是 O(3f(⌊Vn⌋)(n+logV))O(3f(\\lfloor\\frac{V}{n}\\rfloor)(n+logV))O(3f(⌊nV​⌋)(n+logV))，其中 f(x)f(x)f(x) 表示 [1,x][1,x][1,x] 内正整数的因子个数的最大值。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; using namespace std; #define fio(name) freopen(name&quot;.in&quot;,&quot;r&quot;,stdin),freopen(name&quot;.out&quot;,&quot;w&quot;,stdout); const int S=200005; int n,a[S]; inline int gcd(int x,int y) { if(x==0||y==0) return x+y; int t=x%y; while(t!=0) x=y,y=t,t=x%y; return y; } inline bool chk2(int val,int x) { if(x==1) return false; int rt=0,y=0; for(int i=1;i&lt;=n&amp;&amp;(y==0||(y&gt;val&amp;&amp;y!=1));i++) { if(a[i]%x!=val) { if(a[i]&lt;val) return false; y=gcd(y,a[i]-val); } } return y==0||(y&gt;val&amp;&amp;y!=1); } inline bool chk(int val,int x) { if(x&lt;2) return false; for(int d=1;d*d&lt;=x;d++) { if(x%d==0) { if(chk2(val%d,d)) return true; if(d*d!=x&amp;&amp;chk2(val%(x/d),x/d)) return true; } } return false; } int main() { scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); sort(a+1,a+n+1); n=unique(a+1,a+n+1)-a-1; if(n&lt;=2) return puts(&quot;1&quot;),0; int mn=0; for(int i=3;i&lt;=n;i++) if(mn==0||a[i]-a[i-2]&lt;a[mn]-a[mn-2]) mn=i; puts( chk(a[mn],a[mn]-a[mn-1])|| chk(a[mn],a[mn]-a[mn-2])|| chk(a[mn-1],a[mn-1]-a[mn-2]) ?&quot;1&quot;:&quot;2&quot;); return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"},{"name":"数论","slug":"3Mw3ZQABXP","used":true,"link":"https://Rebxe.github.io/tag/3Mw3ZQABXP/"}],"title":"【2022 noip 模拟赛 14】A. 取模 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-14-a-qu-mo-zuo-ti-ji-lu/","stats":{"text":"4 min read","time":196000,"words":617,"minutes":4},"date":"2023-04-08 07:53:21","dateFormat":"2023-04-08"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 个点和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">M</span></span></span></span> 条边的连通图，求一条简单路径 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">path</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span></span></span></span> 和两个点集 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">s1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">1</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">s2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">2</span></span></span></span>，满足：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mn>1</mn><mi mathvariant=\"normal\">∣</mi><mo>=</mo><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mn>2</mn><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|s1| = |s2|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">s</span><span class=\"mord\">1</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">s</span><span class=\"mord\">2</span><span class=\"mord\">∣</span></span></span></span>，两个点集大小相同（可以为空）；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mn>1</mn><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mn>2</mn><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mi mathvariant=\"normal\">∣</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi mathvariant=\"normal\">∣</mi><mo>=</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">|s1| + |s2| + |path| = N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">s</span><span class=\"mord\">1</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">s</span><span class=\"mord\">2</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 且 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>1</mn><mo>∩</mo><mi>s</mi><mn>2</mn><mo>=</mo><mi mathvariant=\"normal\">∅</mi></mrow><annotation encoding=\"application/x-tex\">s1 \\cap s2 = \\varnothing</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66334em;vertical-align:-0.08167em;\"></span><span class=\"mord amsrm\">∅</span></span></span></span> 且 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>1</mn><mo>∩</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo>=</mo><mi mathvariant=\"normal\">∅</mi></mrow><annotation encoding=\"application/x-tex\">s1 \\cap path = \\varnothing</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66334em;vertical-align:-0.08167em;\"></span><span class=\"mord amsrm\">∅</span></span></span></span> 且 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>2</mn><mo>∩</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo>=</mo><mi mathvariant=\"normal\">∅</mi></mrow><annotation encoding=\"application/x-tex\">s2 \\cap path = \\varnothing</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∩</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66334em;vertical-align:-0.08167em;\"></span><span class=\"mord amsrm\">∅</span></span></span></span>，即两个点集和简单路径恰好覆盖了所有点；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">s1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">1</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">s2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord\">2</span></span></span></span> 之间没有边直接相连。</li>\n</ul>\n<p>或者宣称这样的方案不存在。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>N</mi><mo separator=\"true\">,</mo><mi>M</mi><mo>≤</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le N,M\\le 2\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p>\n</blockquote>\n","content":" 给定 NNN 个点和 MMM 条边的连通图，求一条简单路径 pathpathpath 和两个点集 s1s1s1 和 s2s2s2，满足： ∣s1∣=∣s2∣|s1| = |s2|∣s1∣=∣s2∣，两个点集大小相同（可以为空）； ∣s1∣+∣s2∣+∣path∣=N|s1| + |s2| + |path| = N∣s1∣+∣s2∣+∣path∣=N 且 s1∩s2=∅s1 \\cap s2 = \\varnothings1∩s2=∅ 且 s1∩path=∅s1 \\cap path = \\varnothings1∩path=∅ 且 s2∩path=∅s2 \\cap path = \\varnothings2∩path=∅，即两个点集和简单路径恰好覆盖了所有点； s1s1s1 和 s2s2s2 之间没有边直接相连。 或者宣称这样的方案不存在。 1≤N,M≤2×1051\\le N,M\\le 2\\times 10^51≤N,M≤2×105 一眼 dfs 树，然后考虑在树上构造。 根本不会无解。 显然根节点 rtrtrt 一定要让公主占领，然后若根节点 rtrtrt 的儿子的子树恰好可以分给两个王子使得满足条件，那么公主选根节点，根节点的儿子子树平均分给两个王子就行。 否则考虑递归构造，设当前两个王子分别占领了 sum0sum0sum0 个点和 sum1sum1sum1 个点，那么不难想到一个策略： 先让公主占领 rtrtrt； 遍历 rtrtrt 除重儿子 hsonhsonhson 之外的儿子 vvv，若 sum0&lt;sum1sum0&lt;sum1sum0&lt;sum1，那么 vvv 的子树分配给第一个王子，否则分配给第二个王子； 若分配完之后 ∣sum0−sum1∣=sizhson|sum0-sum1|=siz_{hson}∣sum0−sum1∣=sizhson​ 那么构造完成，否则此时一定有 ∣sum0−sum1∣&lt;sizhson|sum0-sum1|&lt;siz_{hson}∣sum0−sum1∣&lt;sizhson​，那么递归构造 hsonhsonhson 的子树。 ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022 NOIP 模拟赛 8】C. 退休计划 II 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-8-c-tui-xiu-ji-hua-ii-zuo-ti-ji-lu/","stats":{"text":"2 min read","time":93000,"words":374,"minutes":2},"date":"2023-04-02 18:24:06","dateFormat":"2023-04-02"},{"abstract":"","content":"初赛 PJ 没什么好说的。 xtl 估分：909090 luogu 估分：929292 实际： 898989 TG 出题人的马被宇宙射线轰炸啦！ 大作业只用选两个人两个人做，其他人抄就行了！ 哇，出题人竟然发明了能让 for(int j=0;j&lt;n;j*=2) 停下来的 C++114，tql！ 寄了。 两个民间答案分数相差 7.57.57.5。 xtl 估分：888888 luogu 估分：80.580.580.5 实际： 77.577.577.5 复赛 PJ 十点 AK 了，后面一直在睡觉。 见到 zlt 了，他也 AK 了。 xtl 估分：100+100+100+100=400100+100+100+100=400100+100+100+100=400 luogu 估分：100+100+100+100=400100+100+100+100=400100+100+100+100=400 实际： 100+100+100+100=400100+100+100+100=400100+100+100+100=400 TG T1 想了 1.5h，刚开始写了一个 dfs 找环，假了，后来发现可以维护前三大。 T2 一眼，2h 做完 T1T2。 T3 想到了维护每个点出度，0.5h 没想到随机赋权，加上题面长，没信心，写 606060 分暴力走人，看 T4。 T4 一眼 DDP，怒码 1.5h，5k。忘记判跳到链外了，还写挂了，喜提 000 分。 挺破防的，T4 606060 多分暴力没拿到，T3 随机赋权也没想到，就不该怒码 T4 的。 luogu 估分：100+100+60+0=260100+100+60+0=260100+100+60+0=260 Infoj 估分：100+100+60+0=260100+100+60+0=260100+100+60+0=260 实际： 100+100+60+0=260100+100+60+0=260100+100+60+0=260 人均 300+ 吗 /ll ","tags":[{"name":2022,"slug":"GJvEuJsM-","used":true,"link":"https://Rebxe.github.io/tag/GJvEuJsM-/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"},{"name":"CSP","slug":"hWQ-FoFtNl","used":true,"link":"https://Rebxe.github.io/tag/hWQ-FoFtNl/"}],"title":"CSP 2022 游记","feature":"","link":"https://Rebxe.github.io/post/csp-2022-you-ji/","stats":{"text":"2 min read","time":97000,"words":362,"minutes":2},"date":"2023-04-02 18:23:41","dateFormat":"2023-04-02"},{"abstract":"<blockquote>\n<p>对于一个序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mn>1</mn><mo>…</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{1\\dots n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"minner mtight\">…</span><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，定义 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi><mo>(</mo><mi>a</mi><msub><mo>)</mo><mrow><mn>1</mn><mo>…</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">b(a)_{1\\dots n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"minner mtight\">…</span><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi><mo>(</mo><mi>a</mi><msub><mo>)</mo><mi>i</mi></msub><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>{</mo><mi>j</mi><mi mathvariant=\"normal\">∣</mi><mi>j</mi><mo>&lt;</mo><mi>i</mi><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>j</mi></msub><mo>&gt;</mo><msub><mi>a</mi><mi>i</mi></msub><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">b(a)_i = max\\{j | j &lt; i, a_j &gt; a_i\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">x</span><span class=\"mopen\">{</span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9456279999999999em;vertical-align:-0.286108em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span>。特别地，若 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi><mo>(</mo><mi>a</mi><msub><mo>)</mo><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">b(a)_i = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>，表示不存在这样的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span>。</p>\n<p>给定一个序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>p</mi><mrow><mn>1</mn><mo>…</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">p_{1\\dots n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"minner mtight\">…</span><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和值域大小 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>，满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>−</mo><mn>1</mn><mo>≤</mo><mi>p</mi><mo>&lt;</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">-1\\le p&lt;i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335400000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>，请求出有多少个序列  <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mn>1</mn><mo>…</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{1\\dots n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"minner mtight\">…</span><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 满足：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">1\\le a_i\\le m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span></li>\n<li>对于所有满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mpadded width=\"0px\"><mo></mo></mpadded><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">p_i\\not=-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mord\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel\"></span></span><span class=\"fix\"></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>，都有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi><mo>(</mo><mi>a</mi><msub><mo>)</mo><mi>i</mi></msub><mo>=</mo><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b(a)_i=p_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n</ul>\n<p>答案对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">7</span></span></span></span> 取模，满足答案至少为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>300</mn><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 300,1\\le m\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 对于一个序列 a1…na_{1\\dots n}a1…n​，定义 b(a)1…nb(a)_{1\\dots n}b(a)1…n​，满足 b(a)i=max{j∣j&lt;i,aj&gt;ai}b(a)_i = max\\{j | j &lt; i, a_j &gt; a_i\\}b(a)i​=max{j∣j&lt;i,aj​&gt;ai​}。特别地，若 b(a)i=0b(a)_i = 0b(a)i​=0，表示不存在这样的 jjj。 给定一个序列 p1…np_{1\\dots n}p1…n​ 和值域大小 mmm，满足 −1≤p&lt;i-1\\le p&lt;i−1≤p&lt;i，请求出有多少个序列 a1…na_{1\\dots n}a1…n​ 满足： 1≤ai≤m1\\le a_i\\le m1≤ai​≤m 对于所有满足 pi=−1p_i\\not=-1pi​​=−1 的 iii，都有 b(a)i=pib(a)_i=p_ib(a)i​=pi​ 答案对 109+710^9+7109+7 取模，满足答案至少为 111。 1≤n≤300,1≤m≤1051\\le n\\le 300,1\\le m\\le 10^51≤n≤300,1≤m≤105。 观察到若 pi=−1p_i\\not=-1pi​​=−1，那么一定有 a[pi+1,i]≤ai,ai&lt;apia_{[p_i+1,i]}\\le a_i,a_i&lt;a_{p_i}a[pi​+1,i]​≤ai​,ai​&lt;api​​。 所以由于答案至少为 111，那么若对于所有满足 pi=−1p_i\\not=-1pi​​=−1 的 iii 都从 iii 向 pip_ipi​ 连一条有向边，这些边肯定不会相交： 观察到这些边构成了包含关系，并且内层的值一定小于等于外层的，所以不难想到堆，那么考虑建立一棵树，跑树形 dp。不难发现，关系只有大于和大于等于两种，所以考虑给树加上边权，边权为 111 表示父亲的值要大于儿子，边权为 000 表示父亲的值要大于等于儿子。 首先虚拟出一个点 n+1n+1n+1，令 pn+1=0p_{n+1}=0pn+1​=0。这么做是为了让所有 pi=0p_i=0pi​=0 联通，最后能够组成一棵树。 考虑 pi=−1p_i=-1pi​=−1 的点。显然，设 xxx 表示包含 iii 的最内层的边的右端点，在树上只要让 iii 的父亲为 xxx，边权为 000 即可。特别的，若 x=n+1x=n+1x=n+1，那么要让 iii 的父亲为 000，边权为 000： 接下来考虑 pi=−1p_i\\not=-1pi​​=−1 的点，朴素的想法是在树上让 iii 的父亲为 pip_ipi​，边权为 111。但是考虑如下情况： 显然要满足 a4≤a6&lt;a2a_4\\le a_6&lt;a_2a4​≤a6​&lt;a2​，那么在树上这样建边即可： 代码实现也不难，倒着扫即可。 建出树之后直接跑 dp 即可，在此不过多赘述。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; using namespace std; inline int read() { int s=0,w=1,c=getchar(); while(c&lt;'0'||c&gt;'9') c=='-'?w=-1,c=getchar():c=getchar(); while(c&gt;='0'&amp;&amp;c&lt;='9') s=s*10+c-'0',c=getchar(); return s*w; } const int S=305,MS=100005,SS=1000005,p=1000000007; int n,m; int pre[S],lst[S]; int esum,to[SS],c[SS],nxt[SS],h[S]; int dp[S][MS]; inline void add(int x,int y,int w) { to[++esum]=y; c[esum]=w; nxt[esum]=h[x]; h[x]=esum; } inline void addd(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } void dfs(int u) { for(int j=1;j&lt;=m;j++) dp[u][j]=1; for(int i=h[u];i;i=nxt[i]) { int v=to[i],w=c[i]; dfs(v); int presm=0; for(int j=1;j&lt;=m;j++) { addd(presm,dp[v][j-w]); dp[u][j]=1ll*dp[u][j]*presm%p; } } } int main() { freopen(&quot;stack.in&quot;,&quot;r&quot;,stdin); freopen(&quot;stack.out&quot;,&quot;w&quot;,stdout); n=read(); m=read(); for(int i=1;i&lt;=n;i++) pre[i]=read(); for(int i=1;i&lt;=n;i++) lst[i]=i; pre[n+1]=0; for(int i=n;i&gt;=1;i--) { if(pre[i]!=-1) { add(lst[pre[i]],i,lst[pre[i]]==pre[i]&amp;&amp;pre[i]!=0); lst[pre[i]]=i; } else { for(int j=i+1;j&lt;=n+1;j++) { if(pre[j]!=-1&amp;&amp;pre[j]&lt;i) { add(j==n+1?0:j,i,0); break; } } } } dfs(0); printf(&quot;%d\\n&quot;,dp[0][m]); return 0; } ","tags":[{"name":"DP","slug":"9IQfpBtLQ","used":true,"link":"https://Rebxe.github.io/tag/9IQfpBtLQ/"},{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"}],"title":"【2022 NOIP 模拟赛 3】C. 单调栈 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022-noip-mo-ni-sai-3-c-dan-diao-zhan-zuo-ti-ji-lu/","stats":{"text":"5 min read","time":281000,"words":926,"minutes":5},"date":"2023-04-02 18:02:57","dateFormat":"2023-04-02"},{"abstract":"","content":"Day 1 开局 10 min 写完 T1，然后发现 T2 T3 不会。 T2 想了很久，知道大概怎么做了，但是有很多细节，不会写。 T3 打两个 log 暴力走人。 估分：100+25+[35,48]=[160,173]100+25+[35,48]=[160,173]100+25+[35,48]=[160,173]。 Day 2 T1 写了 3.5h。 写完 T1 就 12 点了，直接开始打暴力。 T3 写了 10pts 爆搜剪枝。 T2 写了前五个点和特殊性质 A 的匈牙利。 最后 10 min 冲 T2 特殊性质 C，费用流板子，结果 spfa 队列爆内存了，电脑死机了。 估分：100+25+10=135100+25+10=135100+25+10=135。 赛后 云斗学院自测： Day1：T2 不知道为啥挂了，100+10+48=158100+10+48=158100+10+48=158 Day2：T1 过了大样例但是还是挂了，60+28+?=?60+28+?=?60+28+?=? CCF 数据：100+15+48+30+28+5=226100+15+48+30+28+5=226100+15+48+30+28+5=226。 ","tags":[{"name":2023,"slug":"duHpjt30p","used":true,"link":"https://Rebxe.github.io/tag/duHpjt30p/"},{"name":"GDOI","slug":"m_dUCQqMxF","used":true,"link":"https://Rebxe.github.io/tag/m_dUCQqMxF/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"GDOI2023 游记","feature":"","link":"https://Rebxe.github.io/post/gdoi2023-you-ji/","stats":{"text":"2 min read","time":61000,"words":225,"minutes":2},"date":"2023-04-01 21:25:41","dateFormat":"2023-04-01"},{"abstract":"<blockquote>\n<p>有一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">n\\times m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的网格，刚开始每个格子都是白色的，你要把 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(i,j)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"mclose\">)</span></span></span></span> 的颜色通过以下三种方式变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">a_{i,j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>：</p>\n<ul>\n<li>涂白横着/竖着排列的若干格子，若涂了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 格，则代价为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi><mi>k</mi><mo>+</mo><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">Ak+B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span>；</li>\n<li>涂黑横着/竖着排列的若干格子，若涂了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 格，则代价为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi><mi>k</mi><mo>+</mo><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">Ak+B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span>；</li>\n<li>涂黑/涂白单独某个格子，代价为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span></span></span></span>；</li>\n</ul>\n<p>一个格子不能被涂色超过两次，并且一个格子不能被涂白再涂黑。</p>\n<p>求最小代价。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>40</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 40</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi><mo separator=\"true\">,</mo><mi>C</mi><mo>≤</mo><mn>40</mn></mrow><annotation encoding=\"application/x-tex\">0\\le A,B,C\\le 40</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi><mo>≤</mo><mi>A</mi><mo>+</mo><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">C\\le A+B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">A</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span>。</p>\n</blockquote>\n","content":" 有一个 n×mn\\times mn×m 的网格，刚开始每个格子都是白色的，你要把 (i,j)(i,j)(i,j) 的颜色通过以下三种方式变为 ai,ja_{i,j}ai,j​： 涂白横着/竖着排列的若干格子，若涂了 kkk 格，则代价为 Ak+BAk+BAk+B； 涂黑横着/竖着排列的若干格子，若涂了 kkk 格，则代价为 Ak+BAk+BAk+B； 涂黑/涂白单独某个格子，代价为 CCC； 一个格子不能被涂色超过两次，并且一个格子不能被涂白再涂黑。 求最小代价。 1≤n,m≤401\\le n,m\\le 401≤n,m≤40，0≤A,B,C≤400\\le A,B,C\\le 400≤A,B,C≤40，C≤A+BC\\le A+BC≤A+B。 考虑最小割的本质，设点 uuu 最终在源点 SSS 所在的连通块则 bu=1b_u=1bu​=1，在汇点 TTT 所在的连通块则 bu=0b_u=0bu​=0，那么： 边 (S,x,a)(S,x,a)(S,x,a) 对答案的贡献为 a×(1−bx)a\\times (1-b_x)a×(1−bx​)； 边 (x,T,a)(x,T,a)(x,T,a) 对答案的贡献为 a×bxa\\times b_xa×bx​； 边 (x,y,a)(x,y,a)(x,y,a) 对答案的贡献为 a×bx(1−by)a\\times b_x(1-b_y)a×bx​(1−by​)； 回到本题，考虑涂色的顺序，显然可以分为三步： 横竖涂黑 横竖涂白 单点涂色 确认了第一步和第二步，第三步就可以唯一确定了，那么设： bhx,ybh_{x,y}bhx,y​ 为 [(x,y) 被横着涂黑][(x,y)\\text{ 被横着涂黑}][(x,y) 被横着涂黑]； bsx,ybs_{x,y}bsx,y​ 为 [(x,y) 未被竖着涂黑][(x,y)\\text{ 未被竖着涂黑}][(x,y) 未被竖着涂黑]； whx,ywh_{x,y}whx,y​ 为 [(x,y) 未被横着涂白][(x,y)\\text{ 未被横着涂白}][(x,y) 未被横着涂白]； wsx,yws_{x,y}wsx,y​ 为 [(x,y) 被横着涂白][(x,y)\\text{ 被横着涂白}][(x,y) 被横着涂白]； 现在来考虑代价，对于横竖涂色，考虑把 AkAkAk 算在每个格子上，把 BBB 算在末尾格子上。那么有贡献： A×bhx,yA\\times bh_{x,y}A×bhx,y​，B×bhx,y(1−bhx,y+1)B\\times bh_{x,y}(1-bh_{x,y+1})B×bhx,y​(1−bhx,y+1​)； A×bsx,yA\\times bs_{x,y}A×bsx,y​，B×bsx,y(1−bsx+1,y)B\\times bs_{x,y}(1-bs_{x+1,y})B×bsx,y​(1−bsx+1,y​)； A×whx,yA\\times wh_{x,y}A×whx,y​，B×whx,y(1−whx,y+1)B\\times wh_{x,y}(1-wh_{x,y+1})B×whx,y​(1−whx,y+1​)； A×wsx,yA\\times ws_{x,y}A×wsx,y​，B×wsx,y(1−wsx+1,y)B\\times ws_{x,y}(1-ws_{x+1,y})B×wsx,y​(1−wsx+1,y​)； 注意边界情况要特判。 然后考虑单点涂色的代价和不合法的情况，显然一个格子不会被以一个方向涂色两次，所以横竖涂色时一个格子的涂色次数不会超过 222 次，不会不合法： 最后要涂白的格子 (x,y)(x,y)(x,y)： 有贡献情况为该格被涂黑了，但未被涂白：C×whx,y(1−bsx,y)+C×bhx,y(1−wsx,y)C\\times wh_{x,y}(1-bs_{x,y})+C\\times bh_{x,y}(1-ws_{x,y})C×whx,y​(1−bsx,y​)+C×bhx,y​(1−wsx,y​)； 不合法情况为该格已被两次涂黑：∞×bhx,y(1−bsx,y)\\infin\\times bh_{x,y}(1-bs_{x,y})∞×bhx,y​(1−bsx,y​)； 最后要涂黑的格子 (x,y)(x,y)(x,y)： 由于涂白后不能再涂黑，所以有贡献的情况为该格未被涂黑：C×(1−bhx,y)+C×bsx,yC\\times (1-bh_{x,y})+C\\times bs_{x,y}C×(1−bhx,y​)+C×bsx,y​； 不合法情况为该格已被涂白：∞×(1−bhx,y)+∞×bsx,y\\infin\\times (1-bh_{x,y})+\\infin \\times bs_{x,y}∞×(1−bhx,y​)+∞×bsx,y​； 那么建图跑最小割即可。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; #include &lt;queue&gt; using namespace std; const int MS=45,S=10000,BS=100005; int n,m,A,B,C; char a[MS][MS]; int s,t; int esum,to[BS],c[BS],nxt[BS],h[S]; int dep[S]; inline void init() { esum=1; memset(h,0,sizeof(h)); s=0,t=n*m*4+1; } inline void add(int x,int y,int w) { to[++esum]=y; c[esum]=w; nxt[esum]=h[x]; h[x]=esum; } inline void Add(int x,int y,int w) { // printf(&quot;%d %d %d\\n&quot;,x,y,w); add(x,y,w); add(y,x,0); } inline bool bfs() { memset(dep+s,0,(t-s+1)*sizeof(int)); dep[s]=1; queue&lt;int&gt; q; q.push(s); while(!q.empty()) { int u=q.front(); q.pop(); for(int i=h[u];i;i=nxt[i]) { int v=to[i]; if(c[i]&gt;0&amp;&amp;dep[v]==0) { dep[v]=dep[u]+1; q.push(v); } } } return dep[t]!=0; } int dfs(int u,int w) { if(u==t) return w; int sum=0; for(int i=h[u];i;i=nxt[i]) { int v=to[i]; if(c[i]&gt;0&amp;&amp;dep[v]==dep[u]+1) { int re=dfs(v,min(w,c[i])); c[i]-=re; c[i^1]+=re; w-=re; sum+=re; if(w==0) break; } } if(sum==0) dep[u]=0; return sum; } inline int dinic() { int ans=0; while(bfs()) ans+=dfs(s,1e8); return ans; } inline int getid(int x,int y,int id) { return (id-1)*n*m+(x-1)*m+y; } inline void slove() { scanf(&quot;%d%d%d%d%d&quot;,&amp;n,&amp;m,&amp;A,&amp;B,&amp;C); for(int i=1;i&lt;=n;i++) scanf(&quot;%s&quot;,a[i]+1); init(); // 1: 横着涂黑 // 2: 1-竖着涂黑 // 3: 1-横着涂白 // 4: 竖着涂白 for(int i=1;i&lt;=n;i++) { for(int j=1;j&lt;=m;j++) { Add(s,getid(i,j,1),0); Add(s,getid(i,j,2),A+(i==n)*B); Add(s,getid(i,j,3),A+(j==m)*B); Add(s,getid(i,j,4),0); Add(getid(i,j,1),t,A+(j==m)*B); Add(getid(i,j,2),t,0); Add(getid(i,j,3),t,0); Add(getid(i,j,4),t,A+(i==n)*B); } } for(int i=1;i&lt;=n;i++) { for(int j=1;j&lt;=m-1;j++) { Add(getid(i,j,1),getid(i,j+1,1),B); Add(getid(i,j+1,3),getid(i,j,3),B); } } for(int i=1;i&lt;=n-1;i++) { for(int j=1;j&lt;=m;j++) { Add(getid(i+1,j,2),getid(i,j,2),B); Add(getid(i,j,4),getid(i+1,j,4),B); } } for(int i=1;i&lt;=n;i++) { for(int j=1;j&lt;=m;j++) { if(a[i][j]=='#') { Add(getid(i,j,2),getid(i,j,1),C); Add(s,getid(i,j,3),1e8); Add(getid(i,j,4),t,1e8); } else { Add(getid(i,j,1),getid(i,j,4),C); Add(getid(i,j,3),getid(i,j,2),C); Add(getid(i,j,1),getid(i,j,2),1e8); } } } printf(&quot;%d\\n&quot;,dinic()); } int main() { freopen(&quot;color.in&quot;,&quot;r&quot;,stdin); freopen(&quot;color.out&quot;,&quot;w&quot;,stdout); int T; scanf(&quot;%d&quot;,&amp;T); while(T--&gt;0) slove(); return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"图论","slug":"GE8D1uUdm","used":true,"link":"https://Rebxe.github.io/tag/GE8D1uUdm/"},{"name":"网络流","slug":"19EjLeSB_D","used":true,"link":"https://Rebxe.github.io/tag/19EjLeSB_D/"}],"title":"【2023NOI模拟赛19】color on board 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-19-color-on-board-zuo-ti-ji-lu/","stats":{"text":"9 min read","time":497000,"words":1572,"minutes":9},"date":"2023-03-31 20:52:51","dateFormat":"2023-03-31"},{"abstract":"<blockquote>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个矩形 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>l</mi><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>r</mi><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>r</mi><msub><mi>y</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(lx_i,rx_i,ly_i,ry_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，求选出三个互不相交的矩形的方案数。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>l</mi><msub><mi>x</mi><mi>i</mi></msub><mo>&lt;</mo><mi>r</mi><msub><mi>x</mi><mi>i</mi></msub><mo>≤</mo><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le lx_i&lt;rx_i\\le 2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub><mo>&lt;</mo><mi>r</mi><msub><mi>y</mi><mi>i</mi></msub><mo>≤</mo><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le ly_i&lt;ry_i\\le 2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span>，所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">lx_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">rx_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 构成 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列，所有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">ly_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>r</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">ry_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 构成 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列。</p>\n</blockquote>\n","content":" 给定 nnn 个矩形 (lxi,rxi,lyi,ryi)(lx_i,rx_i,ly_i,ry_i)(lxi​,rxi​,lyi​,ryi​)，求选出三个互不相交的矩形的方案数。 1≤n≤1051\\le n\\le 10^51≤n≤105，1≤lxi&lt;rxi≤2n1\\le lx_i&lt;rx_i\\le 2n1≤lxi​&lt;rxi​≤2n，1≤lyi&lt;ryi≤2n1\\le ly_i&lt;ry_i\\le 2n1≤lyi​&lt;ryi​≤2n，所有 lxilx_ilxi​、rxirx_irxi​ 构成 2n2n2n 的排列，所有 lyily_ilyi​、ryiry_iryi​ 构成 2n2n2n 的排列。 考虑容斥，答案即为乱选的方案数，先减去钦定两个矩形有交的方案数，再加上钦定某个矩形和两个矩形有交的方案数，最后减掉三个矩形两两都有交的方案数。第一个显然就是 (n3)\\binom{n}{3}(3n​)，第二个和第三个可以通过算出和第 iii 个矩形相交的矩形个数 sumisum_isumi​ 来解决，先来考虑第四个。 考虑计算选择三个两两有交的矩形的方案数，有如下式子： ∑选 3 个不同的矩形 A,B,C[∣A∩B∩C∣=0]\\sum\\limits_{\\text{选 }3\\text{ 个不同的矩形 }A,B,C}[|A\\cap B\\cap C|\\not= 0] 选 3 个不同的矩形 A,B,C∑​[∣A∩B∩C∣​=0] 观察到 A∩B∩CA\\cap B\\cap CA∩B∩C 一定是一个矩形，本质上是数 A∩B∩CA\\cap B\\cap CA∩B∩C 有多少个简单连通块（内部没有洞）。那么考虑网格图上一种特殊的可以把数简单连通块个数转换为数面积的容斥：简单连通块个数等于 1×11\\times 11×1 的小联通块的个数，减去 1×21\\times 21×2 的小连通块的个数，减去 2×12\\times 12×1 的小连通块的个数，最后再加上 2×22\\times 22×2 的小连通块的个数。 这个容斥本质上其实相当于把连通块往下、往右缩，类似于点边容斥，最后每个凹进去的下右拐角会有 −1-1−1 的贡献，突出来的左上拐角会有 111 的贡献： 那么式子就变成了： 调换求和顺序： 显然可以四遍扫描线求解，维护组合数可以利用范德蒙德卷积和标记永久化。 然后考虑求解 sumisum_isumi​，仍套用以上容斥，扫描线用区间加区间查树状数组维护历史和即可，不用线段树是因为卡常。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; #include &lt;cstring&gt; using namespace std; const int S=100005; struct node { int lx,rx,ly,ry; }; struct prr { int lx,rx; long long k,b; }; int n,on_my_love_ruiruiruiruirui__don_t__STAY______on_my_love_ruiruiruiruirui_non_t__STAY_____; node a[S]; vector&lt;prr&gt; vec[S*2],que[S*2]; int sum[S]; long long ans; namespace tr1 { struct node { long long k,b; inline node(){k=b=0;} inline node(long long x,long long y){k=x,b=y;} inline node operator+(node bb){return (node){k+bb.k,b+bb.b};} inline node operator*(int y){return (node){k*y,b*y};} inline node operator-(){return (node){-k,-b};} inline node operator-(node bb){return (node){k-bb.k,b-bb.b};} }tr1[S*2],tr2[S*2]; inline void clear(){memset(tr1,0,sizeof(tr1));memset(tr2,0,sizeof(tr2));} inline void addt(int p,node x){for(int i=p;i&lt;=n*2;i+=i&amp;-i) tr1[i]=tr1[i]+x,tr2[i]=tr2[i]+x*p;} inline node quet(int p) { node re1,re2; for(int i=p;i&gt;=1;i-=i&amp;-i) re1=re1+tr1[i],re2=re2+tr2[i]; return re1*(p+1)-re2; } void add(int l,int r,long long k,long long b) { node val(k,b); addt(l,val),addt(r+1,-val); } long long que(int l,int r,int tme) { node res=quet(r)-quet(l-1); return res.k*tme+res.b; } } namespace tr2 { long long val[4][S&lt;&lt;3]; int tag[S&lt;&lt;3]; void clear(int u,int l,int r) { val[0][u]=r-l+1,val[1][u]=val[2][u]=val[3][u]=0; tag[u]=0; if(l==r) return; int mid=l+r&gt;&gt;1; clear(u&lt;&lt;1,l,mid),clear(u&lt;&lt;1|1,mid+1,r); } inline void upd(int u,int l,int r) { if(l!=r) { int ls=u&lt;&lt;1,rs=u&lt;&lt;1|1; val[0][u]=val[0][ls]+val[0][rs]; val[1][u]=val[1][ls]+val[1][rs]; val[2][u]=val[2][ls]+val[2][rs]; val[3][u]=val[3][ls]+val[3][rs]; } else val[0][u]=1,val[1][u]=val[2][u]=val[3][u]=0; long long t0=val[0][u],t1=val[1][u],t2=val[2][u],t3=val[3][u]; long long w0=1,w1=tag[u],w2=1ll*tag[u]*(tag[u]-1)/2,w3=1ll*tag[u]*(tag[u]-1)*(tag[u]-2)/6; val[0][u]=t0*w0; val[1][u]=t0*w1+t1*w0; val[2][u]=t0*w2+t1*w1+t2*w0; val[3][u]=t0*w3+t1*w2+t2*w1+t3*w0; } void add(int u,int l,int r,int L,int R,int val) { if(l&gt;R||r&lt;L) return; if(l&gt;=L&amp;&amp;r&lt;=R) return tag[u]+=val,upd(u,l,r),void(); int mid=l+r&gt;&gt;1; if(L&lt;=mid) add(u&lt;&lt;1,l,mid,L,R,val); if(R&gt;=mid+1) add(u&lt;&lt;1|1,mid+1,r,L,R,val); upd(u,l,r); } } inline void calcsum(int bse) { for(int i=1;i&lt;=n*2;i++) vec[i].clear(),que[i].clear(); tr1::clear(); for(int i=1;i&lt;=n;i++) { vec[a[i].ly].push_back((prr){a[i].lx,a[i].rx,1,-(a[i].ly-1)}); if(a[i].ry&lt;n*2) vec[a[i].ry+1].push_back((prr){a[i].lx,a[i].rx,-1,a[i].ry}); if(a[i].ly&gt;1) que[a[i].ly-1].push_back((prr){a[i].lx,a[i].rx,i,-1}); que[a[i].ry].push_back((prr){a[i].lx,a[i].rx,i,1}); } for(int i=1;i&lt;=n*2;i++) { for(prr &amp;u:vec[i]) tr1::add(u.lx,u.rx,u.k,u.b); for(prr &amp;u:que[i]) sum[u.k]+=bse*u.b*tr1::que(u.lx,u.rx,i); } } inline void calcans(int bse) { for(int i=1;i&lt;=n*2;i++) vec[i].clear(); tr2::clear(1,1,n*2); for(int i=1;i&lt;=n;i++) { vec[a[i].ly].push_back((prr){a[i].lx,a[i].rx,1,0}); if(a[i].ry&lt;n*2) vec[a[i].ry+1].push_back((prr){a[i].lx,a[i].rx,-1,0}); } for(int i=1;i&lt;=n*2;i++) { for(prr &amp;u:vec[i]) tr2::add(1,1,n*2,u.lx,u.rx,u.k); ans+=bse*tr2::val[3][1]; } } int main() { freopen(&quot;gift.in&quot;,&quot;r&quot;,stdin); freopen(&quot;gift.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;on_my_love_ruiruiruiruirui__don_t__STAY______on_my_love_ruiruiruiruirui_non_t__STAY_____); for(int i=1;i&lt;=n;i++) scanf(&quot;%d%d%d%d&quot;,&amp;a[i].lx,&amp;a[i].rx,&amp;a[i].ly,&amp;a[i].ry); calcsum(1); calcans(1); for(int i=1;i&lt;=n;i++) a[i].rx--; calcsum(-1); calcans(-1); for(int i=1;i&lt;=n;i++) a[i].rx++; for(int i=1;i&lt;=n;i++) a[i].ry--; calcsum(-1); calcans(-1); for(int i=1;i&lt;=n;i++) a[i].ry++; for(int i=1;i&lt;=n;i++) a[i].rx--,a[i].ry--; calcsum(1); calcans(1); for(int i=1;i&lt;=n;i++) a[i].rx++,a[i].ry++; for(int i=1;i&lt;=n;i++) sum[i]--; long long res1=1ll*n*(n-1)*(n-2)/6; long long res2=0,res3=0; for(int i=1;i&lt;=n;i++) { res2+=1ll*sum[i]*(n-2); res3+=1ll*sum[i]*(sum[i]-1)/2; } res2/=2; printf(&quot;%lld\\n&quot;,res1-res2+res3-ans); return 0; } ","tags":[{"name":"容斥","slug":"1Ur0PWueZ","used":true,"link":"https://Rebxe.github.io/tag/1Ur0PWueZ/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"},{"name":"线段树","slug":"Mhc6P6aymU","used":true,"link":"https://Rebxe.github.io/tag/Mhc6P6aymU/"}],"title":"【2023NOI模拟赛18】送分题 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-18-song-fen-ti-zuo-ti-ji-lu/","stats":{"text":"9 min read","time":524000,"words":1610,"minutes":9},"date":"2023-03-29 22:05:44","dateFormat":"2023-03-29"},{"abstract":"<blockquote>\n<p>对于一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，值域 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1,m]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mclose\">]</span></span></span></span> 的正整数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>{</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>k</mi></msub><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">\\{a_1,a_2,a_3,\\dots,a_k\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span>，定义它的逆转函数 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span></span></span></span> 为满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>{</mo><mi>f</mi><mo>(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>)</mo><mo separator=\"true\">,</mo><mi>f</mi><mo>(</mo><msub><mi>a</mi><mn>2</mn></msub><mo>)</mo><mo separator=\"true\">,</mo><mi>f</mi><mo>(</mo><msub><mi>a</mi><mn>3</mn></msub><mo>)</mo><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>f</mi><mo>(</mo><msub><mi>a</mi><mi>k</mi></msub><mo>)</mo><mo>}</mo><mo>=</mo><mo>{</mo><msub><mi>a</mi><mi>k</mi></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>k</mi><mo>−</mo><mn>2</mn></mrow></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mn>1</mn></msub><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">\\{f(a_1),f(a_2),f(a_3),\\dots,f(a_k)\\}=\\{a_k,a_{k-1},a_{k-2},\\dots,a_1\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span> 的定义域和值域均为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1,m]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mclose\">]</span></span></span></span> 的函数。</p>\n<p>给定长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，值域 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>m</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[1,m]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mclose\">]</span></span></span></span> 的正整数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，定义 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>g</mi><mo>(</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">g(l,r)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>{</mo><msub><mi>a</mi><mi>l</mi></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>l</mi><mo>+</mo><mn>2</mn></mrow></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>r</mi></msub><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">\\{a_l,a_{l+1},a_{l+2},\\dots,a_r\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span> 的逆转函数个数，你需要求出 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mi>l</mi></mrow><mi>n</mi></msubsup><mi>g</mi><mo>(</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{l=1}^{n}\\sum\\limits_{r=l}^n g(l,r)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.35351em;vertical-align:-1.002113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.351397em;\"><span style=\"top:-2.097887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.000005em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.002113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.351397em;\"><span style=\"top:-2.097887em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span style=\"top:-3.000005em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span><span style=\"top:-3.950005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.002113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span></span></span></span> 对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span><span class=\"mord\">9</span><span class=\"mord\">8</span><span class=\"mord\">2</span><span class=\"mord\">4</span><span class=\"mord\">4</span><span class=\"mord\">3</span><span class=\"mord\">5</span><span class=\"mord\">3</span></span></span></span> 取模的结果。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>3</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,m\\le 3\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 对于一个长度为 kkk，值域 [1,m][1,m][1,m] 的正整数序列 {a1,a2,a3,…,ak}\\{a_1,a_2,a_3,\\dots,a_k\\}{a1​,a2​,a3​,…,ak​}，定义它的逆转函数 fff 为满足 {f(a1),f(a2),f(a3),…,f(ak)}={ak,ak−1,ak−2,…,a1}\\{f(a_1),f(a_2),f(a_3),\\dots,f(a_k)\\}=\\{a_k,a_{k-1},a_{k-2},\\dots,a_1\\}{f(a1​),f(a2​),f(a3​),…,f(ak​)}={ak​,ak−1​,ak−2​,…,a1​} 的定义域和值域均为 [1,m][1,m][1,m] 的函数。 给定长度为 nnn，值域 [1,m][1,m][1,m] 的正整数序列 aaa，定义 g(l,r)g(l,r)g(l,r) 为 {al,al+1,al+2,…,ar}\\{a_l,a_{l+1},a_{l+2},\\dots,a_r\\}{al​,al+1​,al+2​,…,ar​} 的逆转函数个数，你需要求出 ∑l=1n∑r=lng(l,r)\\sum\\limits_{l=1}^{n}\\sum\\limits_{r=l}^n g(l,r)l=1∑n​r=l∑n​g(l,r) 对 998244353998244353998244353 取模的结果。 1≤n,m≤3×1051\\le n,m\\le 3\\times 10^51≤n,m≤3×105。 不难发现，若一个序列存在逆转函数，那么它的逆转函数的个数就是 mm−cntm^{m-cnt}mm−cnt，其中 cntcntcnt 是这个序列中不同整数的个数。 考虑 O(nm)O(nm)O(nm) 暴力，由于翻转的性质，枚举中心点显然是更方便的，那么可以暴力从中心点往两边拓展，开桶维护答案。 考虑优化，先考虑长度为奇数的区间，设 a[i−leni,i+leni]a_{[i-len_i,i+len_i]}a[i−leni​,i+leni​]​ 是以 iii 为中心的最长的合法子区间。不难发现由于逆转函数的性质，对于每个 iii，若存在 p&lt;ip&lt;ip&lt;i 且 i≤p+lenpi\\le p+len_pi≤p+lenp​，那么 lenilen_ileni​ 至少是 min⁡(len2p−i,p+lenp−i)\\min(len_{2p-i},p+len_p-i)min(len2p−i​,p+lenp​−i)，因为这两个区间构成双射： 那么根据这个性质，我们可以直接套 manacher，这样就可以求出每个位置的 lenilen_ileni​。 考虑方案数怎么求，在继承区间的时候，若已经知道当前区间内有多少个不同的数 smcntsmcntsmcnt，且知道所有 [i−j,i+j][i-j,i+j][i−j,i+j]（j≤min⁡(len2p−i,p+lenp−i)j\\le \\min(len_{2p-i},p+len_p-i)j≤min(len2p−i​,p+lenp​−i)）的区间的答案的和 smanssmanssmans，那么在暴力拓展的时候就可以直接利用前驱后继来快速维护这两个东西。 考虑在继承的时候如何快速获取这两个东西，显然继承的区间一定也是由某个区间继承过来的，并且一个区间只会从一个区间继承过来，那么设 iii 是从 faifa_ifai​ 继承过来的，继承过来的区间为 [i−len1i,i+len1i][i-len1_i,i+len1_i][i−len1i​,i+len1i​]，暴力拓展后的区间为 [i−len2i,i+len2i][i-len2_i,i+len2_i][i−len2i​,i+len2i​]。 那么在暴力拓展的时候可以开个 vector 维护拓展到每个位置的状态 (smcnt,smans)(smcnt,smans)(smcnt,smans)，继承的时候倍增找到第一个 len1j&lt;min⁡(len2p−i,p+lenp−i)len1_j&lt;\\min(len_{2p-i},p+len_p-i)len1j​&lt;min(len2p−i​,p+lenp​−i) 的 jjj 从它的 vector 里继承过来即可。 需要注意的是 len1len1len1 没有单调性，所以要记一下路径上的 min⁡\\minmin。 长度为偶数的情况也是好做的，再跑一次即可。 代码如下： // Problem: #196. 逆转函数 // Contest: Hydro // URL: http://oiclass.com/d/AKNOI/p/196 // Memory Limit: 128 MB // Time Limit: 1000 ms // // Powered by CP Editor (https://cpeditor.org) #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; #include &lt;cstring&gt; using namespace std; const int S=300005,BS=25; const int p=998244353; int n,m; int a[S],pos[S]; int lft[S],rig[S]; int len1[S],len2[S]; int fa[S][BS],mn[S][BS]; vector&lt;pair&lt;int,int&gt;&gt; sum[S]; int ans; inline int qpow(int x,int y) { int res=1; for(;y&gt;0;y&gt;&gt;=1,x=1ll*x*x%p) res=y&amp;1?1LL*res*x%p:res; return res; } inline void add(int &amp;x,int y) { x+=y; if(x&gt;=p) x-=p; } int main() { freopen(&quot;invfunc.in&quot;,&quot;r&quot;,stdin); freopen(&quot;invfunc.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d%d&quot;,&amp;n,&amp;m); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]); for(int i=1;i&lt;=m;i++) pos[i]=0; for(int i=1;i&lt;=n;i++) { lft[i]=pos[a[i]]; pos[a[i]]=i; } for(int i=1;i&lt;=m;i++) pos[i]=n+1; for(int i=n;i&gt;=1;i--) { rig[i]=pos[a[i]]; pos[a[i]]=i; } for(int i=0;i&lt;=n;i++) { len1[i]=len2[i]=0; memset(fa[i],0,sizeof(fa[i])); memset(mn[i],127,sizeof(mn[i])); sum[i].clear(); } memset(mn[0],0,sizeof(mn[0])); sum[0].push_back(make_pair(1,qpow(m,m-1))); for(int i=1,j=0;i&lt;=n;i++) { int pp=0; if(i&lt;=j+len2[j]) { pp=2*j-i; len1[i]=min(len2[pp],j+len2[j]-i); } fa[i][0]=pp; mn[i][0]=len1[i]; for(int k=1;k&lt;=BS-3;k++) { fa[i][k]=fa[fa[i][k-1]][k-1]; mn[i][k]=min(mn[i][k-1],mn[fa[i][k-1]][k-1]); } int pp2=pp; for(int k=BS-3;k&gt;=0;k--) if(mn[pp2][k]&gt;len1[i]) pp2=fa[pp2][k]; sum[i].push_back(sum[pp2][len1[i]-len1[pp2]]); len2[i]=len1[i]; int smcnt=sum[i][0].first,smans=sum[i][0].second; len2[i]++; while(1) { if(i-len2[i]&lt;1||i+len2[i]&gt;n) { len2[i]--; break; } if(rig[i-len2[i]]&lt;i+len2[i]) { int pp=rig[i-len2[i]]; if(a[i+len2[i]]!=a[2*i-pp]) { len2[i]--; break; } } else smcnt++; if(lft[i+len2[i]]&gt;=i-len2[i]) { int pp=lft[i+len2[i]]; if(a[i-len2[i]]!=a[2*i-pp]) { len2[i]--; break; } } else smcnt++; add(smans,qpow(m,m-smcnt)); sum[i].push_back(make_pair(smcnt,smans)); len2[i]++; } if(i+len2[i]&gt;j+len2[j]) j=i; } for(int i=1;i&lt;=n;i++) add(ans,sum[i][sum[i].size()-1].second); for(int i=0;i&lt;=n;i++) { len1[i]=len2[i]=-1; memset(fa[i],0,sizeof(fa[i])); memset(mn[i],127,sizeof(mn[i])); sum[i].clear(); } memset(mn[0],-1,sizeof(mn[0])); sum[0].push_back(make_pair(0,0)); for(int i=1,j=0;i&lt;=n-1;i++) { int pp=0; if(i&lt;=j+1+len2[j]) { pp=2*j-i; len1[i]=min(len2[pp],j+len2[j]-i); } fa[i][0]=pp; mn[i][0]=len1[i]; for(int k=1;k&lt;=BS-3;k++) { fa[i][k]=fa[fa[i][k-1]][k-1]; mn[i][k]=min(mn[i][k-1],mn[fa[i][k-1]][k-1]); } int pp2=pp; for(int k=BS-3;k&gt;=0;k--) if(mn[pp2][k]&gt;len1[i]) pp2=fa[pp2][k]; sum[i].push_back(sum[pp2][len1[i]-len1[pp2]]); len2[i]=len1[i]; int smcnt=sum[i][0].first,smans=sum[i][0].second; len2[i]++; while(1) { if(i-len2[i]&lt;1||i+1+len2[i]&gt;n) { len2[i]--; break; } if(rig[i-len2[i]]&lt;i+1+len2[i]) { int pp=rig[i-len2[i]]; if(a[i+1+len2[i]]!=a[2*i+1-pp]) { len2[i]--; break; } } else smcnt++; if(lft[i+1+len2[i]]&gt;=i-len2[i]) { int pp=lft[i+1+len2[i]]; if(a[i-len2[i]]!=a[2*i+1-pp]) { len2[i]--; break; } } else smcnt++; add(smans,qpow(m,m-smcnt)); sum[i].push_back(make_pair(smcnt,smans)); len2[i]++; } if(i+len2[i]&gt;j+len2[j]) j=i; } for(int i=1;i&lt;=n-1;i++) add(ans,sum[i][sum[i].size()-1].second); printf(&quot;%d\\n&quot;,ans); return 0; } ","tags":[{"name":"组合计数","slug":"vqtoUvqF8","used":true,"link":"https://Rebxe.github.io/tag/vqtoUvqF8/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数学","slug":"Dkn2lgn3B","used":true,"link":"https://Rebxe.github.io/tag/Dkn2lgn3B/"},{"name":"字符串","slug":"wtMqnxQGh","used":true,"link":"https://Rebxe.github.io/tag/wtMqnxQGh/"}],"title":"【2023NOI模拟赛17】逆转函数 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-17-ni-zhuan-han-shu-zuo-ti-ji-lu/","stats":{"text":"9 min read","time":534000,"words":1665,"minutes":9},"date":"2023-03-29 11:09:13","dateFormat":"2023-03-29"},{"abstract":"<blockquote>\n<p>给定一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，值域 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mo>−</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo separator=\"true\">,</mo><mn>2</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[-2\\times 10^{9},2\\times 10^{9}]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">−</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.008548em;vertical-align:-0.19444em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 的整数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，要求构造一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，值域 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>[</mo><mo>−</mo><mn>1</mn><msup><mn>0</mn><mn>10</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><msup><mn>0</mn><mn>10</mn></msup><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">[-10^{10},10^{10}]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 的正数序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span>，满足对于每一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le i\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.79549em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>，都可以找到一对 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(j,k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span>（<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 可以等于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>），满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>j</mi></msub><mo>+</mo><msub><mi>b</mi><mi>k</mi></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_j+b_k=a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，或者报告无解。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>30</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 30</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个长度为 nnn，值域 [−2×109,2×109][-2\\times 10^{9},2\\times 10^{9}][−2×109,2×109] 的整数序列 aaa，要求构造一个长度为 nnn，值域 [−1010,1010][-10^{10},10^{10}][−1010,1010] 的正数序列 bbb，满足对于每一个 1≤i≤n1\\le i\\le n1≤i≤n 的 iii，都可以找到一对 (j,k)(j,k)(j,k)（jjj 可以等于 kkk），满足 bj+bk=aib_j+b_k=a_ibj​+bk​=ai​，或者报告无解。 1≤n≤301\\le n\\le 301≤n≤30。 考虑一个合法的解 bbb，建出一个 nnn 个点的图，把每个 aaa 中元素的拆分都看作一条边，那么由于有 nnn 条边所以一定有环。 如果 aaa 中元素都是奇数，那么考虑图中的一个环 b1,b2,…,bkb_1,b_2,\\dots,b_kb1​,b2​,…,bk​，ai=bi+bi+1a_i=b_i+b_{i+1}ai​=bi​+bi+1​（bk+1=b1b_{k+1}=b_1bk+1​=b1​），一定有 ∑i=1kai=2∑i=1nbi\\sum\\limits_{i=1}^k a_i=2\\sum\\limits_{i=1}^{n}b_ii=1∑k​ai​=2i=1∑n​bi​，所以 2∣k2|k2∣k。所以有 a1+a3+⋯+ak−1=∑i=1kbi=a2+a4+⋯+aka_1+a_3+\\dots+a_{k-1}=\\sum\\limits_{i=1}^k b_i=a_2+a_4+\\dots+a_ka1​+a3​+⋯+ak−1​=i=1∑k​bi​=a2​+a4​+⋯+ak​。 那么若能找到 aaa 的两个不交的非空子集 AAA、BBB，满足 ∣A∣=∣B∣|A|=|B|∣A∣=∣B∣ 且 ∑u∈Au=∑u∈Bu\\sum\\limits_{u\\in A}u=\\sum\\limits_{u\\in B}uu∈A∑​u=u∈B∑​u 则可以令 b1=0b_1=0b1​=0 然后构造出解，否则一定无解。 注意到 aaa 包含偶数的情况可以直接把那个偶数拆成两个相同的数相加来做，所以问题就变成了找到 aaa 的两个不交的非空子集 AAA、BBB，满足 ∣A∣=∣B∣|A|=|B|∣A∣=∣B∣ 且 ∑u∈Au=∑u∈Bu\\sum\\limits_{u\\in A}u=\\sum\\limits_{u\\in B}uu∈A∑​u=u∈B∑​u。 考虑令 ai′=ai+1+∑i=1n∣ai∣a&#x27;_i=a_i+1+\\sum\\limits_{i=1}^n |a_i|ai′​=ai​+1+i=1∑n​∣ai​∣，则问题就变成了找到 aaa 的两个不交的非空子集 AAA、BBB，满足 ∑u∈Au=∑u∈Bu\\sum\\limits_{u\\in A}u=\\sum\\limits_{u\\in B}uu∈A∑​u=u∈B∑​u。注意这是个经典背包问题，那么可以直接折半，枚举前一半集合划分的所有状态、后一半集合划分的所有状态，哈希表合并即可。 注意构造答案的时候要贪心，具体就是大于等于 000 时选最大的 aia_iai​ 填入，小于 000 时选最小的 aia_iai​ 填入，这样才能保证构造出来的 bbb 合法。 代码如下： #include &lt;iostream&gt; #include &lt;algorithm&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; const int S=35,MS=20000005,hashp=20000003; struct node { long long st,val; }; struct hashmap { int esum,nxt[MS],h[hashp]; node dat[MS]; inline void ins(node x) { int id=(x.val%hashp+hashp)%hashp; dat[++esum]=x; nxt[esum]=h[id]; h[id]=esum; } inline long long fnd(long long sm) { int id=(sm%hashp+hashp)%hashp; for(int i=h[id];i;i=nxt[i]) if(dat[i].val==sm) return dat[i].st; return -1; } }; int n; long long sum,a[S],b[S]; hashmap hmap; long long ans; vector&lt;pair&lt;long long,int&gt;&gt; st1,st2; bool vis[S]; int tot; long long res[S]; void dfs1(int u,long long st,long long sm) { if(u==n/2+1) return hmap.ins((node){st,sm}),void(); dfs1(u+1,st*3+0,sm); dfs1(u+1,st*3+1,sm+b[u]); dfs1(u+1,st*3+2,sm-b[u]); } void dfs2(int u,long long st,long long sm) { if(u==n+1) { long long res=hmap.fnd(-sm); if(res!=-1&amp;&amp;ans==0) { for(int i=1;i&lt;=n-n/2;i++) res*=3; res+=st; ans=res; } return; } dfs2(u+1,st*3+0,sm); dfs2(u+1,st*3+1,sm+b[u]); dfs2(u+1,st*3+2,sm-b[u]); } int main() { scanf(&quot;%d&quot;,&amp;n); sum=1; for(int i=1;i&lt;=n;i++) scanf(&quot;%lld&quot;,&amp;a[i]),sum+=llabs(a[i]); for(int i=1;i&lt;=n;i++) b[i]=a[i]+sum; for(int i=1;i&lt;=n;i++) { if(a[i]&amp;1^1) { long long x=a[i]/2; puts(&quot;Yes&quot;); for(int j=1;j&lt;=n;j++) printf(&quot;%lld &quot;,a[j]-x); printf(&quot;\\n&quot;); for(int j=1;j&lt;=n;j++) printf(&quot;%d %d\\n&quot;,i,j); return 0; } } dfs1(1,0,0),dfs2(n/2+1,0,0); if(ans==0) return puts(&quot;No&quot;),0; for(int i=n;i&gt;=1;i--) { if(ans%3==1) st1.push_back(make_pair(a[i],i)); if(ans%3==2) st2.push_back(make_pair(a[i],i)); ans/=3; } sort(st1.begin(),st1.end()),sort(st2.begin(),st2.end()); int l1=0,r1=st1.size()-1,l2=0,r2=st2.size()-1; long long pre=0; for(int i=0;i&lt;st1.size();i++) { if(pre&lt;0) { res[++tot]=pre; vis[st1[l1].second]=true; pre=st1[l1].first-pre; l1++; } else { res[++tot]=pre; vis[st1[r1].second]=true; pre=st1[r1].first-pre; r1--; } if(pre&lt;0) { res[++tot]=pre; vis[st2[l2].second]=true; pre=st2[l2].first-pre; l2++; } else { res[++tot]=pre; vis[st2[r2].second]=true; pre=st2[r2].first-pre; r2--; } } for(int i=1;i&lt;=n;i++) if(!vis[i]) res[++tot]=a[i]; puts(&quot;Yes&quot;); for(int i=1;i&lt;=n;i++) printf(&quot;%lld &quot;,res[i]); printf(&quot;\\n&quot;); for(int i=1;i&lt;=n;i++) { bool f=false; for(int j=1;j&lt;=n&amp;&amp;!f;j++) { for(int k=1;k&lt;=n&amp;&amp;!f;k++) { if(res[j]+res[k]==a[i]) { f=true; printf(&quot;%d %d\\n&quot;,j,k); } } } if(!f) puts(&quot;NO&quot;); } return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛17】出题人 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-17-chu-ti-ren-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":396000,"words":1220,"minutes":7},"date":"2023-03-28 19:22:01","dateFormat":"2023-03-28"},{"abstract":"<blockquote>\n<p>房子一共住了 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个人，这 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 个人每个人有一个重要程度。</p>\n<p>房门上可以装有若干把锁，每把锁有一种唯一的钥匙与之对应。</p>\n<p>每一种钥匙可以复制若干份，并且可以发给任意多个居民。每个人都可以持有若干钥匙，也可以不持有钥匙。</p>\n<p>如果若干名居民钥匙的并集是全集，他们都在场时就能打开房门，否则不能打开房门。</p>\n<p>现在规定，一组居民都在场时能打开房门当且仅当他们的重要度之和大于等于为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>。</p>\n<p>问至少需要给房门装多少把锁。即，求最小的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，使得存在一种分配钥匙的方案，满足任意一组重要度之和小于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的居民持有的钥匙的并集不能打开所有房门且任意一组重要度之和大于等于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> 的居民持有的钥匙的并集能打开所有房门。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>20</mn></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le20</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le m\\le 10^9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">1 \\le a_i \\le m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span>。</p>\n</blockquote>\n","content":" 房子一共住了 nnn 个人，这 nnn 个人每个人有一个重要程度。 房门上可以装有若干把锁，每把锁有一种唯一的钥匙与之对应。 每一种钥匙可以复制若干份，并且可以发给任意多个居民。每个人都可以持有若干钥匙，也可以不持有钥匙。 如果若干名居民钥匙的并集是全集，他们都在场时就能打开房门，否则不能打开房门。 现在规定，一组居民都在场时能打开房门当且仅当他们的重要度之和大于等于为 mmm。 问至少需要给房门装多少把锁。即，求最小的 kkk，使得存在一种分配钥匙的方案，满足任意一组重要度之和小于 mmm 的居民持有的钥匙的并集不能打开所有房门且任意一组重要度之和大于等于 mmm 的居民持有的钥匙的并集能打开所有房门。 1≤n≤201\\le n\\le201≤n≤20，1≤m≤1091\\le m\\le 10^91≤m≤109，1≤ai≤m1 \\le a_i \\le m1≤ai​≤m。 一道神奇的结论题。 首先摆出结论：答案即为不同的非空集合 SSS 个数 xxx，满足 SSS 里面的人的重要度之和小于 mmm，但是 SSS 任意再加上一个人的重要度之和就大于等于 mmm。 证明： 证明锁的个数小于 xxx 都不可行：考虑反证，设 l&lt;xl&lt;xl&lt;x 且有 lll 个锁的情况是可行的，那么由于一共有 xxx 个满足条件的 SSS 且 x&gt;lx&gt;lx&gt;l，所以必定有两个满足条件的集合 XXX 和 YYY 缺同一把钥匙。那么 XXX 和 YYY 并起来也还是缺那一把钥匙，而此时的重要度之和肯定要大于等于 mmm，却开不了门，不合法。 证明锁的个数等于 xxx 可行：有这样的一种构造方法，每个人持有所有代表的集合不包含他的锁的钥匙。 最后记得特判 ∑ai&lt;m\\sum a_i&lt;m∑ai​&lt;m 的情况，这时只需要一个任何人都没有钥匙的锁即可。 ","tags":[{"name":"结论","slug":"qErN0WkdA","used":true,"link":"https://Rebxe.github.io/tag/qErN0WkdA/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022NOI模拟赛7T1】锁 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022noi-mo-ni-sai-7t1-suo-zuo-ti-ji-lu/","stats":{"text":"3 min read","time":125000,"words":563,"minutes":3},"date":"2023-03-27 09:23:58","dateFormat":"2023-03-27"},{"abstract":"<blockquote>\n<p>对于一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 串，下标从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">n-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。定义两种类型的操作:</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">A</span></span></span></span> 类型:选择一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span>，将序列循环右移 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 位，也就是新序列的第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>i</mi><mo>+</mo><mi>x</mi><mo>)</mo><mspace></mspace><mspace width=\"0.6666666666666666em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">(i+x)\\mod\\ n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6666666666666666em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">n</span></span></span></span> 位对应原序列的第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span> 位。例如：对于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">x=2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0110001100</mn></mrow><annotation encoding=\"application/x-tex\">0110001100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span> 将会变成 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1000110001</mn></mrow><annotation encoding=\"application/x-tex\">1000110001</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 类型:选择一个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span>，满足序列的第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 个位置为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，且第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo>)</mo><mspace></mspace><mspace width=\"0.6666666666666666em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">(x+1)\\mod\\ n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6666666666666666em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">n</span></span></span></span> 位置不为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，交换序列的第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span></span></span></span> 个位置和第 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo>)</mo><mspace></mspace><mspace width=\"0.6666666666666666em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">(x+1)\\mod\\ n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6666666666666666em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">o</span><span class=\"mord mathrm\">d</span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mspace\"> </span><span class=\"mord mathdefault\">n</span></span></span></span> 个位置的字符。</p>\n<p>对于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0101101011</mn></mrow><annotation encoding=\"application/x-tex\">0101101011</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">x= 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">x =3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span></span></span></span> 均是不合法的，而 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">x = 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span></span></span></span> 是合法的，操作后序列变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1101011010</mn></mrow><annotation encoding=\"application/x-tex\">1101011010</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span>。</p>\n<p>给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>k</mi><mo separator=\"true\">,</mo><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">n,k,l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span></span></span></span>。请构造一个由 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 串构成的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mo>[</mo><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">s[]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mclose\">]</span></span></span></span>，下标从 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 开始。使得序列中每个串恰好有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 个 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。且对于所有满足 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>i</mi><mo>&lt;</mo><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">0\\le i&lt;l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69862em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">s[i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mclose\">]</span></span></span></span> 既可以通过一次 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">A</span></span></span></span> 类型的操作，也可以通过一次 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 类型的操作，变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mo>[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding=\"application/x-tex\">s[i+1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>。</p>\n<p>举个例子，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>001001</mn></mrow><annotation encoding=\"application/x-tex\">001001</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span> 既可以通过一种 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">A</span></span></span></span> 类型的操作也可以通过一种 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 类型的操作变为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>100100</mn></mrow><annotation encoding=\"application/x-tex\">100100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>：对于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">A</span></span></span></span> 类型可以设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x = 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，对于 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 类型可以设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>x</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">x = 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span></span></span></span>。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span></span></span></span> 组数据。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>l</mi><mo>≤</mo><mn>100</mn></mrow><annotation encoding=\"application/x-tex\">2\\le n,l\\le 100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">0\\le k\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>T</mi><mo>≤</mo><mn>10</mn></mrow><annotation encoding=\"application/x-tex\">1\\le T\\le 10</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span>。</p>\n</blockquote>\n","content":" 对于一个长度为 nnn 的 010101 串，下标从 000 到 n−1n-1n−1。定义两种类型的操作: AAA 类型:选择一个 xxx，将序列循环右移 xxx 位，也就是新序列的第 (i+x)mod n(i+x)\\mod\\ n(i+x)mod n 位对应原序列的第 iii 位。例如：对于 x=2x=2x=2，011000110001100011000110001100 将会变成 100011000110001100011000110001。 BBB 类型:选择一个 xxx，满足序列的第 xxx 个位置为 111，且第 (x+1)mod n(x+1)\\mod\\ n(x+1)mod n 位置不为 111，交换序列的第 xxx 个位置和第 (x+1)mod n(x+1)\\mod\\ n(x+1)mod n 个位置的字符。 对于 010110101101011010110101101011，x=0x= 0x=0 和 x=3x =3x=3 均是不合法的，而 x=4x = 4x=4 是合法的，操作后序列变为 110101101011010110101101011010。 给定 n,k,ln,k,ln,k,l。请构造一个由 lll 个长度为 nnn 的 010101 串构成的序列 s[]s[]s[]，下标从 000 开始。使得序列中每个串恰好有 kkk 个 111。且对于所有满足 0≤i&lt;l0\\le i&lt;l0≤i&lt;l 的 iii，s[i]s[i]s[i] 既可以通过一次 AAA 类型的操作，也可以通过一次 BBB 类型的操作，变为 s[i+1]s[i+1]s[i+1]。 举个例子，001001001001001001 既可以通过一种 AAA 类型的操作也可以通过一种 BBB 类型的操作变为 100100100100100100：对于 AAA 类型可以设 x=1x = 1x=1，对于 BBB 类型可以设 x=2x = 2x=2。 TTT 组数据。 2≤n,l≤1002\\le n,l\\le 1002≤n,l≤100，0≤k≤n0\\le k\\le n0≤k≤n，1≤T≤101\\le T\\le 101≤T≤10。 #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;set&gt; using namespace std; const int S=105; int n,k,l; int a[S],b[S]; inline int gcd(int x,int y) { if(y==0) return 0; int t=x%y; while(t!=0) x=y,y=t,t=x%y; return y; } // 首先不难发现，只要求出 s[0] 即第一个字符串， // 后面的就可以通过暴力枚举交换的位置哈希判断来得到， // 那么考虑构造一个满足条件的 s[0] void dfs(int n,int k) // 递归构造 n，k 时的 s[0] { if(k==1) { a[1]=1; return; } // 若此时 n 和 k 互质，那么 n 一定不是 k 的倍数。考虑这 k 个 1 之间的 k 个间隔 // 由于这 k 个间隔的总和一定是 n，所以 // 显然有 k-n%k 个 floor(n/k) 和 n%k 个 ceil(n/k) 即 floor(n/k)+1。 // // 考虑操作 B 的本质，其实就是让 a[i]--，a[i+1]++， // 而这样也会让位置 i 上原本的 1 距离上一个 1 的距离增加 1， // 而位置 i 之后最近的那个 1 距离它之前的 1 的距离会减去 1。 // // 也就是说，若设 b[i] 为第 i 个 1 距离第 i-1 个 1 的距离，也就是它们的位置之差， // 特别的，b[1] 表示第 1 个 1 距离第 k 个 1 的距离，那么操作 B 相当于让 b[i]++，b[i+1]--。 // // 那么把等于 floor(n/k) 的 b[i] 都看成 1，把等于 floor(n/k)+1 的 b[i] 看成 0， // 递归处理 n=k，k=k-n%k 的情况即可。 // 若 n 和 k 不互质，那么 ceil(n/k) 显然是不可能恰好等于 floor(n/k)+1 的，此时便无解， // 因为 b[i] 怎么加减都会出现新的未出现过的数值，不可能和原来的 b 循环同构。 dfs(k,k-n%k); int val0=n/k+1,val1=n/k; for(int i=1;i&lt;=k;i++) b[i]=a[i]==0?val0:val1; for(int i=1;i&lt;=n;i++) a[i]=0; int pos=n; // 钦定最后一位为 1，因为 s[0] 是循环同构的 for(int i=k;i&gt;=1;i--) a[pos]=1,pos=(pos-b[i]-1+n)%n+1; } set&lt;__int128_t&gt; st; // 把 01 序列当作二进制数进行哈希 inline __int128_t calc(int a[]) // 计算哈希 { __int128_t pw2=1,has=0; for(int i=1;i&lt;=n;i++) { has+=a[i]*pw2; pw2*=2; } return has; } inline void slove() { scanf(&quot;%d%d%d&quot;,&amp;n,&amp;k,&amp;l); if(gcd(n,k)!=1) // 无解情况：n 和 k 不互质 { puts(&quot;NO&quot;); return; } st.clear(); puts(&quot;YES&quot;); for(int i=1;i&lt;=n;i++) a[i]=0; dfs(n,k); st.insert(calc(a)); for(int i=1;i&lt;=n;i++) // 预处理好和 s[0] 循环同构的字符串 { for(int j=1;j&lt;=n;j++) b[(j+i-1)%n+1]=a[j]; st.insert(calc(b)); } for(int i=1;i&lt;=l;i++) { for(int j=1;j&lt;=n;j++) printf(&quot;%d&quot;,a[j]); printf(&quot;\\n&quot;); for(int j=1;j&lt;=n;j++) // 暴力找下一个 { for(int k=1;k&lt;=n;k++) b[k]=a[k]; if(b[j]==1&amp;&amp;b[j%n+1]==0) { b[j]=0; b[j%n+1]=1; if(st.count(calc(b))) { for(int k=1;k&lt;=n;k++) a[k]=b[k]; break; } } } } } int main() { int T=1; scanf(&quot;%d&quot;,&amp;T); while(T--&gt;0) { slove(); } return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2022NOI模拟赛3T1】环 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022noi-mo-ni-sai-3t1-huan-zuo-ti-ji-lu/","stats":{"text":"6 min read","time":344000,"words":1190,"minutes":6},"date":"2023-03-26 11:24:36","dateFormat":"2023-03-26"},{"abstract":"","content":"Day -3 停课了，PKUSC 和 THUSC 的审核都过了，晚上纠结了一下还是选了 PKUSC。 Day -2 早上打了场模拟赛，听说是 PKU 的真题，结果 T2 数据锅了，T3 没数据 /hanx 赛后发现 T1 是神仙题/ll 晚上有 CF，B 读题没读到 A&lt;B&lt;CA&lt;B&lt;CA&lt;B&lt;C 分讨了 1h，做 C 的时候太紧张了写的很复杂导致了 FST…… 还好 D 想到了贪心才没掉青。 Day -1 早上继续打模拟赛，仍然似乎是 PKU 的真题，T1 是二分模板，T2 写了暴力，T3 写了个最小割树。 赛后看题解发现 T2 是线段树套线段树合并？ 毒瘤。 Day 1 早上试机社死了 /hanx 中午第一次在上学期间出学校吃饭。 T1 题意是两个 CF 号，每次打 rating 最少的那个，有 wiw_iwi​ 概率上 iii 分（i∈[−m,m]i\\in[-m,m]i∈[−m,m]），问 rating 最高的那个号至少有 nnn rating 期望打多少场。1≤n≤103,1≤m≤501\\le n\\le 10^3,1\\le m\\le 501≤n≤103,1≤m≤50。 推了 1.5h，发现可以设 dpi,jdp_{i,j}dpi,j​ 为 rating 最高的号 rating 为 iii，另一个号为 jjj 的期望，然后行之间没有后效性，所以只需要在一行之内消元。线性消元的话可以 O(n2m)O(n^2m)O(n2m)。 后来想了 0.5h 消元的办法，结果没想出来。发现时间有点不太够于是去骗 T2 的部分分。 赛后发现我的做法没错……如果再想最多 0.5h 就能 A…… T2 题意是给 nnn 条 xxx 单调递增，yyy 单调递减的线段 ((a,b),(c,d))((a,b),(c,d))((a,b),(c,d))，即满足 a&lt;c,b&gt;da&lt;c,b&gt;da&lt;c,b&gt;d。然后 qqq 次询问左下角为 (−inf,−inf)(-inf,-inf)(−inf,−inf)，右上角为 (x,y)(x,y)(x,y) 的矩形内线段的长度。1≤n,q≤3×1051\\le n,q\\le 3\\times10^51≤n,q≤3×105。 这道题是用丰厚的 O(n2)O(n^2)O(n2) 部分分吸引我来骗的。 但是用一次函数解析式一直出精度问题，怒调 1.5h/ll 赛后才知道有简洁且精度损失更低的相似三角形解法…… T3 没看。 最后的 0.5h 手推 T1 的暴力高斯消元，结果没推完/dk 得分：0+0+0=00+0+0=00+0+0=0。 心态有毒…… ","tags":[{"name":"PKU","slug":"Jt9rN7EEz","used":true,"link":"https://Rebxe.github.io/tag/Jt9rN7EEz/"},{"name":2022,"slug":"GJvEuJsM-","used":true,"link":"https://Rebxe.github.io/tag/GJvEuJsM-/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"PKUSC 2022 游记","feature":"","link":"https://Rebxe.github.io/post/pkusc-2022-you-ji/","stats":{"text":"3 min read","time":156000,"words":616,"minutes":3},"date":"2023-03-25 21:35:58","dateFormat":"2023-03-25"},{"abstract":"<blockquote>\n<p>给定一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，同时你有一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">b_i=i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span></span></span></span>，设 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>o</mi><mi>p</mi><mo>=</mo><mo>{</mo><mo>(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo>)</mo><mi mathvariant=\"normal\">∣</mi><mn>1</mn><mo>≤</mo><mi>x</mi><mo>&lt;</mo><mi>y</mi><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>x</mi><mi mathvariant=\"normal\">≠</mi><mi>y</mi><mo>}</mo></mrow><annotation encoding=\"application/x-tex\">op=\\{(x,y)|1\\le x&lt;y\\le n,x\\neq y\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mord\">∣</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel\"></span></span><span class=\"fix\"></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">}</span></span></span></span>。你需要重新排列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span></span></span></span> 的元素，满足依次交换 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><msub><mi>x</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">b_{x_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9445399999999999em;vertical-align:-0.2501em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139199999999997em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2501em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>b</mi><msub><mi>y</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">b_{y_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.980548em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3280857142857143em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 后有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">b=a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>。<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个长度为 nnn 的排列 aaa，同时你有一个长度为 nnn 的排列 bi=ib_i=ibi​=i，设 op={(x,y)∣1≤x&lt;y≤n,x≠y}op=\\{(x,y)|1\\le x&lt;y\\le n,x\\neq y\\}op={(x,y)∣1≤x&lt;y≤n,x​=y}。你需要重新排列 bbb 的元素，满足依次交换 bxib_{x_i}bxi​​ 和 byib_{y_i}byi​​ 后有 b=ab=ab=a。 2≤n≤1032\\le n\\le 10^32≤n≤103。 首先有一个结论，交换 bxb_xbx​ 和 byb_yby​（x≠yx\\neq yx​=y）后一定会改变 bbb 的逆序对个数的奇偶性，证明： i&lt;xi&lt;xi&lt;x 和 i&gt;yi&gt;yi&gt;y 的 iii 参与构成的逆序对显然没有影响； x&lt;i&lt;yx&lt;i&lt;yx&lt;i&lt;y 的 iii： 设有 sxsxsx 个 bib_ibi​ 满足 x&lt;i&lt;yx&lt;i&lt;yx&lt;i&lt;y 且 bi&lt;bxb_i&lt;b_xbi​&lt;bx​，有 bxbxbx 个 bib_ibi​ 满足 x&lt;i&lt;yx&lt;i&lt;yx&lt;i&lt;y 且 bi&gt;bxb_i&gt;b_xbi​&gt;bx​； 有 sysysy 个 bib_ibi​ 满足 x&lt;i&lt;yx&lt;i&lt;yx&lt;i&lt;y 且 bi&lt;byb_i&lt;b_ybi​&lt;by​，有 bybyby 个 bib_ibi​ 满足 x&lt;i&lt;yx&lt;i&lt;yx&lt;i&lt;y 且 bi&gt;byb_i&gt;b_ybi​&gt;by​； 那么交换之前 [x,y][x,y][x,y] 中的逆序对个数显然是 bx+sy+[bx&gt;by]bx+sy+[b_x&gt;b_y]bx+sy+[bx​&gt;by​]，交换之后是 sx+by+[bx&lt;by]sx+by+[b_x&lt;b_y]sx+by+[bx​&lt;by​]，由于 sx+bx=sy+bysx+bx=sy+bysx+bx=sy+by 所以 bx+sybx+sybx+sy 和 sx+bysx+bysx+by 奇偶性一样，而 [bx&gt;by]≠[bx&lt;by][b_x&gt;b_y]\\neq [b_x&lt;b_y][bx​&gt;by​]​=[bx​&lt;by​]，所以逆序对个数的奇偶性一定会被改变。 那么 aaa 的逆序对个数的奇偶性和 n(n−1)2\\frac{n(n-1)}{2}2n(n−1)​ 的奇偶性不一样则无解，接下来考虑通过构造来证明其他情况一定有解。 考虑先把所有 bi≠aib_i\\neq a_ibi​​=ai​ 的 iii 通过不断交换满足 bj≠aib_j\\neq a_ibj​​=ai​ 的 bib_ibi​ 和 bjb_jbj​，最后再交换满足 bj=aib_j=a_ibj​=ai​ 的 bib_ibi​ 和 bjb_jbj​，这样就可以消掉 iii，把问题转化为大小为 n−1n-1n−1 的子问题。 那么现在问题就变成了要让进行完所有交换之后 bi=ib_i=ibi​=i。 不难发现，由于逆序对个数（000）和 n(n−1)2\\frac{n(n-1)}{2}2n(n−1)​ 的奇偶性相同，那么此时的 nnn 一定满足 nmod⁡4∈{0,1}n\\operatorname{mod} 4\\in\\{0,1\\}nmod4∈{0,1}，所以考虑不断消掉四个位置来把问题转化为 n−4n-4n−4 的子问题。 考虑这样的过程，其中 ststst 是剩下的位置（不包含 xxx 和 yyy）： inline void slove(int x,int y) { auto p=st.begin(); while(p!=st.end()) swp(x,*p++); swp(x,y); p=st.end(); while(p!=st.begin()) swp(y,*--p); } 不难发现这样就可以把 xxx 和 yyy 消掉且交换 bxb_xbx​ 和 byb_yby​，那么考虑四个位置 x,y,z,wx,y,z,wx,y,z,w，可以这样把它们消掉： st.erase(x); st.erase(y); st.erase(z); st.erase(w); slove(x,y); slove(z,w); swp(x,z),swp(y,w); swp(x,w),swp(y,z); 那么不断执行以上操作，直到 n≤1n\\le 1n≤1 即可。 时间复杂度 O(n2)O(n^2)O(n2)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;set&gt; using namespace std; const int S=1005; struct node { int x,y; }ans[S*S]; int n,a[S],b[S]; int tr[S]; int tot; set&lt;int&gt; st; inline void add(int pos,int x) { for(int i=pos;i&lt;=n;i+=i&amp;-i) tr[i]+=x; } inline int que(int pos) { int res=0; for(int i=pos;i&gt;=1;i-=i&amp;-i) res+=tr[i]; return res; } inline void swp(int x,int y) { swap(b[x],b[y]); ans[++tot]=(node){min(x,y),max(x,y)}; } inline void slove(int x,int y) { auto p=st.begin(); while(p!=st.end()) swp(x,*p++); swp(x,y); p=st.end(); while(p!=st.begin()) swp(y,*--p); } int main() { freopen(&quot;c.in&quot;,&quot;r&quot;,stdin); freopen(&quot;c.out&quot;,&quot;w&quot;,stdout); scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]),b[i]=i; int tmp=n*(n-1)/2&amp;1; for(int i=n;i&gt;=1;i--) tmp^=que(a[i])&amp;1,add(a[i],1); if(tmp!=0) return puts(&quot;NO&quot;),0; else puts(&quot;YES&quot;); for(int i=1;i&lt;=n;i++) st.insert(i); while(1) { int pos=-1; for(int i=1;i&lt;=n;i++) if(b[i]!=a[i]) pos=i; if(pos==-1) break; for(int i=1;i&lt;=n;i++) if(i!=pos&amp;&amp;b[i]!=a[pos]&amp;&amp;st.count(i)) swp(pos,i); for(int i=1;i&lt;=n;i++) { if(b[i]==a[pos]) { swp(pos,i); break; } } st.erase(pos); } while(st.size()&gt;=4) { int x=*st.begin();st.erase(x); int y=*st.begin();st.erase(y); int z=*st.begin();st.erase(z); int w=*st.begin();st.erase(w); slove(x,y); slove(z,w); swp(x,z),swp(y,w); swp(x,w),swp(y,z); } for(int i=1;i&lt;=tot;i++) printf(&quot;%d %d\\n&quot;,ans[i].x,ans[i].y); return 0; } ","tags":[{"name":"构造","slug":"Kb6MJqy9f","used":true,"link":"https://Rebxe.github.io/tag/Kb6MJqy9f/"},{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"}],"title":"【2023NOI模拟赛15】不见不散 做题记录","feature":"","link":"https://Rebxe.github.io/post/2023noi-mo-ni-sai-15-bu-jian-bu-san-zuo-ti-ji-lu/","stats":{"text":"7 min read","time":378000,"words":1192,"minutes":7},"date":"2023-03-24 19:23:58","dateFormat":"2023-03-24"},{"abstract":"","content":"Day -1 虽然 NOIP 压线 1=，但是因为疫情所以参加不了提高组了/kk 只能参加普及组了。 Day 0 登录了一下系统，发现没问题。 尝试暴力破解压缩包密码，但是马上发现密码位数是十几位的，暴力跑要几万年…… 然后调试了一下录屏。 Day 1 洛谷运势大凶…… 一个小时想到了前三题： T1 模拟，但是题目好像没说 A=B=C=0A=B=C=0A=B=C=0 的情况怎么弄，不过测了一下好像没被 hack T2 贪心搞，目标是前缀异或和序列中没有 000 和重复的数字，操作是删掉一个前缀异或和序列中一个不在末尾的数。−1-1−1 的情况即为整个序列疑惑起来结果为 000 T3 二分答案，对于每一个 iii，求出分成最多 iii 个模块的 max⁡\\maxmax 的最小值 mnimn_imni​，然后答案就是 min⁡{i⋅mni}\\min\\{i\\cdot mn_i\\}min{i⋅mni​} T4 卡了好久，结果发现是乱搞题： T4 枚举公差，然后枚举这个公差构成的极长等差数列，然后乱搞。调和级数时间复杂度是 O(nlog⁡n)O(n\\log n)O(nlogn) 预计得分 100+100+100+100=400100+100+100+100=400100+100+100+100=400。 Day 2 T3 出题人 cbddl。 没有大样例的比赛 cbddl。 T1 可行的数 iii 满足 nmod⁡i=0n\\operatorname{mod} i\\not=0nmodi​=0，(n−1)mod⁡i=0(n-1)\\operatorname{mod} i\\not=0(n−1)modi​=0 和 (n−2)mod⁡i=0(n-2)\\operatorname{mod} i\\not=0(n−2)modi​=0，然后根号分解质因数用 set 维护就好 T2 题意奇奇怪怪，反正我写的是 n+叶子个数n+\\text{叶子个数}n+叶子个数 T3 大模拟，淦了 2h+ 才淦出来…… T4 堆优化广搜 最后几分钟才做完，wtcl！ 赛后出 Day 1 成绩了，竟然真的 AK 了。 赛后 T3 好像和别人拍过了？不排除同时错误的可能性…… T4 边界错了。太慌了所以有两个字符 1 写成了 0。 预计得分 100+100+100+0=300100+100+100+0=300100+100+100+0=300。 Day inf 成绩出了： Day 1：100+100+100+100=400 Day 2：100+100+5+100=305 总分：100+100+100+100+100+100+5+100=705 GDOI 普及组不给大样例体验太差了。 出 D2T3 这种垃圾题还省赛？？？没大样例的比赛还叫 OI？？？ cbddl。 2022/4/20 upd: 完了，造数据的时候发现 D1T3 我写的是 O(n2log⁡n)O(n^2\\log n)O(n2logn) 的假做法/qd 竟然过了。 ","tags":[{"name":2022,"slug":"GJvEuJsM-","used":true,"link":"https://Rebxe.github.io/tag/GJvEuJsM-/"},{"name":"GDOI","slug":"m_dUCQqMxF","used":true,"link":"https://Rebxe.github.io/tag/m_dUCQqMxF/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"}],"title":"GDOI 2022 普及组游记","feature":"","link":"https://Rebxe.github.io/post/gdoi-2022-pu-ji-zu-you-ji/","stats":{"text":"3 min read","time":162000,"words":645,"minutes":3},"date":"2023-03-24 12:34:18","dateFormat":"2023-03-24"},{"abstract":"<blockquote>\n<p>给定一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span></span></span></span> 的序列 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span>，有 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，每次询问给定 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mo separator=\"true\">,</mo><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">L,R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">L</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.00773em;\">R</span></span></span></span>，求</p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mi>L</mi></mrow><mi>R</mi></munderover><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mi>l</mi></mrow><mi>R</mi></munderover><mi mathvariant=\"normal\">mex</mi><mo>⁡</mo><mo>(</mo><mo>{</mo><msub><mi>a</mi><mi>l</mi></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mi>a</mi><mrow><mi>l</mi><mo>+</mo><mn>2</mn></mrow></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>r</mi></msub><mo>}</mo><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\sum\\limits_{l=L}^{R}\\sum\\limits_{r=l}^{R} \\operatorname{mex}(\\{a_l,a_{l+1},a_{l+2},\\dots,a_r\\})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.1304490000000005em;vertical-align:-1.302113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283360000000002em;\"><span style=\"top:-1.8478869999999998em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\">L</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.300005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.302113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283360000000002em;\"><span style=\"top:-1.8478869999999998em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mrel mtight\">=</span><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.300005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.00773em;\">R</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.302113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">e</span><span class=\"mord mathrm\">x</span></span><span class=\"mopen\">(</span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">mex</mi><mo>⁡</mo><mo>(</mo><mi>S</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{mex}(S)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">m</span><span class=\"mord mathrm\">e</span><span class=\"mord mathrm\">x</span></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span></span></span></span> 表示 <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 中最小的未出现的非负整数。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>q</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,q\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span>。</p>\n</blockquote>\n","content":" 给定一个长度为 nnn 的序列 aaa，有 qqq 次询问，每次询问给定 L,RL,RL,R，求 ∑l=LR∑r=lRmex⁡({al,al+1,al+2,…,ar})\\sum\\limits_{l=L}^{R}\\sum\\limits_{r=l}^{R} \\operatorname{mex}(\\{a_l,a_{l+1},a_{l+2},\\dots,a_r\\}) l=L∑R​r=l∑R​mex({al​,al+1​,al+2​,…,ar​}) 其中 mex⁡(S)\\operatorname{mex}(S)mex(S) 表示 SSS 中最小的未出现的非负整数。 1≤n,q≤1061\\le n,q\\le 10^61≤n,q≤106。 考虑只有一次询问的时候怎么做，首先 l=1l=1l=1 时每个 [l,r][l,r][l,r] 的 mex⁡\\operatorname{mex}mex 是可以 O(n)O(n)O(n) 预处理的，那么接下来考虑把 lll 往右移，即删掉 ala_lal​ 后每个 [l,r][l,r][l,r] 的 mex⁡\\operatorname{mex}mex。 不如设当前 [l,i][l,i][l,i] 的 mex⁡\\operatorname{mex}mex 为 meime_imei​，那么删除 ala_lal​ 相当于让 me[l+1,nxtl−1]me_{[l+1,nxt_{l}-1]}me[l+1,nxtl​−1]​ 对 ala_lal​ 取 min⁡\\minmin，其中 nxtlnxt_{l}nxtl​ 为 ala_lal​ 下一次出现的位置。 不难发现可以用线段树维护 mememe，由于 mememe 有单调性，所以区间取 min⁡\\minmin 可以通过线段树二分找到 &gt;al&gt;a_l&gt;al​ 的后缀来转换成区间赋值。那么只有一个询问就可以在 O(nlog⁡n)O(n\\log n)O(nlogn) 的时间内解决。 考虑有多个询问的情况，显然一次询问 [L,R][L,R][L,R] 可以拆成 l∈[1,R],r∈[L,R]l\\in[1,R],r\\in[L,R]l∈[1,R],r∈[L,R] 的答案减掉 l∈[1,L−1],r∈[L,R]l\\in[1,L-1],r\\in[L,R]l∈[1,L−1],r∈[L,R] 的答案，那么问题就变成要求 l∈[1,x],r∈[L,R]l\\in[1,x],r\\in[L,R]l∈[1,x],r∈[L,R] 的答案。 考虑把询问离线下来，按照 xxx 升序排序，然后把 lll 从 111 往右移动。这样问题就变成了要求 [L,R][L,R][L,R] 的 mememe 的历史和（每次修改后的值累加的结果，可以看作是在时间维上做前缀和）。 维护历史和有很多种写法，比较通用的是给每个位置维护一个一次函数 k×tme+bk\\times tme+bk×tme+b，其中 tmetmetme 表示当前时间，kkk 存的是上一次修改之后的 meime_imei​。在时间 iii 修改一个位置的 mememe 为 xxx 的时候，设 b′b&#x27;b′ 为新的 bbb，k′k&#x27;k′ 为新的 kkk，那么有： b′=i×(k−x)+bk′=xb&#x27;=i\\times (k-x)+b\\\\ k&#x27;=x b′=i×(k−x)+bk′=x 注意到这个东西只有在区间内每个位置的 kkk 都相等时才可以用区间加快速维护，但是不难发现一个区间改完之后区间内的每个位置的 kkk 就会变成一样的，所以每次修改暴力找到所有区间内 kkk 相等的区间是对的，这样做每一次修改的时间复杂度均摊为 O(log⁡n)O(\\log n)O(logn)，那么总时间复杂度就是 O((n+q)log⁡n)O((n+q)\\log n)O((n+q)logn)。 代码如下： #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;vector&gt; using namespace std; const int S=1000005; struct ask { int l,r,bse,id; }; struct node { long long ks,bs; long long mnk,mxk,tk,tb; }; int IDX; int n,q,a[S]; node tr[S&lt;&lt;2]; vector&lt;ask&gt; vec[S]; bool vis[S]; int b[S],lst[S],nxt[S]; long long ans[S]; inline void upd(int u) { tr[u].ks=tr[u&lt;&lt;1].ks+tr[u&lt;&lt;1|1].ks; tr[u].bs=tr[u&lt;&lt;1].bs+tr[u&lt;&lt;1|1].bs; tr[u].mnk=min(tr[u&lt;&lt;1].mnk,tr[u&lt;&lt;1|1].mnk); tr[u].mxk=max(tr[u&lt;&lt;1].mxk,tr[u&lt;&lt;1|1].mxk); } void build(int u,int l,int r) { if(l==r) return tr[u].ks=tr[u].mnk=tr[u].mxk=b[l],void(); int mid=l+r&gt;&gt;1; build(u&lt;&lt;1,l,mid),build(u&lt;&lt;1|1,mid+1,r); upd(u); } inline void addtag(int u,int l,int r,long long k,long long b) { int siz=r-l+1; tr[u].ks+=k*siz,tr[u].bs+=b*siz; tr[u].mnk+=k,tr[u].mxk+=k; tr[u].tk+=k,tr[u].tb+=b; } inline void dwntag(int u,int l,int r) { if(tr[u].tk==0&amp;&amp;tr[u].tb==0) return; int mid=l+r&gt;&gt;1; addtag(u&lt;&lt;1,l,mid,tr[u].tk,tr[u].tb); addtag(u&lt;&lt;1|1,mid+1,r,tr[u].tk,tr[u].tb); tr[u].tk=tr[u].tb=0; } int quepos(int u,int l,int r,int L,int R,long long k) { if(l&gt;R||r&lt;L||tr[u].mxk&lt;=k) return -1; if(l==r) return l; dwntag(u,l,r); int mid=l+r&gt;&gt;1; if(L&lt;=mid&amp;&amp;tr[u&lt;&lt;1].mxk&gt;k) return quepos(u&lt;&lt;1,l,mid,L,R,k); return quepos(u&lt;&lt;1|1,mid+1,r,L,R,k); } void upda(int u,int l,int r,int L,int R,int tme,long long k) { if(l&gt;R||r&lt;L) return; if(l&gt;=L&amp;&amp;r&lt;=R&amp;&amp;tr[u].mxk==tr[u].mnk) { int len=r-l+1; addtag(u,l,r,k-tr[u].mxk,tme*(tr[u].mxk-k)); return; } dwntag(u,l,r); int mid=l+r&gt;&gt;1; if(L&lt;=mid) upda(u&lt;&lt;1,l,mid,L,R,tme,k); if(R&gt;=mid+1) upda(u&lt;&lt;1|1,mid+1,r,L,R,tme,k); upd(u); } long long quer(int u,int l,int r,int L,int R,int x) { if(l&gt;R||r&lt;L) return 0; if(l&gt;=L&amp;&amp;r&lt;=R) return 1ll*tr[u].ks*x+tr[u].bs; dwntag(u,l,r); int mid=l+r&gt;&gt;1; long long res=0; if(L&lt;=mid) res+=quer(u&lt;&lt;1,l,mid,L,R,x); if(R&gt;=mid+1) res+=quer(u&lt;&lt;1|1,mid+1,r,L,R,x); return res; } int main() { scanf(&quot;%d&quot;,&amp;IDX); scanf(&quot;%d&quot;,&amp;n); for(int i=1;i&lt;=n;i++) scanf(&quot;%d&quot;,&amp;a[i]),a[i]=min(a[i],n+1); scanf(&quot;%d&quot;,&amp;q); for(int i=1;i&lt;=q;i++) { int l,r; scanf(&quot;%d%d&quot;,&amp;l,&amp;r); vec[r].push_back((ask){l,r,1,i}); if(l&gt;1) vec[l-1].push_back((ask){l,r,-1,i}); } for(int i=1,p=0;i&lt;=n;i++) { vis[a[i]]=true; while(vis[p]) p++; b[i]=p; } build(1,1,n); for(int i=0;i&lt;=n+1;i++) lst[i]=n+1; for(int i=n;i&gt;=1;i--) { nxt[i]=lst[a[i]]; lst[a[i]]=i; } for(int i=1;i&lt;=n;i++) { for(ask u:vec[i]) { ans[u.id]+=u.bse*quer(1,1,n,u.l,u.r,i); } int lb=i+1,rb=nxt[i]-1; if(lb&lt;=rb) { int pos=quepos(1,1,n,lb,rb,a[i]); if(pos!=-1) upda(1,1,n,pos,rb,i,a[i]); } upda(1,1,n,i,i,i,0); } for(int i=1;i&lt;=q;i++) printf(&quot;%lld\\n&quot;,ans[i]); return 0; } ","tags":[{"name":"做题记录","slug":"9Q1f-EwaH","used":true,"link":"https://Rebxe.github.io/tag/9Q1f-EwaH/"},{"name":"数据结构","slug":"8ldJi7oB4","used":true,"link":"https://Rebxe.github.io/tag/8ldJi7oB4/"}],"title":"【2022NOI模拟赛01】漏网之鱼 做题记录","feature":"","link":"https://Rebxe.github.io/post/2022noi-mo-ni-sai-01-lou-wang-zhi-yu-zuo-ti-ji-lu/","stats":{"text":"9 min read","time":510000,"words":1580,"minutes":9},"date":"2023-03-21 19:05:00","dateFormat":"2023-03-21"},{"abstract":"","content":" T1 好水，埃氏筛模板，切了/cy T2 smg 啊……打了个状压 dp 骗了 50 pts（后来发现数组开小了痛失 30 pts /ll） T3 乱搞了一个卡时 dfs /ll T4 瞎弄了一个 bfs，好在除了最后一个大样例其它都过了 期望得分：100+50+[0,12]+[0,32]=[150,194] luogu：100+20+12+28=160 小秃驴：100+40+16+32=188 真实成绩：100+20+12+24=156 2021-12-3 1= 分数线 155，压线 1= /fad ","tags":[{"name":"NOIP","slug":"rs_nI3vFV","used":true,"link":"https://Rebxe.github.io/tag/rs_nI3vFV/"},{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"},{"name":2021,"slug":"W1pmcP3ls8","used":true,"link":"https://Rebxe.github.io/tag/W1pmcP3ls8/"}],"title":"NOIP 2021 游记","feature":"","link":"https://Rebxe.github.io/post/noip-2021-you-ji/","stats":{"text":"1 min read","time":31000,"words":118,"minutes":1},"date":"2023-03-21 15:14:35","dateFormat":"2023-03-21"},{"abstract":"","content":"初赛 早上的 tg 四毛子算法是给人做的嘛，还有 base64 也很恶心…… 下午的 pj 怎么还有 base64…… 早上去的时候和两位奆佬一起拼车真快乐 估分： tg: 63 pj: 85 实际： tg: 62 pj: 85 相差不算太大，都过了 awa 复赛 早上的 PJ T1 好水，8 min 左右切了 T2 想了快 15 min 发现可以用离散化+值域树状数组做，当时也是 nt 没看到 1 操作有次数限制，打了大概 30 min 切掉了 T3 有点恶心，各种细节卡了快 50 min /kk T4 发现可以用链表，20 min 打好然后测了下极端数据发现没 TLE 就放心了 后面有快一个小时都在摸鱼+睡觉 /fad 下午的 TG T1 是平衡树，但是不会打 /kk，只拿了 40 pts 暴力分 T2 写了个样例都过不去的 dp /ll T3 完全不会，骗了点部分分就爬了 /ll T4 直接输出样例的 /ll 感觉 tg 无了/kk/kk/kk 估分： pj: 100+100+100+100=400 tg: 40+0+28+0=68 实际 pj: 100+100+100+100=400 tg: 100+0+36+0=136 好耶，是蓝勾勾！ ","tags":[{"name":"游记","slug":"n5pznK7k4","used":true,"link":"https://Rebxe.github.io/tag/n5pznK7k4/"},{"name":2021,"slug":"W1pmcP3ls8","used":true,"link":"https://Rebxe.github.io/tag/W1pmcP3ls8/"},{"name":"CSP","slug":"hWQ-FoFtNl","used":true,"link":"https://Rebxe.github.io/tag/hWQ-FoFtNl/"}],"title":"CSP 2021 游记","feature":"","link":"https://Rebxe.github.io/post/csp-2021-you-ji/","stats":{"text":"2 min read","time":71000,"words":295,"minutes":2},"date":"2023-03-21 09:52:42","dateFormat":"2023-03-21"}]}